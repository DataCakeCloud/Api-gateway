(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-6b124136"],{"0254":function(t,e,n){"use strict";n("3d88")},"0aae":function(t,e,n){},"300a":function(t,e,n){"use strict";n("a9ea")},"3b59":function(t,e,n){t.exports=n.p+"static/img/offset_tips.5be1bb3c.png"},"3cb3":function(t,e,n){"use strict";n("0aae")},"3d88":function(t,e,n){},"80e6":function(t,e,n){"use strict";n("8f07")},"8f07":function(t,e,n){},a9ea:function(t,e,n){},b199:function(t,e,n){"use strict";n.d(e,"y",(function(){return o})),n.d(e,"W",(function(){return i})),n.d(e,"E",(function(){return s})),n.d(e,"p",(function(){return l})),n.d(e,"ab",(function(){return c})),n.d(e,"s",(function(){return u})),n.d(e,"r",(function(){return m})),n.d(e,"t",(function(){return d})),n.d(e,"Q",(function(){return f})),n.d(e,"T",(function(){return p})),n.d(e,"A",(function(){return b})),n.d(e,"O",(function(){return g})),n.d(e,"B",(function(){return h})),n.d(e,"q",(function(){return v})),n.d(e,"e",(function(){return _})),n.d(e,"g",(function(){return y})),n.d(e,"d",(function(){return k})),n.d(e,"ib",(function(){return F})),n.d(e,"n",(function(){return w})),n.d(e,"Y",(function(){return C})),n.d(e,"I",(function(){return T})),n.d(e,"H",(function(){return S})),n.d(e,"c",(function(){return O})),n.d(e,"hb",(function(){return L})),n.d(e,"m",(function(){return x})),n.d(e,"j",(function(){return j})),n.d(e,"f",(function(){return I})),n.d(e,"bb",(function(){return P})),n.d(e,"J",(function(){return D})),n.d(e,"F",(function(){return $})),n.d(e,"h",(function(){return A})),n.d(e,"db",(function(){return R})),n.d(e,"z",(function(){return N})),n.d(e,"R",(function(){return E})),n.d(e,"u",(function(){return V})),n.d(e,"D",(function(){return q})),n.d(e,"P",(function(){return z})),n.d(e,"w",(function(){return K})),n.d(e,"Z",(function(){return B})),n.d(e,"C",(function(){return J})),n.d(e,"eb",(function(){return M})),n.d(e,"a",(function(){return G})),n.d(e,"fb",(function(){return W})),n.d(e,"cb",(function(){return H})),n.d(e,"G",(function(){return U})),n.d(e,"U",(function(){return Y})),n.d(e,"i",(function(){return Q})),n.d(e,"k",(function(){return X})),n.d(e,"K",(function(){return Z})),n.d(e,"L",(function(){return tt})),n.d(e,"N",(function(){return et})),n.d(e,"M",(function(){return nt})),n.d(e,"b",(function(){return at})),n.d(e,"l",(function(){return rt})),n.d(e,"o",(function(){return ot})),n.d(e,"S",(function(){return it})),n.d(e,"gb",(function(){return st})),n.d(e,"X",(function(){return lt})),n.d(e,"v",(function(){return ct})),n.d(e,"V",(function(){return ut}));var a=n("7258"),r="/ds_task/task";function o(t){return a["b"].post("/ds_task/metadata/search",t,{timeout:12e4})}function i(){return a["b"].get("/ds_task/sysdict/getTemplateList")}function s(t){return a["b"].get("/ds_task/dict/list",{params:t})}function l(t){return a["b"].get("/ds_task/artifact/list",{params:t})}function c(t){return a["b"].get("/ds_task/artifactversion/list",{params:t})}function u(t){return a["b"].get("/ds_task/flinkcluster/list",{params:t})}function m(t){return a["b"].get("/ds_task/flinkcluster/auto",{params:t})}function d(t){return a["b"].get("/ds_task/flinkcluster/noauto",{params:t})}function f(t){return a["b"].get("".concat(r,"/get"),{params:t})}function p(t){return a["b"].get("".concat(r,"/page"),{params:t,timeout:6e4})}function b(t){return a["b"].post("/ds_task/metadata/getddl",t)}function g(t){return a["b"].get("".concat(r,"/getInsertSql"),{params:t,timeout:6e5})}function h(t){return a["b"].post("/ds_task/metadata/getdispalyddl",t)}function v(t){return a["b"].get("".concat(r,"/getChildDependencies"),{params:{id:t}})}function _(t){return a["b"].get("".concat(r,"/backfill"),{params:t})}function y(t){return a["b"].put("".concat(r,"/onlineAndOffline"),null,{params:t})}function k(t){return a["b"].post("".concat(r,"/add"),t)}function F(t){return a["b"].put("".concat(r,"/update"),t)}function w(t){return a["b"].delete("".concat(r,"/new/delete"),{params:t})}function C(t){return a["b"].get("/ds_task/user/list",{params:{name:t}})}function T(t){return a["b"].get("/ds_task/label/list",{params:{name:t}})}function S(t){return a["b"].get("/ds_task/label/get",{params:{id:t}})}function O(t){return a["b"].post("/ds_task/label/add",t)}function L(t){return a["b"].put("/ds_task/label/update",t)}function x(t){return a["b"].delete("/ds_task/label/delete",{params:{id:t}})}function j(t){return a["b"].patch("/ds_task/collect/add",null,{params:t})}function I(t){return a["b"].get("/ds_task/collect/cancel",{params:t})}function P(t){return a["b"].get("/ds_task/collect/my",{params:t})}function D(t){return a["b"].get("/ds_task/task/listforlabel",{params:{name:t}})}function $(t){return a["b"].get("/ds_task/task/iam",{params:t})}function A(t){return a["b"].post("/ds_task/task/check",t,{timeout:18e4})}function R(t){return a["b"].get("/ds_task/task/name/search",{params:{name:t}})}function N(t){return a["b"].get("/ds_task/task/backfillDateDetail",{params:t})}function E(t){return a["b"].get("/ds_task/task/last7",{params:t})}function V(t){return a["b"].get("/ds_task/user/getEffectiveCostList",{params:{name:t}})}function q(t){return a["b"].get("/ds_task/task/getGitSqlFile",{params:t})}function z(t){return a["b"].post("/ds_task/task/sqlTbls",t,{headers:{"Content-Type":"multipart/form-data"}})}function K(t){return a["b"].post("/ds_task/task/getCrontab",t)}function B(t){return a["b"].get("/ds_task/taskversion/pages",{params:t})}function J(){return a["b"].get("/ds_task/auditlog/type?module=task")}function M(t){return a["b"].get("/ds_task/taskversion/verionSwitch",{params:t})}function G(t){return a["b"].post("/ds_task/task/addAndStart",t)}function W(t){return a["b"].post("/ds_task/task/updateAndStart",t)}function H(t){return a["b"].post("/ds_task/task/date/preview",t)}function U(t){return a["b"].post("/ds_task/task/mergeSmallFiles/jars",t)}function Y(t){return a["b"].post("/ds_task/task/getTasks",t)}function Q(t){return a["b"].post("/ds_task/task/checkPath",t,{headers:{"Content-Type":"multipart/form-data"}})}function X(t){return a["b"].post("/ds_task/task/fastBackfill?taskId="+t.taskId,t)}function Z(t){return a["b"].get("/ds_task/task/renderContent",{params:t})}function tt(t){return a["b"].post("/ds_task/metadata/preview",t)}function et(t){return a["b"].get("/ds_task/actor/sources/page",{params:t})}function nt(t){return a["b"].get("/ds_task/taskfolder/listFolder",{params:t})}function at(t){return a["b"].post("/ds_task/taskfolder/saveFolder",t)}function rt(t){return a["b"].get("/ds_task/taskfolder/deleteFolder",{params:t})}function ot(t){return a["b"].post("/ds_task/taskfolder/editFolder",t)}function it(t){return a["b"].get("/ds_task/taskfolder/listTask",{params:t})}function st(t){return a["b"].post("/ds_task/taskfolder/updateTask",t)}function lt(t){return a["b"].get("/ds_task/wechatAlert/listById?id=".concat(t))}function ct(t){return a["b"].post("/pipeline/cron/get",t)}function ut(t){return a["b"].get("/ds_task/task/templateRendering",{params:t})}},b207:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return o}));var a=n("7258");function r(t){return a["b"].get("/ds_task/validator/item/list?templateCode="+t)}function o(t,e){return a["b"].post("/ds_task/validator/check?templateCode="+t,e)}},c927:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"step2",class:"task"===t.source?"taskStep2":""},[n("steps-head",{attrs:{active:t.currentStep,source:t.source,direction:"task"===t.source?"vertical":"horizontal"},on:{handelStep:t.handelStep}}),t._v(" "),n("div",{staticClass:"step-content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:1===t.currentStep,expression:"currentStep === 1"}]},[n("el-button",{staticClass:"open-btn",attrs:{type:"primary"},on:{click:function(e){t.drawerVisible=!0}}},[t._v("高级设置")]),t._v(" "),n("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:t.configForm,rules:t.rules,"label-width":"180px"}},[n("form-head",{attrs:{"config-form":t.configForm}}),t._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("form-left",{ref:"formLeft",attrs:{"template-code":t.ruleForm.templateCode,"config-form":t.configForm},on:{"get-columns":t.getColumns}})],1),t._v(" "),n("el-col",{attrs:{span:12}},[n("form-right",{attrs:{"template-code":t.ruleForm.templateCode,"config-form":t.configForm}})],1)],1)],1),t._v(" "),n("table-mapping",{attrs:{"right-columns":t.tableObj.rightColumns,"table-obj":t.tableObj},on:{refreshTable:t.getColumns}})],1),t._v(" "),n("el-drawer",{attrs:{title:"高级设置",visible:t.drawerVisible,"append-to-body":!0,"with-header":!1,direction:"rtl"},on:{"update:visible":function(e){t.drawerVisible=e}}},[n("senior-form",{ref:"seniorForm",attrs:{"senior-form":t.seniorForm},on:{close:function(e){t.drawerVisible=!1}}})],1),t._v(" "),2===t.currentStep?n("step-three",{ref:"stepThree",attrs:{"current-step":t.currentStep,"senior-form":t.seniorForm,"is-workflow":t.isWorkflow,"name-disabled":!0,"is-show-input-check":!0,"is-show-output-check":!0,"rule-form":t.ruleForm}}):t._e(),t._v(" "),3===t.currentStep?n("view-params",{attrs:{info:t.info,"region-list":t.regionList,"is-workflow":t.isWorkflow,"name-disabled":t.nameDisabled,"is-show-input-check":!0,"is-show-output-check":!0},on:{jumpStep:function(e){return t.currentStep=e}}}):t._e()],1),t._v(" "),n("div",{staticClass:"btn-wrap"},[n("el-button",{on:{click:function(e){return t.$emit("cancel")}}},[t._v("取消")]),t._v(" "),t.isShowPublish||!t.isShowPublish&&1!==t.currentStep?n("el-button",{on:{click:t.preStep}},[t._v("上一步")]):t._e(),t._v(" "),n("el-button",{attrs:{type:"primary",disabled:t.tableObj.dragLoading||!t.canEdit&&("task"===t.source&&3===t.currentStep||"task"!==t.source&&2===t.currentStep)},on:{click:t.nextStep}},[t._v(t._s("task"===t.source&&3!==t.currentStep||1===t.currentStep?"下一步":t.copyId?"确认复制":"保存"))]),t._v(" "),t.isShowPublish&&t.currentStep>=3?n("el-checkbox",{staticClass:"task-checkbox",model:{value:t.ruleForm.invokingStatus,callback:function(e){t.$set(t.ruleForm,"invokingStatus",e)},expression:"ruleForm.invokingStatus"}},[t._v("切换至该版本")]):t._e()],1),t._v(" "),n("valid-params",{ref:"validParams",attrs:{code:t.ruleForm.templateCode},on:{save:function(e){t.$emit("save",e)}}})],1)},r=[],o=n("2dfe"),i=n("9caf"),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"form-head"},[n("el-form-item",{attrs:{label:"数据源类型",prop:"sourceType"}},[n("el-select",{staticClass:"area-select",attrs:{placeholder:"请选择数据源",clearable:""},on:{change:t.changeType},model:{value:t.configForm.sourceType,callback:function(e){t.$set(t.configForm,"sourceType",e)},expression:"configForm.sourceType"}},t._l(t.dataOriginList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)},l=[],c={name:"FormHead",props:{configForm:{type:Object,default:function(){return{}}}},data:function(){return{dataOriginList:[{label:"OSS",value:"oss"},{label:"S3",value:"s3"}]}},methods:{changeType:function(){this.configForm.sourceId="",this.configForm.sourceParam={}}}},u=c,m=(n("3cb3"),n("2877")),d=Object(m["a"])(u,s,l,!1,null,"7e290cf4",null),f=d.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-tabs",{staticClass:"form-left"},[a("el-tab-pane",{attrs:{label:"选择来源"}},[a("el-form-item",{staticClass:"quick-item",attrs:{label:"数据源名称",prop:"sourceId"}},[a("el-select",{attrs:{placeholder:"数据源名称",filterable:"",clearable:""},model:{value:t.configForm.sourceId,callback:function(e){t.$set(t.configForm,"sourceId",e)},expression:"configForm.sourceId"}},t._l(t.dataSourceList,(function(t){return a("el-option",{key:t.actorId,attrs:{label:t.name,value:t.actorId}})})),1),t._v(" "),a("div",{staticClass:"quick-action"},[a("el-button",{staticClass:"btn-text",attrs:{type:"text",size:"mini"},on:{click:function(e){return t.$router.push({name:"sourceInstance"})}}},[t._v("新建数据源")])],1),t._v(" "),"File2Lakehouse"===t.templateCode?a("i",{staticClass:"el-icon-info path-info",on:{click:function(e){t.infoVisible=!t.infoVisible}}}):t._e()],1),t._v(" "),a("vue-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"vue-form",attrs:{schema:t.schema,"form-props":t.formProps},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.formData,r=e.formRefFn;return a("div",{staticStyle:{"margin-left":"180px","margin-top":"-6px"}},[Object.keys(t.schema).length?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.getField(n,r)}}},[t._v("获取源表字段")]):t._e()],1)}}]),model:{value:t.configForm.sourceParam,callback:function(e){t.$set(t.configForm,"sourceParam",e)},expression:"configForm.sourceParam"}})],1),t._v(" "),a("el-info",{attrs:{title:"文件路径"},model:{value:t.infoVisible,callback:function(e){t.infoVisible=e},expression:"infoVisible"}},[a("div",[t._v("对于要同步的文件路径可以是目录或文件：")]),t._v(" "),a("div",[t._v("1）同步一个目录：")]),t._v(" "),a("div",[t._v("\n      如果这个目录是动态的，则在指定目录时可使用包含jinjia表达式的动态表达式，例如“s3://桶/路径/dt={ (execution_date-macros.timedelta(days=2)).strftime('%Y%m%d')}/”（末尾别忘了加上\"/\"）；同时，也可以在jinjia表达式的基础上，在目录/文件的路径中包含通配符，例如：s3://桶/路径/country=*/{\n      (execution_date-macros.timedelta(days=1)).strftime('%Y%m%d')}.csv；\n    ")]),t._v(" "),a("div",[t._v('如果这个目录是静态的，则直接指定具体目录，如："s3://桶/路径/xxxx/"，按周期全量同步该静态目录下的全部文件；')]),t._v(" "),a("div",[t._v("2）同步一个文件：")]),t._v(" "),a("div",[t._v("如果是需要周期同步一个动态文件，则可以指定一个包含jinjia表达式的文件路径，例如，“s3://桶/路径/xx_{execution_date}.csv”；")]),t._v(" "),a("div",[t._v("如果是需要周期同步一个静态文件(文件名不变，文件内容可能变化)，则可以指定一个具体的文件路径，例如：“s3://桶/路径/xxxx.csv”；")]),t._v(" "),a("div",[t._v("注：其他文件格式亦同；")]),t._v(" "),a("div",[t._v("支持的常见通配符如下：")]),t._v(" "),a("img",{attrs:{src:n("d92a"),width:"100%"}})])],1)},b=[],g=n("7b46"),h=n("b199"),v={name:"FormLeft",components:{VueForm:g["a"]},props:{configForm:{type:Object,default:function(){return{}}},templateCode:{type:String,default:""}},data:function(){return{dataSourceList:[],loading:!1,schema:{},formProps:{labelPosition:"right",labelWidth:"180px",labelSuffix:" "},infoVisible:!1}},watch:{"configForm.sourceType":function(t){this.changeType(t)},"configForm.sourceId":function(t){var e=this;t&&this.dataSourceList.forEach((function(n){n.actorId===t&&(e.configForm.userGroupName=n.userGroupName,e.getLocation())}))}},methods:{changeType:function(t){t?(this.getSourceList(t),this.getSchema(t)):(this.dataSourceList=[],this.schema={})},getLocation:function(){var t="";this.configForm.partitions.map((function(e){e.name&&(t+=e.name+"="+e.value+"/")})),t=t.substring(0,t.length-1),this.configForm.taskParam.location="/stage/".concat(this.configForm.userGroupName,"/").concat(this.configForm.targetTable,"/").concat(t)},getSourceList:function(t){var e=this;Object(h["y"])({region:this.configForm.sourceRegion,type:t,metaFlag:"AIRBYTE",templateCode:this.templateCode}).then((function(t){var n=t.data;e.dataSourceList=n.data}))},getSchema:function(t){var e=this;this.loading=!0,Object(h["V"])({modelName:t,modelType:"model"}).then((function(t){var n=t.data;if(n){var a=JSON.parse(n);e.schema=a||{}}else e.schema={}})).finally((function(){e.loading=!1}))},getField:function(t,e){var n=this,a=e();a.validate((function(t){t&&n.$emit("get-columns")}))}}},_=v,y=(n("0254"),Object(m["a"])(_,p,b,!1,null,"6b09c206",null)),k=y.exports,F=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-tabs",{staticClass:"form-right"},[n("el-tab-pane",[n("span",{attrs:{slot:"label"},slot:"label"},[t._v("\n      选择目标\n      "),n("el-popover",{attrs:{placement:"bottom",width:"500",trigger:"hover"}},[n("div",[t._v("\n          1）下游目标表如果已经存在（包含表结构），则必须保证所选择的目标表结构涵盖上游表中的字段；"),n("br"),t._v('\n          2）下游目标表如果不存在，则此处支持由用户自定义输入表名，输入后，后台将根据此库表+"字段转换映射"处的“目标表”信息去创建目标表；\n        ')]),t._v(" "),n("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])],1),t._v(" "),n("el-form-item",{attrs:{label:"数据源名称",prop:"destinationId"}},[n("el-select",{attrs:{placeholder:"数据源名称",filterable:"",clearable:""},model:{value:t.configForm.destinationId,callback:function(e){t.$set(t.configForm,"destinationId",e)},expression:"configForm.destinationId"}},t._l(t.destinationList,(function(t){return n("el-option",{key:t.sourceId,attrs:{label:t.name,value:t.sourceId}})})),1)],1),t._v(" "),n("el-form-item",{attrs:{label:"LakeHouse库名",prop:"targetDb"}},[n("el-select",{ref:"dbSelect",attrs:{disabled:"",placeholder:"选择数据库名称","no-match-text":" ","default-first-option":"",filterable:"",clearable:""},model:{value:t.configForm.targetDb,callback:function(e){t.$set(t.configForm,"targetDb",e)},expression:"configForm.targetDb"}},[t._l(t.targetDbList,(function(t){return n("el-option",{key:t.name,attrs:{label:t.name,value:t.name}},[n("ellipsis-tooltip",{attrs:{text:t.name}})],1)})),t._v(" "),n("div",{staticClass:"dy-box dy-box-less"}),t._v(" "),n("div",{staticClass:"dy-box"},[n("div",[n("el-button",{attrs:{type:"text"}},[t._v("+没找到？请联系admin或到元数据页面建库")])],1)])],2)],1),t._v(" "),n("el-form-item",{attrs:{label:"LakeHouse表名",prop:"targetTable"}},[n("el-input",{attrs:{placeholder:"请输入表名"},on:{blur:t.getLocation},model:{value:t.configForm.targetTable,callback:function(e){t.$set(t.configForm,"targetTable",e)},expression:"configForm.targetTable"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"分区标识"},scopedSlots:t._u([{key:"label",fn:function(){return[n("span",[t._v("分区标识")]),t._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"此字段标识了目标表是否每天保存一个全量数据，如果填写了分区字段，则每天往指定的分区字段中写入全量数据；否则，只保留最新一个全量数据",placement:"top"}},[n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"}})])]},proxy:!0}])},[t._v(" "),t._l(t.configForm.partitions,(function(e,a){return n("div",{key:a,staticClass:"partitions_item"},[n("el-input",{staticClass:"name",attrs:{placeholder:"分区名称",clearable:""},on:{change:t.changePartition},model:{value:e.name,callback:function(n){t.$set(e,"name",n)},expression:"item.name"}}),t._v(" "),n("span",{staticClass:"mark"},[t._v("=")]),t._v(" "),n("el-input",{staticClass:"value",attrs:{placeholder:"分区内容",clearable:""},on:{change:t.changePartition},model:{value:e.value,callback:function(n){t.$set(e,"value",n)},expression:"item.value"}}),t._v(" "),t.configForm.partitions.length>1?n("i",{staticClass:"el-icon-delete",on:{click:function(e){return t.deletePartitions(a)}}}):t._e(),t._v(" "),a===t.configForm.partitions.length-1&&t.configForm.partitions.length<3?n("i",{staticClass:"el-icon-plus",class:{onlyAdd:1===t.configForm.partitions.length},on:{click:t.addPartitions}}):t._e()],1)})),t._v(" "),n("span",{staticClass:"tips partitions-tips",on:{click:function(e){t.infoVisible=!0}}},[t._v("参数提示")])],2),t._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"表描述"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.configForm.taskParam.tableComment,placement:"top"}},[n("el-input",{attrs:{placeholder:"请输入表描述"},model:{value:t.configForm.taskParam.tableComment,callback:function(e){t.$set(t.configForm.taskParam,"tableComment",e)},expression:"configForm.taskParam.tableComment"}})],1)],1),t._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"安全级别"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.configForm.taskParam.tableLevel,placement:"top"}},[n("el-select",{attrs:{placeholder:"请选择安全级别"},model:{value:t.configForm.taskParam.tableLevel,callback:function(e){t.$set(t.configForm.taskParam,"tableLevel",e)},expression:"configForm.taskParam.tableLevel"}},t._l(t.securityList,(function(t){return n("el-option",{key:t,attrs:{value:t,label:t}})})),1)],1)],1),t._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"Location"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.configForm.taskParam.location,placement:"top"}},[n("el-input",{attrs:{placeholder:"请输入Location"},model:{value:t.configForm.taskParam.location,callback:function(e){t.$set(t.configForm.taskParam,"location",e)},expression:"configForm.taskParam.location"}})],1)],1)],1),t._v(" "),n("el-info",{attrs:{title:"参数提示"},model:{value:t.infoVisible,callback:function(e){t.infoVisible=e},expression:"infoVisible"}},[n("sql-tips")],1)],1)},w=[],C=n("deac"),T=n("3941"),S={name:"FormRight",components:{SqlTips:C["a"],EllipsisTooltip:T["a"]},props:{configForm:{type:Object,default:function(){return{}}},templateCode:{type:String,default:""}},data:function(){return{infoVisible:!1,destinationList:[],targetDbList:[],securityList:["1级","2级","3级","4级"]}},watch:{"configForm.sourceRegion":function(t){t&&this.getDestinationId()}},methods:{changePartition:function(){this.getLocation()},getDestinationId:function(){var t=this,e={pageNum:1,pageSize:10,sourceName:"iceberg",region:this.configForm.sourceRegion,sortKey:"createTime",sortOrder:"desc"};Object(h["N"])(e).then((function(e){t.destinationList=e.data.list,t.configForm.destinationId||(t.configForm.destinationId=t.destinationList[0].sourceId)}))},getTargetDbList:function(){var t=this;Object(h["y"])({region:this.configForm.sourceRegion,type:"hive",metaFlag:"AIRBYTE",templateCode:this.templateCode}).then((function(e){var n=e.data;t.targetDbList=n.data}))},getLocation:function(){var t="";this.configForm.partitions.map((function(e){e.name&&(t+=e.name+"="+e.value+"/")})),t=t.substring(0,t.length-1),this.configForm.taskParam.location="/stage/".concat(this.configForm.userGroupName,"/").concat(this.configForm.targetTable,"/").concat(t)},addPartitions:function(){this.configForm.partitions.push({value:"",name:""})},deletePartitions:function(t){this.configForm.partitions.splice(t,1)}}},O=S,L=(n("300a"),Object(m["a"])(O,F,w,!1,null,"eadd9426",null)),x=L.exports,j=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-tabs",[n("el-tab-pane",{staticClass:"trans_table",attrs:{label:"字段映射"}},[n("el-row",{staticClass:"tab_content"},[n("el-col",{attrs:{span:13}},[n("div",{staticClass:"mb10"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.showLeftAdd=!0}}},[t._v("添加")]),t._v(" "),n("el-select",{directives:[{name:"show",rawName:"v-show",value:t.showLeftAdd,expression:"showLeftAdd"}],attrs:{placeholder:"在当前选中表中选择字段",size:"mini"},on:{change:t.addLeftItem},model:{value:t.leftAddItem,callback:function(e){t.leftAddItem=e},expression:"leftAddItem"}},t._l(t.leftAddList,(function(t){return n("el-option",{key:t.name,attrs:{value:t,label:t.name+"("+t.data_type+")"}})})),1),t._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.refresh}},[t._v("刷新源表字段")])],1),t._v(" "),t.showLeftTable?n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableObj.tableLeftLoading,expression:"tableObj.tableLeftLoading"}],key:"leftTableKey",ref:"leftTableRef",staticStyle:{"font-size":"13px"},attrs:{data:t.tableObj.leftColumns,"row-key":"id",stripe:"","row-style":{height:"45px"}}},[n("el-table-column",{attrs:{type:"index",label:"序号",width:"80",align:"center"},scopedSlots:t._u([{key:"header",fn:function(){return[t._v("\n                序号\n                "),n("el-popover",{attrs:{trigger:"hover",placement:"bottom","popper-class":"tag-popper"}},[t._v("\n                  拖动列头图标可进行手动排序\n                  "),n("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])]},proxy:!0},{key:"default",fn:function(e){return[n("i",{staticClass:"el-icon-s-operation cursor-move",staticStyle:{color:"#c0c4cc"}}),t._v(" "+t._s(e.$index+1)+" ")]}}],null,!1,925110662)}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"源字段名称","min-width":"120",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-tooltip",{attrs:{content:e.row.name,disabled:t.isTipDisabled}},[n("div",{staticClass:"name-box"},[t.tableObj.isLeftEdit?n("el-input",{attrs:{size:"mini",placeholder:"字段名称"},on:{blur:function(n){return t.changeName(e.row.name,e.$index)}},model:{value:e.row.name,callback:function(n){t.$set(e.row,"name",n)},expression:"scope.row.name"}}):n("span",{staticClass:"ellipsis block name-item",on:{mouseenter:t.isShowTooltip}},[t._v("\n                      "+t._s(e.row.name||"-")+"\n                    ")]),t._v(" "),n("span",{staticStyle:{color:"red"}},[t._v(t._s(e.row.isPK?"(PK)":""))])],1)])]}}],null,!1,2667815969)}),t._v(" "),n("el-table-column",{attrs:{prop:"data_type",label:"字段类型",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isLeftEdit?n("el-select",{attrs:{placeholder:"请选择字段类型",size:"mini",clearable:""},on:{change:function(n){return t.changeType(e.$index,e.row.columnType)}},model:{value:e.row.data_type,callback:function(n){t.$set(e.row,"data_type",n)},expression:"scope.row.data_type"}},t._l(t.typeList,(function(t){return n("el-option",{key:t,attrs:{value:t,label:t}})})),1):n("span",[t._v(t._s(e.row.data_type))])]}}],null,!1,3864146720)}),t._v(" "),n("el-table-column",{attrs:{label:"字段描述","min-width":"100",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isLeftEdit?n("el-input",{attrs:{size:"mini",placeholder:"字段描述"},model:{value:e.row.comment,callback:function(n){t.$set(e.row,"comment",n)},expression:"scope.row.comment"}}):n("span",[t._v(t._s(e.row.comment))])]}}],null,!1,2486336349)}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"70",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.delData(e.row,e.$index)}}},[t._v("删除")])]}}],null,!1,212596410)}),t._v(" "),n("el-table-column",{attrs:{prop:"funcs","min-width":"100",align:"center","class-name":"table-func"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.$index<t.tableObj.rightColumns.length&&e.$index<t.tableObj.leftColumns.length?n("el-popover",{attrs:{trigger:"hover",placement:"bottom","popper-class":"tag-popper",disabled:t.funDisabled}},[e.row.funcs&&e.row.funcs.length>0?n("div",[n("span",{staticClass:"func-span"},[t._v("函数名")]),t._v(" "),n("span",{staticClass:"func-span"},[t._v("参数")]),t._v(" "),t._l(e.row.funcs,(function(e,a){return n("div",{key:a},[n("span",{staticClass:"func-span"},[t._v(t._s(e.funcName))]),t._v(" "),n("span",{staticClass:"func-span"},[t._v(t._s(e.funcParams.join(",")))])])}))],2):n("div",[t._v("添加转换函数")]),t._v(" "),n("template",{slot:"reference"},[n("func-icon",{nativeOn:{click:function(n){return t.clickFunc(e.row,e.$index)}}}),t._v(" "),e.row.funcs&&e.row.funcs.length>0?n("div",{staticClass:"func-num"},[t._v(t._s(e.row.funcs.length))]):t._e(),t._v(" "),"success"===e.row.state?n("span",{staticClass:"state state-success"},[t._v("成功")]):"fail"===e.row.state?n("span",{staticClass:"state state-fail"},[t._v("失败")]):t._e()],1)],2):t._e()]}}],null,!1,2333373212)})],1):t._e()],1),t._v(" "),n("el-col",{attrs:{span:11}},[n("div",{staticClass:"mb10"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.rightAddBtn}},[t._v("添加")]),t._v(" "),n("el-select",{directives:[{name:"show",rawName:"v-show",value:t.showRightAdd,expression:"showRightAdd"}],attrs:{placeholder:"在当前选中表中选择字段",size:"mini"},on:{change:t.addRightItem},model:{value:t.rightAddItem,callback:function(e){t.rightAddItem=e},expression:"rightAddItem"}},t._l(t.rightAddList,(function(t){return n("el-option",{key:t.columnName,attrs:{value:t,label:t.columnName+"("+t.columnType+")"}})})),1),t._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.autoSameName}},[t._v("同名映射")])],1),t._v(" "),n("div",[t.showRightTable?n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableObj.tableRightLoading,expression:"tableObj.tableRightLoading"}],key:"leftTableKey",ref:"rightTableRef",staticStyle:{"font-size":"13px"},attrs:{data:t.tableObj.rightColumns,"row-key":"id",stripe:"","row-style":{height:"45px"}}},[n("el-table-column",{attrs:{type:"index",label:"序号",width:"80",align:"center"},scopedSlots:t._u([{key:"header",fn:function(){return[t._v("\n                  序号\n                  "),n("el-popover",{attrs:{trigger:"hover",placement:"bottom","popper-class":"tag-popper"}},[t._v("\n                    拖动列头图标可进行手动排序\n                    "),n("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])]},proxy:!0},{key:"default",fn:function(e){return[n("i",{staticClass:"el-icon-s-operation cursor-move",staticStyle:{color:"#c0c4cc"}}),t._v(" "+t._s(e.$index+1)+" ")]}}],null,!1,1499026566)}),t._v(" "),n("el-table-column",{attrs:{prop:"name",label:"目标字段名称","min-width":"135",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isRightEdit?n("el-input",{attrs:{size:"mini",placeholder:"字段名称"},model:{value:e.row.columnName,callback:function(n){t.$set(e.row,"columnName",n)},expression:"scope.row.columnName"}}):n("span",[t._v(t._s(e.row.columnName))])]}}],null,!1,1242174692)}),t._v(" "),n("el-table-column",{attrs:{prop:"data_type",label:"字段类型",align:"center","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isRightEdit?n("el-select",{attrs:{placeholder:"请选择目标字段类型",size:"mini",clearable:""},on:{change:function(n){return t.changeType(e.$index,e.row.columnType)}},model:{value:e.row.columnType,callback:function(n){t.$set(e.row,"columnType",n)},expression:"scope.row.columnType"}},t._l(t.typeList,(function(t){return n("el-option",{key:t,attrs:{value:t,label:t}})})),1):n("span",[t._v(t._s(e.row.columnType))])]}}],null,!1,2202353906)}),t._v(" "),n("el-table-column",{attrs:{prop:"columnType",label:"安全级别","min-width":"90",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isRightEdit?n("el-select",{attrs:{size:"mini"},model:{value:e.row.securityLevel,callback:function(n){t.$set(e.row,"securityLevel",n)},expression:"scope.row.securityLevel"}},t._l(t.securityList,(function(t){return n("el-option",{key:t,attrs:{value:t,label:t}})})),1):[t._v(t._s(e.row.securityLevel||"-"))]]}}],null,!1,1971824825)}),t._v(" "),n("el-table-column",{attrs:{label:"字段描述","min-width":"100",align:"center","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t.tableObj.isRightEdit?n("el-input",{attrs:{size:"mini",placeholder:"字段描述"},model:{value:e.row.columnComment,callback:function(n){t.$set(e.row,"columnComment",n)},expression:"scope.row.columnComment"}}):n("span",[t._v(t._s(e.row.columnComment))])]}}],null,!1,1025835014)}),t._v(" "),n("el-table-column",{attrs:{label:"操作",width:"70",align:"center",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return t.delDataRight(e.row,e.$index)}}},[t._v("删除")])]}}],null,!1,824497018)})],1):t._e()],1)])],1)],1)],1),t._v(" "),n("convert-func",{ref:"convertFunc",on:{save:t.save}}),t._v(" "),n("el-dialog",{attrs:{title:"decimal类型自定义",visible:t.dialogVisible,width:"420px","close-on-click-modal":!1,"append-to-body":!0,"modal-append-to-body":!1},on:{"update:visible":function(e){t.dialogVisible=e},close:t.closeForm}},[n("div",{staticClass:"tip"},[t._v("decimal类型支持让用户自定义精度和小数位数")]),t._v(" "),n("el-form",{ref:"decimalForm",attrs:{model:t.decimalForm,"label-width":"140px"}},[n("el-form-item",{attrs:{label:"精度",prop:"accuracy",rules:[{required:!0,message:"请输入精度",trigger:"change"}]}},[n("el-input-number",{attrs:{"controls-position":"right",min:1,max:38},model:{value:t.decimalForm.accuracy,callback:function(e){t.$set(t.decimalForm,"accuracy",e)},expression:"decimalForm.accuracy"}})],1),t._v(" "),n("el-form-item",{attrs:{label:"小数位数",prop:"decimal",rules:[{required:!0,message:"请输入小数位数",trigger:"change"}]}},[n("el-input-number",{attrs:{"controls-position":"right",min:0,max:t.decimalForm.accuracy},model:{value:t.decimalForm.decimal,callback:function(e){t.$set(t.decimalForm,"decimal",e)},expression:"decimalForm.decimal"}})],1)],1),t._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:t.saveDecimal}},[t._v("确 定")])],1)],1)],1)},I=[],P=n("aa47"),D=n("f4b1"),$=n("be0b"),A={components:{FuncIcon:D["a"],ConvertFunc:$["a"]},props:{tableObj:{type:Object,default:function(){}}},data:function(){return{isTipDisabled:!1,showLeftAdd:!1,showRightAdd:!1,showLeftTable:!0,showRightTable:!0,leftAddList:[],leftAddItem:"",rightAddList:[],rightAddItem:"",funDisabled:!1,typeList:["String","Boolean","Bigint","Date","Double","Float","Int","Tinyint","Timestamp"],decimalForm:{accuracy:22,decimal:6},dialogVisible:!1,securityList:["1级","2级","3级","4级"]}},watch:{"tableObj.isRightEdit":function(t){this.rightAddList=[]}},mounted:function(){this.rowDrop()},methods:{isShowTooltip:function(t){var e=t.target.clientWidth,n=t.target.scrollWidth;this.isTipDisabled=!(n>e)},rowDrop:function(){var t=this,e=this.$refs.leftTableRef.$el.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];this.sortable=P["a"].create(e,{ghostClass:"sortable-ghost",handle:".el-icon-s-operation",setData:function(t){t.setData("Text","")},onStart:function(e){t.tableObj.dragLoading=!0},onUpdate:function(e){var n=t.tableObj.leftColumns.splice(e.oldIndex,1)[0];t.tableObj.leftColumns.splice(e.newIndex,0,n),t.showLeftTable=!1},onEnd:function(e){t.$nextTick((function(){t.showLeftTable=!0})),setTimeout((function(){t.tableObj.dragLoading=!1,t.rowDrop()}))}});var n=this.$refs.rightTableRef.$el.querySelectorAll(".el-table__body-wrapper > table > tbody")[0];this.sortable1=P["a"].create(n,{ghostClass:"sortable-ghost",handle:".el-icon-s-operation",onStart:function(e){t.tableObj.dragLoading=!0},onUpdate:function(e){var n=t.tableObj.rightColumns.splice(e.oldIndex,1)[0];t.tableObj.rightColumns.splice(e.newIndex,0,n),t.showRightTable=!1},onEnd:function(e){t.$nextTick((function(){t.showRightTable=!0})),setTimeout((function(){t.tableObj.dragLoading=!1,t.rowDrop()}))}})},changeName:function(t,e){this.tableObj.rightColumns[e].columnName=t},changeType:function(t,e){this.currentIndex=t,"DECIMAL(自定义)"===e&&(this.dialogVisible=!0)},saveDecimal:function(){var t=this;this.dialogVisible=!1,setTimeout((function(){t.columns[t.currentIndex].columnType="DECIMAL(".concat(t.decimalForm.accuracy,",").concat(t.decimalForm.decimal,")")}),100)},closeForm:function(){this.columns[this.currentIndex].columnType="DECIMAL(22,6)"},refresh:function(){this.$emit("refreshTable")},autoSameName:function(){var t=this;this.tableObj.leftColumns.map((function(e,n){if(n<=t.tableObj.rightColumns.length-1){var a=t.tableObj.rightColumns.findIndex((function(t){return t.columnName===e.name}));if(-1!==a){var r=JSON.parse(JSON.stringify(t.tableObj.rightColumns[a]));t.tableObj.rightColumns[a]=JSON.parse(JSON.stringify(t.tableObj.rightColumns[n])),t.tableObj.rightColumns[n]=r,t.$forceUpdate()}}}))},rightAddBtn:function(){this.tableObj.isRightEdit?this.tableObj.rightColumns.push({}):this.showRightAdd=!0},addLeftItem:function(t){this.tableObj.leftColumns.push(t),this.showLeftAdd=!1,this.leftAddItem="",this.leftAddList.splice(this.leftAddList.findIndex((function(e){return e.name===t.name})),1)},addRightItem:function(t){this.tableObj.rightColumns.push(t),this.showRightAdd=!1,this.rightAddItem="",this.rightAddList.splice(this.rightAddList.findIndex((function(e){return e.name===t.name})),1)},delDataRight:function(t,e){this.tableObj.isRightEdit||this.rightAddList.push(t),this.tableObj.rightColumns.splice(e,1)},delData:function(t,e){this.leftAddList.push(t),this.tableObj.leftColumns.splice(e,1)},clickFunc:function(t,e){this.$refs.convertFunc.showWin(t,e)},save:function(t,e){this.$set(this.tableObj.leftColumns[e],"funcs",t)}}},R=A,N=(n("ef04"),Object(m["a"])(R,j,I,!1,null,"6b90d20c",null)),E=N.exports,V=n("042b"),q=n("ffe0"),z=n("b893"),K=n("3dc0");function B(t){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B(t)}function J(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function M(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?J(Object(n),!0).forEach((function(e){G(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function G(t,e,n){return e=W(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function W(t){var e=H(t,"string");return"symbol"===B(e)?e:String(e)}function H(t,e){if("object"!==B(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,e||"default");if("object"!==B(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var U={components:{StepsHead:o["a"],SeniorForm:i["a"],FormHead:f,FormLeft:k,FormRight:x,TableMapping:E,StepThree:V["a"],ViewParams:q["a"],ValidParams:K["a"]},props:{data:{type:Object,default:function(){return{}}},isShowPublish:{type:Boolean,default:!1},source:{type:String,default:"task"}},data:function(){return{currentStep:1,copyId:this.$route.query.copyId,queryId:"",canEdit:!0,isEdit:!1,drawerVisible:!1,tableObj:{isRightEdit:!0,isLeftEdit:!0,tableRightLoading:!1,tableLeftLoading:!1,leftColumns:[],rightColumns:[],dragLoading:!1},ruleForm:{invokingStatus:!0,templateCode:"File2Lakehouse",name:"",description:"",dependTypes:[],triggerParam:{type:"cron",isIrregularSheduler:1,outputGranularity:"daily",crontabParam:{advancedSetting:!1,range:[],interval:5,startTime:"00:00",endTime:"23:59",fixedTime:"00:00"},crontab:""},eventDepends:[],inputDataset:[{metadata:{region:"",type:"mysql",source:"",db:"",table:""},guid:"",id:"",granularity:"daily",unitOffset:0,ready_time:"0 0 * * *",useDateCalcuParam:!1,dateCalculationParam:{}}],outputDataset:[{metadata:{region:"",type:"hive",source:"",db:"",table:""},offset:-1}],cost:[{key:"",value:"100"}]},configForm:{sourceRegion:"",sourceType:"",executeMode:"local",sourceId:"",sourceParam:{},destinationId:"",targetDb:"stage",targetTable:"",partitions:[{name:"",value:""}],taskParam:{location:"",tableComment:"",tableLevel:"1级"}},rules:{sourceId:[{required:!0,message:"请选择数据源",trigger:["blur","change"]}],sourceType:[{required:!0,message:"请选择数据源",trigger:["blur","change"]}],destinationId:[{required:!0,message:"请选择数据源名称",trigger:["blur","change"]}],targetDb:[{required:!0,message:"请选择数据库名称",trigger:["blur","change"]}],targetTable:[{required:!0,message:"请输入目标表名称",trigger:["blur","change"]}]},seniorForm:{alertModel:{success:{alertType:[],notifyCollaborator:!1},failure:{alertType:[],notifyCollaborator:!1,isChecked:!1},retry:{alertType:[],notifyCollaborator:!1},start:{alertType:[],notifyCollaborator:!1}},regularAlert:{offset:0,graularity:"",checkTime:"",triggerCondition:"notStart",alertType:[],notifyCollaborator:!1,isChecked:!1},mysqlCdcType:"init",owner:"",collaborators:[],dsGroups:[],group:"",resourceLevel:"standard",executionTimeout:0,retries:1,maxActiveRuns:1,emails:"",clusterSla:"normal",acrossCloud:"common",startDate:"",endDate:"",batchParams:"",lifecycle:"Ec2spot",location:""},formLeftLoading:!1,primaryKey:"",typeList:["String","Boolean","Bigint","Date","Double","Float","Int","Tinyint","Timestamp"],isWorkflow:!1,nameDisabled:!1,regionList:z["l"]}},computed:{info:function(){return Object.assign({},this.ruleForm,this.seniorForm,this.configForm,{target_columns:this.tableObj.rightColumns,source_columns:this.tableObj.leftColumns})}},watch:{data:{handler:function(t){Object.keys(t).length>0&&(this.isEdit=!0,this.getTaskInfo(t))},deep:!0,immediate:!0}},created:function(){this.seniorForm.dsGroups=this.$store.getters["user/currentUserGroup"].id?[this.$store.getters["user/currentUserGroup"].id]:[],this.seniorForm.owner=this.$store.getters.userInfo.userId},mounted:function(){var t=this;z["l"].then((function(e){t.regionList=e,t.configForm.sourceRegion=e[0].value,t.isEdit||(t.configForm.sourceType="oss")}))},methods:{getTaskInfo:function(t){var e=this;this.copyId||(this.queryId=t.id),this.nameDisabled=1===t.online;var n=JSON.parse(t.runtimeConfig);if(this.configForm.sourceRegion=n.sourceRegion,this.configForm.sourceType=n.sourceType,this.configForm.sourceId=n.sourceId,this.configForm.destinationId=n.destinationId,this.configForm.targetDb=n.catalog.targetDb,this.configForm.targetTable=n.catalog.tables[0].targetTable,n.taskParam?this.configForm.taskParam=n.taskParam:this.getLocation(),this.configForm.sourceParam=n.sourceParam,n.catalog.tables[0].partitions){var a=n.catalog.tables[0].partitions.split(",");a.map((function(t,n){var a=t.indexOf("="),r=t.substring(0,a),o=t.substring(a+1);e.$set(e.configForm.partitions,n,{name:r,value:o})}))}Object.keys(this.seniorForm).forEach((function(t){e.seniorForm[t]=n.advancedParameters[t]})),this.seniorForm.alertModel=n.alertModel?n.alertModel:this.seniorForm.alertModel,this.seniorForm.regularAlert=n.regularAlert?n.regularAlert:this.seniorForm.regularAlert,this.columnsArr=Array.isArray(n.catalog.tables[0].columns)?n.catalog.tables[0].columns:JSON.parse(n.catalog.tables[0].columns),this.tableObj.tableLeftLoading=!0,this.tableObj.tableRightLoading=!0,setTimeout((function(){e.columnsArr.forEach((function(t,n){e.tableObj.rightColumns.push({id:n,columnName:t.columnName,columnType:t.columnType,columnComment:t.columnComment,securityLevel:t.securityLevel});var a={id:n,name:t.name,data_type:t.data_type?t.data_type:t.dataType,comment:t.comment,isPK:t.isPK};t.funcs&&(a.funcs=t.funcs),t.isPK&&(e.primaryKey=t.name),e.tableObj.leftColumns.push(a)})),e.tableObj.tableLeftLoading=!1,e.tableObj.tableRightLoading=!1}),500),this.ruleForm.name=t.name,this.copyId||t.isCopy?(this.ruleForm.name=t.name+"_copy",this.nameDisabled=!1,this.seniorForm.owner=this.seniorFormSql.runtimeConfig.owner=this.$store.getters.userInfo.userId):this.canEdit=t.canEdit,this.ruleForm.description=t.description,this.$set(this.ruleForm,"online",t.online);var r=JSON.parse(t.outputDataset),o=JSON.parse(t.inputDataset);this.ruleForm.inputDataset=o.length?o:this.ruleForm.inputDataset,this.ruleForm.outputDataset=r.length?r:this.ruleForm.outputDataset,this.ruleForm.outputDataset&&this.ruleForm.outputDataset.length>0&&this.ruleForm.outputDataset[0].location&&this.$set(this.ruleForm.outputDataset[0],"check",!0),t.dependTypes&&(this.ruleForm.dependTypes=JSON.parse(t.dependTypes)),t.triggerParam&&Object.assign(this.ruleForm.triggerParam,JSON.parse(t.triggerParam)),t.eventDepends&&(this.ruleForm.eventDepends=JSON.parse(t.eventDepends)),t.workflowId&&(this.isWorkflow=!0)},getLocation:function(){var t="";this.configForm.partitions.map((function(e){e.name&&(t+=e.name+"="+e.value+"/")})),t=t.substring(0,t.length-1),this.configForm.taskParam.location="/stage/".concat(this.configForm.userGroupName,"/").concat(this.configForm.targetTable,"/").concat(t)},handelStep:function(t){t<1?this.$router.push("/task/step1"):this.currentStep=t},getColumns:function(){var t=this;this.tableObj.tableLeftLoading=!0,Object(h["y"])({region:this.configForm.sourceRegion,type:this.configForm.sourceType,actorId:this.configForm.sourceId,metaFlag:"AIRBYTE",templateCode:this.ruleForm.templateCode,sourceParam:this.configForm.sourceParam}).then((function(e){var n=e.data.data;n&&n.length?(t.tableObj.rightColumns=[],t.tableObj.leftColumns=n[0].columns.map((function(e,n){return e.isPK&&(t.primaryKey=e.name),e.id=n,t.tableObj.rightColumns.push(t.regColumItem(e)),{id:e.id,name:e.name,data_type:e.data_type,comment:e.comment,isPK:e.isPK}}))):(t.tableObj.leftColumns=[],t.tableObj.rightColumns=[])})).finally((function(){t.tableObj.tableLeftLoading=!1}))},formatType:function(t){var e=t.toLowerCase();return"bigint"===e||"bigserial"===e||"integer"===e||"smallint"===e||"serial"===e||"int"===e||"numberic"===e?"Bigint":"boolean"===e?"Boolean":"String"},regColumItem:function(t){var e=this;return{columnName:t.name,columnType:this.typeList.find((function(n){return n===e.formatType(t.data_type)})),columnComment:t.comment,securityLevel:"1级"}},localToParams:function(){var t=this,e=z["b"](this.ruleForm);delete e.cost;var n="";return this.configForm.partitions.map((function(t){var e=t.name?t.name+"="+t.value:"";n+=e+","})),n=n.substring(0,n.length-1),e.runtimeConfig={isNewFormat:!0,sourceRegion:this.configForm.sourceRegion,executeMode:this.configForm.executeMode,sourceType:this.configForm.sourceType,sourceId:this.configForm.sourceId,destinationType:"iceberg",destinationId:this.configForm.destinationId,taskParam:this.configForm.taskParam,sourceParam:this.configForm.sourceParam,alertModel:this.seniorForm.alertModel,regularAlert:this.seniorForm.regularAlert,catalog:{targetDb:this.configForm.targetDb,tables:[{autoCreateTable:!0,targetTable:this.configForm.targetTable,partitions:n,columns:this.tableObj.rightColumns.map((function(e,n){return M(M({},t.tableObj.leftColumns[n]),e)})),primaryKey:this.primaryKey}]},advancedParameters:this.seniorForm,cost:this.ruleForm.cost},this.queryId&&(e.id=this.queryId),e},preStep:function(){1===this.currentStep?this.$router.push("/task/step1"):this.currentStep--},nextStep:function(){var t=this;if(1===this.currentStep)this.$refs.ruleForm.validate((function(e){e&&(t.ruleForm.name="imp_".concat(t.configForm.targetTable),t.ruleForm.inputDataset[0].metadata={region:t.configForm.sourceRegion,type:t.configForm.sourceType,source:"",db:"",table:""},t.ruleForm.inputDataset[0].id="",t.ruleForm.outputDataset[0].metadata={region:t.configForm.sourceRegion,type:"hive",source:"",db:t.configForm.targetDb,table:t.configForm.targetTable},t.ruleForm.outputDataset[0].id="",t.currentStep++)}));else if(2===this.currentStep&&"task"===this.source)this.$refs.stepThree.$refs.ruleForm.validate((function(e){e&&t.$refs.stepThree.validateType()&&(t.currentStep++,t.$nextTick((function(){document.documentElement.scrollTo(0,0)})))}));else{var e=0;if(this.ruleForm.cost.forEach((function(t){e+=parseInt(t.value)})),100!==e)return this.$message.error("成本归属占比总额必须是100哦"),!1;var n=!1;if(this.ruleForm.dependTypes.includes("event")&&0===this.ruleForm.eventDepends.length&&(n=!0,this.$message.warning("请至少添加一条内部依赖")),n)return;this.seniorForm.source||(this.seniorForm.source=this.source);var a=this.localToParams();this.$refs.validParams.show(a)}}}},Y=U,Q=(n("80e6"),Object(m["a"])(Y,a,r,!1,null,"245d49c6",null));e["default"]=Q.exports},cc57:function(t,e,n){},d92a:function(t,e,n){t.exports=n.p+"static/img/path_info.e58b7014.png"},ef04:function(t,e,n){"use strict";n("cc57")}}]);