(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-f84c8736"],{"0dab":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"system-box"},[n("div",{staticClass:"sidebar"},[n("ul",e._l(e.sections,(function(t){return n("li",{key:t.id,class:{active:t.id===e.activeSection},on:{click:function(n){return e.setActiveSection(t)}}},[e._v("\n        "+e._s(t.title)+"\n      ")])})),0)]),e._v(" "),n("div",{staticClass:"content"},[n("el-form",{ref:"ruleForm",staticClass:"step-three",attrs:{model:e.ruleForm,rules:e.rules}},[n("div",{attrs:{id:"section1"}},[n("el-tabs",[n("el-tab-pane",{attrs:{label:"登录配置"}},[n("el-form-item",{attrs:{label:"登录方式：","label-width":"130px"},scopedSlots:e._u([{key:"label",fn:function(){return[n("span",[e._v("登录方式："),n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"},on:{click:function(t){e.loginModeVisible=!e.loginModeVisible}}})])]},proxy:!0}])},[e._v(" "),n("el-radio-group",{on:{change:e.changeLoginType},model:{value:e.ruleForm.login_mode,callback:function(t){e.$set(e.ruleForm,"login_mode",t)},expression:"ruleForm.login_mode"}},[n("el-radio",{attrs:{label:"LDAP"}},[e._v("LDAP账号")]),e._v(" "),n("el-radio",{attrs:{label:"DataCake"}},[e._v("DataCake账号")])],1)],1),e._v(" "),e.showLoginBox?n("div",{staticClass:"ldap-box"},[n("el-form-item",{attrs:{label:"登录鉴权接口：","label-width":"130px",prop:"login_auth_interface"}},[n("el-input",{staticClass:"text-box",attrs:{type:"textarea"},model:{value:e.ruleForm.login_auth_interface,callback:function(t){e.$set(e.ruleForm,"login_auth_interface",t)},expression:"ruleForm.login_auth_interface"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"接口描述：","label-width":"130px"}},[n("el-input",{staticClass:"text-box",attrs:{type:"textarea"},model:{value:e.ruleForm.interface_describe,callback:function(t){e.$set(e.ruleForm,"interface_describe",t)},expression:"ruleForm.interface_describe"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"启用MFA验证：","label-width":"130px"}},[n("el-radio-group",{model:{value:e.ruleForm.is_enable_mfa,callback:function(t){e.$set(e.ruleForm,"is_enable_mfa",t)},expression:"ruleForm.is_enable_mfa"}},[n("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),n("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1):e._e()],1)],1)],1),e._v(" "),n("div",{staticClass:"section",attrs:{id:"section2"}},[n("el-tabs",[n("el-tab-pane",{attrs:{label:"告警渠道配置"}},[n("el-form-item",{staticClass:"other-param",attrs:{label:"告警配置：","label-width":"130px",prop:"channel_info"}},[n("span",{staticClass:"check-text"},[n("el-checkbox",{staticStyle:{"margin-right":"3px"},on:{change:function(t){return e.checkBox("enterprise_wechat")}},model:{value:e.channel_infoObj["enterprise_wechat"].check,callback:function(t){e.$set(e.channel_infoObj["enterprise_wechat"],"check",t)},expression:"channel_infoObj['enterprise_wechat'].check"}}),e._v(" "),n("span",{staticClass:"tab",class:{activeText:"enterprise_wechat"===e.alertTypeValue},on:{click:function(t){return e.checkAlertType("enterprise_wechat")}}},[e._v(e._s("企业微信"))])],1),e._v(" "),n("span",{staticClass:"check-text"},[n("el-checkbox",{staticStyle:{"margin-right":"3px"},attrs:{disabled:""},on:{change:function(t){return e.checkBox("dingding")}},model:{value:e.channel_infoObj["dingding"].check,callback:function(t){e.$set(e.channel_infoObj["dingding"],"check",t)},expression:"channel_infoObj['dingding'].check"}}),e._v(" "),n("span",{staticClass:"tab",class:{activeText:"dingding"===e.alertTypeValue},on:{click:function(t){return e.checkAlertType("dingding")}}},[e._v(e._s("钉钉"))])],1),e._v(" "),n("span",{staticClass:"check-text"},[n("el-checkbox",{staticStyle:{"margin-right":"3px"},on:{change:function(t){return e.checkBox("email")}},model:{value:e.channel_infoObj["email"].check,callback:function(t){e.$set(e.channel_infoObj["email"],"check",t)},expression:"channel_infoObj['email'].check"}}),e._v(" "),n("span",{staticClass:"tab",class:{activeText:"email"===e.alertTypeValue},on:{click:function(t){return e.checkAlertType("email")}}},[e._v(e._s("邮件"))])],1),e._v(" "),n("span",{staticClass:"check-text"},[n("el-checkbox",{staticStyle:{"margin-right":"3px"},attrs:{disabled:""},on:{change:function(t){return e.checkBox("phone")}},model:{value:e.channel_infoObj["phone"].check,callback:function(t){e.$set(e.channel_infoObj["phone"],"check",t)},expression:"channel_infoObj['phone'].check"}}),e._v(" "),n("span",{staticClass:"tab",class:{activeText:"phone"===e.alertTypeValue},on:{click:function(t){return e.checkAlertType("phone")}}},[e._v(e._s("电话"))])],1),e._v(" "),n("div",{staticClass:"alert-method-box"},[n("el-form-item",{attrs:{label:"任务告警渠道","label-width":"110px",size:"mini"}},[n("el-radio-group",{model:{value:e.channel_infoObj[e.alertTypeValue].alert,callback:function(t){e.$set(e.channel_infoObj[e.alertTypeValue],"alert",t)},expression:"channel_infoObj[alertTypeValue].alert"}},[n("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),n("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1)])],1)],1)],1)])],1),e._v(" "),n("div",{staticClass:"btn-wrap"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save()}}},[e._v("保 存")])],1),e._v(" "),n("el-info",{attrs:{title:"登录方式介绍"},model:{value:e.loginModeVisible,callback:function(t){e.loginModeVisible=t},expression:"loginModeVisible"}},[n("div",{staticStyle:{padding:"0 16px","font-size":"14px","line-height":"24px",color:"#606266"}},[n("p",[n("span",{staticStyle:{"font-weight":"550"}},[e._v("LDAP账号登录：")]),e._v("鉴权时将调用当前租户的鉴权接口，需要租户admin配置鉴权API。")]),e._v(" "),n("p",[n("span",{staticStyle:{"font-weight":"550"}},[e._v("DataCake账号登录：")]),e._v("鉴权时无需调用外部API。")])])])],1)},a=[],l=n("8593"),o=n("2f62");function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return t=h(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=f(e,"string");return"symbol"===r(t)?t:String(t)}function f(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var b={data:function(){return{sections:[{id:"section1",title:"登录配置"},{id:"section2",title:"告警渠道配置"}],loginModeVisible:!1,activeSection:"enterprise_wechat",showLoginBox:!0,alertTypeValue:"enterprise_wechat",radioTest:3,alertConf:[{label:"企业微信",value:"enterprise_wechat"},{label:"钉钉",value:"dingding"},{label:"邮件",value:"email"},{label:"电话",value:"phone"}],channel_infoObj:{email:{check:!1,alert:!0},enterprise_wechat:{check:!1,alert:!0},phone:{check:!1,alert:!0},dingding:{check:!1,alert:!0}},ruleForm:{login_mode:"LDAP",is_enable_mfa:!1,login_auth_interface:"",interface_describe:"",channel_info:[]},rules:{login_auth_interface:[{required:!0,message:"请填写登陆鉴权接口",trigger:["blur","change"]}],channel_info:[{required:!0,message:"请选择告警渠道",trigger:["blur","change"]}]}}},computed:s(s({},Object(o["c"])(["userInfo"])),{},{systemParams:function(){return this.$store.getters["user/systemConf"]}}),watch:{systemParams:{handler:function(e){e.config&&(this.ruleForm=JSON.parse(e.config),this.getChannelObj(this.ruleForm.channel_info),this.showLoginBox="LDAP"===this.ruleForm.login_mode)},deep:!0}},mounted:function(){window.addEventListener("scroll",this.handleScroll),this.activeSection="section1",this.systemParams.config&&(this.ruleForm=JSON.parse(this.systemParams.config),this.getChannelObj(this.ruleForm.channel_info),this.showLoginBox="LDAP"===this.ruleForm.login_mode)},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll)},methods:{handleScroll:function(){for(var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,t=0;t<this.sections.length;t++){var n=this.sections[t],i=document.getElementById(n.id).offsetTop;e>=i&&(this.activeSection=n.id)}},setActiveSection:function(e){this.activeSection=e.id,document.getElementById(e.id).scrollIntoView()},checkAlertType:function(e){this.alertTypeValue=e},getChannelObj:function(e){var t=this;e.map((function(e){t.channel_infoObj[Object.keys(e)[0]].check=!0,t.channel_infoObj[Object.keys(e)[0]].alert=e[Object.keys(e)[0]].isAlarmConfiguration}))},checkBox:function(e){var t=this;this.ruleForm.channel_info=[],this.alertTypeValue=e;var n=function(e){if(t.channel_infoObj[e].check){var n={};n[e]={isAlarmConfiguration:t.channel_infoObj[e].alert},t.ruleForm.channel_info.push(n)}else{var i=t.ruleForm.channel_info.findIndex((function(t){return Object.keys(t)[0]===e}));i>-1&&t.ruleForm.channel_info.splice(i,1)}};for(var i in this.channel_infoObj)n(i)},changeLoginType:function(){this.showLoginBox="LDAP"===this.ruleForm.login_mode,this.showLoginBox||(this.ruleForm.is_enable_mfa=!1)},save:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){var n=JSON.parse(JSON.stringify(e.systemParams));n.config=e.ruleForm,Object(l["b"])(n).then((function(t){0===t.code&&(Object(l["a"])({id:e.userInfo.tenantId}).then((function(t){e.$store.commit("user/SET_SYSTEMCONF",t.data)})),e.$message({type:"success",message:"保存成功"}))}))}}))}}},p=b,d=(n("4914"),n("2877")),m=Object(d["a"])(p,i,a,!1,null,"2c6216ef",null);t["default"]=m.exports},4914:function(e,t,n){"use strict";n("b08c")},b08c:function(e,t,n){}}]);