(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-9351dab0"],{"1de9":function(t,e,r){},"2b91":function(t,e,r){"use strict";r("1de9")},"46a7":function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"step2"},[r("div",{staticClass:"step_right"},[r("div",{staticClass:"step-content"},[r("div",{directives:[{name:"show",rawName:"v-show",value:1===t.currentStep,expression:"currentStep === 1"}]},[r("el-button",{staticClass:"open-btn",attrs:{type:"primary"},on:{click:function(e){t.drawerVisible=!0}}},[t._v("高级设置")]),t._v(" "),r("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[r("div",{staticClass:"tips"},[t._v("提示：切勿合并iceberg表")]),t._v(" "),r("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"名字只能包含a-z,A-Z,0-9或-或_；开始结尾需为字符，最多60个字符",disabled:t.nameDisabled,maxlength:60},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}}),t._v(" "),r("el-popover",{attrs:{placement:"bottom",trigger:"hover","popper-class":"tag-popper"}},[r("div",[t._v("只有下线任务才可以修改任务名称")]),t._v(" "),r("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer",color:"#409eff",position:"absolute",top:"8px",right:"-20px"},attrs:{slot:"reference"},slot:"reference"})])],1),t._v(" "),r("el-form-item",{attrs:{label:"区域",prop:"inputDataset[0].metadata.region"},scopedSlots:t._u([{key:"label",fn:function(){return[r("span",[t._v("区域")]),t._v(" "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"这里的区域指的是任务提交执行的集群所在的区域",placement:"top"}},[r("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"}})])]},proxy:!0}])},[t._v(" "),r("el-select",{attrs:{placeholder:"请选择区域",clearable:""},on:{change:t.changeRegion},model:{value:t.ruleForm.inputDataset[0].metadata.region,callback:function(e){t.$set(t.ruleForm.inputDataset[0].metadata,"region",e)},expression:"ruleForm.inputDataset[0].metadata.region"}},t._l(t.regionList,(function(t){return r("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),t._v(" "),r("el-form-item",{attrs:{prop:"pathType"}},[r("el-radio-group",{attrs:{disabled:""},model:{value:t.ruleForm.pathType,callback:function(e){t.$set(t.ruleForm,"pathType",e)},expression:"ruleForm.pathType"}},[r("el-radio",{attrs:{label:"table"}},[t._v("数据表")]),t._v(" "),r("el-radio",{attrs:{label:"file"}},[t._v("文件路径")])],1)],1),t._v(" "),"table"===t.ruleForm.pathType?[r("el-form-item",{attrs:{label:"数据库",prop:"inputDataset[0].metadata.db"}},[r("el-select",{attrs:{title:t.ruleForm.inputDataset[0].metadata.db,placeholder:"请选择数据库",loading:t.dbLoad,"allow-create":!0,"default-first-option":"",clearable:"",filterable:""},on:{change:t.changeDb},model:{value:t.ruleForm.inputDataset[0].metadata.db,callback:function(e){t.$set(t.ruleForm.inputDataset[0].metadata,"db",e)},expression:"ruleForm.inputDataset[0].metadata.db"}},t._l(t.sourceDbList,(function(t){return r("el-option",{key:t.name,attrs:{value:t.name,label:t.name}},[r("ellipsis-tooltip",{attrs:{text:t.name}})],1)})),1)],1),t._v(" "),r("el-form-item",{attrs:{label:"表名称",prop:"inputDataset[0].metadata.table"}},[r("el-select",{attrs:{title:t.ruleForm.inputDataset[0].metadata.table,placeholder:"请选择表名称",loading:t.tableLoad,"allow-create":!0,"default-first-option":"",filterable:"",clearable:""},model:{value:t.ruleForm.inputDataset[0].metadata.table,callback:function(e){t.$set(t.ruleForm.inputDataset[0].metadata,"table",e)},expression:"ruleForm.inputDataset[0].metadata.table"}},t._l(t.sourceTableList,(function(t){return r("el-option",{key:t.name,attrs:{value:t.name,label:t.name}},[r("ellipsis-tooltip",{attrs:{text:t.name}})],1)})),1)],1)]:t._e(),t._v(" "),r("el-form-item",{attrs:{label:"任务类型",prop:"type"}},[r("el-radio-group",{model:{value:t.ruleForm.type,callback:function(e){t.$set(t.ruleForm,"type",e)},expression:"ruleForm.type"}},[r("el-radio",{attrs:{label:"jar"}})],1)],1),t._v(" "),r("el-form-item",{attrs:{label:"地址",prop:"jarUrl"}},[r("el-input",{attrs:{placeholder:"请输入地址",disabled:""},model:{value:t.ruleForm.jarUrl,callback:function(e){t.$set(t.ruleForm,"jarUrl",e)},expression:"ruleForm.jarUrl"}})],1)],2)],1),t._v(" "),r("el-drawer",{attrs:{title:"高级设置",visible:t.drawerVisible,"with-header":!1,direction:"rtl"},on:{"update:visible":function(e){t.drawerVisible=e}}},[r("senior-form",{ref:"seniorForm",attrs:{"is-show-mode":t.isShowMode,"senior-form":t.seniorForm,"is-show-cloud":!0},on:{close:function(e){t.drawerVisible=!1}}})],1)],1),t._v(" "),r("div",{staticClass:"btn-wrap"},[r("el-button",{on:{click:function(e){return t.$emit("cancel")}}},[t._v("取消")]),t._v(" "),t.isShowPublish||!t.isShowPublish&&2===t.currentStep?r("el-button",{on:{click:t.preStep}},[t._v("上一步")]):t._e(),t._v(" "),r("el-button",{attrs:{type:"primary",disabled:!t.canEdit&&2===t.currentStep,loading:t.btnLoading},on:{click:t.nextStep}},[t._v(t._s(t.copyId?"确认复制":"保存"))]),t._v(" "),t.isShowPublish?r("el-checkbox",{staticClass:"task-checkbox",model:{value:t.ruleForm.invokingStatus,callback:function(e){t.$set(t.ruleForm,"invokingStatus",e)},expression:"ruleForm.invokingStatus"}},[t._v("切换至该版本")]):t._e()],1)]),t._v(" "),r("valid-params",{ref:"validParams",attrs:{code:t.ruleForm.templateCode},on:{save:function(e){t.$emit("save",e)}}})],1)},a=[],s=r("9caf"),o=r("3941"),i=r("b199"),u=r("b893"),l=r("3dc0");function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach((function(e){m(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t,e,r){return e=f(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t){var e=b(t,"string");return"symbol"===c(e)?e:String(e)}function b(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var g={components:{SeniorForm:s["a"],EllipsisTooltip:o["a"],ValidParams:l["a"]},props:{data:{type:Object,default:function(){return{}}},isShowPublish:{type:Boolean,default:!1},source:{type:String,default:"task"}},data:function(){var t=function(t,e,r){var n=/^[a-zA-Z0-9][-_a-zA-Z0-9]*$/;n.test(e)?r():r(new Error("名字只能包含a-z,A-Z,0-9或-或_；开始需为字符，最多60个字符"))};return{btnLoading:!1,currentStep:1,queryId:"",copyId:this.$route.query.copyId,ruleForm:{invokingStatus:!0,templateCode:"MergeSmallFiles",name:"",description:"",pathType:"table",type:"jar",displayDependJars:[{artifactId:"",id:""}],jarUrl:"",mainClass:"",mainClassArgs:"",dependTypes:[],triggerParam:{type:"cron",isIrregularSheduler:1,outputGranularity:"monthly",crontabParam:{range:[1],fixedTime:"00:00"},crontab:"00 00 1 * *"},eventDepends:[],inputDataset:[{metadata:{region:"",type:"hive",source:"",db:"",table:""},guid:"",id:"",granularity:"daily",unitOffset:0,ready_time:"0 0 * * *",useDateCalcuParam:!1,dateCalculationParam:{}}],outputDataset:[{metadata:{region:"",type:"hive",source:"",db:"",table:""},id:"",offset:-1}],cost:[{key:"Share_it_Product",value:"100"}]},rules:{name:[{required:!0,message:"请输入任务名称",trigger:["blur","change"]},{validator:t,trigger:["blur","change"]}],jarUrl:[{required:!0,message:"请输入地址",trigger:["blur","change"]}],type:[{required:!0,message:"请选择任务类型",trigger:["blur","change"]}],inputDataset:[{metadata:{region:[{required:!0,message:"请选择数据集区域",trigger:["blur","change"]}],db:[{required:!0,message:"请选择数据库",trigger:["blur","change"]}],table:[{required:!0,message:"请选择表名称",trigger:["blur","change"]}]}}]},dbLoad:!1,tableLoad:!1,regionList:u["l"],sourceDbList:[],sourceTableList:[],drawerVisible:!1,seniorForm:{sourceRegion:"",owner:"",collaborators:[],dsGroups:[],group:"",resourceLevel:"standard",executionTimeout:0,retries:1,maxActiveRuns:1,emails:"",clusterSla:"normal",alertMethod:["dingTalk"],alertType:[2],alertModel:{success:{alertType:[],notifyCollaborator:!1},failure:{alertType:[],notifyCollaborator:!1},retry:{alertType:[],notifyCollaborator:!1},start:{alertType:[],notifyCollaborator:!1}},acrossCloud:"common",startDate:"",endDate:"",batchParams:"",lifecycle:"Ec2spot"},canEdit:!0,nameDisabled:!1,copyMsg:null}},computed:{groupList:function(){var t=this.$store.getters.userInfo;return t&&t.group?t.group.split(","):[]},isShowMode:function(){return"sg2"!==this.ruleForm.inputDataset[0].metadata.region}},watch:{data:{handler:function(t){Object.keys(t).length>0&&this.getTaskInfo(t)},deep:!0,immediate:!0}},created:function(){var t=this;u["l"].then((function(e){t.regionList=e})),this.seniorForm.dsGroups=this.$store.getters["user/currentUserGroup"].id?[this.$store.getters["user/currentUserGroup"].id]:[],this.$watch((function(){return this.ruleForm.inputDataset[0].metadata.region}),(function(t){this.seniorForm.sourceRegion=t,this.ruleForm.outputDataset[0].metadata.region=t})),this.init()},destroyed:function(){this.copyMsg&&this.copyMsg.close()},methods:{handelStep:function(){this.$router.push("/task/step1")},init:function(){var t=this;Object(i["p"])({typeCode:"JAR"}).then((function(e){var r=e.data;t.artifactList=r}))},getTaskInfo:function(t){this.copyId||(this.queryId=t.id),this.nameDisabled=1===t.online;var e=JSON.parse(t.runtimeConfig);e.cost&&(this.ruleForm.cost=e.cost),delete e.cost,this.seniorForm=Object.assign(this.seniorForm,e),this.ruleForm.name=t.name,this.ruleForm.description=t.description,this.$set(this.ruleForm,"online",t.online),this.ruleForm.pathType=t.pathType,this.ruleForm.jarUrl=t.jarUrl,t.mainClass&&(this.ruleForm.type="jar",this.ruleForm.mainClass=t.mainClass),this.ruleForm.mainClassArgs=t.mainClassArgs,this.$refs.monaco&&this.$refs.monaco.setCode(t.mainClassArgs),this.ruleForm.inputDataset=JSON.parse(t.inputDataset),this.ruleForm.outputDataset=JSON.parse(t.outputDataset),t.dependTypes&&(this.ruleForm.dependTypes=JSON.parse(t.dependTypes)),t.triggerParam&&Object.assign(this.ruleForm.triggerParam,JSON.parse(t.triggerParam)),t.eventDepends&&(this.ruleForm.eventDepends=JSON.parse(t.eventDepends)),this.changeRegion(this.ruleForm.inputDataset[0].metadata.region,"init"),this.changeDb(this.ruleForm.inputDataset[0].metadata.db,"init"),this.copyId||t.isCopy?(this.ruleForm.name=t.name+"_copy",this.nameDisabled=!1,this.seniorForm.owner=this.$store.getters.userInfo.userId):this.canEdit=t.canEdit},changeRegion:function(t,e){var r=this;e||(this.ruleForm.inputDataset[0].metadata.db="",this.ruleForm.inputDataset[0].metadata.table=""),this.sourceDbList=[],this.dbLoad=!0,Object(i["y"])({region:t,type:"hive",metaFlag:"AIRBYTE",templateCode:"MergeSmallFiles"}).then((function(t){var e=t.data;e.data&&(r.sourceDbList=e.data),r.dbLoad=!1})),Object(i["G"])({region:t}).then((function(t){var e=t.data;r.ruleForm.jarUrl=e}))},changeDb:function(t,e){var r=this;e||(this.ruleForm.inputDataset[0].metadata.table=""),this.sourceTableList=[];var n=this.sourceDbList.find((function(e){return e.name===t}));n&&(this.tableLoad=!0,Object(i["y"])({region:this.ruleForm.inputDataset[0].metadata.region,type:"hive",db:t,metaFlag:"AIRBYTE",templateCode:"MergeSmallFiles"}).then((function(t){var e=t.data;e.data&&(r.sourceTableList=e.data),r.tableLoad=!1})))},formatLabel:function(t,e){return e?"".concat(t,"（").concat(e,"）"):t},preStep:function(){1===this.currentStep?this.$router.push("/task/step1"):this.currentStep--},nextStep:function(t){var e=this;this.$refs.ruleForm.validate((function(t){if(t){e.ruleForm.outputDataset[0].id=e.ruleForm.name;var r=p({},e.ruleForm);e.seniorForm.source||(e.seniorForm.source=e.source),r.runtimeConfig=e.seniorForm,r.runtimeConfig.cost=e.ruleForm.cost,delete r.cost,e.$store.getters.userInfo&&!e.seniorForm.owner&&(r.runtimeConfig.owner=e.$store.getters.userInfo.userId),e.queryId&&(r.id=e.queryId),e.$refs.validParams.show(r)}}))}}},h=g,k=(r("2b91"),r("2877")),v=Object(k["a"])(h,n,a,!1,null,"5b31b2ce",null);e["default"]=v.exports},b199:function(t,e,r){"use strict";r.d(e,"y",(function(){return s})),r.d(e,"W",(function(){return o})),r.d(e,"E",(function(){return i})),r.d(e,"p",(function(){return u})),r.d(e,"ab",(function(){return l})),r.d(e,"s",(function(){return c})),r.d(e,"r",(function(){return d})),r.d(e,"t",(function(){return p})),r.d(e,"Q",(function(){return m})),r.d(e,"T",(function(){return f})),r.d(e,"A",(function(){return b})),r.d(e,"O",(function(){return g})),r.d(e,"B",(function(){return h})),r.d(e,"q",(function(){return k})),r.d(e,"e",(function(){return v})),r.d(e,"g",(function(){return y})),r.d(e,"d",(function(){return _})),r.d(e,"ib",(function(){return F})),r.d(e,"n",(function(){return D})),r.d(e,"Y",(function(){return S})),r.d(e,"I",(function(){return w})),r.d(e,"H",(function(){return C})),r.d(e,"c",(function(){return T})),r.d(e,"hb",(function(){return j})),r.d(e,"m",(function(){return O})),r.d(e,"j",(function(){return L})),r.d(e,"f",(function(){return P})),r.d(e,"bb",(function(){return $})),r.d(e,"J",(function(){return I})),r.d(e,"F",(function(){return x})),r.d(e,"h",(function(){return A})),r.d(e,"db",(function(){return q})),r.d(e,"z",(function(){return E})),r.d(e,"R",(function(){return U})),r.d(e,"u",(function(){return J})),r.d(e,"D",(function(){return M})),r.d(e,"P",(function(){return R})),r.d(e,"w",(function(){return N})),r.d(e,"Z",(function(){return G})),r.d(e,"C",(function(){return V})),r.d(e,"eb",(function(){return B})),r.d(e,"a",(function(){return z})),r.d(e,"fb",(function(){return Z})),r.d(e,"cb",(function(){return Y})),r.d(e,"G",(function(){return H})),r.d(e,"U",(function(){return K})),r.d(e,"i",(function(){return Q})),r.d(e,"k",(function(){return W})),r.d(e,"K",(function(){return X})),r.d(e,"L",(function(){return tt})),r.d(e,"N",(function(){return et})),r.d(e,"M",(function(){return rt})),r.d(e,"b",(function(){return nt})),r.d(e,"l",(function(){return at})),r.d(e,"o",(function(){return st})),r.d(e,"S",(function(){return ot})),r.d(e,"gb",(function(){return it})),r.d(e,"X",(function(){return ut})),r.d(e,"v",(function(){return lt})),r.d(e,"V",(function(){return ct}));var n=r("7258"),a="/ds_task/task";function s(t){return n["b"].post("/ds_task/metadata/search",t,{timeout:12e4})}function o(){return n["b"].get("/ds_task/sysdict/getTemplateList")}function i(t){return n["b"].get("/ds_task/dict/list",{params:t})}function u(t){return n["b"].get("/ds_task/artifact/list",{params:t})}function l(t){return n["b"].get("/ds_task/artifactversion/list",{params:t})}function c(t){return n["b"].get("/ds_task/flinkcluster/list",{params:t})}function d(t){return n["b"].get("/ds_task/flinkcluster/auto",{params:t})}function p(t){return n["b"].get("/ds_task/flinkcluster/noauto",{params:t})}function m(t){return n["b"].get("".concat(a,"/get"),{params:t})}function f(t){return n["b"].get("".concat(a,"/page"),{params:t,timeout:6e4})}function b(t){return n["b"].post("/ds_task/metadata/getddl",t)}function g(t){return n["b"].get("".concat(a,"/getInsertSql"),{params:t,timeout:6e5})}function h(t){return n["b"].post("/ds_task/metadata/getdispalyddl",t)}function k(t){return n["b"].get("".concat(a,"/getChildDependencies"),{params:{id:t}})}function v(t){return n["b"].get("".concat(a,"/backfill"),{params:t})}function y(t){return n["b"].put("".concat(a,"/onlineAndOffline"),null,{params:t})}function _(t){return n["b"].post("".concat(a,"/add"),t)}function F(t){return n["b"].put("".concat(a,"/update"),t)}function D(t){return n["b"].delete("".concat(a,"/new/delete"),{params:t})}function S(t){return n["b"].get("/ds_task/user/list",{params:{name:t}})}function w(t){return n["b"].get("/ds_task/label/list",{params:{name:t}})}function C(t){return n["b"].get("/ds_task/label/get",{params:{id:t}})}function T(t){return n["b"].post("/ds_task/label/add",t)}function j(t){return n["b"].put("/ds_task/label/update",t)}function O(t){return n["b"].delete("/ds_task/label/delete",{params:{id:t}})}function L(t){return n["b"].patch("/ds_task/collect/add",null,{params:t})}function P(t){return n["b"].get("/ds_task/collect/cancel",{params:t})}function $(t){return n["b"].get("/ds_task/collect/my",{params:t})}function I(t){return n["b"].get("/ds_task/task/listforlabel",{params:{name:t}})}function x(t){return n["b"].get("/ds_task/task/iam",{params:t})}function A(t){return n["b"].post("/ds_task/task/check",t,{timeout:18e4})}function q(t){return n["b"].get("/ds_task/task/name/search",{params:{name:t}})}function E(t){return n["b"].get("/ds_task/task/backfillDateDetail",{params:t})}function U(t){return n["b"].get("/ds_task/task/last7",{params:t})}function J(t){return n["b"].get("/ds_task/user/getEffectiveCostList",{params:{name:t}})}function M(t){return n["b"].get("/ds_task/task/getGitSqlFile",{params:t})}function R(t){return n["b"].post("/ds_task/task/sqlTbls",t,{headers:{"Content-Type":"multipart/form-data"}})}function N(t){return n["b"].post("/ds_task/task/getCrontab",t)}function G(t){return n["b"].get("/ds_task/taskversion/pages",{params:t})}function V(){return n["b"].get("/ds_task/auditlog/type?module=task")}function B(t){return n["b"].get("/ds_task/taskversion/verionSwitch",{params:t})}function z(t){return n["b"].post("/ds_task/task/addAndStart",t)}function Z(t){return n["b"].post("/ds_task/task/updateAndStart",t)}function Y(t){return n["b"].post("/ds_task/task/date/preview",t)}function H(t){return n["b"].post("/ds_task/task/mergeSmallFiles/jars",t)}function K(t){return n["b"].post("/ds_task/task/getTasks",t)}function Q(t){return n["b"].post("/ds_task/task/checkPath",t,{headers:{"Content-Type":"multipart/form-data"}})}function W(t){return n["b"].post("/ds_task/task/fastBackfill?taskId="+t.taskId,t)}function X(t){return n["b"].get("/ds_task/task/renderContent",{params:t})}function tt(t){return n["b"].post("/ds_task/metadata/preview",t)}function et(t){return n["b"].get("/ds_task/actor/sources/page",{params:t})}function rt(t){return n["b"].get("/ds_task/taskfolder/listFolder",{params:t})}function nt(t){return n["b"].post("/ds_task/taskfolder/saveFolder",t)}function at(t){return n["b"].get("/ds_task/taskfolder/deleteFolder",{params:t})}function st(t){return n["b"].post("/ds_task/taskfolder/editFolder",t)}function ot(t){return n["b"].get("/ds_task/taskfolder/listTask",{params:t})}function it(t){return n["b"].post("/ds_task/taskfolder/updateTask",t)}function ut(t){return n["b"].get("/ds_task/wechatAlert/listById?id=".concat(t))}function lt(t){return n["b"].post("/pipeline/cron/get",t)}function ct(t){return n["b"].get("/ds_task/task/templateRendering",{params:t})}},b207:function(t,e,r){"use strict";r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return s}));var n=r("7258");function a(t){return n["b"].get("/ds_task/validator/item/list?templateCode="+t)}function s(t,e){return n["b"].post("/ds_task/validator/check?templateCode="+t,e)}}}]);