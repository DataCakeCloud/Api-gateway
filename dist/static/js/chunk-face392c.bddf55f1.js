(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-face392c"],{"3b59":function(e,t,r){e.exports=r.p+"static/img/offset_tips.5be1bb3c.png"},"8e3d5":function(e,t,r){},"9a0f":function(e,t,r){"use strict";r("8e3d5")},b199:function(e,t,r){"use strict";r.d(t,"y",(function(){return n})),r.d(t,"W",(function(){return i})),r.d(t,"E",(function(){return o})),r.d(t,"p",(function(){return l})),r.d(t,"ab",(function(){return u})),r.d(t,"s",(function(){return c})),r.d(t,"r",(function(){return d})),r.d(t,"t",(function(){return m})),r.d(t,"Q",(function(){return p})),r.d(t,"T",(function(){return f})),r.d(t,"A",(function(){return h})),r.d(t,"O",(function(){return b})),r.d(t,"B",(function(){return g})),r.d(t,"q",(function(){return k})),r.d(t,"e",(function(){return v})),r.d(t,"g",(function(){return y})),r.d(t,"d",(function(){return F})),r.d(t,"ib",(function(){return _})),r.d(t,"n",(function(){return w})),r.d(t,"Y",(function(){return C})),r.d(t,"I",(function(){return T})),r.d(t,"H",(function(){return S})),r.d(t,"c",(function(){return L})),r.d(t,"hb",(function(){return I})),r.d(t,"m",(function(){return P})),r.d(t,"j",(function(){return x})),r.d(t,"f",(function(){return A})),r.d(t,"bb",(function(){return $})),r.d(t,"J",(function(){return M})),r.d(t,"F",(function(){return O})),r.d(t,"h",(function(){return D})),r.d(t,"db",(function(){return j})),r.d(t,"z",(function(){return q})),r.d(t,"R",(function(){return J})),r.d(t,"u",(function(){return E})),r.d(t,"D",(function(){return R})),r.d(t,"P",(function(){return V})),r.d(t,"w",(function(){return G})),r.d(t,"Z",(function(){return z})),r.d(t,"C",(function(){return B})),r.d(t,"eb",(function(){return N})),r.d(t,"a",(function(){return K})),r.d(t,"fb",(function(){return U})),r.d(t,"cb",(function(){return Y})),r.d(t,"G",(function(){return Z})),r.d(t,"U",(function(){return H})),r.d(t,"i",(function(){return Q})),r.d(t,"k",(function(){return W})),r.d(t,"K",(function(){return X})),r.d(t,"L",(function(){return ee})),r.d(t,"N",(function(){return te})),r.d(t,"M",(function(){return re})),r.d(t,"b",(function(){return ae})),r.d(t,"l",(function(){return se})),r.d(t,"o",(function(){return ne})),r.d(t,"S",(function(){return ie})),r.d(t,"gb",(function(){return oe})),r.d(t,"X",(function(){return le})),r.d(t,"v",(function(){return ue})),r.d(t,"V",(function(){return ce}));var a=r("7258"),s="/ds_task/task";function n(e){return a["b"].post("/ds_task/metadata/search",e,{timeout:12e4})}function i(){return a["b"].get("/ds_task/sysdict/getTemplateList")}function o(e){return a["b"].get("/ds_task/dict/list",{params:e})}function l(e){return a["b"].get("/ds_task/artifact/list",{params:e})}function u(e){return a["b"].get("/ds_task/artifactversion/list",{params:e})}function c(e){return a["b"].get("/ds_task/flinkcluster/list",{params:e})}function d(e){return a["b"].get("/ds_task/flinkcluster/auto",{params:e})}function m(e){return a["b"].get("/ds_task/flinkcluster/noauto",{params:e})}function p(e){return a["b"].get("".concat(s,"/get"),{params:e})}function f(e){return a["b"].get("".concat(s,"/page"),{params:e,timeout:6e4})}function h(e){return a["b"].post("/ds_task/metadata/getddl",e)}function b(e){return a["b"].get("".concat(s,"/getInsertSql"),{params:e,timeout:6e5})}function g(e){return a["b"].post("/ds_task/metadata/getdispalyddl",e)}function k(e){return a["b"].get("".concat(s,"/getChildDependencies"),{params:{id:e}})}function v(e){return a["b"].get("".concat(s,"/backfill"),{params:e})}function y(e){return a["b"].put("".concat(s,"/onlineAndOffline"),null,{params:e})}function F(e){return a["b"].post("".concat(s,"/add"),e)}function _(e){return a["b"].put("".concat(s,"/update"),e)}function w(e){return a["b"].delete("".concat(s,"/new/delete"),{params:e})}function C(e){return a["b"].get("/ds_task/user/list",{params:{name:e}})}function T(e){return a["b"].get("/ds_task/label/list",{params:{name:e}})}function S(e){return a["b"].get("/ds_task/label/get",{params:{id:e}})}function L(e){return a["b"].post("/ds_task/label/add",e)}function I(e){return a["b"].put("/ds_task/label/update",e)}function P(e){return a["b"].delete("/ds_task/label/delete",{params:{id:e}})}function x(e){return a["b"].patch("/ds_task/collect/add",null,{params:e})}function A(e){return a["b"].get("/ds_task/collect/cancel",{params:e})}function $(e){return a["b"].get("/ds_task/collect/my",{params:e})}function M(e){return a["b"].get("/ds_task/task/listforlabel",{params:{name:e}})}function O(e){return a["b"].get("/ds_task/task/iam",{params:e})}function D(e){return a["b"].post("/ds_task/task/check",e,{timeout:18e4})}function j(e){return a["b"].get("/ds_task/task/name/search",{params:{name:e}})}function q(e){return a["b"].get("/ds_task/task/backfillDateDetail",{params:e})}function J(e){return a["b"].get("/ds_task/task/last7",{params:e})}function E(e){return a["b"].get("/ds_task/user/getEffectiveCostList",{params:{name:e}})}function R(e){return a["b"].get("/ds_task/task/getGitSqlFile",{params:e})}function V(e){return a["b"].post("/ds_task/task/sqlTbls",e,{headers:{"Content-Type":"multipart/form-data"}})}function G(e){return a["b"].post("/ds_task/task/getCrontab",e)}function z(e){return a["b"].get("/ds_task/taskversion/pages",{params:e})}function B(){return a["b"].get("/ds_task/auditlog/type?module=task")}function N(e){return a["b"].get("/ds_task/taskversion/verionSwitch",{params:e})}function K(e){return a["b"].post("/ds_task/task/addAndStart",e)}function U(e){return a["b"].post("/ds_task/task/updateAndStart",e)}function Y(e){return a["b"].post("/ds_task/task/date/preview",e)}function Z(e){return a["b"].post("/ds_task/task/mergeSmallFiles/jars",e)}function H(e){return a["b"].post("/ds_task/task/getTasks",e)}function Q(e){return a["b"].post("/ds_task/task/checkPath",e,{headers:{"Content-Type":"multipart/form-data"}})}function W(e){return a["b"].post("/ds_task/task/fastBackfill?taskId="+e.taskId,e)}function X(e){return a["b"].get("/ds_task/task/renderContent",{params:e})}function ee(e){return a["b"].post("/ds_task/metadata/preview",e)}function te(e){return a["b"].get("/ds_task/actor/sources/page",{params:e})}function re(e){return a["b"].get("/ds_task/taskfolder/listFolder",{params:e})}function ae(e){return a["b"].post("/ds_task/taskfolder/saveFolder",e)}function se(e){return a["b"].get("/ds_task/taskfolder/deleteFolder",{params:e})}function ne(e){return a["b"].post("/ds_task/taskfolder/editFolder",e)}function ie(e){return a["b"].get("/ds_task/taskfolder/listTask",{params:e})}function oe(e){return a["b"].post("/ds_task/taskfolder/updateTask",e)}function le(e){return a["b"].get("/ds_task/wechatAlert/listById?id=".concat(e))}function ue(e){return a["b"].post("/pipeline/cron/get",e)}function ce(e){return a["b"].get("/ds_task/task/templateRendering",{params:e})}},b207:function(e,t,r){"use strict";r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n}));var a=r("7258");function s(e){return a["b"].get("/ds_task/validator/item/list?templateCode="+e)}function n(e,t){return a["b"].post("/ds_task/validator/check?templateCode="+e,t)}},cfd5:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"step2",class:"task"===e.source?"taskStep2":""},[r("steps-head",{attrs:{active:e.currentStep,direction:"task"===e.source?"vertical":"horizontal"},on:{handelStep:e.handelStep}}),e._v(" "),r("div",{staticClass:"step-content"},[r("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}]},[r("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[r("el-form-item",[r("el-radio-group",{attrs:{size:"small"},model:{value:e.ruleForm.typeCode,callback:function(t){e.$set(e.ruleForm,"typeCode",t)},expression:"ruleForm.typeCode"}},[r("el-radio-button",{attrs:{label:"ARTIFACT"}},[e._v("选择上传Jar版本")]),e._v(" "),r("el-radio-button",{attrs:{label:"ONLINE"}},[e._v("输入Jar地址")])],1)],1),e._v(" "),"ARTIFACT"===e.ruleForm.typeCode?[r("el-form-item",{attrs:{label:"Jar文件",prop:"displayDependJars.0.artifactId",rules:e.rules.artifactId}},[r("el-select",{attrs:{placeholder:"请选择Jar文件",filterable:""},on:{change:e.artifactChange},model:{value:e.ruleForm.displayDependJars[0].artifactId,callback:function(t){e.$set(e.ruleForm.displayDependJars[0],"artifactId",t)},expression:"ruleForm.displayDependJars[0].artifactId"}},e._l(e.artifactList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Jar版本",prop:"displayDependJars.0.id",rules:e.rules.dependJars}},[r("el-select",{attrs:{placeholder:"请选择Jar版本",filterable:""},model:{value:e.ruleForm.displayDependJars[0].id,callback:function(t){e.$set(e.ruleForm.displayDependJars[0],"id",t)},expression:"ruleForm.displayDependJars[0].id"}},e._l(e.versionList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.displayVersion,value:e.id}})})),1)],1)]:e._e(),e._v(" "),"ONLINE"===e.ruleForm.typeCode?[r("el-form-item",{attrs:{label:"Jar地址",prop:"jarUrl"}},[r("el-input",{attrs:{placeholder:"请输入jar地址"},model:{value:e.ruleForm.jarUrl,callback:function(t){e.$set(e.ruleForm,"jarUrl",t)},expression:"ruleForm.jarUrl"}})],1)]:e._e(),e._v(" "),r("el-form-item",{attrs:{label:"Main Class",prop:"mainClass"}},[r("el-input",{attrs:{placeholder:"请输入mainClass"},model:{value:e.ruleForm.mainClass,callback:function(t){e.$set(e.ruleForm,"mainClass",t)},expression:"ruleForm.mainClass"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Args"}},[r("div",{class:["monaco-editor-wrap",e.fullscreen?"table-fullscreen":""]},[r("i",{staticClass:"btn-full-screen el-icon-full-screen",attrs:{title:e.fullscreen?"还原":"放大"},on:{click:function(t){e.fullscreen=!e.fullscreen}}}),e._v(" "),1===e.currentStep?r("monaco-editor",{key:e.currentStep,ref:"monaco",attrs:{"word-wrap":"on"},model:{value:e.ruleForm.mainClassArgs,callback:function(t){e.$set(e.ruleForm,"mainClassArgs",t)},expression:"ruleForm.mainClassArgs"}}):e._e()],1)]),e._v(" "),r("el-form-item",{attrs:{label:"Cluster",prop:"flinkClusterId"}},[r("el-select",{attrs:{filterable:""},model:{value:e.ruleForm.flinkClusterId,callback:function(t){e.$set(e.ruleForm,"flinkClusterId",t)},expression:"ruleForm.flinkClusterId"}},e._l(e.clusterList,(function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.clickSenior}},[e._v("高级设置")])],1)],2)],1),e._v(" "),2===e.currentStep?r("step-three",{ref:"stepThree",attrs:{"is-show-dispatch":e.seniorForm.isBatchTask,"is-show-input-btn":!0,"is-show-output-btn":!0,"is-input-edit":!0,"is-output-edit":!0,"is-jar":!0,"is-show-offset":!1,"rule-form":e.ruleForm}}):e._e(),e._v(" "),3===e.currentStep?r("ViewParams",{attrs:{"region-list":e.regionList,info:e.info,content:e.ruleForm.mainClassArgs,"version-list":e.versionList,"cluster-list":e.clusterList,"artifact-list":e.artifactList,"is-show-dispatch":e.seniorForm.isBatchTask,"is-show-input-btn":!0,"is-show-output-btn":!0,"is-input-edit":!0,"is-output-edit":!0,"is-jar":!0,"is-show-offset":!1},on:{jumpStep:function(t){return e.currentStep=t}}}):e._e(),e._v(" "),r("el-drawer",{attrs:{title:"高级设置",visible:e.drawerVisible,"with-header":!1,direction:"rtl",size:500,"before-close":e.confirm},on:{"update:visible":function(t){e.drawerVisible=t}}},[r("el-button",{staticClass:"drawer-btn",attrs:{type:"primary"},on:{click:e.confirm}},[e._v("确认")]),e._v(" "),r("el-tabs",{attrs:{type:"card"}},[r("el-tab-pane",{staticClass:"senior-set",attrs:{label:"高级设置"}},[r("el-form",{ref:"seniorForm",attrs:{model:e.seniorForm,rules:e.seniorRules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"flink job类型",required:""}},[r("el-radio-group",{model:{value:e.seniorForm.isBatchTask,callback:function(t){e.$set(e.seniorForm,"isBatchTask",t)},expression:"seniorForm.isBatchTask"}},[r("el-radio",{attrs:{label:!0}},[e._v("批")]),e._v(" "),r("el-radio",{attrs:{label:!1}},[e._v("流")])],1)],1),e._v(" "),e.seniorForm.isBatchTask?r("el-form-item",{attrs:{label:"邮箱",prop:"emails"}},[r("el-input",{staticClass:"senior-input",attrs:{placeholder:"输入告警邮件发送邮箱",clearable:""},model:{value:e.seniorForm.emails,callback:function(t){e.$set(e.seniorForm,"emails",t)},expression:"seniorForm.emails"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"负责人"}},[r("el-select",{staticClass:"senior-input",attrs:{placeholder:"请输入负责人",clearable:"",filterable:"",remote:"","remote-method":function(t){e.remoteMethod(t,"ownerList")},loading:e.loading,"popper-class":"custom-popper"},model:{value:e.seniorForm.owner,callback:function(t){e.$set(e.seniorForm,"owner",t)},expression:"seniorForm.owner"}},e._l(e.ownerList,(function(t){return r("el-option",{key:t.shareId,attrs:{value:t.shareId,label:t.name}},[r("div",{staticStyle:{"max-width":"250px","word-break":"break-all"}},[e._v("("+e._s(t.staffId)+")-"+e._s(t.name)+e._s(t.deptFullPath?"-"+t.deptFullPath:""))])])})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"用户组",prop:"dsGroups",rules:[{required:!0,message:"请选择用户组",trigger:["blur","change"]}]}},[r("el-select",{attrs:{disabled:"",placeholder:"请选择用户组",multiple:"",filterable:""},model:{value:e.seniorForm.dsGroups,callback:function(t){e.$set(e.seniorForm,"dsGroups",t)},expression:"seniorForm.dsGroups"}},e._l(e.userGroupList,(function(e){return r("el-option",{key:e.id,attrs:{value:e.id,label:e.name}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"Parallelism"}},[r("el-input-number",{attrs:{min:1,max:500,label:"描述文字"},model:{value:e.seniorForm.parallelism,callback:function(t){e.$set(e.seniorForm,"parallelism",t)},expression:"seniorForm.parallelism"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"TM CPU"}},[r("el-input-number",{attrs:{min:.1,precision:1,step:1},model:{value:e.seniorForm.tmCpu,callback:function(t){e.$set(e.seniorForm,"tmCpu",t)},expression:"seniorForm.tmCpu"}}),e._v(" 核\n              "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"kubernetes.taskmanager.cpu",placement:"top"}},[r("i",{staticClass:"el-icon-question"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"TM Memory"}},[r("el-input-number",{attrs:{min:1,step:1},model:{value:e.seniorForm.tmMemory,callback:function(t){e.$set(e.seniorForm,"tmMemory",t)},expression:"seniorForm.tmMemory"}}),e._v(" G\n              "),r("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"taskmanager.memory.process.size",placement:"top"}},[r("i",{staticClass:"el-icon-question"})])],1),e._v(" "),r("el-form-item",{attrs:{label:"超时时间"}},[r("el-input-number",{model:{value:e.seniorForm.checkpointTimeout,callback:function(t){e.$set(e.seniorForm,"checkpointTimeout",t)},expression:"seniorForm.checkpointTimeout"}}),e._v(" 秒 ")],1),e._v(" "),r("el-form-item",{staticClass:"other-param",attrs:{label:"报警类型"}},[r("el-popover",{attrs:{placement:"left",width:"320",trigger:"hover"}},[r("div",[e._v('指定当任务实例处于“成功”、“失败”、“重试”、“开始”状态时，以怎样的报警方式进行通知。注："失败"指实例最终运行失败，“重试”则指实例在指定重试次数内每次重启时。')]),e._v(" "),r("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer",color:"#409eff"},attrs:{slot:"reference"},slot:"reference"})]),e._v(" "),r("el-checkbox",{class:{"active-checkbox":"failure"===e.alertTypeValue},staticStyle:{"margin-right":"16px"},attrs:{value:e.seniorForm.alertModel.failure.alertType.length>0},on:{change:function(t){return e.checkAlertType("failure")}}},[e._v("失败")]),e._v(" "),e.alertTypeValue?r("div",{staticClass:"alert-method-box"},[r("el-form-item",{attrs:{label:"报警方式","label-width":"70px",size:"mini"}},[r("el-checkbox-group",{model:{value:e.seniorForm.alertModel[e.alertTypeValue].alertType,callback:function(t){e.$set(e.seniorForm.alertModel[e.alertTypeValue],"alertType",t)},expression:"seniorForm.alertModel[alertTypeValue].alertType"}},e._l(e.alertList,(function(t,a){return r("el-checkbox",{key:a,staticStyle:{"margin-right":"10px !important"},attrs:{label:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),r("div",[e.seniorForm.alertModel[e.alertTypeValue].alertType.includes("enterprise_wechat")?r("div",[r("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"微信群token：","label-width":"130px",size:"mini",prop:"alertModel."+e.alertTypeValue+".wechatRobotKey",rules:[{required:!0,message:"请填写微信群token",trigger:["blur","change"]}]}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.seniorForm.alertModel[e.alertTypeValue].wechatRobotKey,callback:function(t){e.$set(e.seniorForm.alertModel[e.alertTypeValue],"wechatRobotKey",t)},expression:"seniorForm.alertModel[alertTypeValue].wechatRobotKey"}})],1),e._v(" "),r("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"此群需要@：","label-width":"130px",size:"mini",prop:"alertModel."+e.alertTypeValue+".wechatReceivers",rules:[{required:!0,message:"请选择微信群@对象",trigger:["blur","change"]}]}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择@对象",size:"small",clearable:"",filterable:"",remote:"",multiple:"","reserve-keyword":"","value-key":"shareId","remote-method":function(t){e.remoteMethod(t,"sendList")},loading:e.loading,"popper-class":"custom-popper"},model:{value:e.seniorForm.alertModel[e.alertTypeValue].wechatReceivers,callback:function(t){e.$set(e.seniorForm.alertModel[e.alertTypeValue],"wechatReceivers",t)},expression:"seniorForm.alertModel[alertTypeValue].wechatReceivers"}},e._l(e.sendList,(function(t){return r("el-option",{key:t.shareId,attrs:{value:t,label:t.shareId}},[r("div",{staticStyle:{"max-width":"420px","word-break":"break-all"}},[e._v("("+e._s(t.staffId)+")-"+e._s(t.name)+e._s(t.deptFullPath?"-"+t.deptFullPath:""))])])})),1)],1)],1):e._e(),e._v(" "),e.seniorForm.alertModel[e.alertTypeValue].alertType.includes("email")?r("div",[r("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"邮件接收人：","label-width":"130px",size:"mini",prop:"alertModel."+e.alertTypeValue+".emailReceivers",rules:[{required:!0,message:"请选择邮件接收人",trigger:["blur","change"]}]}},[r("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择邮件接收人",size:"small",clearable:"",filterable:"",remote:"","reserve-keyword":"",multiple:"","value-key":"shareId","remote-method":function(t){e.remoteMethod(t,"sendList")},loading:e.loading,"popper-class":"custom-popper"},model:{value:e.seniorForm.alertModel[e.alertTypeValue].emailReceivers,callback:function(t){e.$set(e.seniorForm.alertModel[e.alertTypeValue],"emailReceivers",t)},expression:"seniorForm.alertModel[alertTypeValue].emailReceivers"}},e._l(e.sendList,(function(t){return r("el-option",{key:t.shareId,attrs:{value:t,label:t.shareId}},[r("div",{staticStyle:{"max-width":"420px","word-break":"break-all"}},[e._v("("+e._s(t.staffId)+")-"+e._s(t.name)+e._s(t.deptFullPath?"-"+t.deptFullPath:""))])])})),1)],1)],1):e._e()])],1):e._e()],1),e._v(" "),r("el-divider"),e._v(" "),r("el-form-item",{attrs:{label:"其他参数"}},[r("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-plus"},on:{click:e.addParam}})],1),e._v(" "),r("div",{staticClass:"param-wrap"},e._l(e.seniorForm.params,(function(t,a){return r("div",{key:a,staticClass:"param-item"},[r("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"key"},model:{value:t.key,callback:function(r){e.$set(t,"key",r)},expression:"item.key"}}),e._v(" :\n                "),r("el-input",{staticStyle:{width:"120px"},attrs:{placeholder:"value"},model:{value:t.value,callback:function(r){e.$set(t,"value",r)},expression:"item.value"}}),e._v(" "),r("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.deleteParam(a)}}})],1)})),0)],1)],1)],1)],1)],1),e._v(" "),r("div",{staticClass:"btn-wrap"},[r("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")]),e._v(" "),e.isShowPublish||!e.isShowPublish&&1!==e.currentStep?r("el-button",{on:{click:e.preStep}},[e._v("上一步")]):e._e(),e._v(" "),r("el-button",{attrs:{type:"primary",disabled:!e.canEdit&&("task"===e.source&&3===e.currentStep||"task"!==e.source&&2===e.currentStep),loading:e.btnLoading},on:{click:e.nextStep}},[e._v(e._s("task"===e.source&&3!==e.currentStep||1===e.currentStep?"下一步":e.copyId?"确认复制":"保存"))]),e._v(" "),e.isShowPublish&&e.currentStep>=2&&e.seniorForm.isBatchTask?r("el-checkbox",{staticClass:"task-checkbox",attrs:{disabled:e.disabled},model:{value:e.ruleForm.invokingStatus,callback:function(t){e.$set(e.ruleForm,"invokingStatus",t)},expression:"ruleForm.invokingStatus"}},[e._v("切换至该版本")]):e._e()],1),e._v(" "),r("valid-params",{ref:"validParams",attrs:{code:e.ruleForm.templateCode},on:{save:e.save}})],1)},s=[],n=r("2dfe"),i=r("042b"),o=r("b03b"),l=r("b199"),u=r("7e3c"),c=r("b893"),d=r("3dc0"),m=r("ffe0");function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t=g(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e){var t=k(e,"string");return"symbol"===p(t)?t:String(t)}function k(e,t){if("object"!==p(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!==p(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function v(e){return w(e)||_(e)||F(e)||y()}function y(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(e,t){if(e){if("string"===typeof e)return C(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(e,t):void 0}}function _(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function w(e){if(Array.isArray(e))return C(e)}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var T=function(e,t,r){var a=/^[a-zA-Z]([-a-zA-Z0-9]*[a-zA-Z0-9])?(\.[a-zA-Z0-9]([-a-zA-Z0-9]*[a-zA-Z0-9])?)*$/;a.test(t)?r():r(new Error("名字只能包含a-z,A-Z,0-9或-；开始需为字符"))},S=function(e,t,r){var a=/^([\w-])+(\.[\w-]+)*$/i;a.test(t)?r():r(new Error("请输入正确的Main Class"))},L={components:{StepsHead:n["a"],StepThree:i["a"],MonacoEditor:o["a"],ValidParams:d["a"],ViewParams:m["a"]},props:{data:{type:Object,default:function(){return{}}},isShowPublish:{type:Boolean,default:!1},source:{type:String,default:"task"}},data:function(){return{btnLoading:!1,currentStep:1,regionList:c["l"],alertList:[],isEdit:!1,ruleForm:{region:"",invokingStatus:!0,templateCode:"StreamingJAR",typeCode:"ARTIFACT",displayDependJars:[{artifactId:"",id:""}],jarUrl:"",mainClass:"",mainClassArgs:'--demo--\n--这是一串带代码我想在这折行请手动输入“\\”\n--job_name test.--ads_table \\\n--dt {{ (execution_date - macros.timedelta(days=1)).strftime("%Y%m%d") }}',flinkClusterId:"",name:"",description:"",dependTypes:[],triggerParam:{type:"data",isIrregularSheduler:1,outputGranularity:"daily",crontabParam:{range:[],interval:5,startTime:"00:00",endTime:"23:59",fixedTime:"00:00"},crontab:""},eventDepends:[],inputDataset:[],outputDataset:[],cost:[{key:"",value:"100"}]},rules:{region:[{required:!0,message:"请选择区域",trigger:["blur","change"]}],name:[{required:!0,message:"请输入应用名称",trigger:["blur","change"]},{validator:T,trigger:["blur","change"]}],artifactId:[{required:!0,message:"请选择Jar文件",trigger:["blur","change"]}],dependJars:[{required:!0,message:"请选择Jar文件版本",trigger:["blur","change"]}],jarUrl:[{required:!0,message:"请输入Jar地址",trigger:["blur","change"]}],mainClass:[{required:!0,message:"请输入主类名",trigger:["blur","change"]},{validator:S,trigger:["blur","change"]}],flinkClusterId:[{required:!0,message:"请选择Cluster",trigger:["blur","change"]}]},artifactList:[],versionList:[],clusterList:[],autoClusterList:[],notautoClusterList:[],drawerVisible:!1,fullscreen:!1,seniorForm:{isBatchTask:!1,emails:"",alertMethod:["dingTalk"],alertType:[2],alertModel:{success:{alertType:[],notifyCollaborator:!1},failure:{alertType:[],notifyCollaborator:!1},retry:{alertType:[],notifyCollaborator:!1},start:{alertType:[],notifyCollaborator:!1}},owner:"",collaborators:[],dsGroups:[],parallelism:1,huaweiIam:"",awsIam:"",tmCpu:1,tmMemory:4,checkpointTimeout:100,params:[],isAutoScaleMode:!1,strategyList:[]},seniorRules:{emails:[{required:!0,message:"请输入邮箱",trigger:["blur","change"]}]},ownerList:[],sendList:[],collaboratorsList:[],huaweiList:[],awsList:[],userGroupList:[],loading:!1,queryId:"",copyId:this.$route.query.copyId,canEdit:!0,copyMsg:null,checkList:[],scaleMode:{operator:{name:"OPERATOR_PROCESS_STRATEGY",topic:"",kafkaCluster:"",coolingTime:120,minimumPercentage:1.5,minPar:1,maxPar:512},kafka:{name:"KAFKA_LAG_STRATEGY",topic:"",kafkaCluster:"",consumer_group:"",delayTime:1800,expandProportion:1.5,minDelayCount:1e3,maxDelayCount:2e5,coolingTime:120,minPar:1,maxPar:512},periodic:{name:"PERIODIC_STRATEGY",periodicList:[{startTime:0,endTime:24,par:1}]}},modeRules:{operator:{topic:[{required:!0,message:"请输入topic名称",trigger:["blur","change"]}],kafkaCluster:[{required:!0,message:"请输入KAFKA集群",trigger:["blur","change"]}],coolingTime:[{required:!0,message:"请输入冷却时间",trigger:["blur","change"]}],minimumPercentage:[{required:!0,message:"请输入扩缩容忍度",trigger:["blur","change"]}],minPar:[{required:!0,message:"请输入最小并行度",trigger:["blur","change"]}],maxPar:[{required:!0,message:"请输入最大并行度",trigger:["blur","change"]}]},kafka:{topic:[{required:!0,message:"请输入topic名称",trigger:["blur","change"]}],kafkaCluster:[{required:!0,message:"请输入KAFKA集群",trigger:["blur","change"]}],consumer_group:[{required:!0,message:"请输入消费者组",trigger:["blur","change"]}],delayTime:[{required:!0,message:"请输入延迟时间",trigger:["blur","change"]}],expandProportion:[{required:!0,message:"请输入扩缩比例",trigger:["blur","change"]}],minDelayCount:[{required:!0,message:"请输入最小延迟条数",trigger:["blur","change"]}],maxDelayCount:[{required:!0,message:"请输入最大延迟条数",trigger:["blur","change"]}],coolingTime:[{required:!0,message:"请输入冷却时间",trigger:["blur","change"]}],minPar:[{required:!0,message:"请输入最小并行度",trigger:["blur","change"]}],maxPar:[{required:!0,message:"请输入最大并行度",trigger:["blur","change"]}]}},alertTypeValue:""}},computed:{info:function(){return Object.assign({},this.ruleForm,this.seniorForm)},disabled:function(){return 3===this.currentStep}},watch:{data:{handler:function(e){Object.keys(e).length>0&&(this.getTaskInfo(e),this.isEdit=!0)},deep:!0,immediate:!0}},created:function(){var e,t=this;if(null!=(e=this.ruleForm.oldAlertList)&&e.length&&!this.$route.query.copyId)this.alertList=this.seniorForm.oldAlertList;else{var r,a=null==(r=JSON.parse(this.$store.getters["user/systemConf"].config))?void 0:r.alarm_channel;a.map((function(e){switch(e){case"enterprise_wechat":t.alertList.push({label:"企业微信",value:"enterprise_wechat"});break;case"email":t.alertList.push({label:"邮件",value:"email"});break}})),this.ruleForm.oldAlertList=this.alertList}this.seniorForm.dsGroups=this.$store.getters["user/currentUserGroup"].id?[this.$store.getters["user/currentUserGroup"].id]:[],this.init(),document.onkeyup=function(e){"Escape"!==e.code&&27!==e.keycode||(t.fullscreen=!1)}},mounted:function(){var e=this;c["l"].then((function(t){e.regionList=t,setTimeout((function(){e.isEdit||(e.ruleForm.region=t[0].value,e.changeRegion(t[0].value))}))}))},destroyed:function(){this.copyMsg&&this.copyMsg.close()},methods:{handelStep:function(e){e<1?this.$router.push("/task/step1"):this.currentStep=e},init:function(){var e=this;Object(l["F"])().then((function(t){var r=t.data;r&&(e.huaweiList=r.huawei,e.awsList=r.aws)})),Object(u["j"])().then((function(t){var r=t.data;e.userGroupList=r}))},getJarFile:function(){var e=this;Object(l["p"])({typeCode:"JAR",region:this.ruleForm.region}).then((function(t){var r=t.data;e.artifactList=r}))},getTaskInfo:function(e){var t=this;this.copyId||(this.queryId=e.id);var r=JSON.parse(e.runtimeConfig);this.ruleForm.region=r.region,this.getCluster(),this.getJarFile(),r.cost&&(this.ruleForm.cost=r.cost),delete r.cost,this.seniorForm=Object.assign(this.seniorForm,r),this.ruleForm.typeCode=e.typeCode,this.ruleForm.oldAlertList=e.oldAlertList,this.ruleForm.jarUrl=e.jarUrl,this.ruleForm.mainClass=e.mainClass,this.ruleForm.mainClassArgs=e.mainClassArgs,this.$refs.monaco&&this.$refs.monaco.setCode(e.mainClassArgs),this.ruleForm.flinkClusterId=e.flinkClusterId,this.ruleForm.name=e.name,this.ruleForm.description=e.description,this.$set(this.ruleForm,"online",e.online),this.ruleForm.inputDataset=JSON.parse(e.inputDataset)||[],this.ruleForm.outputDataset=JSON.parse(e.outputDataset)||[],this.ruleForm.inputDataset.length&&this.ruleForm.inputDataset.forEach((function(e){e.metadata&&""!==e.metadata.table?t.$set(e,"isMetadataSel",!0):t.$set(e,"isMetadataSel",!1)})),this.ruleForm.outputDataset.length&&this.ruleForm.outputDataset.forEach((function(e){e.metadata&&""!==e.metadata.table?t.$set(e,"isMetadataSel",!0):t.$set(e,"isMetadataSel",!1)})),e.displayDependJars&&e.displayDependJars.length?(this.artifactChange(e.displayDependJars[0].artifactId),this.ruleForm.displayDependJars=e.displayDependJars.map((function(e){return{artifactId:e.artifactId,id:e.id}}))):this.$set(this.ruleForm,"displayDependJars",[{artifactId:"",id:""}]),this.seniorForm.collaborators.length&&this.seniorForm.collaborators.map((function(e){Object(l["Y"])(e).then((function(e){var r,a=e.data;(r=t.collaboratorsList).push.apply(r,v(a))}))})),this.seniorForm.isAutoScaleMode&&(this.clusterList=this.autoClusterList),e.dependTypes&&(this.ruleForm.dependTypes=JSON.parse(e.dependTypes)),e.triggerParam&&Object.assign(this.ruleForm.triggerParam,JSON.parse(e.triggerParam)),e.eventDepends&&(this.ruleForm.eventDepends=JSON.parse(e.eventDepends)),this.copyId?(this.ruleForm.name=e.name+"-copy",this.seniorForm.owner=this.$store.getters.userInfo.userId):this.canEdit=e.canEdit,this.checkList=this.seniorForm.strategyList.map((function(e){var r=e.name.split("_")[0].toLowerCase();return t.scaleMode[r]=e,e.name}))},getCluster:function(){var e=this,t={region:this.ruleForm.region};Object(l["s"])(t).then((function(t){var r=t.data;e.clusterList=r}))},changeRegion:function(e){e&&(this.ruleForm.flinkClusterId="",this.ruleForm.displayDependJars=[{artifactId:"",id:""}],this.getCluster(),this.getJarFile())},changeModel:function(e){this.clusterList=e?this.autoClusterList:this.notautoClusterList},clickSenior:function(){this.drawerVisible=!0,this.seniorForm.owner||(this.seniorForm.owner=this.$store.getters.userInfo.userId),this.remoteMethod(this.seniorForm.owner,"ownerList"),this.remoteMethod("","sendList")},artifactChange:function(e){var t=this;Object(l["ab"])({artifactId:e,region:this.ruleForm.region}).then((function(e){var r=e.data;t.versionList=r}))},remoteMethod:function(e,t){var r=this;this.loading=!0,Object(l["Y"])(e).then((function(e){r.loading=!1;var a=e.data;r[t]=a}))},addParam:function(){var e=this.seniorForm.params.length;e>0&&!this.seniorForm.params[e-1].key?this.$message({type:"warning",message:"请先输入当前参数的key！"}):this.seniorForm.params.push({key:"",value:""})},deleteParam:function(e){this.seniorForm.params.splice(e,1)},addPeriod:function(e){this.scaleMode.periodic.periodicList.push({startTime:e+1,endTime:24,par:1})},removePeriod:function(){this.scaleMode.periodic.periodicList.pop()},checkForm:function(e){var t=this;return new Promise((function(r,a){t.$refs[e].validate((function(e){e?r():a()}))}))},confirm:function(){var e=this,t=[this.checkForm("seniorForm")];this.checkList.length&&t.push(this.checkForm("scaleMode")),Promise.all(t).then((function(){if(e.seniorForm.strategyList=[],e.seniorForm.isAutoScaleMode&&e.checkList.length>0&&(e.checkList.includes("OPERATOR_PROCESS_STRATEGY")&&e.seniorForm.strategyList.push(e.scaleMode.operator),e.checkList.includes("KAFKA_LAG_STRATEGY")&&e.seniorForm.strategyList.push(e.scaleMode.kafka),e.checkList.includes("PERIODIC_STRATEGY"))){var t=e.scaleMode.periodic.periodicList.at(-1);if(24!==t.endTime)return void e.$message.warning("周期性策略 时间区间结束时间必须为24");e.seniorForm.strategyList.push(e.scaleMode.periodic)}e.drawerVisible=!1})).catch((function(){e.$message.warning("高级设置中有必填项未填写哦～")}))},preStep:function(){1===this.currentStep?this.$router.push("/task/step1"):this.currentStep--},nextStep:function(e){var t=this;if(1===this.currentStep)this.$refs.ruleForm.validate((function(e){e&&(t.queryId||(t.seniorForm.isBatchTask?(t.ruleForm.dependTypes=["event"],t.ruleForm.eventDepends=[{dependId:"",dependGra:"",dateCalculationParam:{},unitOffset:0,useDateCalcuParam:!1,granularity:"",taskId:""}]):(t.ruleForm.dependTypes=["dataset"],t.ruleForm.eventDepends=[])),t.currentStep++)}));else if(2===this.currentStep&&"task"===this.source)this.$refs.stepThree.$refs.ruleForm.validate((function(e){e&&(t.currentStep++,t.$nextTick((function(){document.documentElement.scrollTo(0,0)})))}));else{if(this.seniorForm.isBatchTask){if(this.ruleForm.dependTypes.includes("dataset")&&!this.ruleForm.inputDataset.length)return this.$message.error("至少包含一个前置依赖"),!1;if(!this.ruleForm.outputDataset.length)return this.$message.error("至少包含一个生成数据集"),!1}var r=0;if(this.ruleForm.cost.forEach((function(e){r+=parseInt(e.value)})),100!==r)return this.$message.error("成本归属占比总额必须是100哦"),!1;var a=!1;if(this.ruleForm.dependTypes.includes("event")&&0===this.ruleForm.eventDepends.length&&(a=!0,this.$message.warning("请至少添加一条内部依赖")),a)return;this.seniorForm.source||(this.seniorForm.source=this.source);var s=h(h({},c["b"](this.ruleForm)),{},{runtimeConfig:h(h({},this.seniorForm),{},{cost:this.ruleForm.cost})});delete s.cost,s.inputDataset.forEach((function(e){e.completePath&&delete e.completePath,e.sourceTableList&&delete e.sourceTableList})),s.outputDataset.forEach((function(e){e.completePath&&delete e.completePath})),this.$store.getters.userInfo&&!s.runtimeConfig.owner&&(s.runtimeConfig.owner=this.$store.getters.userInfo.userId),this.queryId&&(s.id=this.queryId),s.runtimeConfig.region=this.ruleForm.region,s.folderId=this.$route.query.folderId,this.$refs.validParams.show(s)}},save:function(e){this.seniorForm.isBatchTask?this.$emit("save",e,"start"):this.$emit("save",e)},checkAlertType:function(e){this.alertTypeValue!==e?this.alertTypeValue=e:this.alertTypeValue=""}}},I=L,P=(r("9a0f"),r("2877")),x=Object(P["a"])(I,a,s,!1,null,"7d84c6c4",null);t["default"]=x.exports}}]);