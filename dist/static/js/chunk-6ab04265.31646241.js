(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-6ab04265"],{"5e62":function(t,e,a){"use strict";a("a44b")},7011:function(t,e,a){},7668:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticStyle:{"min-height":"calc(100vh - 70px)"}},[a("el-page-header",{staticClass:"page-header",attrs:{content:"公告管理"},on:{back:t.goBack}}),t._v(" "),a("el-form",{attrs:{inline:!0,model:t.params,"label-position":"top","label-width":"80px"}},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("div",[a("el-button",{attrs:{type:"primary"},on:{click:t.handleAnnouncement}},[t._v("新建公告")])],1),t._v(" "),a("div",[a("el-form-item",{attrs:{prop:"online"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择状态"},on:{change:t.page},model:{value:t.params.online,callback:function(e){t.$set(t.params,"online",e)},expression:"params.online"}},[a("el-option",{attrs:{label:"上线",value:1}}),t._v(" "),a("el-option",{attrs:{label:"下线",value:0}})],1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{staticClass:"search-input",staticStyle:{"min-width":"200px"},attrs:{placeholder:"请输入公告名称","prefix-icon":"el-icon-search",clearable:""},on:{change:t.page},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1)],1)])],1),t._v(" "),t.list.length||t.loading?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,"highlight-current-row":"",border:"","header-row-class-name":"custom-table-head"}},[a("el-table-column",{attrs:{label:"公告名称",prop:"name",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{slot:"label",effect:"dark",content:t.b64_to_utf8(e.row.name),placement:"right"},slot:"label"},[a("div",{staticClass:"cell-ellipsis",attrs:{title:"点击可分享"},on:{click:function(a){return t.handleShare(e.row)}}},[t._v(t._s(t.b64_to_utf8(e.row.name)))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态",prop:"online",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(0===e.row.online?"已下线":"已上线")+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"发布时间",prop:"updateTime",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.getTime(e.row.updateTime))+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleOnlineOffline(e.row)}}},[t._v(t._s(0===e.row.online?"上线":"下线"))]),t._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleDetail(e.row)}}},[t._v("查看")]),t._v(" "),e.row.online?t._e():a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("编辑")]),t._v(" "),e.row.online?t._e():a("el-button",{attrs:{loading:e.row.deleteLoading,disabled:e.row.deleteLoading,type:"text"},on:{click:function(a){return t.handleDelete(e.row,e.$index)}}},[t._v("删除")])]}}])})],1),t._v(" "),a("el-pagination",{attrs:{"current-page":t.params.pageNum,"page-sizes":[10,20,30,40],"page-size":t.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1):a("el-empty",{attrs:{description:"无公告数据"}}),t._v(" "),a("CreatEditAnnoucement",{attrs:{visible:t.creatEditAnnoucementVisible,"edit-data":t.editData,loading:t.detailLoading},on:{"update:visible":function(e){t.creatEditAnnoucementVisible=e},updateList:t.page}}),t._v(" "),a("DynamiStateDetail",{attrs:{visible:t.dynamiStateDetailVisible,title:t.title,detail:t.detail,loading:t.detailLoading},on:{"update:visible":function(e){t.dynamiStateDetailVisible=e}}})],1)},i=[],o=a("ed08"),r=a("f904"),l=a.n(r),s=a("5fd4"),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{title:"新建公告",visible:t.visible,width:"750","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisiable=e}}},[a("el-form",{ref:"form",attrs:{model:t.params,rules:t.rules,"label-position":"left","label-width":"80px"}},[a("el-form-item",{attrs:{prop:"name",label:"公告名称"}},[a("el-input",{attrs:{placeholder:"请输入公告名称"},model:{value:t.params.name,callback:function(e){t.$set(t.params,"name",e)},expression:"params.name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"content",label:"公告内容"}},[a("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},on:{blur:function(e){return t.onEditorBlur(e)},focus:function(e){return t.onEditorFocus(e)},ready:function(e){return t.onEditorReady(e)}},model:{value:t.params.content,callback:function(e){t.$set(t.params,"content",e)},expression:"params.content"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.submitLoading,disabled:t.submitLoading},on:{click:t.ok}},[t._v("确定")])],1)],1)},u=[],d=a("5f87"),p=(a("a753"),a("8096"),a("14e1"),a("953d")),m=a("1a9c");p["Quill"].register("modules/ImageExtend",m["a"]);var b={name:"CreatAnnoucement",components:{quillEditor:p["quillEditor"]},props:{visible:{type:Boolean,required:!0},loading:Boolean,editData:{type:Object,default:function(){}}},data:function(){var t=["development","cloud-aws-development"];return{dialogVisiable:this.visible,submitLoading:!1,params:{name:"",content:""},editorOption:{placeholder:"请输入公告内容... ...",modules:{ImageExtend:{loading:!0,name:"image",size:10,action:"".concat(t.includes("cloud-aws-production")?Object({NODE_ENV:"production",VUE_APP_IS_CLOUD:"true",VUE_APP_ENV:"cloud-aws-production",VUE_APP_QIANKUN_NAME:"lakecat",VUE_APP_NAME:"DataCake Cloud",VUE_APP_BI_URL:"https://bi.ushareit.org/",VUE_APP_JH_URL:"https://jupyterhub-sg.ushareit.org/",VUE_APP_SH_URL:"https://sharesql.ushareit.org/sharesql",VUE_APP_CLUSTER_MANAGER_URL:"https://cluster-manager.datacake.cloud/cluster-service/cluster-list",VUE_APP_FRONTEND_URL:"https://datastudio.ushareit.org",VUE_APP_DATACAKE_FRONTEND_ORIGIN:"/#/home",VUE_APP_DATACAKE_FRONTEND:"/#/",VUE_APP_LAKECAT_FRONTEND_ORIGIN:"https://metadata.datacake.cloud/",VUE_APP_API_PATH:"https://ds-task.datacake.cloud",VUE_APP_API_PATH2:"https://metadata.ushareit.org",VUE_APP_API_PATH3:"https://ds-task.ushareit.org/sla-service",VUE_APP_API_PATH4:"https://lakecat-web.ushareit.org",VUE_APP_API_PATH5:"https://query-editor-prod.ushareit.org",VUE_APP_API_PATH6:"https://cost-center.ushareit.org",VUE_APP_API_PATH7:"https://cluster-manager.ushareit.org",VUE_APP_API_GATEWAY_PATH:"/api-gateway/",BASE_URL:""}).VUE_APP_BASE_API_GATEWAY:"/api-gateway/","ds_task/announcement/upload"),accept:"image/jpg, image/png, image/gif, image/jpeg, image/bmp, image/x-icon",response:function(t){return t.data},headers:function(t){t.setRequestHeader("Authentication",Object(d["a"])())},change:function(t,e){}},toolbar:{container:m["c"],handlers:{image:function(){m["b"].emit(this.quill.id)}}}}},rules:{name:[{required:!0,message:"请输入公告名称",trigger:["blur","change"]}],content:[{required:!0,message:"请输入公告内容",trigger:["blur","change"]}]}}},watch:{visible:function(){this.dialogVisiable=this.visible},dialogVisiable:function(t){this.$emit("update:visible",t)},editData:{handler:function(t){Object.keys(t).length?(this.params.name=Object(o["b64_to_utf8"])(this.editData.name),this.params.content=Object(o["b64_to_utf8"])(this.editData.content),this.submitLoading=!1):(this.params.name="",this.params.content="",this.submitLoading=!1)},deep:!0,immediate:!0}},methods:{onEditorBlur:function(){},onEditorFocus:function(){},onEditorReady:function(){},cancel:function(){this.$emit("update:visible",!1)},ok:function(){var t=this;this.$refs["form"].validate((function(e){if(e){t.submitLoading=!0;var a=Object.assign({},t.params);a.name=Object(o["utf8_to_b64"])(a.name),a.content=Object(o["utf8_to_b64"])(a.content),Object.keys(t.editData).length?(a=Object.assign({},a,{id:t.editData.id}),Object(s["m"])(a).then((function(e){t.submitLoading=!1,t.$message({type:"success",message:"编辑公告成功"}),t.$emit("update:visible",!1),t.$emit("updateList")}))):Object(s["a"])(a).then((function(e){t.submitLoading=!1,t.$message({type:"success",message:"新建公告成功"}),t.$emit("update:visible",!1),t.$emit("updateList")}))}}))}}},g=b,f=(a("5e62"),a("2877")),h=Object(f["a"])(g,c,u,!1,null,"f6334196",null),_=h.exports,v=a("2c2c");function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}function P(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function A(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?P(Object(a),!0).forEach((function(e){E(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function E(t,e,a){return e=O(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function O(t){var e=w(t,"string");return"symbol"===y(e)?e:String(e)}function w(t,e){if("object"!==y(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var n=a.call(t,e||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var j={name:"Announcement",components:{CreatEditAnnoucement:_,DynamiStateDetail:v["a"]},data:function(){return{loading:!1,creatEditAnnoucementVisible:!1,dynamiStateDetailVisible:!1,detailLoading:!1,deleteLoading:!1,list:[],detail:"",title:"",editData:{},total:0,params:{name:"",online:null,pageNum:1,pageSize:10}}},created:function(){this.page()},methods:{goBack:function(){this.$router.push({name:"Dashboard"})},b64_to_utf8:function(t){return Object(o["b64_to_utf8"])(t)},utf8_to_b64:function(t){if(t)return Object(o["utf8_to_b64"])(t)},getTime:function(t){return Object(o["parseTime"])(t,"{y}-{m}-{d} {h}:{i}:{s}")},page:function(){var t=this;this.loading=!0;var e=Object.assign({},this.params,{name:Object(o["utf8_to_b64"])(this.params.name),content:Object(o["utf8_to_b64"])(this.params.content)});Object(s["g"])(e).then((function(e){t.loading=!1;var a=e.data;t.list=a.list&&a.list.length&&a.list.map((function(t){return A(A({},t),{},{deleteLoading:!1})}))||[],t.total=a.total,t.params.pageNum=a.pageNum,t.params.pageSize=a.pageSize}))},handleShare:function(t){l()("".concat(this.$locationOrigin,"/home?announcementId=").concat(t.id),{format:"text/plain"}),this.$message({type:"success",message:"".concat(this.b64_to_utf8(t.name),"分享链接已复制到剪切板")})},handleOnlineOffline:function(t){var e=this;Object(s["f"])({id:t.id,online:0===t.online?1:0}).then((function(t){e.page()}))},handleDetail:function(t){var e=this;this.detailLoading=!0,this.dynamiStateDetailVisible=!0,Object(s["d"])({id:t.id}).then((function(t){e.detailLoading=!1;var a=t.data;e.title=Object(o["b64_to_utf8"])(a.name),e.detail=Object(o["b64_to_utf8"])(a.content)}))},handleEdit:function(t){var e=this;this.detailLoading=!0,this.creatEditAnnoucementVisible=!0,Object(s["d"])({id:t.id}).then((function(t){var a=t.data;e.detailLoading=!1,e.editData=a,e.page()}))},handleDelete:function(t,e){var a=this;this.list[e].deleteLoading=!0,Object(s["c"])({id:t.id}).then((function(n){a.list[e].deleteLoading=!1,a.$message({type:"success",message:"".concat(Object(o["b64_to_utf8"])(t.name),"删除成功")}),a.page()}))},handleSizeChange:function(t){this.params.pageSize=t,this.page()},handleCurrentChange:function(t){this.params.pageNum=t,this.page()},handleAnnouncement:function(){this.creatEditAnnoucementVisible=!0,this.editData={}}}},k=j,S=(a("a35e"),Object(f["a"])(k,n,i,!1,null,"3a23baa6",null));e["default"]=S.exports},a35e:function(t,e,a){"use strict";a("7011")},a44b:function(t,e,a){}}]);