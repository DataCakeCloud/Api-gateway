(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-8664ba3e"],{"095f":function(t,e,a){},1619:function(t,e,a){"use strict";a("095f")},"17ef":function(t,e,a){},"1e99":function(t,e,a){"use strict";a("324b")},"20f1":function(t,e,a){},"293f":function(t,e,a){},"324b":function(t,e,a){},"67ee":function(t,e,a){"use strict";a("293f")},"9fee":function(t,e,a){"use strict";a("20f1")},a03a:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{staticClass:"box-card-container"},[a("div",{staticClass:"task-list"},[a("div",{staticClass:"left-wrap transition",class:{"left-close":!t.isOpen}},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.isOpen,expression:"isOpen"}],staticClass:"tree"},[a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("全部标签")])]),t._v(" "),a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择标签",size:"small",title:t.tagTitle,filterable:"",clearable:""},on:{change:t.clickTag},model:{value:t.labelId,callback:function(e){t.labelId=e},expression:"labelId"}},t._l(t.allTagList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[a("el-tooltip",{attrs:{"popper-class":"tag-popper",content:e.name,placement:"top",disabled:t.isTipDisabled}},[a("span",{staticStyle:{float:"left","max-width":"320px",overflow:"hidden","text-overflow":"ellipsis"},on:{mouseenter:t.isShowTooltip}},[t._v(t._s(e.name))])]),t._v(" "),a("el-popover",{staticClass:"icon-star",attrs:{trigger:"hover","popper-class":"tag-popper"}},[t._v("\n                  收藏\n                  "),t._v(" "),a("el-rate",{attrs:{slot:"reference",disabled:"",max:1},nativeOn:{click:function(a){return t.collectTag(e)}},slot:"reference",model:{value:e.collectVal,callback:function(a){t.$set(e,"collectVal",a)},expression:"item.collectVal"}})],1)],1)})),1)],1),t._v(" "),a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("我的收藏")])]),t._v(" "),t.collectList&&t.collectList.labels?t._l(t.collectList.labels,(function(e){return a("span",{key:e.name,on:{contextmenu:function(a){return a.preventDefault(),t.onContextmenu(a,e,3)}}},[a("el-tooltip",{attrs:{"popper-class":"tag-popper",content:e.name,placement:"bottom-start",disabled:t.isTipDisabled}},[a("el-tag",{staticClass:"item",attrs:{effect:e.id==t.params.labelId?"dark":"plain"},on:{click:function(a){return t.clickTag(e.id)}},nativeOn:{mouseenter:function(e){return t.isShowTooltip(e)}}},[t._v(t._s(e.name))])],1)],1)})):a("div",{staticClass:"no-data"},[t._v("No Data")])],2),t._v(" "),a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("\n                我的标签\n                "),a("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"tag-popper"}},[t._v("\n                  右击可编辑标签\n                  "),a("i",{staticClass:"el-icon-info global-color-ca",attrs:{slot:"reference"},slot:"reference"})])],1),t._v(" "),a("el-button",{staticStyle:{float:"right",padding:"0"},attrs:{type:"text"},on:{click:t.addTag}},[t._v("添加")])],1),t._v(" "),t.tagList.current&&0===t.tagList.current.length?a("div",{staticClass:"no-data"},[t._v("No Data")]):t._l(t.tagList.current,(function(e){return a("span",{key:e.name,on:{contextmenu:function(a){return a.preventDefault(),t.onContextmenu(a,e,1)}}},[a("el-tooltip",{attrs:{"popper-class":"tag-popper",content:e.name,placement:"bottom-start",disabled:t.isTipDisabled}},[a("el-tag",{staticClass:"item",attrs:{effect:e.id==t.params.labelId?"dark":"plain"},on:{click:function(a){return t.clickTag(e.id)}},nativeOn:{mouseenter:function(e){return t.isShowTooltip(e)}}},[t._v(t._s(e.name))])],1)],1)}))],2),t._v(" "),a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[t._v("\n                公开给我的标签\n                "),a("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"tag-popper"}},[t._v("\n                  右击可编辑标签\n                  "),a("i",{staticClass:"el-icon-info global-color-ca",attrs:{slot:"reference"},slot:"reference"})])],1)]),t._v(" "),0===t.publishTagList.length?a("div",{staticClass:"no-data"},[t._v("No Data")]):t._l(t.publishTagList,(function(e){return a("span",{key:e.name,on:{contextmenu:function(a){return a.preventDefault(),t.onContextmenu(a,e,4)}}},[a("el-tooltip",{attrs:{"popper-class":"tag-popper",content:e.name,placement:"bottom-start",disabled:t.isTipDisabled}},[a("el-tag",{staticClass:"item",attrs:{effect:e.id==t.params.labelId?"dark":"plain"},on:{click:function(a){return t.clickTag(e.id)}},nativeOn:{mouseenter:function(e){return t.isShowTooltip(e)}}},[t._v(t._s(e.name))])],1)],1)}))],2)],1),t._v(" "),a("div",{class:["tree-arrow",{"tree-arrow-close":!t.isOpen}],on:{click:t.handleOpen}},[a("i",{class:["icon-arrow-tree",t.isOpen?"el-icon-arrow-left":"el-icon-arrow-right"]})])]),t._v(" "),a("div",{ref:"rightWrap",staticClass:"right-wrap"},[a("div",{staticClass:"search-condition-wrap"},[a("div",{staticClass:"search"},[a("search-item",{staticClass:"custom-search",attrs:{width:"100px",span:8,label:"ID/名称"}},[a("el-input",{staticClass:"search-box",staticStyle:{width:"300px"},attrs:{placeholder:"请输入工作流ID、名称",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.params.keyWord,callback:function(e){t.$set(t.params,"keyWord","string"===typeof e?e.trim():e)},expression:"params.keyWord"}})],1),t._v(" "),a("search-item",{staticClass:"custom-search",attrs:{width:"60px",span:8,label:"上线状态"}},[a("el-select",{staticClass:"search-input",attrs:{placeholder:"请选择上线状态",size:"small",clearable:""},on:{change:function(e){return t.search("createBy")}},model:{value:t.params.status,callback:function(e){t.$set(t.params,"status",e)},expression:"params.status"}},[a("el-option",{key:"1",attrs:{value:1,label:"上线"}}),t._v(" "),a("el-option",{key:"2",attrs:{value:2,label:"下线"}})],1)],1),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.search}},[t._v("查询")]),t._v(" "),t.isShowSelf?a("el-checkbox",{staticClass:"custom-checkbox",staticStyle:{"margin-left":"5px"},on:{change:t.getList},model:{value:t.params.onlyMine,callback:function(e){t.$set(t.params,"onlyMine",e)},expression:"params.onlyMine"}},[t._v("只看自己")]):t._e(),t._v(" "),t.isShowSelf?a("el-tooltip",{attrs:{effect:"dark",content:"勾选此项后，可以查看&编辑'负责人'为自己或'协作者'为自己或'用户组'包含自己的工作流；",placement:"bottom"}},[a("i",{staticClass:"el-icon-info global-color-ca"})]):t._e()],1),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("创建工作流")])],1),t._v(" "),a("div",{staticClass:"table-wrap"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:t.data,stripe:"",border:"","cell-style":{padding:"10px 0"}},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"id",label:"工作流ID","min-width":"95",sortable:"custom","label-class-name":"column-padding"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"工作流名称","min-width":"270",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.name,placement:"top",disabled:t.isTipDisabled}},[a("a",{staticClass:"ellipsis block",on:{click:function(a){return t.clickName(e.row)},mouseenter:t.isShowTooltip}},[t._v(t._s(e.row.name))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"createBy",label:"创建人","min-width":"100","show-overflow-tooltip":!0}}),t._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间","min-width":"160",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dataTime")(e.row.updateTime)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"updateBy",label:"最近运行状态","min-width":"190",align:"right","header-align":"left","class-name":"statusCol"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row.taskInstances,(function(i,r){return a("el-popover",{key:r,attrs:{trigger:"hover",placement:"bottom"}},[a("p",[t._v("执行时间："+t._s(i.executionDate?t.$utils.parseTime(i.executionDate):"-"))]),t._v(" "),a("p",[t._v("执行状态："+t._s(t.offlineStateCode[i.state]||"-"))]),t._v(" "),a("p",[t._v("开始时间："+t._s(i.startDate?t.$utils.parseTime(i.startDate):"-"))]),t._v(" "),a("p",[t._v("结束时间："+t._s(i.endDate?t.$utils.parseTime(i.endDate):"-"))]),t._v(" "),a("p",[t._v("耗时："+t._s(t._f("duration")(1e3*i.duration)))]),t._v(" "),a("span",{class:["circle","task-state",i.state],attrs:{slot:"reference"},on:{click:function(a){return t.clickIns(e.row,i.executionDate)}},slot:"reference"})])}))}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"userGroup",label:"用户组","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{prop:"granularity",label:"执行计划","min-width":"120",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"nextExecutionDate",label:"下次执行","min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("dataTime")(e.row.nextExecutionDate)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述","min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.description,placement:"top",disabled:t.isTipDisabled}},[a("span",{staticClass:"ellipsis block",on:{mouseenter:t.isShowTooltip}},[t._v(t._s(e.row.description||"-"))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",prop:"status",label:"状态","min-width":"70",sortable:"custom","label-class-name":"column-padding"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{staticClass:"online-switch",attrs:{value:1===e.row.status,"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){return t.goLine(e.row)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作","min-width":"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",disabled:t.isDisabled(e.row)},on:{click:function(a){return t.navEdit(e.row)}}},[t._v("编辑")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:t.isDisabled(e.row)||1!==e.row.status},on:{click:function(a){return t.addNum(e.row)}}},[t._v("补数")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:t.isDisabled(e.row)||1===e.row.status},on:{click:function(a){return t.deleteHandler(e.row)}}},[t._v("删除")]),t._v(" "),a("el-button",{attrs:{type:"text",disabled:t.isDisabled(e.row)},on:{click:function(a){return t.getVersion(e.row)}}},[t._v("版本")])]}}])})],1)],1),t._v(" "),a("el-pagination",{attrs:{background:"",total:t.total,"current-page":t.params.pageNo,"page-size":t.params.pageSize,"page-sizes":[10,20,30,50,100],layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)]),t._v(" "),a("win-add-tag",{ref:"dialogTag",attrs:{"user-id":t.userInfo.userId},on:{save:t.init}}),t._v(" "),a("win-add-num",{ref:"winAddNum",on:{save:t.getList}}),t._v(" "),a("workflow-version-list",{ref:"versionList",on:{save:t.getList}}),t._v(" "),a("win-del-tip",{ref:"winDelTip",on:{save:t.getList}}),t._v(" "),a("el-dialog",{attrs:{title:"创建工作流",visible:t.dialogVisible,width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"btn-wrap"},[a("span",{on:{click:function(e){return t.addWorkFlow("new")}}},[t._v("全部新建")]),t._v(" "),a("span",{on:{click:function(e){return t.addWorkFlow("history")}}},[t._v("批量导入历史任务")])])]),t._v(" "),a("history-task",{ref:"historyTask"})],1)},r=[],n=a("460e"),s=a("4bf8b"),o=a("b199"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-drawer",{attrs:{visible:t.drawer,"append-to-body":!0,direction:"rtl","show-close":!1,size:"800"},on:{"update:visible":function(e){t.drawer=e}}},[a("div",{staticClass:"title",attrs:{slot:"title"},slot:"title"},[t._v("\n    版本信息\n    ")]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:!0,stripe:"","cell-style":{padding:"10px 0"}}},[a("el-table-column",{attrs:{prop:"version",label:"版本号","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.version?a("el-tooltip",{attrs:{content:"跳转到当前版本的编辑页面","open-delay":200,"popper-class":"tag-popper"}},[a("a",{staticClass:"link",on:{click:function(a){return t.edit(e.row)}}},[t._v("v"+t._s(e.row.version)+t._s(e.row.isCurrentVersion?"-当前版本":""))])]):a("span",[t._v("-")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"创建时间","min-width":"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.$utils.parseTime(e.row.createTime)))]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"description",label:"描述","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:e.row.name,placement:"top",disabled:t.isTipDisabled}},[a("span",{staticClass:"ellipsis block",on:{mouseenter:t.isShowTooltip}},[t._v(t._s(e.row.description||"-"))])])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{disabled:e.row.isCurrentVersion,type:"text",size:"mini"},on:{click:function(a){return t.switchVer(e.row)}}},[t._v("切换")])]}}])})],1),t._v(" "),a("el-pagination",{staticStyle:{"margin-bottom":"15px"},attrs:{background:"",total:t.total,"current-page":t.params.pageNo,"page-sizes":[10,20,30,50,100],"page-size":t.params.pageSize,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t._v(" "),a("el-dialog",{attrs:{title:"切换版本提示",visible:t.dialogVisible,width:"700px","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"mb10"},[t._v("您确认要切换至该工作流版本吗？以下是缺少的任务正在被依赖的信息：")]),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:t.relyData,stripe:"",border:"","cell-style":{padding:"10px 0"}}},[a("el-table-column",{attrs:{prop:"curTaskName",label:"任务名称","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"downTaskName",label:"下游任务","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"downTaskOwner",label:"下游任务owner","min-width":"100"}})],1),t._v(" "),a("div",{staticClass:"mt10"},[a("span",[t._v("通知下游任务owner：")]),t._v(" "),a("el-radio-group",{model:{value:t.notify,callback:function(e){t.notify=e},expression:"notify"}},[a("el-radio",{attrs:{label:!0}},[t._v("是")]),t._v(" "),a("el-radio",{attrs:{label:!1}},[t._v("否")])],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.btnDisabled},on:{click:t.save}},[t._v("确 定")])],1)],1)],1)},c=[],u={name:"WorkflowVersionList",data:function(){return{drawer:!1,loading:!1,tableData:[],total:0,params:{workflowId:"",pageNo:1,pageSize:20},isTipDisabled:!1,currentStatus:0,currentTaskIds:[],dialogVisible:!1,deleteLoading:!1,relyData:[],notify:!0,rowData:{},btnDisabled:!1}},methods:{showWin:function(t){this.drawer=!0,this.currentStatus=t.status,this.currentTaskIds=t.taskIds,this.params.workflowId=t.id,this.params.pageNo=1,this.params.pageSize=20,this.getList()},isShowTooltip:function(t){var e=t.target.clientWidth,a=t.target.scrollWidth;this.isTipDisabled=!(a>e)},getList:function(){var t=this;this.loading=!0,Object(s["v"])(this.params).then((function(e){var a=e.data;t.loading=!1,t.total=a.total,t.tableData=a.list}))},handleCurrentChange:function(t){this.params.pageNo=t,this.getList()},handleSizeChange:function(t){this.params.pageSize=t,this.params.pageNo=1,this.getList()},showDeleteDialog:function(t){var e=this;this.dialogVisible=!0,this.deleteLoading=!0,Object(s["h"])({taskIds:t.join(",")}).then((function(t){var a=t.data;e.relyData=a,0===e.relyData.length&&(e.notify=!1),e.deleteLoading=!1}))},save:function(){var t=this;this.btnDisabled=!0,Object(s["y"])({workflowId:this.rowData.workflowId,workflowVersionId:this.rowData.workflowVersionId,notify:this.notify}).then((function(e){t.$message({type:"success",message:"切换成功"}),t.drawer=!1,t.dialogVisible=!1,t.getList(),t.$emit("save")})).finally((function(){t.btnDisabled=!1}))},switchVer:function(t){var e=this,a=[];this.currentTaskIds.forEach((function(e){t.taskIds.includes(e)||a.push(e)})),1===this.currentStatus&&a.length?(this.showDeleteDialog(a),this.rowData=t):this.$confirm("确定切换为当前版本?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["y"])({workflowId:t.workflowId,version:t.version,notify:!1}).then((function(t){e.$message({type:"success",message:"切换成功"}),e.drawer=!1,e.getList(),e.$emit("save")}))})).catch((function(){}))},edit:function(t){var e=this.$router.resolve({path:"/workflow/add",query:{id:t.workflowId,version:t.version}}).href;window.open(e,"_blank")}}},d=u,f=(a("1619"),a("2877")),h=Object(f["a"])(d,l,c,!1,null,"50e75175",null),p=h.exports,m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"custom-dialog",attrs:{title:"补数",visible:t.dialogVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e},close:t.resetForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.formLoading,expression:"formLoading"}],ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"工作流名称"}},[a("span",[t._v(t._s(t.taskName))])]),t._v(" "),a("el-form-item",{attrs:{label:"起止时间",prop:"timeRange"}},[a("el-date-picker",{key:t.dateKey,staticClass:"dialog-select",attrs:{"popper-class":"yyyy-MM-dd HH"===t.valueFormat?"time-hour":"",type:t.dateType,"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":t.valueFormat,format:t.valueFormat,"picker-options":t.pickerOptions,"default-time":["00:00:00","23:59:59"]},model:{value:t.ruleForm.timeRange,callback:function(e){t.$set(t.ruleForm,"timeRange",e)},expression:"ruleForm.timeRange"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.btnDisabled},on:{click:t.save}},[t._v("确 定")])],1)],1)},g=[],v={name:"WinAddNum",data:function(){return{dialogVisible:!1,formLoading:!1,ruleForm:{timeRange:[]},rules:{timeRange:[{required:!0,message:"请选择起止时间",trigger:"change"}]},dateKey:0,dateType:"datetimerange",valueFormat:"yyyy-MM-dd HH:mm:ss",pickerOptions:{disabledDate:function(t){return t.getTime()>new Date(new Date((new Date).toLocaleDateString()).getTime()+864e5-1)}},currentId:"",taskName:"",btnDisabled:!1}},methods:{showWin:function(t){this.currentId=t.id,this.taskName=t.name,this.dialogVisible=!0,this.btnDisabled=!1,this.dateKey++,"hourly"===t.granularity?(this.dateType="datetimerange",this.valueFormat="yyyy-MM-dd HH"):"minutely"===t.granularity?(this.dateType="datetimerange",this.valueFormat="yyyy-MM-dd HH:mm"):"monthly"===t.granularity?(this.dateType="monthrange",this.valueFormat="yyyy-MM"):(this.dateType="daterange",this.valueFormat="yyyy-MM-dd")},dateFormat:function(){if("yyyy-MM-dd HH:mm"===this.valueFormat)this.ruleForm.timeRange[0]+=":00",this.ruleForm.timeRange[1]+=":59";else if("yyyy-MM-dd HH"===this.valueFormat)this.ruleForm.timeRange[0]+=":00:00",this.ruleForm.timeRange[1]+=":59:59";else if("yyyy-MM-dd"===this.valueFormat)this.ruleForm.timeRange[0]+=" 00:00:00",this.ruleForm.timeRange[1]+=" 23:59:59";else if("yyyy-MM"===this.valueFormat){var t=this.ruleForm.timeRange[1].split("-"),e=new Date(t[0],t[1],0).getDate();this.ruleForm.timeRange[0]+="-01 00:00:00",this.ruleForm.timeRange[1]+="-".concat(e," 23:59:59")}},resetForm:function(){this.$refs.ruleForm.resetFields()},save:function(){var t=this;this.$refs.ruleForm.validate((function(e){e&&(t.btnDisabled=!0,t.dateFormat(),Object(s["b"])({workflowID:t.currentId,startDate:t.ruleForm.timeRange[0],endDate:t.ruleForm.timeRange[1]}).then((function(e){t.dialogVisible=!1,t.$message({type:"success",message:"操作成功"}),t.$emit("save")})).finally((function(){t.btnDisabled=!1})))}))}}},b=v,y=(a("a192"),Object(f["a"])(b,m,g,!1,null,"8c536ae6",null)),w=y.exports,k=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"turnoff"===t.operation?"下线提示":"删除提示",visible:t.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[t.tableData.length?[a("div",{staticClass:"mb10"},[t._v("您确认要"+t._s("turnoff"===t.operation?"下线":"删除")+"该工作流吗？以下是该工作流下的任务正在被依赖的信息：")]),t._v(" "),a("el-table",{staticClass:"custom-table",staticStyle:{width:"100%"},attrs:{data:t.tableData,stripe:"",border:"","cell-style":{padding:"10px 0"}}},[a("el-table-column",{attrs:{prop:"curTaskName",label:"任务名称","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"downTaskName",label:"下游任务","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"downTaskOwner",label:"下游任务owner","min-width":"100"}})],1),t._v(" "),a("div",{staticClass:"mt10"},[a("span",[t._v("通知下游任务owner：")]),t._v(" "),a("el-radio-group",{model:{value:t.notify,callback:function(e){t.notify=e},expression:"notify"}},[a("el-radio",{attrs:{label:!0}},[t._v("是")]),t._v(" "),a("el-radio",{attrs:{label:!1}},[t._v("否")])],1)],1)]:a("div",[t._v("您确认要"+t._s("turnoff"===t.operation?"下线":"删除")+"该工作流吗？")])],2),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.btnDisabled},on:{click:t.save}},[t._v("确 定")])],1)])},_=[],x={name:"WinDelTip",data:function(){return{dialogVisible:!1,operation:"",loading:!1,tableData:[],notify:!0,data:{},btnDisabled:!1}},methods:{showWin:function(t,e){var a=this;this.dialogVisible=!0,this.operation=e,this.data=t,this.loading=!0,Object(s["i"])({workflowId:t.id}).then((function(t){var e=t.data;a.tableData=e,0===a.tableData.length&&(a.notify=!1),a.loading=!1}))},save:function(){var t,e=this;this.btnDisabled=!0,"turnoff"===this.operation?t=Object(s["x"])({workflowId:this.data.id,notify:this.notify}):"del"===this.operation&&(t=Object(s["d"])({workflowId:this.data.id,notify:this.notify})),t.then((function(t){e.$message.success("操作成功"),e.$emit("save"),e.dialogVisible=!1})).finally((function(){e.btnDisabled=!1}))}}},L=x,T=Object(f["a"])(L,k,_,!1,null,null,null),C=T.exports,D=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"custom-dialog",attrs:{visible:t.dialogVisible,width:"1100px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e},close:t.closeDialog}},[a("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n    导入历史任务\n    "),a("el-tooltip",{attrs:{effect:"dark",content:"只能导入任务owner或协作者为自己的任务",placement:"bottom"}},[a("i",{staticClass:"el-icon-info global-color-ca"})])],1),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"history-task"},[a("tree-transfer",{ref:"treeTransfer",attrs:{datas:t.treeTransferData,"default-props":t.defaultProps,"checked-list":t.treeChecked}}),t._v(" "),a("div",{staticClass:"preview-btn"},[a("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.priview}},[t._v("预览")])],1),t._v(" "),a("div",{ref:"previewWrap",staticClass:"preview-wrap"},[a("Graph",{ref:"graph",attrs:{data:t.graphData,"is-show-minmap":!1,"layout-begin":[10,10],ranksep:20,nodesep:30}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确认导入")])],1)])},I=[],O=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tree-transfer"},[a("div",{staticClass:"tree-transfer-left"},[a("div",{staticClass:"title"},[a("el-checkbox",{model:{value:t.allCheckLeft,callback:function(e){t.allCheckLeft=e},expression:"allCheckLeft"}},[t._v("历史任务列表")])],1),t._v(" "),a("div",{staticClass:"transfer-content"},[a("el-input",{attrs:{placeholder:"请输入任务ID/名称/标签"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),t._v(" "),a("el-tree",{ref:"treeLeft",staticClass:"treeLeft",attrs:{data:t.dataLeft,"show-checkbox":"",indent:8,"node-key":t.defaultProps.id,props:t.defaultProps,"default-expand-all":"","filter-node-method":t.filterNode},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,r=e.data;return a("div",{staticClass:"tree_item ellipsis"},[r.id?a("div",{staticClass:"item_wrap"},[a("div",{staticClass:"item_title"},[a("span",[t._v(t._s(r.id))]),t._v("\n              |\n              "),a("span",[t._v(t._s(r.granularity?""+r.granularity:"-"))])]),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.label,placement:"bottom-start"}},[a("span",{staticClass:"ellipsis name"},[t._v(t._s(i.label))])])],1):a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:i.label,placement:"bottom-start"}},[a("span",{staticClass:"ellipsis"},[t._v(t._s(i.label))])])],1)}}])})],1)]),t._v(" "),a("div",{staticClass:"tree-transfer-middle"},[a("el-button",{attrs:{icon:"el-icon-arrow-left",size:"mini"},on:{click:t.remove}}),t._v(" "),a("el-button",{attrs:{icon:"el-icon-arrow-right",size:"mini"},on:{click:t.add}})],1),t._v(" "),a("div",{staticClass:"tree-transfer-right"},[a("div",{staticClass:"title"},[a("el-checkbox",{model:{value:t.allCheckRight,callback:function(e){t.allCheckRight=e},expression:"allCheckRight"}},[t._v("已选择列表")])],1),t._v(" "),a("div",{staticClass:"transfer-content"},[a("el-input",{attrs:{placeholder:"请输入任务ID/名称"},model:{value:t.filterRightText,callback:function(e){t.filterRightText=e},expression:"filterRightText"}}),t._v(" "),a("el-checkbox-group",{staticClass:"transfer_group",model:{value:t.rightChecked,callback:function(e){t.rightChecked=e},expression:"rightChecked"}},t._l(t.dataRight,(function(e){return a("el-checkbox",{key:e[t.defaultProps.id],attrs:{label:e}},[a("div",{staticClass:"item_wrap"},[a("div",{staticClass:"item_title"},[a("span",[t._v(t._s(e.id))]),t._v("\n              |\n              "),a("span",[t._v(t._s(e.granularity?""+e.granularity:"-"))])]),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e[t.defaultProps.label],placement:"bottom-start"}},[a("span",{staticClass:"ellipsis name"},[t._v(t._s(e[t.defaultProps.label]))])])],1)])})),1)],1)])])},S=[],$={name:"TreeTranster",props:["datas","defaultProps","checkedList"],data:function(){return{filterText:"",filterRightText:"",yuansiData:[],dataLeft:[],rawDataRight:[],dataRight:[],rightChecked:[]}},computed:{allCheckRight:{get:function(){return this.dataRight.length&&this.rightChecked.length===this.dataRight.length},set:function(t){this.rightChecked=t?this.dataRight:[]}},allCheckLeft:{get:function(){var t=this.$refs.treeLeft&&this.$refs.treeLeft.getCheckedNodes(),e=[];return t&&t.length&&t.forEach((function(t){t.children&&t.children.length&&e.push(t)})),this.dataLeft.length&&this.dataLeft.length===e.length},set:function(t){var e=this;this.dataLeft.forEach((function(a){e.$refs.treeLeft.setChecked(a[e.defaultProps.id],t),a.children.forEach((function(a){a.disabled||e.$refs.treeLeft.setChecked(a[e.defaultProps.id],t)}))}))}}},watch:{filterText:function(t){this.$refs.treeLeft.filter(t)},filterRightText:function(t){this.dataRight=this.rawDataRight.filter((function(e){var a="".concat(e.name,"(").concat(e.granularity,")");return a.indexOf(t)>-1}))},checkedList:function(){var t=this;this.$nextTick((function(){t.checkedList.map((function(e,a){t.$refs.treeLeft.setChecked(e[t.defaultProps.id],!0)})),t.dataRight=t.checkedList}))},datas:function(){this.dataLeft=JSON.parse(JSON.stringify(this.datas))}},mounted:function(){this.yuansiData=JSON.parse(JSON.stringify(this.datas))},methods:{filterNode:function(t,e,a){if(!t)return!0;var i=-1!==e[this.defaultProps.label].indexOf(t)||e["id"]&&-1!==e["id"].toString().indexOf(t),r=a.parent&&a.parent.data&&a.parent.data[this.defaultProps.label]&&-1!==a.parent.data[this.defaultProps.label].indexOf(t),n=!1,s=!1;return 1===a.level?n=i:2===a.level&&(s=i||r),n||s},filterTreeData:function(t){var e=this;return t.filter((function(t){return t[e.defaultProps.children]&&t[e.defaultProps.children].length>0?(t.disabled=!0,t.children=e.filterTreeData(t[e.defaultProps.children])):t[e.defaultProps.label]="".concat(t[e.defaultProps.label],"(").concat(t[e.defaultProps.pCode],")"),t}))},add:function(){var t=this,e=this.dataRight.map((function(t){return t.id}));this.dataRight=[];var a=this.$refs.treeLeft.getCheckedNodes();a=a.filter((function(t){return!t.children||0===t.children.length}));var i=a[0].granularity,r=!0;if(a.forEach((function(e){if(e.granularity!==i)return t.$message.warning("必须选择粒度一致的任务"),void(r=!1)})),r){this.dataRight=a;var n=this.dataRight.map((function(t){return t.id}));this.dataLeft.forEach((function(t){t.children&&t.children.length&&t.children.forEach((function(t){t.disabled=t.granularity!==i,n.includes(t.id)&&(t.disabled=!0)}))})),this.dataRight.forEach((function(a){e.includes(a.id)||t.rightChecked.push(a)}))}this.rawDataRight=JSON.parse(JSON.stringify(this.dataRight))},remove:function(){var t=this,e=JSON.parse(JSON.stringify(this.rightChecked)),a=e.map((function(t){return t.id}));e.map((function(e,a){t.$refs.treeLeft.setChecked(e[t.defaultProps.id],!1),t.dataRight.map((function(a,i){e[t.defaultProps.id]===a[t.defaultProps.id]&&t.dataRight.splice(i,1)}))})),this.rawDataRight=JSON.parse(JSON.stringify(this.dataRight)),this.dataLeft.forEach((function(e){e.children&&e.children.length&&e.children.forEach((function(e){(0===t.dataRight.length||a.includes(e.id))&&(e.disabled=!1)}))})),this.rightChecked=[]},reset:function(){var t=this,e=this.$refs.treeLeft.getCheckedNodes();e.map((function(e,a){t.$refs.treeLeft.setChecked(e,!1)})),this.dataRight=[],this.rawDataRight=[],this.rightChecked=[]},getVal:function(){return this.rightChecked}}},N=$,F=(a("9fee"),Object(f["a"])(N,O,S,!1,null,"f25d6b62",null)),j=F.exports,E=a("7e61"),P={name:"HistoryTask",components:{TreeTransfer:j,Graph:E["a"]},data:function(){return{dialogVisible:!1,loading:!1,props:{key:"id",label:"name"},btnLoading:!1,value:[],taskData:[],graphData:{nodes:[],edges:[]},treeTransferData:[],defaultProps:{id:"treeId",label:"name",children:"children"},treeChecked:[]}},methods:{showWin:function(){var t=this;this.dialogVisible=!0,this.getTaskList(),this.$nextTick((function(){var e=t.$refs.previewWrap&&t.$refs.previewWrap.offsetWidth,a=t.$refs.previewWrap&&t.$refs.previewWrap.offsetHeight;t.$refs.graph.init(e,a),t.$refs.treeTransfer.reset()}))},getTaskList:function(){var t=this;this.loading=!0,Object(s["w"])({keyword:""}).then((function(e){var a=e.data;t.taskData=[],t.treeTransferData=[],a.forEach((function(e){var a={treeId:e.labelName,name:e.labelName};e.taskList.forEach((function(t){t.disabled=!1,t.treeId=e.labelName+t.id})),a.children=e.taskList,t.treeTransferData.push(a)})),t.loading=!1}))},priview:function(){var t=this,e=this.$refs.treeTransfer.getVal();if(e.length){var a=e.map((function(t){return{taskId:t.id}}));this.btnLoading=!0,Object(s["r"])({tasks:a}).then((function(e){var a=e.data;t.graphData={nodes:[],edges:[]},a.nodeList.forEach((function(e){t.graphData.nodes.push({id:e.taskId+"",shape:"mini-card",data:{id:e.taskId+"",name:e.taskName,templateCode:e.templateCode,isHistoryTask:e.isOutside}})})),a.relation.forEach((function(e){t.graphData.edges.push({source:e.source+"",target:e.target+"",shape:e.sourceIsOutside?"light-dash-edge":"light-edge"})})),t.$refs.graph.render()})).finally((function(){t.btnLoading=!1}))}else this.$message.warning("请在已选择列表中勾选想要预览的任务")},changeTransfer:function(t,e,a){var i=this;if("right"===e&&t.length===a.length){var r=this.taskData.filter((function(t){return a.includes(t.id)})),n=r[0].granularity;r.forEach((function(t){if(t.granularity!==n)return i.$message.warning("必须选择粒度一致的任务"),void(i.value=[])})),this.value.length&&this.taskData.forEach((function(t){t.granularity!==n&&(t.disabled=!0)}))}0===t.length&&this.taskData.forEach((function(t){t.disabled=!1}))},closeDialog:function(){this.value=[],this.graphData={nodes:[],edges:[]},this.$refs.graph.dispose()},submit:function(){var t=this.$refs.treeTransfer.getVal();if(t.length){var e=t.map((function(t){return{taskId:t.id}}));localStorage.setItem("tasks",JSON.stringify(e)),this.$router.push({path:"/workflow/add",query:{type:"history"}})}else this.$message.warning("请在已选择列表中勾选想要导入的任务")}}},V=P,R=(a("1e99"),Object(f["a"])(V,D,I,!1,null,"05e95026",null)),W=R.exports,M=a("b893"),z=a("2f62"),A=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.title,visible:t.dialogVisible,width:"700px","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e},close:t.resetForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"标签名字",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入标签名字，不超过128个字符",maxlength:"128",clearable:"",disabled:4===t.tagType},model:{value:t.ruleForm.name,callback:function(e){t.$set(t.ruleForm,"name",e)},expression:"ruleForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"关联工作流"}},[a("div",{class:["task-tag-wrap",t.selectTasks.length?"border-dashed":""]},t._l(t.selectTasks,(function(e){return a("el-tag",{key:e.id,staticClass:"task-tag",attrs:{closable:"",type:"info",effect:"plain"},on:{close:function(a){return t.handleClose(e)}}},[t._v("\n            "+t._s(e.name)+"\n          ")])})),1),t._v(" "),a("el-input",{attrs:{placeholder:"请选择归属于该标签的工作流（最多可选500个）"},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}}),t._v(" "),t.filterText?a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.taskLoading,expression:"taskLoading"}],staticClass:"tree-wrap"},[a("el-tree",{ref:"tree",staticClass:"filter-tree",attrs:{data:t.options,props:t.defaultProps,"empty-text":t.filterText?"No Data":"","check-on-click-node":!0,"expand-on-click-node":!1,"node-key":"id","show-checkbox":"","default-expand-all":""},on:{check:t.handleCheck}})],1):t._e()],1),t._v(" "),a("el-form-item",{attrs:{label:"是否公开此标签"}},[a("div",{attrs:{slot:"label"},slot:"label"},[t._v("\n          是否公开此标签\n          "),a("el-popover",{attrs:{trigger:"hover",placement:"top","popper-class":"tag-popper",width:"250"}},[t._v("\n            标签公开后，公开对象除了不能删除此标签外，可任意编辑此标签\n            "),a("i",{staticClass:"el-icon-info global-color-ca",attrs:{slot:"reference"},slot:"reference"})])],1),t._v(" "),a("el-radio",{attrs:{label:0,disabled:t.createBy!==t.userId},model:{value:t.ruleForm.publish,callback:function(e){t.$set(t.ruleForm,"publish",e)},expression:"ruleForm.publish"}},[t._v("否")]),t._v(" "),a("el-radio",{attrs:{label:1,disabled:t.createBy!==t.userId},model:{value:t.ruleForm.publish,callback:function(e){t.$set(t.ruleForm,"publish",e)},expression:"ruleForm.publish"}},[t._v("是")])],1),t._v(" "),t.showPublic?a("el-form-item",{attrs:{label:"公开给",prop:"publishers"}},[a("el-select",{staticClass:"senior-input",attrs:{placeholder:"请输入公开人",filterable:"",multiple:"",remote:"","allow-create":"","reserve-keyword":"",disabled:t.createBy!==t.userId,"remote-method":function(e){t.remoteMethod(e,"collaboratorsList")},loading:t.publicLoading,"popper-class":"custom-popper"},model:{value:t.ruleForm.publishers,callback:function(e){t.$set(t.ruleForm,"publishers",e)},expression:"ruleForm.publishers"}},t._l(t.collaboratorsList,(function(e){return a("el-option",{key:e.shareId,attrs:{value:e.shareId,label:e.name}},[a("div",{staticStyle:{"max-width":"250px","word-break":"break-all"}},[t._v("("+t._s(e.staffId)+")-"+t._s(e.name)+t._s(e.deptFullPath?"-"+e.deptFullPath:""))])])})),1)],1):t._e()],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.btnDisabled},on:{click:t.save}},[t._v("确 定")])],1)],1)},B=[],H={props:{userId:{type:String,default:""}},data:function(){var t=function(t,e,a){var i=/^[A-Za-z0-9_\u4e00-\u9fa5]{2,128}$/;i.test(e)?a():a(new Error("【只包含a-z,A-Z,0-9或_或中文】，长度2-128"))},e=function(t,e,a){0===e.length?a(new Error("请选择公开人")):a()};return{createBy:"",publicLoading:!1,taskLoading:!1,showPublic:!1,collaboratorsList:[],dialogVisible:!1,loading:!1,ruleForm:{name:"",publishers:[],publish:0},rules:{name:[{required:!0,validator:t,trigger:["blur","change"]}],publishers:[{required:!0,validator:e,trigger:["blur","change"]}]},btnDisabled:!1,selectTasks:[],filterText:"",options:[],defaultProps:{multiple:!0,value:"id",label:"name"},title:"添加标签",tagType:0}},watch:{filterText:function(t){this.filterTasks({vm:this,value:t})},"ruleForm.publish":function(t){this.showPublic=1===t}},created:function(){this.createBy=this.userId},methods:{showWin:function(t,e){this.dialogVisible=!0,this.btnDisabled=!1,this.tagType=e,t?(this.ruleForm.id=t,this.title="编辑标签",this.getInfo(t)):(this.ruleForm.id="",this.ruleForm.publishers=[],this.ruleForm.publish=0,this.title="添加标签")},getInfo:function(t){var e=this;this.loading=!0,Object(o["H"])(t).then((function(t){var a=t.data;e.createBy=a.createBy,e.ruleForm.name=a.name,e.ruleForm.publish=a.publish,e.ruleForm.publishers=a.publishers?a.publishers.split(","):[],a.workflows&&e.getList("",a.workflows),e.loading=!1}))},filterTasks:M["d"]((function(t){var e=t.vm,a=t.value;a?e.getList(a):e.options=[]}),400),remoteMethod:function(t,e){var a=this;""!==t?(this.publicLoading=!0,Object(o["Y"])(t).then((function(t){a.publicLoading=!1;var i=t.data;a[e]=i.filter((function(t){return t.shareId!==a.createBy}))}))):this[e]=[]},getList:function(t,e){var a=this;this.taskLoading=!0,e=t?"":e;var i={workflows:e,keyWord:t,onlyMine:!1,pageNo:1,pageSize:1e5,comefromLabel:!0};Object(s["u"])(i).then((function(t){a.taskLoading=!1,e&&(a.selectTasks=t.data.list.map((function(t){return{id:t.id,name:t.name}})));var i={};if(t.data.list.forEach((function(t){i[t.owner]?i[t.owner].push(t):i[t.owner]=[t]})),a.options=[],i){for(var r in i)i[r].forEach((function(t){t.name="(".concat(t.id,")").concat(t.name)})),a.options.push({id:"createBy-"+r,name:r,children:i[r]});a.$nextTick((function(){a.$refs.tree&&a.selectTasks.forEach((function(t){a.$refs.tree.setChecked(t,!0)}))}))}}))},handleCheck:function(t,e){var a=this,i=e.checkedKeys,r=e.checkedNodes;if(i.includes(t.id))r.forEach((function(t){if(!t.children){var e=a.selectTasks.find((function(e){return e.id===t.id}));e||(a.selectTasks.length>=500?a.$refs.tree.setChecked(t,!1):a.selectTasks.push({id:t.id,name:t.name}))}})),this.selectTasks.length>=500&&this.$message({type:"warning",message:"关联任务不能超过500个"});else if(t.children)t.children.forEach((function(t){var e=a.selectTasks.findIndex((function(e){return e.id===t.id}));-1!==e&&a.selectTasks.splice(e,1)}));else{var n=this.selectTasks.findIndex((function(e){return e.id===t.id}));-1!==n&&this.selectTasks.splice(n,1)}},handleClose:function(t){this.selectTasks.splice(this.selectTasks.findIndex((function(e){return e.id===t.id})),1),this.$refs.tree.setChecked(t,!1)},resetForm:function(){this.$refs.ruleForm.resetFields(),this.selectTasks=[],this.filterText="",this.options=[]},save:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.btnDisabled=!0;var a,i={name:t.ruleForm.name,workflows:t.selectTasks.map((function(t){return t.id})).join(","),publish:t.ruleForm.publish,publishers:t.ruleForm.publishers.join(",")};t.ruleForm.id?(i.id=t.ruleForm.id,a=Object(o["hb"])(i)):a=Object(o["c"])(i),a.then((function(e){t.dialogVisible=!1,t.$message({type:"success",message:t.title+"成功"}),t.$emit("save")})).finally((function(){t.btnDisabled=!1}))}}))}}},J=H,G=(a("cc30"),Object(f["a"])(J,A,B,!1,null,"328fce7d",null)),q=G.exports;function K(t){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K(t)}function Y(t){return X(t)||Q(t)||U(t)||Z()}function Z(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function U(t,e){if(t){if("string"===typeof t)return tt(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?tt(t,e):void 0}}function Q(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function X(t){if(Array.isArray(t))return tt(t)}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function et(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */et=function(){return e};var t,e={},a=Object.prototype,i=a.hasOwnProperty,r=Object.defineProperty||function(t,e,a){t[e]=a.value},n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function c(t,e,a){return Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,a){return t[e]=a}}function u(t,e,a,i){var n=e&&e.prototype instanceof v?e:v,s=Object.create(n.prototype),o=new S(i||[]);return r(s,"_invoke",{value:C(t,a,o)}),s}function d(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var f="suspendedStart",h="suspendedYield",p="executing",m="completed",g={};function v(){}function b(){}function y(){}var w={};c(w,s,(function(){return this}));var k=Object.getPrototypeOf,_=k&&k(k($([])));_&&_!==a&&i.call(_,s)&&(w=_);var x=y.prototype=v.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function a(r,n,s,o){var l=d(t[r],t,n);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==K(u)&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,s,o)}),(function(t){a("throw",t,s,o)})):e.resolve(u).then((function(t){c.value=t,s(c)}),(function(t){return a("throw",t,s,o)}))}o(l.arg)}var n;r(this,"_invoke",{value:function(t,i){function r(){return new e((function(e,r){a(t,i,e,r)}))}return n=n?n.then(r,r):r()}})}function C(e,a,i){var r=f;return function(n,s){if(r===p)throw new Error("Generator is already running");if(r===m){if("throw"===n)throw s;return{value:t,done:!0}}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var l=D(o,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===f)throw r=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var c=d(e,a,i);if("normal"===c.type){if(r=i.done?m:h,c.arg===g)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(r=m,i.method="throw",i.arg=c.arg)}}}function D(e,a){var i=a.method,r=e.iterator[i];if(r===t)return a.delegate=null,"throw"===i&&e.iterator.return&&(a.method="return",a.arg=t,D(e,a),"throw"===a.method)||"return"!==i&&(a.method="throw",a.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var n=d(r,e.iterator,a.arg);if("throw"===n.type)return a.method="throw",a.arg=n.arg,a.delegate=null,g;var s=n.arg;return s?s.done?(a[e.resultName]=s.value,a.next=e.nextLoc,"return"!==a.method&&(a.method="next",a.arg=t),a.delegate=null,g):s:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,g)}function I(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(I,this),this.reset(!0)}function $(e){if(e||""===e){var a=e[s];if(a)return a.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function a(){for(;++r<e.length;)if(i.call(e,r))return a.value=e[r],a.done=!1,a;return a.value=t,a.done=!0,a};return n.next=n}}throw new TypeError(K(e)+" is not iterable")}return b.prototype=y,r(x,"constructor",{value:y,configurable:!0}),r(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},L(T.prototype),c(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,a,i,r,n){void 0===n&&(n=Promise);var s=new T(u(t,a,i,r),n);return e.isGeneratorFunction(a)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},L(x),c(x,l,"Generator"),c(x,s,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),a=[];for(var i in e)a.push(i);return a.reverse(),function t(){for(;a.length;){var i=a.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=$,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var a=this;function r(i,r){return o.type="throw",o.arg=e,a.next=i,r&&(a.method="next",a.arg=t),!!r}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),c=i.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var s=n?n.completion:{};return s.type=t,s.arg=e,n?(this.method="next",this.next=n.finallyLoc,g):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),O(a),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var r=i.arg;O(a)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,a,i){return this.delegate={iterator:$(e),resultName:a,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}function at(t,e,a,i,r,n,s){try{var o=t[n](s),l=o.value}catch(c){return void a(c)}o.done?e(l):Promise.resolve(l).then(i,r)}function it(t){return function(){var e=this,a=arguments;return new Promise((function(i,r){var n=t.apply(e,a);function s(t){at(n,i,r,s,o,"next",t)}function o(t){at(n,i,r,s,o,"throw",t)}s(void 0)}))}}function rt(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function nt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?rt(Object(a),!0).forEach((function(e){st(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):rt(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function st(t,e,a){return e=ot(e),e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function ot(t){var e=lt(t,"string");return"symbol"===K(e)?e:String(e)}function lt(t,e){if("object"!==K(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var i=a.call(t,e||"default");if("object"!==K(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var ct={components:{WorkflowVersionList:p,WinAddNum:w,WinDelTip:C,HistoryTask:W,WinAddTag:q,SearchItem:n["a"]},data:function(){var t;sessionStorage.getItem("workflowParams")&&(t=JSON.parse(sessionStorage.getItem("workflowParams")));var e=!0;return sessionStorage.getItem("isOpen")&&(e="true"===sessionStorage.getItem("isOpen")),{labelId:t&&t.labelId?t.labelId:"",params:{comefromLabel:!1,owner:"",status:"",workflows:"",labelId:t&&t.labelId?t.labelId:"",keyWord:t&&t.keyWord?t.keyWord:"",pageNo:t&&t.pageNo?t.pageNo:1,pageSize:t&&t.pageSize?t.pageSize:20,sortKey:"",sortValue:"",onlyMine:!!t&&t.onlyMine},isShowSelf:!1,total:0,ownerLoading:!1,loading:!1,ownerList:[],isOpen:e,isShowAll:!0,fullscreen:!1,statusConfig:M["o"],codeToText:M["a"],offlineStateCode:M["i"],realtimeStateCode:M["k"],filterTag:"",tagList:{},allTagList:[],publishTagList:[],collectList:{},isTipDisabled:!1,keyWordResults:[],dialogVisible:!1,btnDisabled:!1,ruleForm:{id:"",status:0,ifnotify:!1},ifnotifyFrom:"",data:[],recordParams:{eventId:1,pageNo:1,pageSize:10,module:"WORKFLOW"}}},computed:nt(nt({},Object(z["c"])(["isAdmin","userInfo"])),{},{tagTitle:function(){var t=this,e=this.allTagList.find((function(e){return e.id===t.labelId}));return e?e.name:""},userInfo:function(){return this.$store.getters.userInfo||JSON.parse(sessionStorage.getItem("userInfo"))}}),created:function(){this.init()},methods:{init:function(){var t=it(et().mark((function t(){var e,a=this;return et().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.isAdmin?this.isShowSelf=!1:(this.isShowSelf=!0,this.params.onlyMine=!JSON.parse(sessionStorage.getItem("workflowParams"))||JSON.parse(sessionStorage.getItem("workflowParams")).onlyMine),!this.params.labelId){t.next=13;break}return t.next=4,this.getLabelList();case 4:e=this.allTagList.find((function(t){return t.id===a.params.labelId})).workflows,this.$set(this.params,"labelId",this.params.labelId),this.$set(this.params,"workflows",e),this.$set(this.params,"comefromLabel",!0),this.labelId=this.params.labelId,this.params.pageNum=1,this.getList(),t.next=15;break;case 13:this.getLabelList(),this.getList();case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),remoteMethod:function(t){var e=this;""!==t?(this.ownerLoading=!0,Object(o["Y"])(t).then((function(t){e.ownerLoading=!1;var a=t.data;e.ownerList=a}))):this.ownerList=[]},onContextmenu:function(t,e,a){var i,r=this,n=[{label:"编辑",onClick:function(){r.$refs.dialogTag.showWin(e.id,a)},disabled:!(e.isMy||e.publish)},{label:"删除",onClick:function(){r.$confirm("确定删除此标签?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["m"])(e.id).then((function(t){r.$message({type:"success",message:"删除成功!"}),r.getLabelList(),e.id===r.params.labelId&&(r.labelId="",r.params.labelId="",r.search())}))})).catch((function(){}))},disabled:!e.isMy},{label:"添加收藏",onClick:function(){Object(o["j"])({labelId:e.id}).then((function(t){r.$message({type:"success",message:"收藏成功!"}),r.getLabelList()}))}},{label:"取消收藏",onClick:function(){Object(o["f"])({labelId:e.id}).then((function(t){r.$message({type:"success",message:"取消收藏成功!"}),r.getLabelList()}))}}];1===a?i=[n[0],n[1],n[2]]:2===a?i=[n[2]]:3===a?i=[n[0],n[1],n[3]]:4===a&&(i=[n[0]]),this.$contextmenu({items:i,event:t,zIndex:2100,minWidth:50}),t.preventDefault()},clickTag:function(t){var e=this.allTagList.find((function(e){return e.id===t})).workflows;this.params.labelId===t?(this.$set(this.params,"labelId",""),this.$set(this.params,"workflows",""),this.$set(this.params,"comefromLabel",!1)):(this.$set(this.params,"labelId",t),this.$set(this.params,"workflows",e),this.$set(this.params,"comefromLabel",!0)),this.labelId=this.params.labelId,this.params.pageNum=1,this.getList()},addTag:function(){this.$refs.dialogTag.showWin()},handleOpen:function(){this.isOpen=!this.isOpen,sessionStorage.setItem("isOpen",this.isOpen)},collectTag:function(t){var e=this;t.collectVal?Object(o["f"])({labelId:t.id}).then((function(t){e.$message({type:"success",message:"取消收藏成功!"}),e.getLabelList()})):Object(o["j"])({labelId:t.id}).then((function(t){e.$message({type:"success",message:"收藏成功!"}),e.getLabelList()}))},getLabelList:function(){var t=it(et().mark((function t(){var e=this;return et().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,a){Object(o["I"])().then((function(a){var i=a.data;i&&(e.tagList=i,e.allTagList=[].concat(Y(i.current),Y(i.others)),e.publishTagList=e.allTagList.filter((function(t,a){return 1===t.publish&&t.publishers.includes(e.userInfo.userId)}))),e.getMyLabel(),t("success")}))})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),getMyLabel:function(){var t=this;Object(o["bb"])().then((function(e){var a=e.data;a?(t.collectList=a,t.allTagList.forEach((function(e){e.collectVal=0;var a=t.collectList.labels.findIndex((function(t){return t.name===e.name}));a>-1&&(e.collectVal=1)}))):t.collectList={}}))},navEdit:function(t){this.$router.push({path:"/workflow/add",query:{id:t.id,version:t.version}})},clickName:function(t){this.$router.push({path:"/workflow/detail",query:{id:t.id,version:t.version,name:t.name}}),localStorage.removeItem("executionDate")},clickIns:function(t,e){this.$router.push({path:"/workflow/detail",query:{id:t.id,version:t.version,name:t.name,tab:2}}),localStorage.setItem("executionDate",this.$utils.parseTime(e,"{y}-{m}-{d} {h}:{i}:{s}"))},sortChange:function(t){t.column;var e=t.prop,a=t.order,i="ascending"===a?"asc":"descending"===a?"desc":"";this.params.sortKey=e,this.params.sortValue=i,this.getList()},addNum:function(t){this.$refs.winAddNum.showWin(t)},getGroupName:function(t){var e=t.map((function(t){return t.name}));return e.length?e.join():"-"},isDisabled:function(t){if(this.userInfo){if(this.userInfo.isAdmin)return!1;var e=t.groupList.map((function(t){return t.id})),a=this.userInfo.groupIds.split(","),i=a.some((function(t){return e.includes(Number(t))}));return t.owner!==this.userInfo.userId&&!t.collaborators.includes(this.userInfo.userId)&&!i}return!1},isShowTooltip:function(t){var e=t.target.clientWidth,a=t.target.scrollWidth;this.isTipDisabled=!(a>e)},handleCurrentChange:function(t){this.params.pageNo=t,this.getList()},handleSizeChange:function(t){this.params.pageSize=t,this.params.pageNo=1,this.getList()},getList:function(){var t=this;this.loading=!0;var e=nt({},this.params);Object.keys(e).forEach((function(t){""===e[t]&&delete e[t]})),Object(s["u"])(e).then((function(a){var i=a.data;t.data=i.list,t.total=i.total,t.loading=!1;var r=t.data?t.data.map((function(t){return t.id})):[];sessionStorage.setItem("workflowParams",JSON.stringify(e)),r.length&&(Object(s["t"])({workflowList:r,num:7}).then((function(e){var a=e.data,i=function(e){var i=t.data.find((function(t){return t.id===Number(e)}));i&&t.$set(i,"taskInstances",a[e])};for(var r in a)i(r)})),Object(s["p"])({workflowList:r}).then((function(e){var a=e.data,i=function(e){var i=t.data.find((function(t){return t.id===Number(e)}));i&&t.$set(i,"nextExecutionDate",a[e])};for(var r in a)i(r)})))}))},search:function(){this.params.pageNo=1,this.getList()},goLine:function(t){var e=this;1!==t.status?this.$confirm("确定上线?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(s["y"])({workflowId:t.id,version:t.version}).then((function(t){e.$message.success("上线成功"),e.getList()})).finally((function(){e.loading=!1}))})):this.$refs.winDelTip.showWin(t,"turnoff")},addWorkFlow:function(t){"history"===t?(this.dialogVisible=!1,this.$refs.historyTask.showWin()):this.$router.push({path:"/workflow/add",query:{type:t}})},deleteHandler:function(t){var e=this;"history"===t.source&&0===t.status&&this.$confirm("确定删除工作流?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.loading=!0,Object(s["d"])({workflowId:t.id,notify:!1}).then((function(t){e.$message.success("删除成功"),e.getList()})).finally((function(){e.loading=!1}))})),this.$refs.winDelTip.showWin(t,"del")},getVersion:function(t){this.$refs.versionList.showWin(t)}}},ut=ct,dt=(a("67ee"),Object(f["a"])(ut,i,r,!1,null,"58d92b6a",null));e["default"]=dt.exports},a192:function(t,e,a){"use strict";a("b6e7")},b6e7:function(t,e,a){},cc30:function(t,e,a){"use strict";a("17ef")}}]);