(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-7d21d75b"],{"4e14":function(e,t,a){},"638f":function(e,t,a){"use strict";a("6c10")},"6c10":function(e,t,a){},"7ea2":function(e,t,a){"use strict";a.d(t,"m",(function(){return i})),a.d(t,"a",(function(){return o})),a.d(t,"t",(function(){return s})),a.d(t,"l",(function(){return c})),a.d(t,"g",(function(){return l})),a.d(t,"o",(function(){return u})),a.d(t,"p",(function(){return d})),a.d(t,"q",(function(){return p})),a.d(t,"r",(function(){return m})),a.d(t,"s",(function(){return f})),a.d(t,"n",(function(){return g})),a.d(t,"b",(function(){return b})),a.d(t,"f",(function(){return h})),a.d(t,"c",(function(){return v})),a.d(t,"d",(function(){return y})),a.d(t,"e",(function(){return _})),a.d(t,"i",(function(){return w})),a.d(t,"k",(function(){return L})),a.d(t,"j",(function(){return O})),a.d(t,"h",(function(){return j}));var r=a("7258"),n="/ds_task/flinkcluster";function i(e){return r["b"].get("".concat(n,"/page?"),{params:e})}function o(e){return r["b"].post("".concat(n,"/add"),e)}function s(e){return r["b"].put("".concat(n,"/update"),e)}function c(e){return r["b"].get("".concat(n,"/get?id=").concat(e))}function l(e){return r["b"].delete("".concat(n,"/delete"),{params:{id:e}})}function u(e){return r["b"].post("/cluster-service/cloud/resource/add",e,{timeout:6e5})}function d(e){return r["b"].delete("/cluster-service/cloud/resource/delete/".concat(e))}function p(e){return r["b"].get("/cluster-service/cloud/resource/getOne",{params:e})}function m(e){return r["b"].get("/cluster-service/cloud/resource/search",{params:e})}function f(e){return r["b"].post("/cluster-service/cloud/resource/update",e,{timeout:6e5})}function g(e){return r["b"].get("/cluster-service/cloud/resource/getRegion",{params:e})}function b(e){return r["b"].post("/cluster-service/cloud/data/add",e,{timeout:6e5})}function h(e){return r["b"].post("/cluster-service/cloud/data/update",e,{timeout:6e5})}function v(e){return r["b"].delete("/cluster-service/cloud/data/delete",{params:e})}function y(e){return r["b"].get("/cluster-service/cloud/data/getOne",{params:e})}function _(e){return r["b"].get("/cluster-service/cloud/data/search",{params:e})}function w(e){return r["b"].get("/cluster-service/cluster/service/roles",{params:e})}function L(e){return r["b"].get("/cluster-service/cluster/vpcs",{params:e})}function O(e){return r["b"].get("/cluster-service/cluster/subnets",{params:e})}function j(e){return r["b"].get("/cluster-service/cluster/security/groups",{params:e})}},b410:function(e,t,a){"use strict";a("4e14")},f3f8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"box-card-container"},[a("div",{attrs:{slot:"header"},slot:"header"},[e._v("数据挂载")]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-form",{attrs:{model:e.params,inline:!0}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入挂载名称"},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.getList}},[e._v("搜索")])],1)],1),e._v(" "),a("el-form",{attrs:{inline:!0}},[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("添加数据")])],1)],1)],1),e._v(" "),a("Table",{attrs:{body:e.body,loading:e.loading,params:e.params},on:{edit:e.handleEdit,handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange,updateList:e.getList}}),e._v(" "),a("AddData",{attrs:{visible:e.addResourceVisible,"edit-data":e.editData,loading:e.addLoading},on:{"update:visible":function(t){e.addResourceVisible=t},updateList:e.updateList}})],1)},n=[],i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.body,"highlight-current-row":"",border:"",height:"calc(100vh - 300px)"}},[a("el-table-column",{attrs:{label:"挂载名称",prop:"name",align:"left","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"云资源名称",prop:"cloudResourceName",align:"left","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{label:"地区",prop:"cloudResourceRegion",align:"center","min-width":"90"}}),e._v(" "),a("el-table-column",{attrs:{label:"路径",prop:"path",align:"center","min-width":"200"}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",prop:"createTime",align:"center","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.parseTime(t.row.createTime))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"更新时间",prop:"updateTime",align:"center","min-width":"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.parseTime(t.row.updateTime))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-popconfirm",{attrs:{title:"确认删除吗？","confirm-button-text":"确认","cancel-button-text":"取消"},on:{confirm:function(a){return e.handleDelete(t.row)}}},[a("el-button",{attrs:{slot:"reference",type:"text",loading:e.deleteLoading},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.params.pageNum,"page-sizes":[10,20,30,40],"page-size":e.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.params.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},o=[],s=a("ed08"),c=a("7ea2"),l={name:"CloudList",props:{params:{type:Object,default:function(){}},body:{type:Array,default:function(){return[]}},loading:Boolean},data:function(){return{deleteLoading:!1}},methods:{parseTime:function(e){var t=new Date(e).getTime();return Object(s["parseTime"])(t,"{y}-{m}-{d}")},handleSizeChange:function(e){this.$emit("handleSizeChange",e)},handleCurrentChange:function(e){this.$emit("handleCurrentChange",e)},handleEdit:function(e){this.$emit("edit",e)},handleDelete:function(e){var t=this;this.deleteLoading=!0,Object(c["c"])({id:e.id}).then((function(e){t.deleteLoading=!1,0===e.code&&(t.$message({type:"success",message:"删除成功"}),t.$emit("updateList"))}))}}},u=l,d=a("2877"),p=Object(d["a"])(u,i,o,!1,null,null,null),m=p.exports,f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:Object.keys(e.editData).length?"编辑数据":"新建数据",visible:e.visible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[a("el-form",{ref:"form",attrs:{model:e.params,rules:e.rules}},[a("el-form-item",{attrs:{prop:"name",label:"名称"}},[a("el-input",{attrs:{placeholder:"输入名称"},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name","string"===typeof t?t.trim():t)},expression:"params.name"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"dataSource",label:"数据源"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"选择数据源"},model:{value:e.params.dataSource,callback:function(t){e.$set(e.params,"dataSource",t)},expression:"params.dataSource"}},e._l(e.dataSourceList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.value}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"cloudResourceId",label:"所属云资源名称"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"选择所属云资源名称"},model:{value:e.params.cloudResourceId,callback:function(t){e.$set(e.params,"cloudResourceId",t)},expression:"params.cloudResourceId"}},e._l(e.cloudResourceList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"path",label:"存储路径"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"<桶>/<路径>，支持多个','分隔"},model:{value:e.params.path,callback:function(t){e.$set(e.params,"path","string"===typeof t?t.trim():t)},expression:"params.path"}}),e._v(" "),a("div",{staticStyle:{color:"666"}},[e._v("添加的桶名称，需要提前进行授权，可参考 "),a("a",{attrs:{href:"https://shimo.im/docs/KlkKVxR7PwUYxdqd",target:"_blank"}},[e._v("授权桶权限方法")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"Principal"}},[a("el-input",{staticStyle:{visibility:"hidden"},attrs:{disabled:"","suffix-icon":"el-icon-document-copy"},model:{value:e.roleName,callback:function(t){e.roleName=t},expression:"roleName"}}),e._v(" "),a("div",{staticStyle:{"margin-top":"-30px"}},[e._v(e._s(e.roleName)+" "),a("i",{staticClass:"el-icon-document-copy",on:{click:e.handleCopy}})])],1),e._v(" "),e.showProgress?a("el-form-item",[a("el-progress",{attrs:{percentage:e.percentage,"text-inside":!0,"stroke-width":26,color:e.customColorMethod}}),e._v(" "),a("div",{staticStyle:{color:"666"}},[e._v("提示：正在校验区域信息和当前桶是否在同一区域；并且确认 datacake 平台是否获得该桶的读写删权限")])],1):e._e(),e._v(" "),e.addDataErrorMessage?a("div",{staticClass:"error_message"},[e._v("\n      "+e._s("错误: "+e.addDataErrorMessage)+"\n    ")]):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{loading:e.submitLoading,type:"primary"},on:{click:e.ok}},[e._v("确定")])],1)],1)},g=[],b=a("f904"),h=a.n(b),v={name:"AddResource",props:{visible:{type:Boolean,required:!0},loading:Boolean,editData:{type:Object,default:function(){}}},data:function(){return{addDataErrorMessage:"",submitLoading:!1,dialogVisiable:this.visible,roleName:"arn:aws:iam::404486105145:root",dataSourceList:[{name:"对象存储",value:"s3"}],percentage:10,showProgress:!1,cloudResourceList:[],params:{name:"",dataSource:"",cloudResourceId:"",path:""},defaultParams:{name:"",dataSource:"",cloudResourceId:"",path:""},rules:{name:[{required:!0,message:"请输入数据挂载名称",trigger:["blur"]}],dataSource:[{required:!0,message:"请选择数据源",trigger:["blur"]}],cloudResourceId:[{required:!0,message:"请选择所属云资源名称",trigger:["blur"]}],path:[{required:!0,message:"请输入存储桶路径",trigger:["blur"]}]}}},watch:{visible:function(){this.dialogVisiable=this.visible,this.dialogVisiable||(this.percentage=10)},dialogVisiable:function(e){this.$emit("update:visible",e)},editData:{handler:function(e){this.submitLoading=!1,this.params=Object.assign({},this.params,e),Object.keys(e).length||(this.params=Object.assign({},this.defaultParams),this.addDataErrorMessage="")},deep:!0,immediate:!0}},created:function(){this.getList()},methods:{customColorMethod:function(e){return e<30?"#909399":e<70?"#e6a23c":"#67c23a"},increase:function(){var e=this,t=null;t=setInterval((function(a){if(!e.submitLoading)return clearInterval(t),e.addDataErrorMessage?(e.percentage=0,void(e.showProgress=!1)):(e.percentage=100,void setTimeout((function(t){e.showProgress=!1,e.$emit("update:visible",!1),e.$emit("updateList")}),800));e.percentage+=3,e.percentage>90&&(e.percentage=90)}),500)},getList:function(){var e=this;Object(c["r"])({}).then((function(t){e.cloudResourceList=t.data.list}))},handleChangeProvider:function(){this.getRegion()},handleChangeRegion:function(e){},handleCopy:function(){h()(this.roleName,{format:"text/plain"}),this.$message({type:"success",message:"RoleName 已复制到剪贴板"})},cancel:function(){this.$emit("update:visible",!1),this.addDataErrorMessage=""},ok:function(){var e=this;this.$refs["form"].validate((function(t){if(t){e.submitLoading=!0,e.showProgress=!0,e.addDataErrorMessage="",e.increase();var a=Object.assign({},e.params);Object.keys(e.editData).length?(a=Object.assign({},a,{id:e.editData.id}),Object(c["f"])(a).then((function(t){e.submitLoading=!1,0===t.code&&(e.$message({type:"success",message:"编辑数据成功"}),e.$emit("update:visible",!1),e.$emit("updateList"))})).finally((function(){e.submitLoading=!1}))):Object(c["b"])(a).then((function(t){e.submitLoading=!1,0===t.code&&(e.$message({type:"success",message:"添加数据成功"}),e.$emit("update:visible",!1),e.$emit("updateList"))})).catch((function(t){e.addDataErrorMessage=t.data||""})).finally((function(){e.submitLoading=!1}))}}))}}},y=v,_=(a("b410"),Object(d["a"])(y,f,g,!1,null,"25e1fa8b",null)),w=_.exports,L=a("2f62");function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(Object(a),!0).forEach((function(t){k(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function k(e,t,a){return t=C(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e){var t=R(e,"string");return"symbol"===O(t)?t:String(t)}function R(e,t){if("object"!==O(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var x={name:"Cloud",components:{AddData:w,Table:m},data:function(){return{addResourceVisible:!1,addLoading:!1,loading:!1,editData:{},body:[],params:{name:"",total:0,pageNum:1,pageSize:10}}},computed:S({},Object(L["c"])(["userInfo"])),created:function(){this.getList()},methods:{handleAdd:function(){this.editData={},this.addResourceVisible=!0},handleEdit:function(e){var t=this;this.addLoading=!0,this.addResourceVisible=!0,Object(c["d"])({id:e.id}).then((function(e){t.addLoading=!1,t.editData=e.data}))},handleSizeChange:function(e){this.params.pageSize=e,this.getReportList()},handleCurrentChange:function(e){this.params.pageNum=e,this.getReportList()},getList:function(){var e=this;this.loading=!0,Object(c["e"])(this.params).then((function(t){e.loading=!1,e.body=t.data.list||[],e.params.total=t.data.total}))},updateList:function(){this.getList()}}},D=x,$=(a("638f"),Object(d["a"])(D,r,n,!1,null,"1bb4b6bd",null));t["default"]=$.exports}}]);