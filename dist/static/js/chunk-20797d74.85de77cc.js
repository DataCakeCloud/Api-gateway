(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-20797d74"],{"1d86":function(e,t,r){"use strict";r("6df2")},"28ec":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",{staticClass:"role-list box-card-container"},[r("div",{staticClass:"search-condition-wrap"},[r("search-condition",{attrs:{label:"角色名称"}},[r("el-input",{staticClass:"search-box",attrs:{placeholder:"请输入角色名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.params.roleName,callback:function(t){e.$set(e.params,"roleName","string"===typeof t?t.trim():t)},expression:"params.roleName"}})],1),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.search}},[e._v("查询")]),e._v(" "),r("el-button",{staticClass:"create",attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0,e.operateType="add"}}},[e._v("新建角色")])],1),e._v(" "),r("div",{staticClass:"table-wrap"},[r("table-page",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"table-data":e.comTableData,"column-data":e.columnData,"table-height":"calc(100vh - 230px)",total:e.total,"page-num":e.params.pageNum,"page-size":e.params.pageSize},on:{changePage:e.changePage}},[r("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(r){return e.edit(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{staticStyle:{margin:"0 10px"},attrs:{type:"text",size:"mini"},on:{click:function(r){return e.roleDetail(t.row)}}},[e._v("用户/权限管理")]),e._v(" "),r("el-button",{staticClass:"global-color-cb",attrs:{type:"text",size:"mini"},on:{click:function(r){return e.deleteData(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),r("el-dialog",{attrs:{title:e.showSuccess?"角色授权":"edit"===e.operateType?"编辑角色":"新增数据权限角色",visible:e.dialogVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.handleClose}},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.showSuccess,expression:"!showSuccess"}],ref:"roleRef",attrs:{model:e.roleForm,rules:e.rules,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"角色名称",prop:"roleName"}},[r("el-input",{model:{value:e.roleForm.roleName,callback:function(t){e.$set(e.roleForm,"roleName",t)},expression:"roleForm.roleName"}}),e._v(" "),r("div",[e._v("允许英文字母、数字或'_'。字符数应小于等于64个")])],1),e._v(" "),r("el-form-item",{attrs:{label:"角色描述"}},[r("el-input",{attrs:{type:"textarea",rows:4},model:{value:e.roleForm.comment,callback:function(t){e.$set(e.roleForm,"comment",t)},expression:"roleForm.comment"}})],1)],1),e._v(" "),e.showSuccess?r("ul",{staticClass:"seccueeBox"},[r("li",[r("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:""}}),e._v(" "),r("span",{staticClass:"successTitle"},[e._v(" 角色创建成功")])],1),e._v(" "),r("li",[r("span",{staticClass:"labelEle"},[e._v("已选实体账号:"+e._s(e.userInfo.tenantName))])]),e._v(" "),r("li",[r("span",{staticClass:"labelEle"},[e._v("角色名称："+e._s(e.addUserForm.roleName))])]),e._v(" "),r("li",[e._v("\n        为确保角色的正常使用，建议您继续为此角色添加权限\n        "),r("el-button",{attrs:{type:"primary"},on:{click:e.addMenu}},[e._v("新增权限")])],1)]):e._e(),e._v(" "),e.showSuccess?e._e():r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("保 存")])],1)],1),e._v(" "),e.detailVisible?r("el-dialog",{staticClass:"detaiDial",attrs:{title:"角色详情",visible:e.detailVisible,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(t){e.detailVisible=t},close:e.detailClose}},[r("div",[r("el-card",{staticClass:"box-card"},[r("el-descriptions",{attrs:{column:2}},[r("el-descriptions-item",{attrs:{label:"角色名称"}},[e._v(e._s(e.addUserForm.roleName))]),e._v(" "),r("el-descriptions-item",{attrs:{label:"角色ID"}},[e._v(e._s(e.addUserForm.roleId))]),e._v(" "),r("el-descriptions-item",{attrs:{label:"角色描述"}},[e._v(e._s(e.addUserForm.comment))])],1)],1),e._v(" "),r("el-tabs",{attrs:{type:""},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{name:"first"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-s-custom"}),e._v(" 用户管理")]),e._v(" "),r("div",{staticClass:"tool"},[r("el-button",{staticClass:"btnEle",attrs:{type:"primary"},on:{click:function(t){e.addUserVisible=!0}}},[e._v("添加用户")]),e._v(" "),r("el-button",{staticClass:"btnEle",attrs:{type:"primary"},on:{click:function(t){e.addGroupVisible=!0}}},[e._v("添加用户组")]),e._v(" "),r("div",{staticClass:"searchName"},[r("el-input",{staticClass:"search-box",attrs:{placeholder:"请输入用户名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchNameFn(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"===typeof t?t.trim():t},expression:"searchName"}},[r("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.searchNameFn},slot:"suffix"})])],1)],1),e._v(" "),r("el-table",{attrs:{data:e.comTableDataUser,border:"",height:"350px"}},[r("el-table-column",{attrs:{prop:"name",label:"用户名称"}}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-popconfirm",{attrs:{title:"确认移除该用户吗？"},on:{confirm:function(r){return e.removeUserBtn(t.row)}}},[r("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[e._v("从该角色移除")])],1)]}}],null,!1,2934849918)})],1)],1),e._v(" "),r("el-tab-pane",{attrs:{name:"second"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-s-tools"}),e._v(" 数据权限配置")]),e._v(" "),r("data-role-table",{attrs:{info:e.addUserForm}})],1)],1)],1),e._v(" "),r("span",{staticClass:"detail-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.detailVisible=!1}}},[e._v("取 消")])],1)]):e._e(),e._v(" "),r("el-dialog",{attrs:{"close-on-click-modal":!1,title:"角色名称:"+e.addUserForm.roleName,center:"",visible:e.addUserVisible,width:"450px"},on:{"update:visible":function(t){e.addUserVisible=t},closed:e.addUserClosed}},[r("ul",e._l(e.addUserForm.userIds,(function(t,n){return r("li",{key:n,staticClass:"liEle"},[r("span",{staticClass:"labelEle"},[e._v("用户名称")]),e._v(" "),r("el-select",{attrs:{filterable:"",placeholder:"请输入用户名称","remote-method":function(t){e.remoteMethod(t,n)},remote:"","reserve-keyword":"",loading:e.loadingSelect},model:{value:t.id,callback:function(r){e.$set(t,"id",r)},expression:"item.id"}},e._l(e.options[n],(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),e._v(" "),0===n?r("i",{staticClass:"el-icon-plus iconEle",on:{click:e.addItem}}):e._e(),e._v(" "),0!==n?r("i",{staticClass:"el-icon-minus iconEle",on:{click:function(t){return e.deleteItem(n)}}}):e._e()],1)})),0),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addUserVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.addUserLoading},on:{click:e.addUserBtn}},[e._v("增 加")])],1)]),e._v(" "),r("el-dialog",{attrs:{title:"角色名称:"+e.addUserForm.roleName,center:"",visible:e.addGroupVisible,width:"450px"},on:{"update:visible":function(t){e.addGroupVisible=t},closed:e.addGroupClosed}},[r("div",[r("span",{staticClass:"labelEle"},[e._v("用户组名称")]),e._v(" "),r("el-cascader",{attrs:{options:e.groupOptions,props:e.props,clearable:"",placeholder:"请选择用户组"},model:{value:e.userGroupIds,callback:function(t){e.userGroupIds=t},expression:"userGroupIds"}})],1),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.addGroupVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",loading:e.addGroupLoading},on:{click:e.addGroupBtn}},[e._v("增 加")])],1)])],1)},a=[],i=r("88c9"),o=r("6041"),s=r("31e9"),l=r("7e3c"),c=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"header"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("添加数据权限")]),e._v(" "),r("el-input",{staticClass:"filter",attrs:{placeholder:"请输入要查询的数据库/表名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getListFn(t)}},model:{value:e.keyWord,callback:function(t){e.keyWord="string"===typeof t?t.trim():t},expression:"keyWord"}},[r("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.getListFn},slot:"suffix"})])],1),e._v(" "),r("el-table",{ref:"tableData",attrs:{data:e.tableData,height:"425px"}},[r("el-table-column",{attrs:{type:"selection",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{label:"对象类型",filters:e.tableFilters.grantedOn,"filter-method":e.filterHandler,width:"100",prop:"grantedOn"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[r("div",[e._v("\n          "+e._s(e.objectTypeFn(n.grantedOn,n.privilege))+"\n        ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"所属区域",filters:e.tableFilters.regionRoleName,width:"100","filter-method":e.filterHandler,prop:"regionRoleName"}}),e._v(" "),r("el-table-column",{attrs:{label:"名称",prop:"name","min-width":"180"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v("\n        "+e._s(e.formatTableName(r))+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"权限","min-width":"160"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return e._l(n.privilege,(function(t,a){return r("el-tag",{key:a,staticStyle:{margin:"2px"},attrs:{closable:"",closablesize:"medium"},on:{close:function(r){return e.delRow({rolename:n.name,privilege:t,grantedOn:n.grantedOn},"one")}}},[e._v("\n          "+e._s(e.privilegeFn(t))+"\n        ")])}))}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.delRow(n,"row")}}},[e._v("删除")])]}}])})],1),e._v(" "),r("div",{staticClass:"footer"},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.delRow("","all")}}},[e._v("批量删除")]),e._v(" "),r("el-pagination",{attrs:{background:"","pager-count":5,"page-size":e.params.maxResults,"page-sizes":[10,20,30,50,100],layout:"total,  prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),e.dialogVisible?r("el-dialog",{attrs:{title:"添加数据权限",visible:e.dialogVisible,width:"85%","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.closeAddDataRole}},[r("div",{staticClass:"addDataRole"},[r("el-card",{staticClass:"box-card"},[r("el-descriptions",{attrs:{column:2}},[r("el-descriptions-item",{attrs:{label:"角色名称"}},[e._v(e._s(e.info.roleName))]),e._v(" "),r("el-descriptions-item",{attrs:{label:"角色ID"}},[e._v(e._s(e.info.roleId))]),e._v(" "),r("el-descriptions-item",{attrs:{label:"角色描述"}},[e._v(e._s(e.info.comment))])],1)],1),e._v(" "),r("div",{staticClass:"selectType"},[r("div",{staticClass:"label"},[e._v("请选择对象类型:  ")]),e._v(" "),r("el-select",{attrs:{placeholder:"请选择对象类型"},model:{value:e.dataType,callback:function(t){e.dataType=t},expression:"dataType"}},e._l(e.optionsType,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),r("transferPage",{ref:"transferPage",attrs:{"object-type":e.dataType}}),e._v(" "),r("div",{staticClass:"selelectRole"},[r("div",{staticClass:"title"},[e._v("请选择具体的授予的权限")]),e._v(" "),r("div",{staticClass:"role"},[r("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),e._v(" "),r("el-checkbox-group",{on:{change:e.roleChange},model:{value:e.roleList,callback:function(t){e.roleList=t},expression:"roleList"}},e._l(e.grantRole,(function(t,n){return r("el-checkbox",{key:n,attrs:{label:t.label}},[e._v(e._s(t.label))])})),1)],1)]),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.closeDial}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.addSubmit}},[e._v("保 存")])],1)],1)]):e._e()],1)},u=[],f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"transfer"},[r("div",{staticClass:"leftTransfer"},[r("div",{staticClass:"leftTransfer_title"},[r("el-checkbox",{attrs:{indeterminate:e.left.isIndeterminate},on:{change:e.leftHandleCheckAllChange},model:{value:e.left.checkAll,callback:function(t){e.$set(e.left,"checkAll",t)},expression:"left.checkAll"}},[e._v(e._s(e.titles[0]))]),e._v(" "),r("span",[e._v(e._s(e.left.transferDataChecked.length)+"/"+e._s(e.left.transferData.length))])],1),e._v(" "),r("el-input",{staticClass:"transfer_input",attrs:{placeholder:"请输入内容","prefix-icon":"el-icon-search"},on:{input:e.transferInputLeft},model:{value:e.left.inputValue,callback:function(t){e.$set(e.left,"inputValue",t)},expression:"left.inputValue"}}),e._v(" "),r("div",{staticStyle:{margin:"5px 0"}}),e._v(" "),r("el-checkbox-group",{staticClass:"transfer_group",on:{change:e.leftHandleCheckedCitiesChange},model:{value:e.left.transferDataChecked,callback:function(t){e.$set(e.left,"transferDataChecked",t)},expression:"left.transferDataChecked"}},e._l(e.left.transferData,(function(t){return r("el-checkbox",{key:t[e.defaultProps.id],attrs:{label:t}},[e._v(e._s(t[e.defaultProps.label]))])})),1),e._v(" "),r("el-pagination",{staticClass:"pagination",attrs:{small:"",layout:"prev, pager, next","page-size":100,total:e.total},on:{"current-change":e.handleCurrentChange}})],1),e._v(" "),r("div",{staticClass:"transferButton"},[r("el-button",{attrs:{type:"primary"},on:{click:e.push}},[e._v(">")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.del}},[e._v("<")])],1),e._v(" "),r("div",{staticClass:"rightTransfer"},[r("div",{staticClass:"rightTransfer_title"},[r("el-checkbox",{attrs:{indeterminate:e.right.isIndeterminate},on:{change:e.rightHandleCheckAllChange},model:{value:e.right.checkAll,callback:function(t){e.$set(e.right,"checkAll",t)},expression:"right.checkAll"}},[e._v(e._s(e.titles[1]))]),e._v(" "),r("span",[e._v(e._s(e.right.transferDataChecked.length)+"/"+e._s(e.right.transferData.length))])],1),e._v(" "),r("el-input",{staticClass:"transfer_input",attrs:{placeholder:"请输入内容","prefix-icon":"el-icon-search"},on:{input:e.transferInputRight},model:{value:e.right.inputValue,callback:function(t){e.$set(e.right,"inputValue",t)},expression:"right.inputValue"}}),e._v(" "),r("div",{staticStyle:{margin:"5px 0"}}),e._v(" "),r("el-checkbox-group",{staticClass:"transfer_group transfer_group_right",on:{change:e.rightHandleCheckedCitiesChange},model:{value:e.right.transferDataChecked,callback:function(t){e.$set(e.right,"transferDataChecked",t)},expression:"right.transferDataChecked"}},e._l(e.right.transferData,(function(t){return r("el-checkbox",{key:t[e.defaultProps.id],attrs:{label:t}},[e._v(e._s(t[e.defaultProps.label]))])})),1)],1)])},d=[];function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function p(e){return b(e)||g(e)||v(e)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function v(e,t){if(e){if("string"===typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function g(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function b(e){if(Array.isArray(e))return y(e)}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){k(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e,t,r){return t=D(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){var t=C(e,"string");return"symbol"===h(t)?t:String(t)}function C(e,t){if("object"!==h(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var A={name:"TransferPage",props:{titles:{type:Array,default:function(){return["待选列表","已选列表"]}},objectType:{type:String,default:""}},data:function(){return{originData:{},left:{inputValue:"",isIndeterminate:!1,checkAll:!1,transferData:[],transferDataAll:[],transferDataChecked:[]},right:{inputValue:"",isIndeterminate:!1,checkAll:!1,transferData:[],transferDataAll:[],transferDataChecked:[]},total:0,queryParams:{pageNum:1,pageSize:100},defaultProps:{label:"label",id:"id"},timer:null}},watch:{objectType:function(){this.right.inputValue="",this.right.isIndeterminate=!1,this.right.checkAll=!1,this.right.transferData=[],this.right.transferDataAll=[],this.right.transferDataChecked=[],this.left.inputValue="",this.left.isIndeterminate=!1,this.left.checkAll=!1,this.left.transferData=[],this.left.transferDataAll=[],this.left.transferDataChecked=[],this.initTransferData()}},created:function(){this.initTransferData()},destroyed:function(){clearTimeout(this.timer)},methods:{initTransferData:function(){var e=this,t=w({objectType:this.objectType,keyword:this.left.inputValue},this.queryParams);Object(s["i"])(t).then((function(t){var r=t.data;e.originData=r,e.left.transferData=r.objectNames,e.left.transferData=e.left.transferData.map((function(t,r){return{label:t,id:t,pageNum:e.queryParams.pageNum}})),e.total=r.total,e.left.transferDataAll=e.left.transferData;var n=e.right.transferData.map((function(t){return t[e.defaultProps.id]}));e.left.transferData=e.left.transferData.filter((function(t){if(!n.includes(t[e.defaultProps.id]))return t}))}))},leftHandleCheckAllChange:function(e){this.left.transferDataChecked=e?this.left.transferData:[],this.left.isIndeterminate=!1},leftHandleCheckedCitiesChange:function(e){var t=e.length;this.left.checkAll=t===this.left.transferData.length,this.left.isIndeterminate=t>0&&t<this.left.transferData.length},rightHandleCheckAllChange:function(e){this.right.transferDataChecked=e?this.right.transferData:[],this.right.isIndeterminate=!1},rightHandleCheckedCitiesChange:function(e){var t=e.length;this.right.checkAll=t===this.right.transferData.length,this.right.isIndeterminate=t>0&&t<this.right.transferData.length},push:function(){var e=this;this.right.transferData=[].concat(p(this.right.transferData),p(this.left.transferDataChecked)).sort((function(t,r){return t[e.defaultProps.id]-r[e.defaultProps.id]})),this.right.transferDataAll=this.right.transferData;var t=this.right.transferData.map((function(t){return t[e.defaultProps.id]}));this.left.transferData=this.left.transferData.filter((function(r){if(!t.includes(r[e.defaultProps.id]))return r})),this.left.transferDataAll=this.left.transferData,this.left.transferDataChecked=[],this.left.isIndeterminate=!1,this.left.checkAll=!1},del:function(){var e=this,t=this.right.transferDataChecked.filter((function(t){if(e.queryParams.pageNum===t.pageNum)return t}));this.left.transferData=[].concat(p(this.left.transferData),p(t)).sort((function(t,r){return t[e.defaultProps.id]-r[e.defaultProps.id]})),this.left.transferDataAll=this.left.transferData;var r=this.right.transferDataChecked.map((function(t){return t[e.defaultProps.id]}));this.right.transferData=this.right.transferData.filter((function(t){if(!r.includes(t[e.defaultProps.id]))return t})),this.right.transferDataAll=this.right.transferData,this.right.transferDataChecked=[],this.right.isIndeterminate=!1,this.right.checkAll=!1},handleCurrentChange:function(e){this.queryParams.pageNum=e,this.initTransferData()},transferInputLeft:function(){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.queryParams.pageNum=1,e.queryParams.pageSize=100,e.initTransferData()}),600)},transferInputRight:function(){var e=this;this.right.inputValue?this.right.transferData=this.right.transferData.filter((function(t){return-1!==t[e.defaultProps.label].indexOf(e.right.inputValue)})):this.right.transferData=this.right.transferDataAll}}},O=A,x=(r("609d"),r("2877")),T=Object(x["a"])(O,f,d,!1,null,"071b2141",null),N=T.exports,E=r("2f62");function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function j(e){return R(e)||P(e)||I(e)||L()}function L(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){if(e){if("string"===typeof e)return F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?F(e,t):void 0}}function P(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function R(e){if(Array.isArray(e))return F(e)}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){V(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e,t,r){return t=$(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $(e){var t=B(e,"string");return"symbol"===S(t)?t:String(t)}function B(e,t){if("object"!==S(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var z=function(e){var t=[];return e.forEach((function(e){return t.push({text:e,value:e})})),t},H={"CREATE DATABASE":"创建库","CREATE TABLE":"创建表","DROP DATABASE":"删除库","DESC DATABASE":"描述库","ALTER DATABASE":"修改库","ALTER TABLE":"修改表","DROP TABLE":"删除表","DESC TABLE":"描述表","SELECT TABLE":"查询数据","INSERT TABLE":"插入数据","DESC CATALOG":"访问数据源","DROP CATALOG":"删除数据源","ALTER CATALOG":"编辑数据源"},M={components:{transferPage:N},props:{info:{type:Object,default:function(){return{}}}},data:function(){return{isIndeterminate:!0,checkAll:!1,pageNum:1,privilegesData:{},roleList:[],dataType:"REGION",optionsType:[{value:"REGION",label:"数据区域"},{value:"DATABASE",label:"数据库"},{value:"TABLE",label:"数据表"},{value:"CATALOG",label:"外部数据源"}],keyWord:"",tableData:[],total:0,dialogVisible:!1,params:{page:"",maxResults:40}}},computed:G(G({},Object(E["c"])(["userInfo"])),{},{dobcomPrivilegesData:function(){return this.comPrivilegesData.slice(100*(this.pageNum-1),100*this.pageNum)},comPrivilegesData:function(){var e=this,t=this.grantRole.map((function(e){var t=e.value;return t})),r=[];return t.forEach((function(t){var n;e.privilegesData[t]&&(n=r).push.apply(n,j(e.privilegesData[t]))})),r=Array.from(new Set(r)),r=r.map((function(e){return{key:e,label:e}})),r},grantRole:function(){var e={REGION:[{label:"创建库",value:"CREATE_DATABASE"}],DATABASE:[{label:"创建表",value:"CREATE_TABLE"},{label:"删除库",value:"DROP_DATABASE"},{label:"描述库",value:"DESC_DATABASE"},{label:"修改库",value:"ALTER_DATABASE"}],TABLE:[{label:"修改表",value:"ALTER_TABLE"},{label:"删除表",value:"DROP_TABLE"},{label:"描述表",value:"DESC_TABLE"},{label:"查询数据",value:"SELECT_TABLE"},{label:"插入数据",value:"INSERT_TABLE"}],CATALOG:[{label:"访问数据源",value:"DESC"},{label:"编辑数据源",value:"DROP"},{label:"删除数据源",value:"ALTER"}]};return e[this.dataType]},tableFilters:function(){var e=new Set,t=new Set;return this.tableData.forEach((function(r){"grantedOn"in r&&t.add(r.grantedOn),"regionRoleName"in r&&e.add(r.regionRoleName)})),{regionRoleName:z(e),grantedOn:z(t)}}}),watch:{dataType:function(){this.roleList=[]}},created:function(){this.getList()},methods:{roleChange:function(e){var t=e.length;this.checkAll=t===this.grantRole.length,this.isIndeterminate=t>0&&t<this.grantRole.length},handleCheckAllChange:function(e){this.roleList=e?this.grantRole.map((function(e){var t=e.label;return t})):[],this.isIndeterminate=!1},formatTableName:function(e){return"CATALOG"===e.grantedOn?e.uuid:e.name},closeDial:function(){this.dialogVisible=!1,this.closeAddDataRole()},closeAddDataRole:function(){this.roleList=[],this.checkAll=!1,this.isIndeterminate=!0},getListFn:function(){this.params.page="",this.getList()},objectTypeFn:function(e,t){var r=this.optionsType.find((function(t){return t.value===e}))||{};return"CATALOG"===e&&t[0].includes("DATABASE")?"数据区域":r.label||"- -"},privilegeFn:function(e){return H[e]||"- -"},addSubmit:function(){var e=this,t=this.$refs.transferPage.right.transferData.map((function(e){var t=e.id;return t})),r="";if(t.length<=0)return r="请选择授权的数据",void this.$message({type:"warning",message:r});if(this.roleList.length<=0)return r="请选择具体的授予的权限",void this.$message({type:"warning",message:r});var n={roleName:this.info.roleName,operation:this.roleList,objectNames:t};"CATALOG"===this.dataType&&(n.objectNames=t.map((function(t){var r=e.$refs.transferPage.originData.actors.find((function(e){return e.name===t}));return r.uuid}))),Object(s["b"])(n).then((function(t){e.$message({type:"success",message:"添加成功!"}),e.dialogVisible=!1,e.params.page="",e.getList()}))},getList:function(){var e=this,t=G(G({projectId:this.userInfo.tenantName||"shareit",roleName:this.info.roleName,objectName:this.keyWord},this.params),{},{page:this.params.page,maxResults:this.params.maxResults});Object(s["j"])(t).then((function(t){var r=t.data||[];e.total=t.total;var n=Array.from(new Set(r.map((function(e){var t=e.name;return t})))),a=[];n.forEach((function(e){var t=r.filter((function(t){var r=t.name;return e===r})),n=Array.from(new Set(t.map((function(e){var t=e.privilege;return t}))));a.push({grantedOn:t[0].grantedOn,name:e,privilege:n,regionRoleName:t[0].regionRoleName,uuid:t[0].uuid})})),e.tableData=a}))},delRow:function(e,t){var r=this;this.$confirm("确定移除该权限吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={roleName:r.info.roleName,roleInputs:[]};if("one"===t){var a=[];a.push(H[e.privilege]),n.roleInputs.push({objectName:[].concat(e.rolename),operation:a,objectType:"REGION"===e.grantedOn?"CATALOG":e.grantedOn})}else if("row"===t){var i=[];e.privilege.forEach((function(e){i.push(H[e])})),n.roleInputs.push({objectName:[].concat(e.name),operation:i,objectType:"REGION"===e.grantedOn?"CATALOG":e.grantedOn})}else if("all"===t){var o=r.$refs.tableData.selection;if(o.length<=0)return void r.$message({type:"warning",message:"至少选择一项要删除的权限"});var l=[];o.forEach((function(e){var t=[];e.privilege.forEach((function(e){t.push(H[e])})),l.push({objectName:[].concat(e.name),operation:t,objectType:"REGION"===e.grantedOn?"CATALOG":e.grantedOn})})),n.roleInputs=l}Object(s["d"])(n).then((function(e){r.params.page="",r.getList(),r.$message({type:"success",message:"删除成功"})}))})).catch((function(){}))},handleSizeChange:function(e){this.params.maxResults=e,this.getList()},handleCurrentChange:function(e){this.params.page=e,this.getList()},filterHandler:function(e,t,r){var n,a=r["property"];return null==(n=t[a])?void 0:n.includes(e)}}},q=M,W=(r("1d86"),Object(x["a"])(q,c,u,!1,null,"2585283a",null)),K=W.exports;function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Y(e){return ee(e)||Z(e)||X(e)||Q()}function Q(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function X(e,t){if(e){if("string"===typeof e)return te(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?te(e,t):void 0}}function Z(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function ee(e){if(Array.isArray(e))return te(e)}function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function re(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */re=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function u(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),s=new E(n||[]);return a(o,"_invoke",{value:O(e,r,s)}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",h="suspendedYield",p="executing",m="completed",v={};function g(){}function b(){}function y(){}var _={};c(_,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(S([])));k&&k!==r&&n.call(k,o)&&(_=k);var D=y.prototype=g.prototype=Object.create(_);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function r(a,i,o,s){var l=f(e[a],e,i);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==J(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var i;a(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return i=i?i.then(a,a):a()}})}function O(t,r,n){var a=d;return function(i,o){if(a===p)throw new Error("Generator is already running");if(a===m){if("throw"===i)throw o;return{value:e,done:!0}}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var l=x(s,n);if(l){if(l===v)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=p;var c=f(t,r,n);if("normal"===c.type){if(a=n.done?m:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=m,n.method="throw",n.arg=c.arg)}}}function x(t,r){var n=r.method,a=t.iterator[n];if(a===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,x(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(a,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var o=i.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function S(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw new TypeError(J(t)+" is not iterable")}return b.prototype=y,a(D,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(D),e},t.awrap=function(e){return{__await:e}},C(A.prototype),c(A.prototype,s,(function(){return this})),t.AsyncIterator=A,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new A(u(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(D),c(D,l,"Generator"),c(D,o,(function(){return this})),c(D,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=S,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),N(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;N(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:S(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),v}},t}function ne(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(n,a)}function ae(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){ne(i,n,a,o,s,"next",e)}function s(e){ne(i,n,a,o,s,"throw",e)}o(void 0)}))}}function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function se(e,t,r){return t=le(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function le(e){var t=ce(e,"string");return"symbol"===J(t)?t:String(t)}function ce(e,t){if("object"!==J(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==J(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var ue=function(){return{roleId:"",roleName:"",userIds:[{id:""}],comment:""}},fe={name:"DataRole",components:{SearchCondition:i["a"],TablePage:o["a"],DataRoleTable:K},data:function(){var e=this;return{props:{multiple:!0,value:"id",label:"name"},groupOptions:[],userGroupIds:[],addGroupVisible:!1,searchName:"",addUserLoading:!1,addGroupLoading:!1,showSuccess:!1,allArr:[],actionChecked:[],menuChecked:[],operateType:"",menuLoading:!1,actionLoading:!1,tableDataUser:[],comTableDataUser:[],addUserVisible:!1,addUserForm:ue(),options:[[]],loadingSelect:!1,activeName:"first",detailVisible:!1,roleForm:{roleName:"",comment:""},oldName:"",rules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"},{max:64,message:"字符数应小于等于64个",trigger:"blur"},{pattern:/^\w+$/,message:"格式错误",trigger:"blur"}]},dialogVisible:!1,loading:!1,tableData:[],columnData:[{prop:"roleName",label:"角色名称",width:"100"},{prop:"roleId",label:"角色ID",width:"180"},{prop:"comment",label:"角色描述",width:"100"},{prop:"createdTime",label:"创建时间",width:"100",format:function(t){return e.$utils.parseTime(t.createdTime)}},{prop:"owner",label:"创建人",width:"80"}],total:0,params:{roleName:"",pageNum:1,pageSize:10}}},computed:oe(oe({},Object(E["c"])(["userInfo"])),{},{comTableData:function(){var e=(this.params.pageNum-1)*this.params.pageSize,t=this.params.pageNum*this.params.pageSize;return this.tableData.slice(e,t)}}),created:function(){this.getList(),this.getUserGroup()},methods:{getUserGroup:function(){var e=this,t={userId:JSON.parse(sessionStorage.getItem("userInfo")).userId};Object(l["m"])(t).then((function(t){e.groupOptions=t.data,e.solveEmptyChildren(e.groupOptions)}))},solveEmptyChildren:function(e){var t=this;e.forEach((function(e){e.children.length?t.solveEmptyChildren(e.children):delete e.children}))},searchNameFn:function(){var e=this;this.searchName?this.comTableDataUser=this.tableDataUser.filter((function(t){return t.name.includes(e.searchName)})):this.comTableDataUser=this.tableDataUser},addUserClosed:function(){this.addUserForm.userIds=[{id:""}],this.options=[[]]},addGroupClosed:function(){},remoteMethod:function(){var e=ae(re().mark((function e(t,r){var n;return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(""===t.trim()){e.next=11;break}return this.loadingSelect=!0,e.next=4,Object(l["M"])({name:t,tenantId:this.userInfo.tenantId});case 4:return e.next=6,e.sent.data;case 6:n=e.sent,this.loadingSelect=!1,this.options[r]=n.length>0?n.map((function(e){return{label:e.name,value:e.name}})):[],e.next=12;break;case 11:this.options[r]=[];case 12:case"end":return e.stop()}}),e,this)})));function t(t,r){return e.apply(this,arguments)}return t}(),roleGetFn:function(){var e=ae(re().mark((function e(t){return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["roleGet"])({id:t});case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),removeUserBtn:function(){var e=ae(re().mark((function e(t){return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(s["c"])({roleName:this.addUserForm.roleName,userIds:[t.name]});case 2:this.$message.success("删除成功"),this.roleDetail(this.addUserForm);case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),addUserBtn:function(){var e=ae(re().mark((function e(){var t;return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.addUserForm.userIds,!t.some((function(e){return""===e.id}))){e.next=4;break}return this.$message.warning("用户名称不能为空"),e.abrupt("return");case 4:return this.addUserLoading=!0,t=t.map((function(e){var t=e.id;return t})),e.prev=6,e.next=9,Object(s["a"])({roleName:this.addUserForm.roleName,userIds:t});case 9:return this.$message.success("添加成功"),e.next=12,this.roleDetail(this.addUserForm);case 12:this.addUserVisible=!1,e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](6),console.error(e.t0);case 18:this.addUserLoading=!1;case 19:case"end":return e.stop()}}),e,this,[[6,15]])})));function t(){return e.apply(this,arguments)}return t}(),addGroupBtn:function(){var e=ae(re().mark((function e(){return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.userGroupIds.length){e.next=3;break}return this.$message.warning("用户名称不能为空"),e.abrupt("return");case 3:return this.addGroupLoading=!0,e.prev=4,e.next=7,Object(s["a"])({roleName:this.addUserForm.roleName,groupIds:this.userGroupIds.map((function(e){return e[e.length-1]})).join(",")});case 7:return e.next=9,this.roleDetail(this.addUserForm);case 9:this.$message.success("添加成功"),this.addGroupVisible=!1,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](4),console.error(e.t0);case 16:this.addGroupLoading=!1;case 17:case"end":return e.stop()}}),e,this,[[4,13]])})));function t(){return e.apply(this,arguments)}return t}(),deleteItem:function(e){this.addUserForm.userIds.splice(e,1)},addItem:function(){this.addUserForm.userIds.push({id:""}),this.options.push([])},roleDetail:function(){var e=ae(re().mark((function e(t){var r,n,a,i,o;return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.comment,n=t.roleId,a=t.roleName,e.next=3,Object(s["k"])({projectId:this.userInfo.tenantName||"shareit",roleName:a});case 3:return e.next=5,e.sent.data;case 5:return i=e.sent,o=i.toUsers,this.addUserForm.roleId=n,this.addUserForm.roleName=a,this.addUserForm.comment=r,this.tableDataUser=this.comTableDataUser=o.map((function(e){return{name:e}})),this.detailVisible=!0,e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),addMenu:function(){this.dialogVisible=!1,this.detailVisible=!0,this.roleDetail(this.addUserForm)},saveBtn:function(){var e=this,t=this.$refs.menuActionRef.$refs.menuTree.getCheckedKeys();0===t.length?this.$confirm("未配置任何权限，确定保存吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.updateMenusFn()})).catch((function(){})):this.updateMenusFn()},updateMenusFn:function(){var e=ae(re().mark((function e(){var t,r,n,a,i;return re().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$refs.menuActionRef.$refs.actionTree.getCheckedKeys(),r=this.$refs.menuActionRef.$refs.menuTree.getCheckedKeys(),n=this.$refs.menuActionRef.$refs.menuTree.getHalfCheckedKeys(),a=[].concat(Y(t),Y(r),Y(n)),i={id:this.addUserForm.roleId,menuIds:a.join(",")},e.next=7,Object(s["roleUpdateMenus"])(i);case 7:this.$message.success("保存成功"),this.detailVisible=!1;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submit:function(){var e=this;this.$refs["roleRef"].validate(function(){var t=ae(re().mark((function t(r){var n,a;return re().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!r){t.next=8;break}return n="add"===e.operateType?s["e"]:s["h"],a="add"===e.operateType?oe(oe({},e.roleForm),{},{ownerUser:e.userInfo.userId}):{oldName:e.oldName,comment:e.roleForm.comment,newName:e.roleForm.roleName},t.next=5,n(a);case 5:"add"===e.operateType?(e.showSuccess=!0,e.addUserForm.roleName=e.roleForm.roleName):(e.$message.success("编辑成功"),e.dialogVisible=!1,e.getList()),t.next=9;break;case 8:return t.abrupt("return",!1);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},edit:function(e){var t=e.roleName,r=e.comment;this.oldName=t,this.operateType="edit",this.roleForm.roleName=t,this.roleForm.comment=r,this.dialogVisible=!0},handleClose:function(){this.$refs.roleRef.resetFields(),this.roleForm={roleName:"",comment:""},this.showSuccess&&this.getList(),this.showSuccess=!1},detailClose:function(){this.addUserForm=ue(),this.activeName="first"},changePage:function(e){this.params.pageSize=e.pageSize,this.params.pageNum=e.pageNum},getList:function(){var e=this;this.loading=!0;var t=oe({},this.params);Object.keys(t).forEach((function(e){""===t[e]&&delete t[e]})),t.roleName?Object(s["k"])({roleName:t.roleName,projectId:this.userInfo.tenantName||"shareit"}).then((function(t){e.loading=!1;var r=t.data;e.total=1,e.tableData=r?[r]:[]})).catch((function(){e.loading=!1,e.total=1,e.tableData=[]})):Object(s["g"])(t).then((function(t){var r=t.data;e.loading=!1,e.total=r.length,e.tableData=r})).catch((function(e){console.log(e,"err")}))},reset:function(){this.params={componentCode:"",createBy:"",keyword:"",pageNum:1,pageSize:10},this.getList()},search:function(){this.params.pageNum=1,this.getList()},deleteData:function(e){var t=this,r=e.roleName;this.$confirm("确定删除".concat(r,"?"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["f"])({roleName:r}).then((function(e){t.$message({type:"success",message:"删除成功!"}),t.params.roleName="",t.getList()}))})).catch((function(){}))}}},de=fe,he=(r("e909"),Object(x["a"])(de,n,a,!1,null,"07ae32b4",null));t["default"]=he.exports},"31e9":function(e,t,r){"use strict";r.d(t,"e",(function(){return a})),r.d(t,"g",(function(){return i})),r.d(t,"f",(function(){return o})),r.d(t,"h",(function(){return s})),r.d(t,"k",(function(){return l})),r.d(t,"c",(function(){return c})),r.d(t,"a",(function(){return u})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return d})),r.d(t,"b",(function(){return h})),r.d(t,"d",(function(){return p}));var n=r("7258");function a(e){return n["b"].post("/metadata/role/createRole",e)}function i(e){return n["b"].get("/metadata/role/showRoles",{params:e})}function o(e){return n["b"].delete("/metadata/role/dropRole",{params:e})}function s(e){return n["b"].patch("/metadata/role/alterRole",e)}function l(e){return n["b"].get("/metadata/role/showUsers",{params:e})}function c(e){return n["b"].patch("/metadata/role/removeUsers",e)}function u(e){return n["b"].post("/metadata/role/addUsers",e)}function f(e){return n["b"].get("/metadata/role/showPrivileges",{params:e})}function d(e){return n["b"].get("/metadata/role/showObjectNames",{params:e})}function h(e){return n["b"].post("/metadata/role/grantPrivilegeToRole",e)}function p(e){return n["b"].patch("/metadata/role/revokePrivilegeFromRole",e)}},"4bdc":function(e,t,r){},"609d":function(e,t,r){"use strict";r("f7a0")},"6df2":function(e,t,r){},e909:function(e,t,r){"use strict";r("4bdc")},f7a0:function(e,t,r){}}]);