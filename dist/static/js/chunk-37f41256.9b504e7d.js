(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-37f41256"],{"0366":function(t,e,i){"use strict";i("3990")},"089d":function(t,e,i){"use strict";i("8297")},"1acbe":function(t,e,i){"use strict";i("8619")},2267:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-card",{staticClass:"box-card-container metadata-box"},[r("SearchCondition",{attrs:{keyword:t.params.keyWord},on:{updateList:t.updateList}}),t._v(" "),r("el-row",{staticClass:"meta-box",attrs:{gutter:10}},[r("el-col",{staticClass:"meta-left",attrs:{span:6}},[r("LeftBar",{ref:"leftBar",attrs:{keyword:t.params.keyWord,region:t.params.region,"left-db-list":t.leftDbList,list:t.data},on:{updateList:t.updateList,getDbDetail:t.getDbDetail}})],1),t._v(" "),r("el-col",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content",attrs:{span:18}},[t.params.dbName?r("div",{staticClass:"card-box"},[r("el-card",[r("div",[r("div",{staticClass:"info-box"},[r("div",{staticClass:"icon-box"},[r("span",{staticClass:"metaIcon"},[r("img",{attrs:{src:i("b958"),alt:""}})]),t._v(" "),r("span",[t._v("数据库详情---"+t._s(t.params.dbName))])]),t._v(" "),t.isRoot?r("div",{staticClass:"btn-box"},[r("i",{staticClass:"el-icon-edit",on:{click:t.editDb}}),t._v(" "),r("el-popconfirm",{attrs:{title:"确定要删除该数据库吗?"},on:{confirm:t.deleteDb}},[r("i",{staticClass:"el-icon-delete delete",attrs:{slot:"reference"},slot:"reference"})])],1):t._e()]),t._v(" "),r("div",{staticClass:"detail-box"},[r("el-descriptions",{attrs:{column:2}},[r("el-descriptions-item",{attrs:{label:"归属用户组"}},[t._v(t._s(t.dbDetail.owner||"--"))]),t._v(" "),r("el-descriptions-item",{attrs:{label:"创建时间"}},[t._v(t._s(t.$utils.parseTime(t.dbDetail.createTime)))]),t._v(" "),r("el-descriptions-item",{attrs:{label:"描述"}},[t._v(t._s(t.dbDetail.description||"--"))]),t._v(" "),r("el-descriptions-item",{attrs:{label:"Location"}},[t._v(" "+t._s(t.dbDetail.locationUri||"--"))]),t._v(" "),r("el-descriptions-item",{attrs:{label:"修改时间"}},[t._v(t._s(t.$utils.parseTime(t.dbDetail.createTime)))]),t._v(" "),r("el-descriptions-item",{attrs:{label:"访问信息"}},[t._v("--")])],1)],1)])])],1):t._e(),t._v(" "),r("div",{staticClass:"remark"},[r("el-button",{attrs:{loading:t.batchLoading,disabled:t.batchLoading,type:"primary"},on:{click:t.batchApply}},[t._v(t._s(t.batchText))]),t._v(" "),r("div",[r("span",[t._v("共"+t._s(t.total)+"个结果，没找到您想要的表？")]),t._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:t.create}},[t._v("创建表")])],1)],1),t._v(" "),0===t.data.length?r("el-empty",{attrs:{"image-size":200}}):[t._l(t.data,(function(e,i){return r("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.updateLoading,expression:"item.updateLoading"}],key:i,staticClass:"content-card box-card",attrs:{shadow:"hover",title:"点击进入详情","element-loading-text":"列表更新中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"},nativeOn:{click:function(i){return t.gotoDetail(e)}}},[r("div",{staticClass:"content-card-title"},[r("span",{staticClass:"title"},[t._v(t._s(e.db_name)+"."+t._s(e.table_name))]),t._v(" "),r("span",{directives:[{name:"loading",rawName:"v-loading",value:e.collectLoading,expression:"item.collectLoading"}],class:["item-flag",{"el-icon-star-on":e.flag},{"el-icon-star-off":!e.flag},{collect:e.flag}],attrs:{"element-loading-spinner":"el-icon-loading"},on:{click:function(r){return r.stopPropagation(),t.handleCollect(e,i)}}},[t._v(t._s(e.collect||""))]),t._v(" "),r("span",{staticClass:"item-flag el-icon-user owner"},[t._v(t._s(e.owner||"-"))]),t._v(" "),e.level?r("el-tag",{attrs:{effect:"plain"}},[t._v(t._s(e.level))]):t._e(),t._v(" "),e.storage?r("el-tag",{attrs:{effect:"plain",type:"warning"}},[t._v(t._s(e.storage))]):t._e()],1),t._v(" "),r("div",{staticClass:"tag-wrap"},[r("el-tag",{attrs:{type:"warning"}},[t._v("分区类型：\n              "),0===e.Partition_type?[t._v("非分区表")]:1===e.Partition_type?[t._v("分区表")]:[t._v("-")]],2),t._v(" "),t._l(t.formatTags(e.tags),(function(e){return r("el-tag",{key:e.key,staticClass:"tag",attrs:{type:e.type}},[t._v(t._s((e.key||"-")+": "+(e.value||"-")))])}))],2),t._v(" "),r("p",{staticClass:"content-text"},[r("span",[t._v("中文表名："+t._s(e.cnName||"--"))]),t._v(" "),r("span",[t._v("业务描述："+t._s(e.description||"--"))])]),t._v(" "),r("div",{staticClass:"content-basic"},[r("span",{staticClass:"time"},[t._v("创建时间："+t._s(e.create_time||"-"))]),t._v("\n            最近访问："),t._l(e.recents,(function(e,i){return r("el-tag",{key:i,attrs:{type:"info"}},[t._v(t._s(e))])}))],2),t._v(" "),e.tableAuth?t._e():r("el-button",{staticClass:"content-btn",attrs:{loading:e.applyLoading,type:"primary",disabled:e.applyLoading},on:{click:function(r){return r.stopPropagation(),t.apply(e,i)}}},[t._v(t._s(e.applyText))])],1)})),t._v(" "),r("el-pagination",{attrs:{background:"","current-page":t.params.pageNum,"page-sizes":[10,20,30,50],"page-size":t.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})]],2)],1),t._v(" "),r("DataPermission",{attrs:{visiable:t.dataPermissionVisible,"per-data":t.perData,"list-index":t.listIndex},on:{"update:visiable":function(e){t.dataPermissionVisible=e},close:t.handleClosePer}}),t._v(" "),r("Authorization",{attrs:{visiable:t.authorizationVisible,"autho-data":t.authoData,"list-index":t.listIndex},on:{"update:visiable":function(e){t.authorizationVisible=e},close:t.handleCloseAuth}}),t._v(" "),r("BatchApply",{attrs:{visiable:t.batchApplyVisible},on:{"update:visiable":function(e){t.batchApplyVisible=e},close:t.handleCloseBatch}})],1)},a=[],n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",{staticClass:"condition-box"},[i("div",{staticClass:"search"},[i("div",{staticClass:"search_item"},[i("el-input",{attrs:{placeholder:"请输入表名查询",clearable:""},on:{change:t.search},model:{value:t.params.keyWord,callback:function(e){t.$set(t.params,"keyWord",e)},expression:"params.keyWord"}},[i("el-button",{attrs:{slot:"append"},on:{click:t.search},slot:"append"},[t._v("搜索")])],1)],1)])])},o=[],s=i("7d99"),l=i("7ea2"),c=i("2f62");function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function p(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */p=function(){return e};var t,e={},i=Object.prototype,r=i.hasOwnProperty,a=Object.defineProperty||function(t,e,i){t[e]=i.value},n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",s=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function c(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,i){return t[e]=i}}function d(t,e,i,r){var n=e&&e.prototype instanceof y?e:y,o=Object.create(n.prototype),s=new N(r||[]);return a(o,"_invoke",{value:x(t,i,s)}),o}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var f="suspendedStart",m="suspendedYield",b="executing",g="completed",v={};function y(){}function _(){}function w(){}var L={};c(L,o,(function(){return this}));var O=Object.getPrototypeOf,k=O&&O(O(A([])));k&&k!==i&&r.call(k,o)&&(L=k);var j=w.prototype=y.prototype=Object.create(L);function S(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function i(a,n,o,s){var l=h(t[a],t,n);if("throw"!==l.type){var c=l.arg,p=c.value;return p&&"object"==u(p)&&r.call(p,"__await")?e.resolve(p.__await).then((function(t){i("next",t,o,s)}),(function(t){i("throw",t,o,s)})):e.resolve(p).then((function(t){c.value=t,o(c)}),(function(t){return i("throw",t,o,s)}))}s(l.arg)}var n;a(this,"_invoke",{value:function(t,r){function a(){return new e((function(e,a){i(t,r,e,a)}))}return n=n?n.then(a,a):a()}})}function x(e,i,r){var a=f;return function(n,o){if(a===b)throw new Error("Generator is already running");if(a===g){if("throw"===n)throw o;return{value:t,done:!0}}for(r.method=n,r.arg=o;;){var s=r.delegate;if(s){var l=D(s,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===f)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=b;var c=h(e,i,r);if("normal"===c.type){if(a=r.done?g:m,c.arg===v)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=g,r.method="throw",r.arg=c.arg)}}}function D(e,i){var r=i.method,a=e.iterator[r];if(a===t)return i.delegate=null,"throw"===r&&e.iterator.return&&(i.method="return",i.arg=t,D(e,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var n=h(a,e.iterator,i.arg);if("throw"===n.type)return i.method="throw",i.arg=n.arg,i.delegate=null,v;var o=n.arg;return o?o.done?(i[e.resultName]=o.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,v):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function A(e){if(e||""===e){var i=e[o];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,n=function i(){for(;++a<e.length;)if(r.call(e,a))return i.value=e[a],i.done=!1,i;return i.value=t,i.done=!0,i};return n.next=n}}throw new TypeError(u(e)+" is not iterable")}return _.prototype=w,a(j,"constructor",{value:w,configurable:!0}),a(w,"constructor",{value:_,configurable:!0}),_.displayName=c(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,l,"GeneratorFunction")),t.prototype=Object.create(j),t},e.awrap=function(t){return{__await:t}},S(C.prototype),c(C.prototype,s,(function(){return this})),e.AsyncIterator=C,e.async=function(t,i,r,a,n){void 0===n&&(n=Promise);var o=new C(d(t,i,r,a),n);return e.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},S(j),c(j,l,"Generator"),c(j,o,(function(){return this})),c(j,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),i=[];for(var r in e)i.push(r);return i.reverse(),function t(){for(;i.length;){var r=i.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=A,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function a(r,a){return s.type="throw",s.arg=e,i.next=r,a&&(i.method="next",i.arg=t),!!a}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var a=r.arg;I(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,i,r){return this.delegate={iterator:A(e),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}function d(t,e,i,r,a,n,o){try{var s=t[n](o),l=s.value}catch(c){return void i(c)}s.done?e(l):Promise.resolve(l).then(r,a)}function h(t){return function(){var e=this,i=arguments;return new Promise((function(r,a){var n=t.apply(e,i);function o(t){d(n,r,a,o,s,"next",t)}function s(t){d(n,r,a,o,s,"throw",t)}o(void 0)}))}}function f(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function m(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?f(Object(i),!0).forEach((function(e){b(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):f(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function b(t,e,i){return e=g(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function g(t){var e=v(t,"string");return"symbol"===u(e)?e:String(e)}function v(t,e){if("object"!==u(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var y={name:"SearchCondition",props:{keyword:{type:String,default:""}},data:function(){return{params:{keyWord:window.sessionStorage.getItem("metaKeyWord")||"",region:"",dbName:"",subject:""},hisSearchList:[],hisBrowseList:[],regionList:this.$t("data.regionList"),themeList:[],dbList:[]}},computed:m({},Object(c["c"])(["userInfo","isCloud"])),watch:{keyword:function(t){this.params.keyWord=t},"params.dbName":{handler:function(t){sessionStorage.setItem("metadada_db",t)}}},created:function(){this.init(),this.params.dbName=sessionStorage.getItem("metadada_db")||""},methods:{init:function(){var t=h(p().mark((function t(){var e=this;return p().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(Object(s["o"])({dictType:"subject_domain"}).then((function(t){var i=t.data;e.themeList=i})),!this.isCloud){t.next=4;break}return t.next=4,this.getRegion();case 4:this.getDbList();case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getRegion:function(){var t=this;return Object(l["r"])().then((function(e){var i,r=e.data,a=r.list.map((function(t){return{label:t.description||t.regionAlias,value:t.regionAlias}}));t.regionList=a,t.params.region=(null==(i=t.regionList[0])?void 0:i.value)||"",t.search()}))},getDbList:function(){var t=this;Object(s["l"])({region:this.params.region}).then((function(e){var i=e.data;Array.isArray(i)&&i.length?t.dbList=i:t.dbList=[]}))},search:function(){this.params.subject="",this.params.pageNum=1,window.sessionStorage.setItem("metaKeyWord",this.params.keyWord),this.$emit("updateList",this.params,"keyWord")},handleChangeDb:function(){this.$emit("updateList",this.params)},searchParam:function(t,e){this.params[t]=e,"region"===t&&(e||(this.params.dbName=""),this.getDbList()),this.$emit("updateList",this.params)}}},_=y,w=(i("0366"),i("2877")),L=Object(w["a"])(_,n,o,!1,null,"1fabb8e4",null),O=L.exports,k=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-card",[i("div",{staticClass:"title hive-title"},[i("div",{staticClass:"el-icon-caret-bottom"},[t._v("\n      Hive库\n      "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看库信息",placement:"top"}},[i("i",{staticClass:"el-icon-warning-outline",staticStyle:{cursor:"pointer"}})])],1),t._v(" "),t.isRoot?i("div",[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.createDb}},[t._v("创建库")])],1):t._e()]),t._v(" "),i("div",{staticClass:"config_table"},[i("div",{staticClass:"table_title"},[i("el-input",{staticClass:"table_search",attrs:{placeholder:"请输入库名",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchDb(e)}},model:{value:t.dbKeyword,callback:function(e){t.dbKeyword=e},expression:"dbKeyword"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:t.searchDb},slot:"suffix"})])],1),t._v(" "),i("div",{staticClass:"table_content"},[t.showDbList.length<=0?i("el-empty",{attrs:{description:"暂无数据"}}):i("div",{ref:"tableTree",staticClass:"table-tree"},t._l(t.showDbList,(function(e,r){return i("div",{key:r,staticClass:"table-item"},[i("div",{staticClass:"table-title",class:{"active-item":t.activeIndex===r},on:{click:function(i){return i.stopPropagation(),t.clickDb(e.dbName,r)}}},[i("svg-icon",{staticClass:"icon",attrs:{"icon-class":"dataSource"}}),t._v(" "),i("div",[i("span",[t._v(t._s(e.dbName))]),t._v(" "),i("span",{directives:[{name:"show",rawName:"v-show",value:t.keyword,expression:"keyword"}],staticClass:"tableNumBox"},[t._v(" 搜索到"+t._s(e.dbCount)+"张表")])])],1)])})),0)],1)]),t._v(" "),i("el-divider"),t._v(" "),i("div",{staticClass:"title el-icon-view"},[t._v("历史浏览")]),t._v(" "),!t.hisBrowseList.length&!t.hisBrowseLoading?i("el-empty",{attrs:{"image-size":100}}):i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.hisBrowseLoading,expression:"hisBrowseLoading"}],staticClass:"history-list"},t._l(t.hisBrowseList,(function(e,r){return i("el-tooltip",{key:e.tableInfoId,attrs:{"popper-class":"tag-popper",content:e.tableInfoName,placement:"bottom-start",disabled:t.isTipDisabled}},[i("span",{directives:[{name:"loading",rawName:"v-loading",value:e.descLoading,expression:"item.descLoading"}],class:["sl-value-item bg",{active:t.keyword===e.tableInfoName}],attrs:{"element-loading-spinner":"el-icon-loading"},on:{mouseenter:t.isShowTooltip,click:function(i){return t.handleSearchDetail(e,r)}}},[t._v(t._s(e.tableInfoName))])])})),1),t._v(" "),i("el-divider"),t._v(" "),i("div",{staticClass:"title el-icon-search"},[t._v("历史搜索")]),t._v(" "),t.hisSearchList.length||t.hisSearchLoading?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.hisSearchLoading,expression:"hisSearchLoading"}],staticClass:"history-list"},t._l(t.hisSearchList,(function(e,r){return i("el-tooltip",{key:e.id,attrs:{"popper-class":"tag-popper",content:e.input,placement:"bottom-start",disabled:t.isTipDisabled}},[i("span",{directives:[{name:"loading",rawName:"v-loading",value:e.delLoading,expression:"item.delLoading"}],class:["sl-value-item bg",{active:t.keyword===e.input}],attrs:{"element-loading-spinner":"el-icon-loading"},on:{mouseenter:t.isShowTooltip,click:function(i){return t.searchParam("keyWord",e.input)}}},[t._v(t._s(e.input)+" "),i("i",{staticClass:"del el-icon-error",on:{click:function(i){return i.stopPropagation(),t.delHistorySearch(e,r)}}})])])})),1):i("el-empty",{attrs:{"image-size":100}}),t._v(" "),i("el-divider"),t._v(" "),i("div",{staticClass:"title el-icon-star-off"},[t._v("我的收藏")]),t._v(" "),!t.collectList.length&!t.collectLoading?i("el-empty",{attrs:{"image-size":100}}):i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.collectLoading,expression:"collectLoading"}],class:["history-list",{show:!t.isShowAllCollect}]},[t._l(t.collectList,(function(e,r){return i("el-tooltip",{key:e.tableName,attrs:{"popper-class":"tag-popper",content:e.tableName,placement:"bottom-start",disabled:t.isTipDisabled}},[i("span",{directives:[{name:"loading",rawName:"v-loading",value:e.collectLoading,expression:"item.collectLoading"}],class:["sl-value-item bg",{active:t.keyword===e.tableName,hidden:r>5&&!t.isShowAllCollect}],attrs:{"element-loading-spinner":"el-icon-loading"},on:{mouseenter:t.isShowTooltip,click:function(i){return t.searchParam("keyWord",e.tableName)}}},[t._v(t._s(e.tableName)+" "),i("i",{staticClass:"del el-icon-error",on:{click:function(i){return i.stopPropagation(),t.handleCollect(e,r)}}})])])})),t._v(" "),t.collectList.length>5?i("span",{staticClass:"show-more",on:{click:t.handleShowMoreCollect}},[t._v(t._s(t.showMoreText))]):t._e()],2),t._v(" "),i("create-db",{ref:"createDb",on:{addDbOk:t.addDbOk}})],1)},j=[],S=i("9b8c");function C(t){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function x(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function D(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?x(Object(i),!0).forEach((function(e){P(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function P(t,e,i){return e=I(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function I(t){var e=N(t,"string");return"symbol"===C(e)?e:String(e)}function N(t,e){if("object"!==C(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var A={name:"LeftBar",components:{CreateDb:S["a"]},props:{keyword:{type:String,default:""},region:{type:String,default:""},showNumTip:{type:Boolean,default:!1},list:{type:Array,default:function(){return[]}},leftDbList:{type:Array,default:function(){return[]}}},data:function(){return{hisSearchLoading:!1,hisBrowseLoading:!1,collectLoading:!1,isTipDisabled:!1,isShowAllCollect:!1,showMoreText:"更多",hisSearchList:[],hisBrowseList:[],collectList:[],params:{dbName:"",subject:""},activeIndex:"",dbKeyword:"",reqDbList:[],showDbList:[],dbDetail:{}}},computed:D(D({},Object(c["c"])(["userInfo","currentUserGroup"])),{},{isRoot:function(){return["dpm"].includes(this.currentUserGroup.name)}}),watch:{list:function(){this.getCollectList(!1)},keyword:function(){this.getHistorySearch(),this.getHistoryTable()},region:function(t){t&&this.getDbList()},leftDbList:{handler:function(t){var e=this;t.length?this.reqDbList.forEach((function(i){var r,a=(null==(r=t.find((function(t){return t.dbName===i.dbName})))?void 0:r.dbCount)||0;e.$set(i,"dbCount",a)})):this.reqDbList.forEach((function(t){e.$set(t,"dbCount",0)}))},deep:!0}},created:function(){this.getHistorySearch(),this.getHistoryTable(),this.searchDb()},methods:{createDb:function(){this.$refs.createDb.showWin(this.region)},editDb:function(){this.$refs.createDb.showWin(this.region,this.dbDetail)},deleteDb:function(){var t=this,e={databaseName:this.params.dbName};Object(s["n"])(e).then((function(e){t.clickDb("",t.activeIndex),t.searchDb()}))},searchDb:function(){var t=this;this.showDbList=this.reqDbList.filter((function(e){return-1!==e.dbName.indexOf(t.dbKeyword.trim())}))},closeClickDb:function(){this.activeIndex="",this.params.dbName=""},clickDb:function(t,e){this.activeIndex===e?(this.activeIndex="",this.params.dbName=""):(this.activeIndex=e,this.params.dbName=t,this.getDbDetail(t)),this.$emit("updateList",this.params)},getDbDetail:function(t){var e=this;Object(s["u"])({region:this.region,dbName:t}).then((function(t){e.dbDetail=t.data,e.$emit("getDbDetail",e.dbDetail)}))},addDbOk:function(t){t&&this.getDbDetail(this.params.dbName)},getDbList:function(){var t=this;this.reqDbList=[],Object(s["v"])({region:this.region}).then((function(e){var i=e.data;t.reqDbList=i?i.map((function(t){return{dbName:t}})):[],t.searchDb()}))},delHistorySearch:function(t,e){var i=this;this.hisSearchList[e].delLoading=!0,Object(s["m"])({name:t.input}).then((function(t){i.hisSearchList[e].delLoading=!1,i.$message({type:"success",message:"删除搜索记录成功"}),i.getHistorySearch()}))},getHistorySearch:function(){var t=this;this.hisSearchLoading=!0,this.hisSearchList=[],Object(s["w"])({size:5}).then((function(e){t.hisSearchLoading=!1;var i=e.data;Array.isArray(i)&&!i.length||(t.hisSearchList=i.length&&i.map((function(t){var e=D(D({},t),{},{delLoading:!1});return e})))}))},getHistoryTable:function(){var t=this;this.hisBrowseLoading=!0,Object(s["x"])({size:5}).then((function(e){t.hisBrowseLoading=!1;var i=e.data;Array.isArray(i)&&!i.length||(t.hisBrowseList=i.length&&i.map((function(t){var e=D(D({},t),{},{descLoading:!1});return e}))||[])}))},getCollectList:function(t){var e=this;this.collectLoading=!0,this.collectList=[],t?Object(s["j"])({size:-1}).then((function(t){e.collectLoading=!1;var i=t.data;Array.isArray(i)&&!i.length||(e.collectList=i.length&&i.map((function(t){var e=D(D({},t),{},{collectLoading:!1});return e}))||[])})):Object(s["j"])({size:6}).then((function(t){e.collectLoading=!1;var i=t.data;Array.isArray(i)&&!i.length||(e.collectList=i.length&&i.map((function(t){var e=D(D({},t),{},{collectLoading:!1});return e}))||[])}))},handleShowMoreCollect:function(){this.isShowAllCollect=!this.isShowAllCollect,this.isShowAllCollect?(this.showMoreText="收起",this.getCollectList(!0)):this.showMoreText="更多"},handleSearchDetail:function(t,e){var i=this;this.hisBrowseList[e].descLoading||(this.hisBrowseList[e].descLoading=!0,Object(s["B"])({id:t.tableInfoId}).then((function(t){i.hisBrowseList[e].descLoading=!1;var r=t.data;Object.keys(r).length?i.$router.push({name:"MetaDataDetail",query:{id:r.id,region:r.region,databaseName:r.db_name,tableName:r.table_name}}):i.$message({type:"warning",message:"获取详情失败"})})))},isShowTooltip:function(t){var e=t.target.clientWidth,i=t.target.scrollWidth;this.isTipDisabled=!(i>e)},handleCollect:function(t,e){var i=this;this.collectList[e].collectLoading=!0,Object(s["i"])({id:t.tableId,isCollect:!1}).then((function(t){i.collectList[e].collectLoading=!1,i.$message({type:"success",message:"取消收藏成功"}),i.$emit("updateList",i.params)}))},searchParam:function(t,e){this.params[t]=e,this.$emit("updateList",this.params)}}},T=A,$=(i("3d11"),Object(w["a"])(T,k,j,!1,null,"036fe539",null)),E=$.exports,G=i("852f"),F=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"ope-dialog",attrs:{title:"权限授权",visible:t.visiable,width:"45%","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisiable=e}}},[i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("表基础信息")])]),t._v(" "),Object.keys(t.authoData).length?i("el-descriptions",{attrs:{column:3}},[i("el-descriptions-item",{attrs:{label:"数据源位置"}},[t._v(t._s(t.regionFormat(t.authoData.region)||"-"))]),t._v(" "),i("el-descriptions-item",{attrs:{label:"对象类型"}},[t._v(t._s(t.authoData.db_name))]),t._v(" "),i("el-descriptions-item",{attrs:{label:"对象名称",span:2}},[t._v(t._s(t.authoData.table_name))])],1):t._e()],1),t._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("授权信息")])]),t._v(" "),i("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),i("el-checkbox-group",{staticClass:"checkbox-group",on:{change:t.handleCheckedCitiesChange},model:{value:t.checkedOpes,callback:function(e){t.checkedOpes=e},expression:"checkedOpes"}},t._l(t.permissions,(function(e){return i("el-checkbox",{key:e,attrs:{label:e}},[t._v(t._s(e))])})),1)],1),t._v(" "),i("el-card",{staticClass:"box-card"},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("添加对象")])]),t._v(" "),Object.keys(t.authoData).length?i("el-descriptions",[i("el-descriptions-item",{attrs:{label:"生效范围",span:3}},[i("el-select",{attrs:{placeholder:"选择生效范围"},on:{change:t.handleScope},model:{value:t.effectScope,callback:function(e){t.effectScope=e},expression:"effectScope"}},t._l(t.scopeList,(function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.value}})})),1),t._v(" "),2===t.effectScope?i("el-select",{staticClass:"select_group",attrs:{placeholder:"请选择用户组",multiple:"",clearable:""},model:{value:t.scopes,callback:function(e){t.scopes=e},expression:"scopes"}},t._l(t.groupOptions,(function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.uuid}})})),1):t._e(),t._v(" "),2===t.effectScope?i("el-tooltip",{staticClass:"item",staticStyle:{"margin-left":"5px"},attrs:{effect:"dark",content:"您可以在用户管理模块中创建新的用户组",placement:"top"}},[i("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"}})]):t._e()],1),t._v(" "),i("el-descriptions-item",{attrs:{label:"权限保留周期",span:3}},[i("el-radio-group",{model:{value:t.cycle,callback:function(e){t.cycle=e},expression:"cycle"}},t._l(t.cycleList,(function(e,r){return i("el-radio",{key:r,attrs:{label:e.value}},[t._v(t._s(e.name))])})),1)],1)],1):t._e()],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",loading:t.submitLoading,disabled:t.submitLoading},on:{click:t.ok}},[t._v("确 定")])],1)],1)},B=[],z=i("7e3c");function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function U(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function W(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?U(Object(i),!0).forEach((function(e){M(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):U(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function M(t,e,i){return e=q(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function q(t){var e=H(t,"string");return"symbol"===V(e)?e:String(e)}function H(t,e){if("object"!==V(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==V(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var R=["查询","编辑","删除","描述","插入"],K={name:"DataPermission",props:{visiable:{type:Boolean,required:!0},listIndex:{type:Number,default:0},authoData:{type:Object,default:function(){}}},data:function(){return{groupOptions:[],searchValue:"",reason:"",dialogVisiable:this.visiable,regionList:this.$t("data.regionList"),cycleList:this.$t("data.cycle"),submitLoading:!1,checkAll:!1,checkedOpes:["查询"],permissions:R,isIndeterminate:!0,scopes:[],flag:1,effectScope:2,cycle:"2",userGroupList:[],scopeList:[{name:"用户组",value:2}]}},computed:W({},Object(c["c"])(["userInfo","isCloud"])),watch:{visiable:function(){this.dialogVisiable=this.visiable,this.dialogVisiable?(this.scopes=[],this.checkedOpes=["查询"]):this.$emit("close",this.listIndex)},dialogVisiable:function(t){this.$emit("update:visiable",t)}},created:function(){this.getGroupPage(),this.isCloud&&this.getRegion()},methods:{getGroupPage:function(){var t=this,e={userId:JSON.parse(sessionStorage.getItem("userInfo")).userId,name:"",pageNum:1,pageSize:1e4};Object(z["l"])(e).then((function(e){t.groupOptions=e.data.list||[]}))},getRegion:function(){var t=this;Object(l["r"])().then((function(e){var i=e.data;t.regionList=i.list.map((function(t){return{label:t.description||t.regionAlias,value:t.regionAlias}}))}))},handleCheckAllChange:function(t){this.checkedOpes=t?R:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.permissions.length,this.isIndeterminate=e>0&&e<this.permissions.length},handleScope:function(t){this.scopes=[],2===t&&(this.flag=1)},regionFormat:function(t){var e=this.regionList.find((function(e){return e.value===t}));return e?e.label:"-"},cancel:function(){this.$emit("update:visiable",!1)},ok:function(){var t=this;if(this.checkedOpes.length)if(this.scopes.length){var e={owner:this.authoData.owner,type:1,flag:this.flag,cycle:this.cycle,roleInputs:{objectName:["".concat(this.authoData.region,".").concat(this.authoData.db_name,".").concat(this.authoData.table_name)],scope:this.scopes,operation:this.checkedOpes}};this.submitLoading=!0,Object(s["e"])(e).then((function(e){t.submitLoading=!1,t.$message({type:"success",message:"权限授权成功"}),t.$emit("update:visiable",!1)})),this.$emit("trigger",this.resultList)}else this.$message({type:"warning",message:"请选择生效范围"});else this.$message({type:"warning",message:"请选择权限"})}}},Y=K,Z=(i("f90b"),Object(w["a"])(Y,F,B,!1,null,"58d18eef",null)),J=Z.exports,Q=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{staticClass:"ope-dialog",attrs:{title:"批量申请权限",visible:t.visiable,width:"55%","close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisiable=e}}},[i("div",{staticClass:"usergroup_info"},[i("div",{staticClass:"usergroup_item"},[i("span",{staticClass:"label"},[t._v("申请用户组: ")]),t._v(" "),i("span",[t._v(t._s(t.userGroup.name||"-"))])]),t._v(" "),i("div",{staticClass:"usergroup_item"},[i("span",{staticClass:"label"},[t._v("申请用户组负责人: ")]),t._v(" "),i("span",[t._v(t._s(t.viewHeader()))])])]),t._v(" "),i("el-form",{attrs:{model:t.params,"label-position":"left","label-width":"120px"}},[i("el-form-item",{attrs:{prop:"roleInputs.objectName",label:"表名"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入表名, 最多支持20个",clearable:"",filterable:"",multiple:"",remote:"","remote-method":t.remoteMethod,loading:t.tableLoading,"popper-class":"custom-popper"},on:{change:t.changeTable},model:{value:t.params.roleInputs.objectName,callback:function(e){t.$set(t.params.roleInputs,"objectName",e)},expression:"params.roleInputs.objectName"}},t._l(t.tableList,(function(e){return i("el-option",{key:e.table_name,attrs:{value:e.region+"."+e.db_name+"."+e.table_name+":"+e.owner+":"+e.id,label:""+e.title}},[i("div",{staticStyle:{"max-width":"420px","word-break":"break-all"}},[t._v(t._s(e.title))])])})),1)],1),t._v(" "),i("el-form-item",{attrs:{prop:"roleInputs.operation",label:"权限选择"}},[i("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),i("el-checkbox-group",{staticClass:"checkbox-group",on:{change:t.handleCheckedCitiesChange},model:{value:t.params.roleInputs.operation,callback:function(e){t.$set(t.params.roleInputs,"operation",e)},expression:"params.roleInputs.operation"}},t._l(t.permissions,(function(e){return i("el-checkbox",{key:e,attrs:{label:e}},[t._v(t._s(e))])})),1)],1),t._v(" "),i("el-form-item",{attrs:{prop:"reason",label:"原因"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{rows:3,type:"textarea",placeholder:"请输入您申请表的理由，最多输入50个字",maxlength:"50","show-word-limit":""},model:{value:t.params.reason,callback:function(e){t.$set(t.params,"reason",e)},expression:"params.reason"}})],1)],1),t._v(" "),i("div",{staticClass:"level_info"},[i("div",{staticClass:"title"},[t._v("申请数据表信息:")]),t._v(" "),i("div",{staticClass:"content"},[i("TableInfo",{attrs:{"table-id-list":t.tableIdList}})],1)]),t._v(" "),i("div",{staticClass:"level_info"},[i("div",{staticClass:"title"},[t._v("敏感级别说明:")]),t._v(" "),i("div",{staticClass:"content"},[i("ProveTable")],1)]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancel}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",loading:t.submitLoading,disabled:t.submitLoading},on:{click:t.ok}},[t._v("确 定")])],1)],1)},X=[],tt=i("ec40"),et=i("d620"),it=i("b199");function rt(t){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rt(t)}function at(t){return lt(t)||st(t)||ot(t)||nt()}function nt(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ot(t,e){if(t){if("string"===typeof t)return ct(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?ct(t,e):void 0}}function st(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function lt(t){if(Array.isArray(t))return ct(t)}function ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function ut(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function pt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(i),!0).forEach((function(e){dt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ut(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function dt(t,e,i){return e=ht(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ht(t){var e=ft(t,"string");return"symbol"===rt(e)?e:String(e)}function ft(t,e){if("object"!==rt(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var mt=["查询"],bt={name:"DataPermission",components:{ProveTable:tt["a"],TableInfo:et["a"]},props:{visiable:{type:Boolean,required:!0}},data:function(){return{searchValue:"",ownerLoading:!1,submitLoading:!1,tableLoading:!1,dialogVisiable:this.visiable,checkAll:!1,permissions:mt,isIndeterminate:!0,tableList:[],cycleList:this.$t("data.cycle"),ownerList:[],scope:"",params:{cycle:"5",coApplicants:[],reason:"",userName:"",roleInputs:{objectName:[],operation:["查询"]}},userGroup:{},tableIdList:[],handelTableList:[]}},computed:pt({},Object(c["c"])(["userInfo","currentUserGroup"])),watch:{visiable:function(){this.dialogVisiable=this.visiable,this.dialogVisiable?(this.params.roleInputs.objectName=[],this.params.roleInputs.operation=["查询"],this.params.reason="",this.params.cycle="5",this.params.coApplicants=[]):(this.tableIdList=[],this.handelTableList=[],this.$emit("close"))},dialogVisiable:function(t){this.$emit("update:visiable",t)}},created:function(){this.params.userName=this.userInfo.userId,this.scope=this.currentUserGroup.uuid||"",Object.assign(this.userGroup,this.currentUserGroup)},methods:{viewHeader:function(){var t;return(null==(t=this.userGroup.ownerList)?void 0:t.join(","))||"-"},changeTable:function(t){var e=this,i=[];t.forEach((function(t){var r=t.split(":")[0],a=e.handelTableList.find((function(t){return"".concat(t.region,".").concat(t.db_name,".").concat(t.table_name)===r}));a&&i.push(a)})),this.$set(this,"tableIdList",i)},handleCheckAllChange:function(t){this.params.roleInputs.operation=t?mt:[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.permissions.length,this.isIndeterminate=e>0&&e<this.permissions.length},remoteMethod:function(t,e){var i=this;""!==t&&(this.tableLoading=!0,Object(s["y"])({userId:this.userInfo.userId,keyWord:t,pageNum:1,pageSize:10}).then((function(t){var e;i.tableLoading=!1;var r=t.data;i.tableList=r.results||[],(e=i.handelTableList).push.apply(e,at(i.tableList))})))},remoteMethodPerson:function(t,e){var i=this;""!==t?(this.ownerLoading=!0,Object(it["Y"])(t).then((function(t){i.ownerLoading=!1;var e=t.data;i.ownerList=e}))):this.ownerList=[]},cancel:function(){this.$emit("update:visiable",!1)},ok:function(){var t=this;if(this.params.roleInputs.objectName.length)if(this.params.roleInputs.operation.length)if(this.params.reason)if(this.params.cycle){this.submitLoading=!0;var e=this.params.roleInputs.operation.includes("查询")?[].concat(at(this.params.roleInputs.operation),["描述"]):at(this.params.roleInputs.operation),i=Object.assign({},this.params,{coApplicants:this.params.coApplicants.join(","),roleInputs:pt(pt({},this.params.roleInputs),{},{operation:e,scope:[this.scope]})});Object(s["z"])(i).then((function(e){t.$message({type:"success",message:"批量申请权限成功"}),t.$emit("update:visiable",!1)})).finally((function(){t.submitLoading=!1}))}else this.$message({type:"warning",message:"请选择周期"});else this.$message({type:"warning",message:"请输入原因"});else this.$message({type:"warning",message:"请选择权限"});else this.$message({type:"warning",message:"请输入表名"})}}},gt=bt,vt=(i("1acbe"),Object(w["a"])(gt,Q,X,!1,null,"778333d2",null)),yt=vt.exports;function _t(t){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_t(t)}function wt(t,e){return St(t)||jt(t,e)||Ot(t,e)||Lt()}function Lt(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Ot(t,e){if(t){if("string"===typeof t)return kt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?kt(t,e):void 0}}function kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function jt(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,a,n,o,s=[],l=!0,c=!1;try{if(n=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=n.call(i)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){c=!0,a=t}finally{try{if(!l&&null!=i.return&&(o=i.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}function St(t){if(Array.isArray(t))return t}function Ct(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function xt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(i),!0).forEach((function(e){Dt(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ct(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Dt(t,e,i){return e=Pt(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Pt(t){var e=It(t,"string");return"symbol"===_t(e)?e:String(e)}function It(t,e){if("object"!==_t(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==_t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var Nt={components:{SearchCondition:O,LeftBar:E,DataPermission:G["a"],Authorization:J,BatchApply:yt},data:function(){return{dataPermissionVisible:!1,authorizationVisible:!1,batchApplyVisible:!1,collectLoading:!1,batchLoading:!1,batchText:"批量申请权限",listIndex:0,perData:{},authoData:{},params:{keyWord:this.$route.query.tableName||window.sessionStorage.getItem("metaKeyWord")||"",region:"",subject:"",pageNum:1,pageSize:10},hisSearchList:[],hisBrowseList:[],themeList:[],loading:!1,data:[],leftDbList:[],total:0,isTipDisabled:!1,closePerTimer:null,closeAuthTimer:null,closeBatchTimer:null,dbDetail:{},types:["info","success","","danger","warning"]}},computed:xt(xt({},Object(c["c"])(["userInfo","currentUserGroup"])),{},{isRoot:function(){return["dpm"].includes(this.currentUserGroup.name)}}),created:function(){},methods:{formatTags:function(t){var e=this;return t?t.split(",").map((function(t,i){var r=t.split("="),a=wt(r,2),n=a[0],o=a[1];return{key:n,value:o,type:e.types[i%e.types.length]}})).filter((function(t){return t.key})):t},editDb:function(){this.$refs.leftBar.editDb()},deleteDb:function(){this.$refs.leftBar.deleteDb()},getDbDetail:function(t){this.dbDetail=t},updateList:function(t,e){var i;(this.params=Object.assign({},this.params,t),"keyWord"===e)&&(null==(i=this.$refs.leftBar)||i.closeClickDb());this.getList()},getList:function(){var t=this;this.loading=!0;var e=Object.assign({},this.params);window.sessionStorage.setItem("metaKeyWord",this.params.keyWord),Object.keys(e).forEach((function(t){e[t]||delete e[t]})),Object(s["y"])(xt({},e)).then((function(e){var i,r=e.data||{};r&&(t.data=(null==(i=r.results)?void 0:i.map((function(t){var e=xt(xt({},t),{},{recents:t.recents&&t.recents.length?t.recents.split(","):[],collectLoading:!1,updateLoading:!1,authLoading:!1,applyLoading:!1,authText:"权限授予",applyText:"申请权限"});return e})))||[],t.total=r.total||0,t.leftDbList=r.dbCount||[],t.loading=!1)}))},handleSizeChange:function(t){this.params.pageSize=t,this.params.pageNum=1,this.getList()},handleCurrentChange:function(t){this.params.pageNum=t,this.getList()},handleCollect:function(t,e){var i=this;this.data[e].collectLoading=!0,Object(s["i"])({id:t.id,isCollect:!t.flag}).then((function(r){i.data[e].collectLoading=!1,0===r.code&&(i.$message({type:"success",message:t.flag?"取消收藏成功":"收藏成功"}),i.data[e].updateLoading=!0,Object(s["B"])({id:t.id}).then((function(t){if(i.data[e].updateLoading=!1,0===t.code){var r=t.data,a=xt(xt({},r),{},{recents:r.recents&&r.recents.length?r.recents.split(","):[],collectLoading:!1,updateLoading:!1,authLoading:!1,applyLoading:!1,authText:"权限授予",applyText:"申请权限"});i.data.splice(e,1,a)}})))}))},gotoDetail:function(t){this.$router.push({name:"MetaDataDetail",query:{id:t.id,region:t.region,databaseName:t.db_name,tableName:t.table_name}})},create:function(){this.$router.push({name:"MetaDataStep",query:{region:this.params.region||"",dbName:this.params.dbName||""}})},apply:function(t,e){this.listIndex=e,this.data[e].applyLoading=!0,this.data[e].applyText="申请中",this.dataPermissionVisible=!0,this.perData=t},authorization:function(t,e){this.listIndex=e,this.data[e].authLoading=!0,this.data[e].authText="申请中",this.authorizationVisible=!0,this.authoData=t},batchApply:function(){this.batchLoading=!0,this.batchText="申请中",this.batchApplyVisible=!0},handleClosePer:function(t){var e=this;clearTimeout(this.closePerTimer),this.closePerTimer=setTimeout((function(){e.data[t].applyLoading=!1,e.data[t].applyText="申请权限"}),1e3)},handleCloseAuth:function(t){var e=this;clearTimeout(this.closeAuthTimer),this.closeAuthTimer=setTimeout((function(){e.data[t].authLoading=!1,e.data[t].authText="权限授予"}),1e3)},handleCloseBatch:function(){var t=this;clearTimeout(this.closeBatchTimer),this.closeBatchTimer=setTimeout((function(){t.batchLoading=!1,t.batchText="批量申请权限"}),100)}}},At=Nt,Tt=(i("089d"),Object(w["a"])(At,r,a,!1,null,"09424ad0",null));e["default"]=Tt.exports},3990:function(t,e,i){},"3d11":function(t,e,i){"use strict";i("be08")},"5abc":function(t,e,i){},8297:function(t,e,i){},8619:function(t,e,i){},"9b8c":function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{title:(t.isEdit?"编辑":"创建")+"库",visible:t.dialogVisible,width:"620px"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.resetForm}},[i("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"80px","label-position":"left"}},[i("el-form-item",{attrs:{label:"库名",prop:"databaseName"}},[i("el-input",{attrs:{disabled:t.isEdit,placeholder:"名字只能包含a-z,A-Z,0-9或-或_；开始结尾需为字符,最多30个字符",maxlength:"30"},model:{value:t.ruleForm.databaseName,callback:function(e){t.$set(t.ruleForm,"databaseName",e)},expression:"ruleForm.databaseName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"location",prop:"locationUri"}},[i("el-input",{attrs:{placeholder:"请输入库路径"},model:{value:t.ruleForm.locationUri,callback:function(e){t.$set(t.ruleForm,"locationUri",e)},expression:"ruleForm.locationUri"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入描述",rows:"4"},model:{value:t.ruleForm.description,callback:function(e){t.$set(t.ruleForm,"description",e)},expression:"ruleForm.description"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"归属",prop:"uuid"}},[i("div",{staticClass:"form_item"},[i("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"选择生效范围"},on:{change:t.handleScope},model:{value:t.effectScope,callback:function(e){t.effectScope=e},expression:"effectScope"}},t._l(t.scopeList,(function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.value}})})),1),t._v(" "),1===t.effectScope?i("el-select",{staticStyle:{width:"65%","margin-left":"20px"},attrs:{placeholder:"请输入用户ID, 最多20个",clearable:"",filterable:"",multiple:"",remote:"","remote-method":t.remoteMethod,loading:t.ownerLoading,"popper-class":"custom-popper"},model:{value:t.scopes,callback:function(e){t.scopes=e},expression:"scopes"}},t._l(t.ownerList,(function(e){return i("el-option",{key:e.shareId,attrs:{value:e.shareId,label:e.name}},[i("div",{staticStyle:{"max-width":"420px","word-break":"break-all"}},[t._v("("+t._s(e.name)+")-"+t._s(e.deptFullPath))])])})),1):t._e(),t._v(" "),2===t.effectScope?i("el-select",{staticStyle:{width:"74%","margin-left":"20px"},attrs:{"value-key":"id",placeholder:"请选择用户组",clearable:""},model:{value:t.currentGroup,callback:function(e){t.currentGroup=e},expression:"currentGroup"}},t._l(t.groupOptions,(function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t}})})),1):t._e()],1)])],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary",loading:t.btnDisabled,disabled:t.btnDisabled},on:{click:t.save}},[t._v("确 定")])],1)],1)},a=[],n=i("7d99"),o=i("2f62"),s=i("b199"),l=i("7e3c");function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function d(t,e,i){return e=h(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t){var e=f(t,"string");return"symbol"===c(e)?e:String(e)}function f(t,e){if("object"!==c(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,e||"default");if("object"!==c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var m=function(t,e,i){var r=/^[a-zA-Z0-9][-_a-zA-Z0-9]*$/;r.test(e)?i():i(new Error("名字只能包含a-z,A-Z,0-9或-或_；开始需为字符，最多30个字符"))},b="/warehouse/{groupname}/db_{dbname}",g={name:"CreateDb",props:{regionList:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,ruleForm:{region:"",databaseName:"",locationUri:"/warehouse/{groupname}/db_{dbname}",description:"",uuid:"",userId:"",userGroupName:""},btnDisabled:!1,checkAll:!1,ownerLoading:!1,permissions:[{label:"创建表",value:"创建表"},{label:"删除库",value:"删除库"},{label:"描述库",value:"描述库"},{label:"修改库",value:"修改库"}],checkedOpes:["创建表","删除库","描述库","修改库"],isIndeterminate:!0,ownerList:[],groupOptions:[],scopeList:[{name:"用户组",value:2}],effectScope:2,scopes:[],currentGroup:null,isEdit:!1}},computed:p(p({},Object(o["c"])(["isCloud","userInfo","currentUserGroup"])),{},{rules:function(){var t={databaseName:[{required:!0,message:"请输入库名",trigger:["blur","change"]},{validator:m,trigger:["blur","change"]}],uuid:[{required:!0,message:"请选择负责人",trigger:["blur","change"]}]};return t}}),watch:{currentGroup:{handler:function(t){if(t){var e,i;this.ruleForm.uuid=t.uuid,this.ruleForm.userGroupName=t.name;var r=(null==(e=t.userGroupRelationList.find((function(t){return 0===t.owner})))?void 0:e.userName)||(null==(i=t.userGroupRelationList[0])?void 0:i.userName)||"";r&&(this.ruleForm.userId=r)}else this.ruleForm.uuid="",this.ruleForm.userId="",this.ruleForm.userGroupName=""}}},created:function(){this.getGroupPage(),this.currentUserGroup.name&&(this.ruleForm.locationUri=this.formatLocation(this.currentUserGroup.name))},methods:{formatLocation:function(t,e){var i=b;return t&&(i=i.replace("{groupname}",this.currentUserGroup.name)),e&&(i=i.replace("{dbname}",e)),i},getGroupPage:function(){var t=this,e={userId:this.userInfo.userId,name:"",pageNum:1,pageSize:1e4};Object(l["l"])(e).then((function(e){t.groupOptions=e.data.list||[]}))},handleCheckAllChange:function(t){this.checkedOpes=t?this.permissions.map((function(t){var e=t.value;return e})):[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.permissions.length,this.isIndeterminate=e>0&&e<this.permissions.length},handleScope:function(t){this.scopes=[],this.currentGroup=null},remoteMethod:function(t,e){var i=this;""!==t?(this.ownerLoading=!0,Object(s["Y"])(t).then((function(t){i.ownerLoading=!1;var e=t.data;i.ownerList=e}))):this.ownerList=[]},showWin:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.ruleForm.region=t,this.dialogVisible=!0,this.btnDisabled=!1,e.databaseName){if(this.ruleForm.databaseName=e.databaseName,this.ruleForm.locationUri=e.locationUri,this.ruleForm.description=e.description,this.ruleForm.userGroupName=e.owner,this.groupOptions.length){var i=this.groupOptions.find((function(t){return t.name===e.owner}));i&&(this.currentGroup=i)}this.isEdit=!0}else this.isEdit=!1},resetForm:function(){this.$refs.ruleForm.resetFields(),this.ruleForm.databaseName="",this.ruleForm.locationUri=this.formatLocation(this.currentUserGroup.name),this.scopes=[],this.currentGroup=null,this.ruleForm.description=""},save:function(){var t=this;this.$refs.ruleForm.validate((function(e){if(e){t.btnDisabled=!0;var i=null;i=t.isEdit?n["r"]:n["b"],i(t.ruleForm).then((function(e){t.dialogVisible=!1,t.$message({type:"success",message:"".concat(t.isEdit?"编辑":"创建","成功")}),t.$emit("addDbOk",t.isEdit)})).finally((function(){t.btnDisabled=!1}))}}))}}},v=g,y=(i("b8b8"),i("2877")),_=Object(y["a"])(v,r,a,!1,null,"0d1677e6",null);e["a"]=_.exports},b8b8:function(t,e,i){"use strict";i("5abc")},b958:function(t,e,i){t.exports=i.p+"static/img/metaIcon.18fbe500.png"},be08:function(t,e,i){},d23f:function(t,e,i){},f90b:function(t,e,i){"use strict";i("d23f")}}]);