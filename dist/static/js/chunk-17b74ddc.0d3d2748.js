(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-17b74ddc"],{"001b":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"box-card-container step"},[n("div",{staticClass:"step-out clearfix"},[n("sql-box",{attrs:{label:"SQL",required:!0,name:"tableSchema"},on:{check:e.check,format:e.format,clear:e.clear}},[n("monaco-editor",{directives:[{name:"loading",rawName:"v-loading",value:e.sqlCheckLoading,expression:"sqlCheckLoading"}],ref:"tableSchema",staticClass:"content",model:{value:e.tableSchema,callback:function(t){e.tableSchema=t},expression:"tableSchema"}})],1),e._v(" "),n("el-form",{ref:"ruleForm",class:["ruleForm","step-form","step-content-form"],attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"TableFormat",prop:"type"}},[n("el-select",{attrs:{placeholder:"请选择TableFormat",clearable:"",disabled:""},model:{value:e.ruleForm.type,callback:function(t){e.$set(e.ruleForm,"type",t)},expression:"ruleForm.type"}},[n("el-option",{attrs:{label:"Hive",value:"hive"}}),e._v(" "),n("el-option",{attrs:{label:"iceberg",value:"iceberg",disabled:""}}),e._v(" "),n("el-option",{attrs:{label:"clickhouse",value:"clickhouse",disabled:""}}),e._v(" "),n("el-option",{attrs:{label:"mysql",value:"mysql",disabled:""}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"选择库",prop:"dbName"}},[n("el-select",{attrs:{placeholder:"请选择库",filterable:"",clearable:""},on:{"visible-change":e.handleFocus},model:{value:e.ruleForm.dbName,callback:function(t){e.$set(e.ruleForm,"dbName",t)},expression:"ruleForm.dbName"}},e._l(e.dbList,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1),e._v(" "),e.isAddDB?n("div",{staticClass:"marks"},[e._v("没找到您想要的数据库？"),n("el-button",{attrs:{loading:e.createLoading,type:"text"},on:{click:e.create}},[e._v("去创建")])],1):e._e()],1),e._v(" "),n("el-form-item",{attrs:{label:"表名(英文)",prop:"name"}},[n("el-input",{attrs:{placeholder:"表名支持有英文小写、下划线、数字，不允许数字作为表名开头",clearable:""},on:{focus:e.handleFocus,blur:e.handleBlur},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"别名"}},[n("el-input",{attrs:{placeholder:"业务描述（事实）-使用中文填写",clearable:""},model:{value:e.ruleForm.cnName,callback:function(t){e.$set(e.ruleForm,"cnName",t)},expression:"ruleForm.cnName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{type:"textarea",placeholder:"不允许使用英文分号 (;)，英文冒号 (:)",clearable:""},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"数据归集业务组:"}},[n("el-select",{attrs:{placeholder:"请输入数据归集业务组",clearable:"",filterable:""},model:{value:e.ruleForm.subject,callback:function(t){e.$set(e.ruleForm,"subject",t)},expression:"ruleForm.subject"}},e._l(e.groupOptions,(function(e){return n("el-option",{key:e.id,attrs:{value:e.uuid,label:e.name}})})),1)],1),e._v(" "),"textfile"===e.ruleForm.sdFileFormat?n("el-form-item",{attrs:{label:"分隔符"}},[n("el-input",{attrs:{placeholder:"请输入分隔符"},model:{value:e.ruleForm.fileDelimiter,callback:function(t){e.$set(e.ruleForm,"fileDelimiter",t)},expression:"ruleForm.fileDelimiter"}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:"标签"}},[n("div",{staticClass:"tagList"},[n("div",{staticClass:"labels_box"},e._l(e.ruleForm.tagList,(function(t,r){return n("div",{key:r,staticClass:"labels_item"},[n("div",{staticClass:"box"},[n("span",{staticClass:"label"},[e._v("key")]),e._v(" "),n("el-input",{attrs:{placeholder:"请输入key",clearable:""},model:{value:t.key,callback:function(n){e.$set(t,"key",n)},expression:"item.key"}}),e._v(" "),n("span",{staticClass:"label last"},[e._v("value")]),e._v(" "),n("el-input",{attrs:{placeholder:"请输入value",clearable:""},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"item.value"}})],1),e._v(" "),n("i",{staticClass:"el-icon-circle-close",on:{click:function(t){return e.setLabels("sub",r)}}})])})),0),e._v(" "),n("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){return e.setLabels("add")}}},[e._v("新建标签")])],1)])],1)],1),e._v(" "),n("div",{staticClass:"step-btns"},[n("el-button",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.btnDisabled,disabled:e.btnDisabled},on:{click:e.nextStep}},[e._v("完成")])],1),e._v(" "),n("create-db",{ref:"createDb",attrs:{"region-list":e.regionList},on:{addDbOk:e.getDbList}})],1)},a=[],i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sql-box"},[n("div",{staticClass:"sql-box-btn"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.checkSql}},[e._v("sql校验")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.formatSql}},[e._v("格式化")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.clearSql}},[e._v("清除")])],1),e._v(" "),n("div",{staticClass:"sql-smaple"},[e._v("\n    在下方填写SQL，包含insert，overwrite等，还有一些别的Tips\n    "),n("el-popover",{staticClass:"sql-tips",attrs:{placement:"bottom",width:"900",trigger:"click"}},[n("div",{staticClass:"monaco-editor-wrap"},[n("monaco-editor",{ref:"monaco",attrs:{"read-only":!0},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1),e._v(" "),n("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])],1),e._v(" "),n("div",{class:["sql-box-content",e.fullscreen?"table-fullscreen":""]},[n("div",{class:["label",e.required?"required":""]},[e._v(e._s(e.label)+"：")]),e._v(" "),n("i",{staticClass:"btn-full-screen el-icon-full-screen",attrs:{title:e.fullscreen?"还原":"放大"},on:{click:e.switchFullscreen}}),e._v(" "),e._t("default")],2)])},o=[],s=n("b03b"),u={name:"SqlBox",components:{MonacoEditor:s["a"]},props:{label:{type:String,default:"SQL"},required:{type:Boolean,default:!1},name:{type:String,default:""}},data:function(){return{fullscreen:!1,content:this.$t("data.sqlExam")}},created:function(){var e=this;document.onkeyup=function(t){"Escape"!==t.code&&27!==t.keycode||(e.fullscreen=!1)}},methods:{switchFullscreen:function(){this.fullscreen=!this.fullscreen},checkSql:function(){this.$emit("check",this.name)},formatSql:function(){this.$emit("format",this.name)},clearSql:function(){this.$emit("clear",this.name)}}},c=u,l=(n("efd0"),n("2877")),d=Object(l["a"])(c,i,o,!1,null,"a0f7b7cc",null),f=d.exports,m=n("9b8c"),b=n("7ea2"),p=n("7d99"),h=n("b199"),g=n("7e3c"),v=n("2f62");function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n){return t=L(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function L(e){var t=S(e,"string");return"symbol"===k(t)?t:String(t)}function S(e,t){if("object"!==k(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var w=function(e,t,n){var r=/^(_?[a-z])([a-z0-9]|_[a-z0-9]_?)*$/;r.test(t)?n():n(new Error("表名支持有英文小写、下划线、数字，不允许数字作为表名开头"))};function O(e,t){return'\n-- CREATE TABLE TEMPLATE\n-- 左侧必填：创建区域、数据源类型、库名、表名、location\n-- SQL窗口定义schema和分区即可，选填：字段 COMMENT 注释，表  COMMENT 注释\n-- location 自定义示例："s3://bucket/../databaseName/tableName"\n-- 由于增加了库名、表名自动匹配功能，因此建议您完成SQL语句的填写，再校验右侧库、表名称是否正确\nCREATE TABLE IF NOT EXISTS '.concat(e||"dbname",".").concat(t||"tablename"," (\n  id string COMMENT 'ID' ,\n  name string COMMENT '名称'\n)\nrow format delimited\nfields terminated by '/t'\nSTORED AS orc\n    ")}var A={components:{SqlBox:f,CreateDb:m["a"],MonacoEditor:s["a"]},data:function(){return{cycleList:this.$t("data.cycle"),cycle:"5",effectScope:2,scopes:[],ownerList:[],groupOptions:[],scopeList:[{name:"用户组",value:2}],ownerLoading:!1,checkedOpes:[],permissions:["查询","编辑","删除","描述","插入"],checkAll:!1,isIndeterminate:!0,createLoading:!1,isManualAction:!1,commentRegexp:/\/\*[\s\S]*?\*\/|\x2D\x2D[\s\S]*?\n/g,codeRegexp:/create\s+(?:temporary\s)?\s*(?:external\s)?\s*table\s+(?:if\s)?\s*(?:not\s)?\s*(?:exists\s)?\s*(`?[a-zA-Z_0-9]+)`?\.?(`?([a-zA-Z_0-9]+)`?)?\s*\(/i,nameRegexp:/(`?[a-zA-Z_0-9]+)`?\.?(`?([a-zA-Z_0-9]+)`?)?\s*\(/,dbNamePattern:"$dbname",tableNamePattern:"$tablename",sqlCheckLoading:!1,fileFormatTip:"\n        parquet的压缩比率较高，分区过滤和列修建可以帮助我们大幅节省磁盘IO，减轻对服务器的压力。如果您的数据字段较多，但实际应用中读取其中部分字段，parquet将是一个非常好的选择。为了提升部门数据效率、降低数据成本，本平台建议您使用parquet文件类型进行建表。\n      ",ruleForm:{region:"ue1",type:"hive",dbName:"dbname",subject:"",updateType:"",interval:"",cnName:"",name:"tablename",description:"",sdFileFormat:"parquet",fileDelimiter:"",lifecycle:30,hierarchical:"",department:"",pu:"",application:"",tagList:[{key:"",value:""}]},rules:{region:[{required:!0,message:"请选择创建区域",trigger:["blur","change"]}],type:[{required:!0,message:"请选择数据源类型",trigger:["blur","change"]}],dbName:[{required:!0,message:"请选择库",trigger:["blur","change"]}],sdFileFormat:[{required:!0,message:"请选择sdFileFormat",trigger:["blur","change"]}],updateType:[{required:!0,message:"请选择表类型",trigger:["blur","change"]}],interval:[{required:!0,message:"请选择更新频次",trigger:["blur","change"]}],name:[{required:!0,message:"请输入英文名"},{validator:w,trigger:["blur","change"]}]},regionList:[{label:"AWS 美东",value:"ue1"},{label:"AWS 新加坡",value:"sg1"},{label:"华为 新加坡",value:"sg2"}],dbList:[{id:1,name:"sdk_ddl_my_database"}],sdFileFormatList:[],updateTypeList:[],frequencyList:[],hierarchypeList:[],departmentList:[],puList:[],appTip:"指表的生产方，即归属于哪个应用，不代表使用方",applicationList:[{value:"SHAREIT_A"},{value:"SHAREIT_I"},{value:"SHAREK"},{value:"SLITE_A"},{value:"FUNU"},{value:"LAKI"},{value:"WATCHIT"},{value:"LIKEIT"},{value:"BUZZNEWS"},{value:"STAR_LIVE"},{value:"LIKEIT_L"},{value:"GAMESHARE_A"},{value:"MAXPLAYER_A"},{value:"PLAYIT_A"},{value:"SHAREIT_W"},{value:"GAMESHARE_B"},{value:"MAXFILE_A"},{value:"WALL_PAP"},{value:"NEWS_BEES"}],tableSchema:O(),codes:O("$dbname","$tablename"),btnDisabled:!1}},computed:y(y({},Object(v["c"])(["userInfo","isCloud","currentUserGroup"])),{},{isAddDB:function(){return["dpm"].includes(this.currentUserGroup.name)}}),watch:{"ruleForm.dbName":function(e,t){e&&e!==t&&this.isManualAction&&(this.$refs["tableSchema"].setCode(this.codes.replace(this.dbNamePattern,e).replace(this.tableNamePattern,this.ruleForm.name)),this.isManualAction=!1)},"ruleForm.name":function(e,t){if(!e){if("tablename"===t)return;this.isManualAction=!0}e!==t&&this.isManualAction&&this.$refs["tableSchema"].setCode(this.codes.replace(this.dbNamePattern,this.ruleForm.dbName).replace(this.tableNamePattern,e))},tableSchema:function(e,t){if(e!==t&&!this.isManualAction){var n=e,r=n.match(this.codeRegexp);if(r&&r.length>=3){var a=r[0].match(this.nameRegexp);if(a&&a.length){var i=n.slice(0,r.index+a.index),o=n.slice(r.index+a.index+a[0].length-1);this.codes=i+this.dbNamePattern+"."+this.tableNamePattern+o}r[2]?(this.ruleForm.dbName=r[1],this.ruleForm.name=r[2]):(this.ruleForm.dbName="",this.ruleForm.name=r[1])}e||(this.codes=e||"")}}},created:function(){var e;this.init(),this.getGroupPage(),null!=(e=this.currentUserGroup)&&e.defaultHiveDbName&&(this.ruleForm.dbName=this.currentUserGroup.defaultHiveDbName),this.$route.query.dbName&&(this.ruleForm.dbName=this.$route.query.dbName,this.isManualAction=!0)},methods:{handleScope:function(e){this.scopes=[]},remoteMethod:function(e,t){var n=this;""!==e?(this.ownerLoading=!0,Object(h["Y"])(e).then((function(e){n.ownerLoading=!1;var t=e.data;n.ownerList=t}))):this.ownerList=[]},getGroupPage:function(){var e=this,t={userId:this.userInfo.userId,name:"",pageNum:1,pageSize:1e4};Object(g["l"])(t).then((function(t){e.groupOptions=t.data.list||[]}))},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.permissions.length,this.isIndeterminate=t>0&&t<this.permissions.length},handleCheckAllChange:function(e){this.checkedOpes=e?this.permissions:[],this.isIndeterminate=!1},setLabels:function(e,t){"add"===e?this.ruleForm.tagList.push({key:"",value:""}):this.ruleForm.tagList.splice(t,1)},handleFocus:function(e){e&&(this.isManualAction=!0)},handleBlur:function(e){this.isManualAction=!1},init:function(){this.isCloud||this.getDbList(),this.getFileFormatList(),this.isCloud&&(this.dbList=[],this.getRegion())},getRegion:function(){var e=this;Object(b["r"])().then((function(t){var n=t.data;if(e.regionList=n.list.map((function(e){return{label:e.description||e.regionAlias,value:e.regionAlias}})),e.regionList.length){var r,a=e.$route.query.region||"ue1";e.ruleForm.region=(null==(r=e.regionList.find((function(e){return e.value===a})))?void 0:r.value)||e.regionList[0].value,e.getDbList()}else e.ruleForm.region=""}))},getDbList:function(){var e=this;this.dbList=[],Object(p["v"])({region:this.ruleForm.region}).then((function(t){var n=t.data;e.dbList=n||[]}))},getFileFormatList:function(){var e=this,t={dictType:"SD_FileFormat"};Object(p["o"])(t).then((function(t){var n=t.data;e.sdFileFormatList=n}))},handleLocation:function(e){var t=this,n={owner:this.userInfo.userId,region:this.ruleForm.region,dbName:this.ruleForm.dbName,tableName:this.ruleForm.name},r=Object.values(n).findIndex((function(e){return!e}));-1===r?Object(p["A"])(n).then((function(e){var n=e.data;t.ruleForm.location=n.path})):this.$message({type:"warning",message:"区域、数据库、表名不为空以请求Location"})},create:function(){var e=this;if(this.ruleForm.region){var t={catalogName:this.ruleForm.region||"",operation:"CREATE_DATABASE",projectId:this.userInfo.tenantName,qualifiedName:"".concat(this.ruleForm.region),region:this.ruleForm.region};this.createLoading=!0,Object(p["p"])(t).then((function(t){e.createLoading=!1;var n=t.data;n?e.$refs.createDb.showWin(e.ruleForm.region):e.$message({type:"warning",message:"您暂无权限，请联系管理员申请权限"})}))}else this.$message({type:"warning",message:"请先选择创建区域"})},check:function(e){var t=this;this[e]?(this.sqlCheckLoading=!0,Object(p["h"])({region:this.ruleForm.region,sql:window.btoa(encodeURIComponent(this.tableSchema))}).then((function(e){t.sqlCheckLoading=!1,t.$message({type:"success",message:"校验通过"})})).finally((function(){t.sqlCheckLoading=!1}))):this.$message({type:"warning",message:"请先输入SQL"})},format:function(e){this.$refs[e].formatSql()},clear:function(e){this.$refs[e].setCode("")},cancel:function(){this.$router.push({name:"MetaData"})},querySearch:function(e,t){var n=this.applicationList,r=e?n.filter(this.createFilter(e)):n;t(r)},createFilter:function(e){return function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}},nextStep:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){if(e.btnDisabled=!0,!e.tableSchema)return e.$message.error("请输入SQL"),void(e.btnDisabled=!1);if(e.dbList.length&&!e.dbList.includes(e.ruleForm.dbName))return e.$message.warning("请选择正确的数据库"),void(e.btnDisabled=!1);Object(p["g"])(y(y({},e.ruleForm),{},{owner:e.userInfo.userId,sql:window.btoa(encodeURIComponent(e.tableSchema))})).then((function(t){var n=t.data;if(n){var r=y(y({},e.ruleForm),{},{owner:e.userInfo.userId,region:e.ruleForm.region,sql:window.btoa(encodeURIComponent(e.tableSchema))});Object(p["c"])(y({},r)).then((function(t){if(0===t.code){var n=t.data;e.$router.push({name:"MetaDataDetail",query:{id:n.id,region:n.region,databaseName:n.dbName,tableName:n.name}})}})).finally((function(){e.btnDisabled=!1}))}else e.btnDisabled=!1})).catch((function(){e.btnDisabled=!1}))}}))},handelAuthorized:function(){if(this.scopes.length){var e={owner:this.userInfo.userId,type:this.effectScope,flag:1,cycle:this.cycle,roleInputs:{objectName:["".concat(this.ruleForm.region,".").concat(this.ruleForm.dbName,".").concat(this.ruleForm.name)],scope:this.scopes,operation:this.checkedOpes}};Object(p["e"])(e).then((function(e){}))}}}},N=A,C=(n("e0a8"),Object(l["a"])(N,r,a,!1,null,"22145a8d",null));t["default"]=C.exports},"06eb":function(e,t,n){},"16f9":function(e,t,n){},"5abc":function(e,t,n){},"7d99":function(e,t,n){"use strict";n.d(t,"y",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"w",(function(){return s})),n.d(t,"m",(function(){return u})),n.d(t,"x",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"t",(function(){return d})),n.d(t,"v",(function(){return f})),n.d(t,"b",(function(){return m})),n.d(t,"h",(function(){return b})),n.d(t,"s",(function(){return p})),n.d(t,"q",(function(){return h})),n.d(t,"a",(function(){return g})),n.d(t,"o",(function(){return v})),n.d(t,"A",(function(){return k})),n.d(t,"g",(function(){return _})),n.d(t,"d",(function(){return y})),n.d(t,"z",(function(){return F})),n.d(t,"p",(function(){return L})),n.d(t,"E",(function(){return S})),n.d(t,"F",(function(){return w})),n.d(t,"G",(function(){return O})),n.d(t,"H",(function(){return A})),n.d(t,"I",(function(){return N})),n.d(t,"l",(function(){return C})),n.d(t,"i",(function(){return x})),n.d(t,"k",(function(){return I})),n.d(t,"B",(function(){return E})),n.d(t,"C",(function(){return q})),n.d(t,"j",(function(){return D})),n.d(t,"f",(function(){return j})),n.d(t,"D",(function(){return $})),n.d(t,"u",(function(){return P})),n.d(t,"r",(function(){return T})),n.d(t,"n",(function(){return G}));var r=n("7258"),a="/metadata";function i(e){return r["b"].get("".concat(a,"/table/search"),{params:e})}function o(e){return r["b"].post("".concat(a,"/role/batchGrantPrivilegeToUser"),e)}function s(e){return r["b"].get("".concat(a,"/history/input"),{params:e})}function u(e){return r["b"].get("".concat(a,"/history/del"),{params:e})}function c(e){return r["b"].get("".concat(a,"/history/table"),{params:e})}function l(e){return r["b"].post("".concat(a,"/table/add"),e,{timeout:6e4})}function d(e){return r["b"].get("".concat(a,"/table/data"),{params:e})}function f(e){return r["b"].get("".concat(a,"/table/dbList"),{params:e})}function m(e){return r["b"].post("".concat(a,"/table/createdb"),e)}function b(e){return r["b"].get("".concat(a,"/table/check"),{params:e})}function p(e){return r["b"].post("".concat(a,"/table/changeDetail"),e)}function h(e){return r["b"].post("".concat(a,"/table/alterColumn"),e,{timeout:6e4})}function g(e){return r["b"].post("".concat(a,"/table/addColumn"),e,{timeout:6e4})}function v(e){return r["b"].post("".concat(a,"/dict/"),e)}function k(e){return r["b"].post("".concat(a,"/table/route"),e)}function _(e){return r["b"].post("".concat(a,"/table/checkCreate"),e)}function y(e){return r["b"].get("".concat(a,"/table/alterOwner"),{params:e})}function F(e){return r["b"].post("".concat(a,"/role/grantPrivilegeToUser"),e)}function L(e){return r["b"].post("".concat(a,"/auth/doAuth"),e)}function S(e){return r["b"].post("".concat(a,"/table/tableOutputInfo"),e)}function w(e){return r["b"].post("".concat(a,"/table/tablePrivilegeInfo"),e)}function O(e){return r["b"].post("".concat(a,"/table/tableProfileInfo"),e)}function A(e){return r["b"].post("".concat(a,"/table/tableStorageInfo"),e)}function N(e){return r["b"].post("".concat(a,"/table/tableSummaryDescInfo"),e)}function C(e){return r["b"].get("".concat(a,"/table/dbList"),{params:e})}function x(e){return r["b"].post("".concat(a,"/table/collect"),e)}function I(e){return r["b"].get("".concat(a,"/table/column"),{params:e})}function E(e){return r["b"].get("".concat(a,"/table/searchOne"),{params:e})}function q(e){return r["b"].post("".concat(a,"/tags/search"),e)}function D(e){return r["b"].get("".concat(a,"/table/collectList"),{params:e})}function j(e){return r["b"].post("".concat(a,"/blood"),e,{timeout:12e4})}function $(e){return r["b"].get("".concat(a,"/table/sensitivityLevel"),{params:e})}function P(e){return r["b"].get("".concat(a,"/table/getdb"),{params:e})}function T(e){return r["b"].post("".concat(a,"/table/updatedb"),e)}function G(e){return r["b"].post("".concat(a,"/table/deletedb"),e)}},"7ea2":function(e,t,n){"use strict";n.d(t,"m",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"t",(function(){return s})),n.d(t,"l",(function(){return u})),n.d(t,"g",(function(){return c})),n.d(t,"o",(function(){return l})),n.d(t,"p",(function(){return d})),n.d(t,"q",(function(){return f})),n.d(t,"r",(function(){return m})),n.d(t,"s",(function(){return b})),n.d(t,"n",(function(){return p})),n.d(t,"b",(function(){return h})),n.d(t,"f",(function(){return g})),n.d(t,"c",(function(){return v})),n.d(t,"d",(function(){return k})),n.d(t,"e",(function(){return _})),n.d(t,"i",(function(){return y})),n.d(t,"k",(function(){return F})),n.d(t,"j",(function(){return L})),n.d(t,"h",(function(){return S}));var r=n("7258"),a="/ds_task/flinkcluster";function i(e){return r["b"].get("".concat(a,"/page?"),{params:e})}function o(e){return r["b"].post("".concat(a,"/add"),e)}function s(e){return r["b"].put("".concat(a,"/update"),e)}function u(e){return r["b"].get("".concat(a,"/get?id=").concat(e))}function c(e){return r["b"].delete("".concat(a,"/delete"),{params:{id:e}})}function l(e){return r["b"].post("/cluster-service/cloud/resource/add",e,{timeout:6e5})}function d(e){return r["b"].delete("/cluster-service/cloud/resource/delete/".concat(e))}function f(e){return r["b"].get("/cluster-service/cloud/resource/getOne",{params:e})}function m(e){return r["b"].get("/cluster-service/cloud/resource/search",{params:e})}function b(e){return r["b"].post("/cluster-service/cloud/resource/update",e,{timeout:6e5})}function p(e){return r["b"].get("/cluster-service/cloud/resource/getRegion",{params:e})}function h(e){return r["b"].post("/cluster-service/cloud/data/add",e,{timeout:6e5})}function g(e){return r["b"].post("/cluster-service/cloud/data/update",e,{timeout:6e5})}function v(e){return r["b"].delete("/cluster-service/cloud/data/delete",{params:e})}function k(e){return r["b"].get("/cluster-service/cloud/data/getOne",{params:e})}function _(e){return r["b"].get("/cluster-service/cloud/data/search",{params:e})}function y(e){return r["b"].get("/cluster-service/cluster/service/roles",{params:e})}function F(e){return r["b"].get("/cluster-service/cluster/vpcs",{params:e})}function L(e){return r["b"].get("/cluster-service/cluster/subnets",{params:e})}function S(e){return r["b"].get("/cluster-service/cluster/security/groups",{params:e})}},"9b8c":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:(e.isEdit?"编辑":"创建")+"库",visible:e.dialogVisible,width:"620px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"80px","label-position":"left"}},[n("el-form-item",{attrs:{label:"库名",prop:"databaseName"}},[n("el-input",{attrs:{disabled:e.isEdit,placeholder:"名字只能包含a-z,A-Z,0-9或-或_；开始结尾需为字符,最多30个字符",maxlength:"30"},model:{value:e.ruleForm.databaseName,callback:function(t){e.$set(e.ruleForm,"databaseName",t)},expression:"ruleForm.databaseName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"location",prop:"locationUri"}},[n("el-input",{attrs:{placeholder:"请输入库路径"},model:{value:e.ruleForm.locationUri,callback:function(t){e.$set(e.ruleForm,"locationUri",t)},expression:"ruleForm.locationUri"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{type:"textarea",placeholder:"请输入描述",rows:"4"},model:{value:e.ruleForm.description,callback:function(t){e.$set(e.ruleForm,"description",t)},expression:"ruleForm.description"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"归属",prop:"uuid"}},[n("div",{staticClass:"form_item"},[n("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"选择生效范围"},on:{change:e.handleScope},model:{value:e.effectScope,callback:function(t){e.effectScope=t},expression:"effectScope"}},e._l(e.scopeList,(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.value}})})),1),e._v(" "),1===e.effectScope?n("el-select",{staticStyle:{width:"65%","margin-left":"20px"},attrs:{placeholder:"请输入用户ID, 最多20个",clearable:"",filterable:"",multiple:"",remote:"","remote-method":e.remoteMethod,loading:e.ownerLoading,"popper-class":"custom-popper"},model:{value:e.scopes,callback:function(t){e.scopes=t},expression:"scopes"}},e._l(e.ownerList,(function(t){return n("el-option",{key:t.shareId,attrs:{value:t.shareId,label:t.name}},[n("div",{staticStyle:{"max-width":"420px","word-break":"break-all"}},[e._v("("+e._s(t.name)+")-"+e._s(t.deptFullPath))])])})),1):e._e(),e._v(" "),2===e.effectScope?n("el-select",{staticStyle:{width:"74%","margin-left":"20px"},attrs:{"value-key":"id",placeholder:"请选择用户组",clearable:""},model:{value:e.currentGroup,callback:function(t){e.currentGroup=t},expression:"currentGroup"}},e._l(e.groupOptions,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1):e._e()],1)])],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.btnDisabled,disabled:e.btnDisabled},on:{click:e.save}},[e._v("确 定")])],1)],1)},a=[],i=n("7d99"),o=n("2f62"),s=n("b199"),u=n("7e3c");function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t=m(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){var t=b(e,"string");return"symbol"===c(t)?t:String(t)}function b(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var p=function(e,t,n){var r=/^[a-zA-Z0-9][-_a-zA-Z0-9]*$/;r.test(t)?n():n(new Error("名字只能包含a-z,A-Z,0-9或-或_；开始需为字符，最多30个字符"))},h="/warehouse/{groupname}/db_{dbname}",g={name:"CreateDb",props:{regionList:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,ruleForm:{region:"",databaseName:"",locationUri:"/warehouse/{groupname}/db_{dbname}",description:"",uuid:"",userId:"",userGroupName:""},btnDisabled:!1,checkAll:!1,ownerLoading:!1,permissions:[{label:"创建表",value:"创建表"},{label:"删除库",value:"删除库"},{label:"描述库",value:"描述库"},{label:"修改库",value:"修改库"}],checkedOpes:["创建表","删除库","描述库","修改库"],isIndeterminate:!0,ownerList:[],groupOptions:[],scopeList:[{name:"用户组",value:2}],effectScope:2,scopes:[],currentGroup:null,isEdit:!1}},computed:d(d({},Object(o["c"])(["isCloud","userInfo","currentUserGroup"])),{},{rules:function(){var e={databaseName:[{required:!0,message:"请输入库名",trigger:["blur","change"]},{validator:p,trigger:["blur","change"]}],uuid:[{required:!0,message:"请选择负责人",trigger:["blur","change"]}]};return e}}),watch:{currentGroup:{handler:function(e){if(e){var t,n;this.ruleForm.uuid=e.uuid,this.ruleForm.userGroupName=e.name;var r=(null==(t=e.userGroupRelationList.find((function(e){return 0===e.owner})))?void 0:t.userName)||(null==(n=e.userGroupRelationList[0])?void 0:n.userName)||"";r&&(this.ruleForm.userId=r)}else this.ruleForm.uuid="",this.ruleForm.userId="",this.ruleForm.userGroupName=""}}},created:function(){this.getGroupPage(),this.currentUserGroup.name&&(this.ruleForm.locationUri=this.formatLocation(this.currentUserGroup.name))},methods:{formatLocation:function(e,t){var n=h;return e&&(n=n.replace("{groupname}",this.currentUserGroup.name)),t&&(n=n.replace("{dbname}",t)),n},getGroupPage:function(){var e=this,t={userId:this.userInfo.userId,name:"",pageNum:1,pageSize:1e4};Object(u["l"])(t).then((function(t){e.groupOptions=t.data.list||[]}))},handleCheckAllChange:function(e){this.checkedOpes=e?this.permissions.map((function(e){var t=e.value;return t})):[],this.isIndeterminate=!1},handleCheckedCitiesChange:function(e){var t=e.length;this.checkAll=t===this.permissions.length,this.isIndeterminate=t>0&&t<this.permissions.length},handleScope:function(e){this.scopes=[],this.currentGroup=null},remoteMethod:function(e,t){var n=this;""!==e?(this.ownerLoading=!0,Object(s["Y"])(e).then((function(e){n.ownerLoading=!1;var t=e.data;n.ownerList=t}))):this.ownerList=[]},showWin:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.ruleForm.region=e,this.dialogVisible=!0,this.btnDisabled=!1,t.databaseName){if(this.ruleForm.databaseName=t.databaseName,this.ruleForm.locationUri=t.locationUri,this.ruleForm.description=t.description,this.ruleForm.userGroupName=t.owner,this.groupOptions.length){var n=this.groupOptions.find((function(e){return e.name===t.owner}));n&&(this.currentGroup=n)}this.isEdit=!0}else this.isEdit=!1},resetForm:function(){this.$refs.ruleForm.resetFields(),this.ruleForm.databaseName="",this.ruleForm.locationUri=this.formatLocation(this.currentUserGroup.name),this.scopes=[],this.currentGroup=null,this.ruleForm.description=""},save:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){e.btnDisabled=!0;var n=null;n=e.isEdit?i["r"]:i["b"],n(e.ruleForm).then((function(t){e.dialogVisible=!1,e.$message({type:"success",message:"".concat(e.isEdit?"编辑":"创建","成功")}),e.$emit("addDbOk",e.isEdit)})).finally((function(){e.btnDisabled=!1}))}}))}}},v=g,k=(n("b8b8"),n("2877")),_=Object(k["a"])(v,r,a,!1,null,"0d1677e6",null);t["a"]=_.exports},b199:function(e,t,n){"use strict";n.d(t,"y",(function(){return i})),n.d(t,"W",(function(){return o})),n.d(t,"E",(function(){return s})),n.d(t,"p",(function(){return u})),n.d(t,"ab",(function(){return c})),n.d(t,"s",(function(){return l})),n.d(t,"r",(function(){return d})),n.d(t,"t",(function(){return f})),n.d(t,"Q",(function(){return m})),n.d(t,"T",(function(){return b})),n.d(t,"A",(function(){return p})),n.d(t,"O",(function(){return h})),n.d(t,"B",(function(){return g})),n.d(t,"q",(function(){return v})),n.d(t,"e",(function(){return k})),n.d(t,"g",(function(){return _})),n.d(t,"d",(function(){return y})),n.d(t,"ib",(function(){return F})),n.d(t,"n",(function(){return L})),n.d(t,"Y",(function(){return S})),n.d(t,"I",(function(){return w})),n.d(t,"H",(function(){return O})),n.d(t,"c",(function(){return A})),n.d(t,"hb",(function(){return N})),n.d(t,"m",(function(){return C})),n.d(t,"j",(function(){return x})),n.d(t,"f",(function(){return I})),n.d(t,"bb",(function(){return E})),n.d(t,"J",(function(){return q})),n.d(t,"F",(function(){return D})),n.d(t,"h",(function(){return j})),n.d(t,"db",(function(){return $})),n.d(t,"z",(function(){return P})),n.d(t,"R",(function(){return T})),n.d(t,"u",(function(){return G})),n.d(t,"D",(function(){return M})),n.d(t,"P",(function(){return R})),n.d(t,"w",(function(){return U})),n.d(t,"Z",(function(){return z})),n.d(t,"C",(function(){return B})),n.d(t,"eb",(function(){return H})),n.d(t,"a",(function(){return Z})),n.d(t,"fb",(function(){return W})),n.d(t,"cb",(function(){return Q})),n.d(t,"G",(function(){return V})),n.d(t,"U",(function(){return K})),n.d(t,"i",(function(){return Y})),n.d(t,"k",(function(){return X})),n.d(t,"K",(function(){return J})),n.d(t,"L",(function(){return ee})),n.d(t,"N",(function(){return te})),n.d(t,"M",(function(){return ne})),n.d(t,"b",(function(){return re})),n.d(t,"l",(function(){return ae})),n.d(t,"o",(function(){return ie})),n.d(t,"S",(function(){return oe})),n.d(t,"gb",(function(){return se})),n.d(t,"X",(function(){return ue})),n.d(t,"v",(function(){return ce})),n.d(t,"V",(function(){return le}));var r=n("7258"),a="/ds_task/task";function i(e){return r["b"].post("/ds_task/metadata/search",e,{timeout:12e4})}function o(){return r["b"].get("/ds_task/sysdict/getTemplateList")}function s(e){return r["b"].get("/ds_task/dict/list",{params:e})}function u(e){return r["b"].get("/ds_task/artifact/list",{params:e})}function c(e){return r["b"].get("/ds_task/artifactversion/list",{params:e})}function l(e){return r["b"].get("/ds_task/flinkcluster/list",{params:e})}function d(e){return r["b"].get("/ds_task/flinkcluster/auto",{params:e})}function f(e){return r["b"].get("/ds_task/flinkcluster/noauto",{params:e})}function m(e){return r["b"].get("".concat(a,"/get"),{params:e})}function b(e){return r["b"].get("".concat(a,"/page"),{params:e,timeout:6e4})}function p(e){return r["b"].post("/ds_task/metadata/getddl",e)}function h(e){return r["b"].get("".concat(a,"/getInsertSql"),{params:e,timeout:6e5})}function g(e){return r["b"].post("/ds_task/metadata/getdispalyddl",e)}function v(e){return r["b"].get("".concat(a,"/getChildDependencies"),{params:{id:e}})}function k(e){return r["b"].get("".concat(a,"/backfill"),{params:e})}function _(e){return r["b"].put("".concat(a,"/onlineAndOffline"),null,{params:e})}function y(e){return r["b"].post("".concat(a,"/add"),e)}function F(e){return r["b"].put("".concat(a,"/update"),e)}function L(e){return r["b"].delete("".concat(a,"/new/delete"),{params:e})}function S(e){return r["b"].get("/ds_task/user/list",{params:{name:e}})}function w(e){return r["b"].get("/ds_task/label/list",{params:{name:e}})}function O(e){return r["b"].get("/ds_task/label/get",{params:{id:e}})}function A(e){return r["b"].post("/ds_task/label/add",e)}function N(e){return r["b"].put("/ds_task/label/update",e)}function C(e){return r["b"].delete("/ds_task/label/delete",{params:{id:e}})}function x(e){return r["b"].patch("/ds_task/collect/add",null,{params:e})}function I(e){return r["b"].get("/ds_task/collect/cancel",{params:e})}function E(e){return r["b"].get("/ds_task/collect/my",{params:e})}function q(e){return r["b"].get("/ds_task/task/listforlabel",{params:{name:e}})}function D(e){return r["b"].get("/ds_task/task/iam",{params:e})}function j(e){return r["b"].post("/ds_task/task/check",e,{timeout:18e4})}function $(e){return r["b"].get("/ds_task/task/name/search",{params:{name:e}})}function P(e){return r["b"].get("/ds_task/task/backfillDateDetail",{params:e})}function T(e){return r["b"].get("/ds_task/task/last7",{params:e})}function G(e){return r["b"].get("/ds_task/user/getEffectiveCostList",{params:{name:e}})}function M(e){return r["b"].get("/ds_task/task/getGitSqlFile",{params:e})}function R(e){return r["b"].post("/ds_task/task/sqlTbls",e,{headers:{"Content-Type":"multipart/form-data"}})}function U(e){return r["b"].post("/ds_task/task/getCrontab",e)}function z(e){return r["b"].get("/ds_task/taskversion/pages",{params:e})}function B(){return r["b"].get("/ds_task/auditlog/type?module=task")}function H(e){return r["b"].get("/ds_task/taskversion/verionSwitch",{params:e})}function Z(e){return r["b"].post("/ds_task/task/addAndStart",e)}function W(e){return r["b"].post("/ds_task/task/updateAndStart",e)}function Q(e){return r["b"].post("/ds_task/task/date/preview",e)}function V(e){return r["b"].post("/ds_task/task/mergeSmallFiles/jars",e)}function K(e){return r["b"].post("/ds_task/task/getTasks",e)}function Y(e){return r["b"].post("/ds_task/task/checkPath",e,{headers:{"Content-Type":"multipart/form-data"}})}function X(e){return r["b"].post("/ds_task/task/fastBackfill?taskId="+e.taskId,e)}function J(e){return r["b"].get("/ds_task/task/renderContent",{params:e})}function ee(e){return r["b"].post("/ds_task/metadata/preview",e)}function te(e){return r["b"].get("/ds_task/actor/sources/page",{params:e})}function ne(e){return r["b"].get("/ds_task/taskfolder/listFolder",{params:e})}function re(e){return r["b"].post("/ds_task/taskfolder/saveFolder",e)}function ae(e){return r["b"].get("/ds_task/taskfolder/deleteFolder",{params:e})}function ie(e){return r["b"].post("/ds_task/taskfolder/editFolder",e)}function oe(e){return r["b"].get("/ds_task/taskfolder/listTask",{params:e})}function se(e){return r["b"].post("/ds_task/taskfolder/updateTask",e)}function ue(e){return r["b"].get("/ds_task/wechatAlert/listById?id=".concat(e))}function ce(e){return r["b"].post("/pipeline/cron/get",e)}function le(e){return r["b"].get("/ds_task/task/templateRendering",{params:e})}},b8b8:function(e,t,n){"use strict";n("5abc")},e0a8:function(e,t,n){"use strict";n("06eb")},efd0:function(e,t,n){"use strict";n("16f9")}}]);