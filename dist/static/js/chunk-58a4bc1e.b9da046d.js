(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-58a4bc1e"],{"39d4":function(e,t,n){"use strict";n("4136")},"3b59":function(e,t,n){e.exports=n.p+"static/img/offset_tips.5be1bb3c.png"},4136:function(e,t,n){},"4f04":function(e,t,n){"use strict";n("c8e3")},a95f:function(e,t,n){},b199:function(e,t,n){"use strict";n.d(t,"y",(function(){return o})),n.d(t,"W",(function(){return i})),n.d(t,"E",(function(){return s})),n.d(t,"p",(function(){return l})),n.d(t,"ab",(function(){return c})),n.d(t,"s",(function(){return u})),n.d(t,"r",(function(){return m})),n.d(t,"t",(function(){return p})),n.d(t,"Q",(function(){return d})),n.d(t,"T",(function(){return f})),n.d(t,"A",(function(){return g})),n.d(t,"O",(function(){return b})),n.d(t,"B",(function(){return h})),n.d(t,"q",(function(){return v})),n.d(t,"e",(function(){return y})),n.d(t,"g",(function(){return _})),n.d(t,"d",(function(){return T})),n.d(t,"ib",(function(){return k})),n.d(t,"n",(function(){return F})),n.d(t,"Y",(function(){return C})),n.d(t,"I",(function(){return w})),n.d(t,"H",(function(){return x})),n.d(t,"c",(function(){return L})),n.d(t,"hb",(function(){return S})),n.d(t,"m",(function(){return I})),n.d(t,"j",(function(){return D})),n.d(t,"f",(function(){return P})),n.d(t,"bb",(function(){return O})),n.d(t,"J",(function(){return E})),n.d(t,"F",(function(){return q})),n.d(t,"h",(function(){return M})),n.d(t,"db",(function(){return N})),n.d(t,"z",(function(){return j})),n.d(t,"R",(function(){return $})),n.d(t,"u",(function(){return A})),n.d(t,"D",(function(){return R})),n.d(t,"P",(function(){return H})),n.d(t,"w",(function(){return Y})),n.d(t,"Z",(function(){return J})),n.d(t,"C",(function(){return V})),n.d(t,"eb",(function(){return K})),n.d(t,"a",(function(){return G})),n.d(t,"fb",(function(){return B})),n.d(t,"cb",(function(){return z})),n.d(t,"G",(function(){return U})),n.d(t,"U",(function(){return Q})),n.d(t,"i",(function(){return W})),n.d(t,"k",(function(){return X})),n.d(t,"K",(function(){return Z})),n.d(t,"L",(function(){return ee})),n.d(t,"N",(function(){return te})),n.d(t,"M",(function(){return ne})),n.d(t,"b",(function(){return re})),n.d(t,"l",(function(){return ae})),n.d(t,"o",(function(){return oe})),n.d(t,"S",(function(){return ie})),n.d(t,"gb",(function(){return se})),n.d(t,"X",(function(){return le})),n.d(t,"v",(function(){return ce})),n.d(t,"V",(function(){return ue}));var r=n("7258"),a="/ds_task/task";function o(e){return r["b"].post("/ds_task/metadata/search",e,{timeout:12e4})}function i(){return r["b"].get("/ds_task/sysdict/getTemplateList")}function s(e){return r["b"].get("/ds_task/dict/list",{params:e})}function l(e){return r["b"].get("/ds_task/artifact/list",{params:e})}function c(e){return r["b"].get("/ds_task/artifactversion/list",{params:e})}function u(e){return r["b"].get("/ds_task/flinkcluster/list",{params:e})}function m(e){return r["b"].get("/ds_task/flinkcluster/auto",{params:e})}function p(e){return r["b"].get("/ds_task/flinkcluster/noauto",{params:e})}function d(e){return r["b"].get("".concat(a,"/get"),{params:e})}function f(e){return r["b"].get("".concat(a,"/page"),{params:e,timeout:6e4})}function g(e){return r["b"].post("/ds_task/metadata/getddl",e)}function b(e){return r["b"].get("".concat(a,"/getInsertSql"),{params:e,timeout:6e5})}function h(e){return r["b"].post("/ds_task/metadata/getdispalyddl",e)}function v(e){return r["b"].get("".concat(a,"/getChildDependencies"),{params:{id:e}})}function y(e){return r["b"].get("".concat(a,"/backfill"),{params:e})}function _(e){return r["b"].put("".concat(a,"/onlineAndOffline"),null,{params:e})}function T(e){return r["b"].post("".concat(a,"/add"),e)}function k(e){return r["b"].put("".concat(a,"/update"),e)}function F(e){return r["b"].delete("".concat(a,"/new/delete"),{params:e})}function C(e){return r["b"].get("/ds_task/user/list",{params:{name:e}})}function w(e){return r["b"].get("/ds_task/label/list",{params:{name:e}})}function x(e){return r["b"].get("/ds_task/label/get",{params:{id:e}})}function L(e){return r["b"].post("/ds_task/label/add",e)}function S(e){return r["b"].put("/ds_task/label/update",e)}function I(e){return r["b"].delete("/ds_task/label/delete",{params:{id:e}})}function D(e){return r["b"].patch("/ds_task/collect/add",null,{params:e})}function P(e){return r["b"].get("/ds_task/collect/cancel",{params:e})}function O(e){return r["b"].get("/ds_task/collect/my",{params:e})}function E(e){return r["b"].get("/ds_task/task/listforlabel",{params:{name:e}})}function q(e){return r["b"].get("/ds_task/task/iam",{params:e})}function M(e){return r["b"].post("/ds_task/task/check",e,{timeout:18e4})}function N(e){return r["b"].get("/ds_task/task/name/search",{params:{name:e}})}function j(e){return r["b"].get("/ds_task/task/backfillDateDetail",{params:e})}function $(e){return r["b"].get("/ds_task/task/last7",{params:e})}function A(e){return r["b"].get("/ds_task/user/getEffectiveCostList",{params:{name:e}})}function R(e){return r["b"].get("/ds_task/task/getGitSqlFile",{params:e})}function H(e){return r["b"].post("/ds_task/task/sqlTbls",e,{headers:{"Content-Type":"multipart/form-data"}})}function Y(e){return r["b"].post("/ds_task/task/getCrontab",e)}function J(e){return r["b"].get("/ds_task/taskversion/pages",{params:e})}function V(){return r["b"].get("/ds_task/auditlog/type?module=task")}function K(e){return r["b"].get("/ds_task/taskversion/verionSwitch",{params:e})}function G(e){return r["b"].post("/ds_task/task/addAndStart",e)}function B(e){return r["b"].post("/ds_task/task/updateAndStart",e)}function z(e){return r["b"].post("/ds_task/task/date/preview",e)}function U(e){return r["b"].post("/ds_task/task/mergeSmallFiles/jars",e)}function Q(e){return r["b"].post("/ds_task/task/getTasks",e)}function W(e){return r["b"].post("/ds_task/task/checkPath",e,{headers:{"Content-Type":"multipart/form-data"}})}function X(e){return r["b"].post("/ds_task/task/fastBackfill?taskId="+e.taskId,e)}function Z(e){return r["b"].get("/ds_task/task/renderContent",{params:e})}function ee(e){return r["b"].post("/ds_task/metadata/preview",e)}function te(e){return r["b"].get("/ds_task/actor/sources/page",{params:e})}function ne(e){return r["b"].get("/ds_task/taskfolder/listFolder",{params:e})}function re(e){return r["b"].post("/ds_task/taskfolder/saveFolder",e)}function ae(e){return r["b"].get("/ds_task/taskfolder/deleteFolder",{params:e})}function oe(e){return r["b"].post("/ds_task/taskfolder/editFolder",e)}function ie(e){return r["b"].get("/ds_task/taskfolder/listTask",{params:e})}function se(e){return r["b"].post("/ds_task/taskfolder/updateTask",e)}function le(e){return r["b"].get("/ds_task/wechatAlert/listById?id=".concat(e))}function ce(e){return r["b"].post("/pipeline/cron/get",e)}function ue(e){return r["b"].get("/ds_task/task/templateRendering",{params:e})}},b207:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var r=n("7258");function a(e){return r["b"].get("/ds_task/validator/item/list?templateCode="+e)}function o(e,t){return r["b"].post("/ds_task/validator/check?templateCode="+e,t)}},c280:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"step2",class:"task"===e.source?"taskStep2":""},[n("steps-head",{attrs:{active:e.currentStep,source:e.source,direction:"task"===e.source?"vertical":"horizontal"},on:{handelStep:e.handelStep}}),e._v(" "),n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.contentLoading,expression:"contentLoading"}],staticClass:"step-content"},[n("div",{directives:[{name:"show",rawName:"v-show",value:1===e.currentStep,expression:"currentStep === 1"}]},[n("el-button",{staticClass:"open-btn",attrs:{type:"primary"},on:{click:function(t){e.drawerVisible=!0}}},[e._v("高级设置")]),e._v(" "),n("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.configForm,rules:e.rules,"label-width":"180px"}},[n("div",{staticClass:"form-head"},[n("el-form-item",{attrs:{label:"数据源类型",prop:"sourceType"}},[n("el-select",{staticClass:"area-select",attrs:{placeholder:"请选择数据源",clearable:""},on:{change:e.changeDataOrigin},model:{value:e.configForm.sourceType,callback:function(t){e.$set(e.configForm,"sourceType",t)},expression:"configForm.sourceType"}},e._l(e.dataOriginList,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),n("el-form-item",{attrs:{label:"表类型选择",prop:"table_type",required:""}},[n("el-radio-group",{on:{change:e.typeChange},model:{value:e.configForm.table_type,callback:function(t){e.$set(e.configForm,"table_type",t)},expression:"configForm.table_type"}},[n("el-radio",{attrs:{label:"single"}},[e._v("单表")]),e._v(" "),"mysql"===e.configForm.sourceType?n("el-radio",{attrs:{label:"more",disabled:!0}},[e._v("整库/多表")]):e._e()],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"数据同步方式",prop:"syncType"}},[n("template",{slot:"label"},[e._v(" 数据同步方式"),n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"},on:{click:function(t){e.syncTypeVisible=!e.syncTypeVisible}}})]),e._v(" "),n("el-radio-group",{attrs:{disabled:!!e.queryId},on:{change:e.syncTypeChange},model:{value:e.configForm.syncType,callback:function(t){e.$set(e.configForm,"syncType",t)},expression:"configForm.syncType"}},[n("el-radio",{attrs:{label:1}},[e._v("全量")]),e._v(" "),"mysql"===e.configForm.sourceType?n("el-radio",{attrs:{disabled:!0,label:2}},[e._v("实时")]):e._e()],1)],2),e._v(" "),n("el-form-item",{attrs:{required:""},scopedSlots:e._u([{key:"label",fn:function(){return[n("span",[e._v("运行模式"),n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"},on:{click:function(t){e.modeVisible=!e.modeVisible}}})])]},proxy:!0}])},[e._v(" "),n("el-radio-group",{on:{change:e.modeChange},model:{value:e.configForm.executeMode,callback:function(t){e.$set(e.configForm,"executeMode",t)},expression:"configForm.executeMode"}},[n("el-radio",{attrs:{label:"local"}},[e._v("本地模式")]),e._v(" "),n("el-radio",{attrs:{label:"distribution",disabled:!0}},[e._v("分布式模式")])],1)],1)],1),e._v(" "),n("el-row",[n("el-col",{attrs:{span:12}},[n("el-tabs",[n("el-tab-pane",{attrs:{label:"选择来源"}},[n("el-form-item",{staticClass:"quick-item",attrs:{label:e.formatOriginLabel()+"数据源名称",prop:"sourceId"}},[n("el-select",{attrs:{placeholder:"数据源名称",loading:e.sourceLoad,filterable:"",clearable:""},on:{change:e.changeSourceName},model:{value:e.configForm.sourceId,callback:function(t){e.$set(e.configForm,"sourceId",t)},expression:"configForm.sourceId"}},e._l(e.dataSourceList,(function(e){return n("el-option",{key:e.actorId,attrs:{label:e.name,value:e.actorId}})})),1),e._v(" "),e.configForm.sourceRegion?e._e():n("span",{staticClass:"tips"},[e._v("* 请先选择区域")]),e._v(" "),n("div",{staticClass:"quick-action"},[n("el-button",{staticClass:"btn-text",attrs:{type:"text"},on:{click:function(t){return e.$router.push({name:"sourceInstance"})}}},[e._v("新建数据源")])],1)],1),e._v(" "),n("el-form-item",{attrs:{label:e.formatOriginLabel()+"库名",prop:"sourceDb"}},[n("el-input",{attrs:{disabled:!0},model:{value:e.configForm.sourceDb,callback:function(t){e.$set(e.configForm,"sourceDb",t)},expression:"configForm.sourceDb"}})],1),e._v(" "),"single"===e.configForm.table_type?n("el-form-item",{staticClass:"quick-item",attrs:{prop:"sourceTable"},scopedSlots:e._u([{key:"label",fn:function(){return[n("span",[e._v(e._s(e.formatOriginLabel())+"表名")]),e._v(" "),e.isLiveTable?n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.handelInfo("liveTable","参数提示")}}}):e._e()]},proxy:!0}],null,!1,2069516551)},[e._v(" "),n("div",{staticClass:"table-box"},[e.isLiveTable?n("el-input",{attrs:{placeholder:e.liveIpt},on:{blur:e.changeLiveTable},model:{value:e.configForm.sourceTable,callback:function(t){e.$set(e.configForm,"sourceTable",t)},expression:"configForm.sourceTable"}}):n("el-select",{attrs:{placeholder:"选择表名称",loading:e.tableLoad,clearable:"",filterable:""},on:{change:e.changeSourceTable},model:{value:e.configForm.sourceTable,callback:function(t){e.$set(e.configForm,"sourceTable",t)},expression:"configForm.sourceTable"}},e._l(e.sourceTableList,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[n("ellipsis-tooltip",{attrs:{text:e.name}})],1)})),1),e._v(" "),n("span",[e.isLiveTable?n("span",[n("el-button",{staticClass:"tips live-btn",attrs:{type:"text"},on:{click:function(t){return e.switchLiveTable()}}},[e._v("返回")])],1):n("span",{staticClass:"tips live-btn",attrs:{type:"text"},on:{click:function(t){return e.switchLiveTable()}}},[e._v("输入动态表名")])])],1),e._v(" "),n("span",[e.isLiveTable?e._e():n("div",{staticClass:"quick-action"},[n("el-button",{staticClass:"btn-text",attrs:{type:"text"},on:{click:function(t){return e.getPreviewData()}}},[e._v("数据预览")])],1)])]):e._e(),e._v(" "),"mongodb"!==e.configForm.sourceType?n("el-form-item",{staticClass:"quick-item",attrs:{label:"分片组件"}},[n("el-select",{attrs:{placeholder:"数据源名称",filterable:"",clearable:""},model:{value:e.configForm.splitPk,callback:function(t){e.$set(e.configForm,"splitPk",t)},expression:"configForm.splitPk"}},e._l(e.splitPkList,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1):e._e(),e._v(" "),"single"===e.configForm.table_type?n("el-form-item",{attrs:{label:"过滤条件",prop:"filterStr"}},[n("el-input",{attrs:{placeholder:e.filterIpt,type:"textarea"},model:{value:e.configForm.filterStr,callback:function(t){e.$set(e.configForm,"filterStr",t)},expression:"configForm.filterStr"}}),e._v(" "),n("span",{staticClass:"tips",on:{click:function(t){return e.handelInfo("jinjia","参数提示")}}},[e._v("参数提示")])],1):e._e()],1)],1)],1),e._v(" "),n("el-col",{attrs:{span:12}},[n("el-tabs",[n("el-tab-pane",[n("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n                    选择目标\n                    "),n("el-popover",{attrs:{placement:"bottom",width:"500",trigger:"hover"}},[n("div",[e._v("\n                        1）下游目标表如果已经存在（包含表结构），则必须保证所选择的目标表结构涵盖上游表中的字段；"),n("br"),e._v('\n                        2）下游目标表如果不存在，则此处支持由用户自定义输入表名，输入后，后台将根据此库表+"字段转换映射"处的“目标表”信息去创建目标表；\n                      ')]),e._v(" "),n("i",{staticClass:"el-icon-info",attrs:{slot:"reference"},slot:"reference"})])],1),e._v(" "),n("el-form-item",{staticClass:"quick-item",attrs:{label:"数据源名称",prop:"destinationId"}},[n("el-select",{attrs:{placeholder:"数据源名称",filterable:"",clearable:""},model:{value:e.configForm.destinationId,callback:function(t){e.$set(e.configForm,"destinationId",t)},expression:"configForm.destinationId"}},e._l(e.destinationList,(function(e){return n("el-option",{key:e.sourceId,attrs:{label:e.name,value:e.sourceId}})})),1),e._v(" "),e.configForm.sourceRegion?e._e():n("span",{staticClass:"tips"},[e._v("* 请先选择区域")])],1),e._v(" "),n("el-form-item",{attrs:{label:"LakeHouse库名",prop:"targetDb"}},[n("el-select",{ref:"dbSelect",staticClass:"lake-table-select",attrs:{disabled:"",placeholder:"选择数据库名称","no-match-text":" ",loading:e.tdbLoad,"default-first-option":"",filterable:"",clearable:""},on:{change:e.changeLakeHouseDb},model:{value:e.configForm.targetDb,callback:function(t){e.$set(e.configForm,"targetDb",t)},expression:"configForm.targetDb"}},[e._l(e.targetDbList,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[n("ellipsis-tooltip",{attrs:{text:e.name}})],1)})),e._v(" "),n("div",{staticClass:"dy-box dy-box-less"}),e._v(" "),n("div",{staticClass:"dy-box"},[n("div",[n("el-button",{attrs:{type:"text"}},[e._v("+没找到？请联系admin或到元数据页面建库")])],1)])],2),e._v(" "),e.configForm.sourceRegion?e._e():n("span",{staticClass:"tips"},[e._v("* 请先选择区域")])],1),e._v(" "),"single"===e.configForm.table_type?n("el-form-item",{staticClass:"targetTable",attrs:{label:"LakeHouse表名",prop:"targetTable"}},[e.autoCreateTable?n("el-input",{attrs:{disabled:e.isTargetTableExit&&!e.copyId},on:{blur:function(t){return e.changeTargetTable("single")}},model:{value:e.configForm.targetTable,callback:function(t){e.$set(e.configForm,"targetTable",t)},expression:"configForm.targetTable"}}):n("el-select",{ref:"targetTableSelect",staticClass:"lake-table-select",attrs:{placeholder:"选择表名称","no-match-text":" ","default-first-option":"",filterable:"",clearable:""},on:{change:function(t){return e.changeTargetTable("single")}},model:{value:e.configForm.targetTable,callback:function(t){e.$set(e.configForm,"targetTable",t)},expression:"configForm.targetTable"}},e._l(e.targetTableList,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}},[n("ellipsis-tooltip",{attrs:{text:e.name}})],1)})),1)],1):n("el-form-item",{staticClass:"targetTable",attrs:{label:"LakeHouse表名前缀(可选)",prop:"targetTablePart"}},[n("el-input",{attrs:{disabled:e.isEdit},on:{input:function(t){return e.changeTargetTable("more")}},model:{value:e.configForm.targetTablePart,callback:function(t){e.$set(e.configForm,"targetTablePart",t)},expression:"configForm.targetTablePart"}})],1),e._v(" "),2!==e.configForm.syncType?n("el-form-item",{attrs:{label:"分区标识",prop:"partitionsRules"},scopedSlots:e._u([{key:"label",fn:function(){return[n("span",[e._v("分区标识")]),e._v(" "),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"此字段标识了目标表是否每天保存一个全量数据，如果填写了分区字段，则每天往指定的分区字段中写入全量数据；否则，只保留最新一个全量数据",placement:"top"}},[n("i",{staticClass:"el-icon-info",staticStyle:{cursor:"pointer"}})])]},proxy:!0}],null,!1,3866741592)},[e._v(" "),e._l(e.configForm.partitions,(function(t,r){return n("div",{key:r,staticClass:"partitions_item"},[n("el-input",{staticClass:"name",attrs:{placeholder:"分区名称",clearable:""},model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"item.name"}}),e._v(" "),n("span",{staticClass:"mark"},[e._v("=")]),e._v(" "),n("el-input",{staticClass:"value",attrs:{placeholder:"分区内容",clearable:""},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"item.value"}}),e._v(" "),e.configForm.partitions.length>1?n("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.deletePartitions(r)}}}):e._e(),e._v(" "),r===e.configForm.partitions.length-1&&e.configForm.partitions.length<3?n("i",{staticClass:"el-icon-plus",class:{onlyAdd:1===e.configForm.partitions.length},on:{click:e.addPartitions}}):e._e()],1)})),e._v(" "),n("span",{staticClass:"tips partitions-tips",on:{click:function(t){return e.handelInfo("jinjia","参数提示")}}},[e._v("参数提示")])],2):e._e(),e._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"表描述"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.taskParam.tableComment,placement:"top"}},[n("el-input",{model:{value:e.taskParam.tableComment,callback:function(t){e.$set(e.taskParam,"tableComment",t)},expression:"taskParam.tableComment"}})],1)],1),e._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"安全级别"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.taskParam.tableLevel,placement:"top"}},[n("el-select",{model:{value:e.taskParam.tableLevel,callback:function(t){e.$set(e.taskParam,"tableLevel",t)},expression:"taskParam.tableLevel"}},e._l(e.securityList,(function(e){return n("el-option",{key:e,attrs:{value:e,label:e}})})),1)],1)],1),e._v(" "),n("el-form-item",{staticClass:"targetTable",attrs:{label:"Location"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.taskParam.location,placement:"top"}},[n("el-input",{attrs:{disabled:""},model:{value:e.taskParam.location,callback:function(t){e.$set(e.taskParam,"location",t)},expression:"taskParam.location"}})],1)],1)],1)],1)],1)],1)],1),e._v(" "),n("div",[n("div",{staticClass:"table-title"},[n("span",{staticClass:"table-span1"},[n("span",{staticClass:"icon-box"},[n("span",{staticClass:"icon-table"},[e._v("源表")]),1===e.configForm.syncType?n("i",{staticClass:"el-icon-info",on:{click:function(t){return e.handelInfo("originTable","源表schema变更的几种情况说明")}}}):e._e()]),e._v(" "),n("div",{staticClass:"refresh",class:{"refresh-select":e.selectItemShow}},["more"===e.configForm.table_type?n("el-input",{attrs:{placeholder:"搜索表名",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchMoreTable(t)}},model:{value:e.moretableName,callback:function(t){e.moretableName=t},expression:"moretableName"}}):e._e(),e._v(" "),"single"===e.configForm.table_type?n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.addTableItem}},[e._v("添加")]):e._e(),e._v(" "),e.selectItemShow?n("el-select",{staticClass:"add-select",attrs:{size:"mini",placeholder:"在当前选中表中选择字段",clearable:""},on:{change:e.selectTableItem},model:{value:e.tableAddItem,callback:function(t){e.tableAddItem=t},expression:"tableAddItem"}},e._l(e.singleTableSelect,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1):e._e(),e._v(" "),e.isEdit||"single"===e.configForm.table_type?n("el-button",{staticClass:"refresh-btn",attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.refreshTable(e.configForm.table_type)}}},[e._v("刷新源表字段")]):e._e()],1)]),e._v(" "),n("span",{staticClass:"table-span2"},[e._v("映射")]),e._v(" "),n("span",{staticClass:"table-span3"},[e._v("目标表")])]),e._v(" "),"single"===e.configForm.table_type?n("div",[n("ipt-c-table",{ref:"singleTable",attrs:{"input-columns":e.inputColumns,columns:e.columns,"type-list":e.typeList,"config-form":e.configForm,"input-columns-loading":e.inputColumnsLoading,"columns-loading":e.columnsLoading,"is-single":!0},on:{deleteTableItem:e.deleteTableItem}})],1):n("div",[n("el-row",[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.moreInputColumnsLoading,expression:"moreInputColumnsLoading"}],ref:"moreInputColumns",attrs:{data:e.moreInputColumns,stripe:"","cell-style":{height:"42px",padding:"0px"}},on:{"expand-change":e.expandChange,"selection-change":e.selectMoreTable}},[n("el-table-column",{attrs:{type:"selection",width:"35",selectable:e.selectable}}),e._v(" "),n("el-table-column",{attrs:{type:"expand",width:"30"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"more-table"},[n("ipt-c-table",{directives:[{name:"loading",rawName:"v-loading",value:e.moreInputLoadingArr[t.$index],expression:"moreInputLoadingArr[scope.$index]"}],key:t.$index,attrs:{"input-columns":t.row.inputColumns,columns:t.row.columns,"type-list":e.typeList}})],1)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"库名",align:"center"}},[[n("el-tooltip",{attrs:{content:e.configForm.sourceDb,disabled:e.isTipDisabled}},[n("span",{staticClass:"ellipsis block",on:{mouseenter:e.isShowTooltip}},[e._v(e._s(e.configForm.sourceDb||"-"))])])]],2),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"表名",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tooltip",{attrs:{content:t.row.name,disabled:e.isTipDisabled}},[n("span",{staticClass:"ellipsis block",on:{mouseenter:e.isShowTooltip}},[e._v(e._s(t.row.name||"-"))])])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"预览",align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.getPreviewData(t.row.name,t.$index)}}},[e._v("数据预览")])]}}])},[e._v("``\n                ")]),e._v(" "),n("el-table-column",{attrs:{label:"映射&转换",align:"center","min-width":"100"}},[n("div",{staticClass:"func-icon"},[n("div",{staticClass:"func-icon-line"},[n("div",{staticClass:"circle left"}),e._v(" "),n("div",{staticClass:"circle right"})])])]),e._v(" "),n("el-table-column",{attrs:{label:"库名","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tooltip",{attrs:{content:t.row.lakeHouseDbName,disabled:e.isTipDisabled}},[n("span",{staticClass:"ellipsis block",on:{mouseenter:e.isShowTooltip}},[e._v(e._s(t.row.lakeHouseDbName||"-"))])])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"表名","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-tooltip",{attrs:{content:t.row.name,disabled:e.isTipDisabled}},[n("span",{staticClass:"ellipsis block",on:{mouseenter:e.isShowTooltip}},[e._v(e._s(t.row.preMoreTableName||"-"))])])]}}])})],1)],1)],1)])],1),e._v(" "),2===e.currentStep?n("step-three",{ref:"stepThree",attrs:{"current-step":e.currentStep,"senior-form":e.seniorForm,"is-workflow":e.isWorkflow,"name-disabled":e.nameDisabled,"is-show-input-check":!0,"is-show-output-check":!0,"rule-form":e.ruleForm}}):e._e(),e._v(" "),3===e.currentStep?n("ViewParams",{attrs:{info:e.info,"region-list":e.regionList,"target-source-list":e.dataSourceList,"is-workflow":e.isWorkflow,"name-disabled":e.nameDisabled,"is-show-input-check":!0,"is-show-output-check":!0},on:{jumpStep:function(t){return e.currentStep=t}}}):e._e(),e._v(" "),n("el-drawer",{attrs:{title:"高级设置",visible:e.drawerVisible,"append-to-body":!0,"with-header":!1,direction:"rtl"},on:{"update:visible":function(t){e.drawerVisible=t}}},[1===e.configForm.syncType?n("senior-form",{ref:"seniorForm",attrs:{"is-show-mode":e.isShowMode,"run-mode-show":e.runModeShow,"senior-form":e.seniorForm},on:{close:function(t){e.drawerVisible=!1}}}):n("senior-sql-form",{ref:"seniorForm",attrs:{"no-cluster":e.noCluster,"senior-form":e.seniorFormSql,region:e.configForm.sourceRegion},on:{close:function(t){e.drawerVisible=!1}}})],1)],1),e._v(" "),n("div",{staticClass:"btn-wrap"},[n("el-button",{on:{click:function(t){return e.$emit("cancel")}}},[e._v("取消")]),e._v(" "),e.isShowPublish||!e.isShowPublish&&1!==e.currentStep?n("el-button",{on:{click:e.preStep}},[e._v("上一步")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"primary",disabled:!e.canEdit&&("task"===e.source&&3===e.currentStep||"task"!==e.source&&2===e.currentStep),loading:e.btnLoading},on:{click:e.nextStep}},[e._v(e._s("task"===e.source&&3!==e.currentStep||1===e.currentStep?"下一步":e.copyId?"确认复制":"保存"))]),e._v(" "),e.isShowPublish&&e.currentStep>=3?n("el-checkbox",{staticClass:"task-checkbox",model:{value:e.ruleForm.invokingStatus,callback:function(t){e.$set(e.ruleForm,"invokingStatus",t)},expression:"ruleForm.invokingStatus"}},[e._v("切换至该版本")]):e._e()],1),e._v(" "),n("valid-params",{ref:"validParams",attrs:{code:e.ruleForm.templateCode},on:{save:function(t){e.$emit("save",t)}}}),e._v(" "),n("el-info",{attrs:{title:"数据同步方式介绍"},model:{value:e.syncTypeVisible,callback:function(t){e.syncTypeVisible=t},expression:"syncTypeVisible"}},[n("div",{staticStyle:{padding:"0 16px","font-size":"14px","line-height":"24px",color:"#606266"}},[n("div",{staticStyle:{"font-weight":"550"}},[e._v("1、全量同步方式介绍")]),e._v(" "),n("div",[e._v("将源端所有数据周期性全量拉取到LakeHouse，任务例行过程中，如果源发生DDL类变更，需及时关注任务运行状态。")]),e._v(" "),n("div",{staticStyle:{"margin-top":"10px","font-weight":"550"}},[e._v("2、实时同步方式介绍")]),e._v(" "),n("div",[e._v("先将源端所有数据一次性全量拉取到LakeHouse后，再实时地将增量数据拉取到LakeHouse中；整库/多表方式下不支持一键实时选项；此方式需要您提前开启MySQL客户端的Binlog设置。")])])]),e._v(" "),n("el-info",{attrs:{title:"运行模式介绍"},model:{value:e.modeVisible,callback:function(t){e.modeVisible=t},expression:"modeVisible"}},[n("div",{staticStyle:{padding:"0 16px","font-size":"14px","line-height":"24px",color:"#606266"}},[n("p",[e._v("支持本地模式与分布式模式；")]),e._v(" "),n("p",[n("span",{staticStyle:{"font-weight":"550"}},[e._v("本地模式：")]),e._v("通过固定路由提交到本地机器上执行；")]),e._v(" "),n("p",[n("span",{staticStyle:{"font-weight":"550"}},[e._v("分布式模式：")]),e._v("适用于海量数据处理的任务，提交到分布式集群上执行；")])])]),e._v(" "),n("el-dialog",{attrs:{visible:e.previewVisible,"append-to-body":!0},on:{"update:visible":function(t){e.previewVisible=t}}},[n("div",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(e.previewTable)+"的数据预览 "),n("span",{staticClass:"preview-tip"},[e._v("只显示limit 5的信息")])]),e._v(" "),e.previewData.length?n("el-table",{attrs:{data:e.previewData}},e._l(Object.keys(e.previewData[0]),(function(t,r){return n("el-table-column",{key:r,attrs:{property:t,label:t,"min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(r){return[n("el-tooltip",{staticClass:"preview-table",attrs:{effect:"dark",content:r.row[t],placement:"top"}},[n("span",[e._v(" "+e._s(r.row[t])+" ")])])]}}],null,!0)},[n("template",{slot:"header"},[n("el-tooltip",{staticClass:"preview-header",attrs:{effect:"dark",content:t,placement:"top"}},[n("span",[e._v(" "+e._s(t)+" ")])])],1)],2)})),1):e._e()],1),e._v(" "),n("el-info",{attrs:{title:e.infoObj.title},model:{value:e.infoObj.type,callback:function(t){e.$set(e.infoObj,"type",t)},expression:"infoObj.type"}},["jinjia"===e.infoObj.msgType?n("sql-tips"):e._e(),e._v(" "),"originTable"===e.infoObj.msgType?n("origin-table-tips"):e._e(),e._v(" "),"liveTable"===e.infoObj.msgType?n("live-table-tips"):e._e()],1)],1)},a=[],o=n("2dfe"),i=n("9caf"),s=n("5163"),l=n("042b"),c=n("deac"),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sql-tips"},[n("div",{staticClass:"title1",staticStyle:{"margin-bottom":"5px"}},[e._v("表达式中的tomorrow、yesterday等都是基于ds（入参时间）计算")]),e._v(" "),n("el-table",{attrs:{data:e.gridData,size:"mini","cell-style":{padding:"4px 0"}}},[n("el-table-column",{attrs:{property:"expression",label:"参数"}}),e._v(" "),n("el-table-column",{attrs:{property:"mean",label:"含义"}})],1),e._v(" "),n("div",{staticStyle:{"margin-top":"5px"}},[e._v("其他情况请参考：")]),e._v(" "),e._m(0)],1)},m=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("a",{attrs:{href:"https://shimo.im/docs/pmkxQmWOO4COMKAN#anchor-vxmb",target:"_blank"}},[e._v("https://shimo.im/docs/pmkxQmWOO4COMKAN#anchor-vxmb")])])}],p={name:"SqlTips",data:function(){return{text:"{{ (execution_date - macros.timedelta(days=1)).strftime('%Y%m%d') }}",gridData:[{expression:"{{ ds }}",mean:"the execution date as YYYY-MM-DD"},{expression:"{{ ds_nodash }}",mean:"the execution date as YYYYMMDD"},{expression:"{{ yesterday_ds }}",mean:"yesterday’s date as YYYY-MM-DD"},{expression:"{{ yesterday_ds_nodash }}",mean:"yesterday’s date as YYYYMMDD"},{expression:"{{ tomorrow_ds }}",mean:"tomorrow’s date as YYYY-MM-DD"},{expression:"{{ tomorrow_ds_nodash }}",mean:"tomorrow’s date as YYYYMMDD"}]}}},d=p,f=(n("4f04"),n("2877")),g=Object(f["a"])(d,u,m,!1,null,"ac3dc5d4",null),b=g.exports,h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sql-tips"},[e._m(0),e._v(" "),n("el-table",{attrs:{data:e.gridData,size:"mini","header-cell-style":{"text-align":"center"}}},[n("el-table-column",{attrs:{prop:"expression",label:"来源端发生的表结构变化",align:"center","max-width":"120"}}),e._v(" "),n("el-table-column",{attrs:{label:"目标数据库同步策略"}},[n("el-table-column",{attrs:{prop:"mean",label:"任务不修改的情况下",align:"center","max-width":"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v("\n            "+e._s(t.row.mean1)+"\n          ")])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"mean",label:"任务修改的情况下","min-width":"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v("\n            "+e._s(t.row.mean2)+"\n          ")]),e._v(" "),n("div",[e._v("\n            "+e._s(t.row.mean3)+"\n          ")]),e._v(" "),n("div",[e._v("\n            "+e._s(t.row.mean4)+"\n          ")])]}}])})],1)],1)],1)},v=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"title",staticStyle:{"margin-bottom":"5px"}},[e._v('\n    注：当您触发“刷新源表字段”后，下方列表字段将获取源表最新schema信息。如果源表字段发生过变更，将会标记"变更"提示，此时，您需要根据此变更标记去修改目标表相应的字段（如果已经提前处理目标表schema则无需关注），处理目标表schema后，再保存此任务，下次运行将会正常同步。\n    '),n("p",{staticClass:"next-line"},[e._v("当前平台侧尚不支持DDL变更后自动同步，若源表schema与目标表schema不一致，写入目标表的策略如下所示：")])])}],y={name:"SqlTips",data:function(){return{text:"{{ (execution_date - macros.timedelta(days=1)).strftime('%Y%m%d') }}",gridData:[{expression:"表字段删除",mean1:"执行会报错",mean2:"如果想让任务仍然执行成功，您需要：",mean3:'1）通过"数据分析"模块手动执行sql以删除LakeHouse表同名字段；',mean4:'2）修改任务，进入step2点击"刷新源表字段"后，"字段映射"会展示最新的源表schema（目标字段自动与源表映射一致），保存任务例行即可；'},{expression:"表字段新增",mean1:"正常执行",mean2:"如果想要同步新增的源字段，您需要：",mean3:'1）修改任务，进入step2点击"刷新源表字段"后，"字段映射"会展示最新的源表schema（目标字段自动与源表映射一致），保存任务例行即可；'},{expression:"表字段修改",mean1:"执行会报错",mean2:"如果想让任务仍然执行成功，您需要：",mean3:'1）通过"数据分析"模块手动执行sql以修改LakeHouse表同名字段，使其与源表字段保持一致；',mean4:'2）修改任务，进入step2点击"刷新源表字段"后，"字段映射"会展示最新的源表schema（目标字段自动与源表映射一致），保存任务例行即可；'}]}}},_=y,T=(n("39d4"),Object(f["a"])(_,h,v,!1,null,"3caca5bd",null)),k=T.exports,F=n("3941"),C=n("b199"),w=(n("7e3c"),n("b893")),x=n("3dc0"),L=n("4fb9"),S=n("ffe0");function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){return t=E(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){var t=q(e,"string");return"symbol"===I(t)?t:String(t)}function q(e,t){if("object"!==I(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function M(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */M=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var o=t&&t.prototype instanceof h?t:h,i=Object.create(o.prototype),s=new P(r||[]);return a(i,"_invoke",{value:x(e,n,s)}),i}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",g="completed",b={};function h(){}function v(){}function y(){}var _={};c(_,i,(function(){return this}));var T=Object.getPrototypeOf,k=T&&T(T(O([])));k&&k!==n&&r.call(k,i)&&(_=k);var F=y.prototype=h.prototype=Object.create(_);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(a,o,i,s){var l=m(e[a],e,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==I(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,s)}),(function(e){n("throw",e,i,s)})):t.resolve(u).then((function(e){c.value=e,i(c)}),(function(e){return n("throw",e,i,s)}))}s(l.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function x(t,n,r){var a=p;return function(o,i){if(a===f)throw new Error("Generator is already running");if(a===g){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var s=r.delegate;if(s){var l=L(s,r);if(l){if(l===b)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===p)throw a=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=f;var c=m(t,n,r);if("normal"===c.type){if(a=r.done?g:d,c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(a=g,r.method="throw",r.arg=c.arg)}}}function L(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,L(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var o=m(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,b;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(I(t)+" is not iterable")}return v.prototype=y,a(F,"constructor",{value:y,configurable:!0}),a(y,"constructor",{value:v,configurable:!0}),v.displayName=c(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(F),e},t.awrap=function(e){return{__await:e}},C(w.prototype),c(w.prototype,s,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new w(u(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(F),c(F,l,"Generator"),c(F,i,(function(){return this})),c(F,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return s.type="throw",s.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var l=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(l&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function N(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){N(o,r,a,i,s,"next",e)}function s(e){N(o,r,a,i,s,"throw",e)}i(void 0)}))}}var $={components:{StepsHead:o["a"],SeniorForm:i["a"],SeniorSqlForm:s["a"],StepThree:l["a"],SqlTips:c["a"],OriginTableTips:k,EllipsisTooltip:F["a"],ValidParams:x["a"],IptCTable:L["a"],ViewParams:S["a"],LiveTableTips:b},props:{data:{type:Object,default:function(){return{}}},isShowPublish:{type:Boolean,default:!1},source:{type:String,default:"task"}},data:function(){var e=this,t=function(t,n,r){e.targetTableList.map((function(t){t.name.toLowerCase()!==e.configForm.targetTable.toLocaleLowerCase()||e.isEdit||r(new Error("目标表名已存在"))})),r()},n=function(e,t,n){var r=/^[a-z]+[a-z0-9-_]*$/;r.test(t)?n():n(new Error("只能包含a-z,0-9或-或_；开始需为字符"))},r=function(e,t,n){var r=/^[a-z]+[a-z0-9-_]*$/;t&&(!r.test(t)||t.length>20)?n(new Error("只能包含a-z,0-9或-或_；开始需为字符")):n()},a=function(e,t,n){n()};return{infoObj:{type:!1,msgType:"",title:""},dataOriginList:[{label:"MySQL",value:"mysql"},{label:"Oracle",value:"oracle"},{label:"SQL Server",value:"sqlserver"},{label:"Doris",value:"doris"},{label:"Postgres",value:"postgres"},{label:"MongoDB",value:"mongodb"},{label:"Hana",value:"hana"}],taskParam:{location:"",tableComment:"",tableLevel:"1级"},destinationList:[],runModeShow:!1,liveIpt:"如：tablename_{{ execution_date.strftime('%Y%m%d') }}",filterIpt:"如：column1='china' and column2>'yesterday_date'",isLiveTable:!1,autoCreateTable:!0,selectItemShow:!1,singleTableSelect:[],tableAddItem:"",initAlertModel:{alertType:[],notifyCollaborator:!1},initRegularAlert:{offset:0,graularity:"",checkTime:"",triggerCondition:"notStart",alertType:[],notifyCollaborator:!1,isChecked:!1},partitionsValue:"",isEdit:!1,isTargetTableExit:!1,columnsArr:[],noCluster:!1,initTable:"",expands:[],splitPkList:[],syncTypeVisible:!1,modeVisible:!1,previewVisible:!1,previewData:[],btnLoading:!1,formLoading:!1,contentLoading:!1,tableLoading:!1,currentStep:1,queryId:"",copyId:this.$route.query.copyId,hasTableName:!1,moreTableList:[],moretableName:"",previewTable:"",securityList:["1级","2级","3级","4级"],initInputDataset:[{metadata:{region:"",type:"mysql",source:"",db:"",table:""},guid:"",id:"",granularity:"daily",unitOffset:0,ready_time:"0 0 * * *",useDateCalcuParam:!1,dateCalculationParam:{}}],initOutputDataset:[{metadata:{region:"",type:"hive",source:"",db:"",table:""},offset:-1}],seniorFormSql:{isLakeHouseReal:!1,displayDependJars:[{artifactId:"",id:""}],flinkClusterId:"",runtimeConfig:{sourceType:"mysql",topic:"",bootstrapServerUri:"",mysqlCdcType:"initial",checkpoint:1,checkpointInterval:30,checkpointTimeout:100,checkpointMode:"AT_LEAST_ONCE",owner:"",collaborators:[],dsGroups:[],parallelism:1,huaweiIam:"",awsIam:"",tmCpu:1,tmMemory:4,params:[],alertModel:{success:{alertType:[],notifyCollaborator:!1},failure:{alertType:[],notifyCollaborator:!1},retry:{alertType:[],notifyCollaborator:!1},start:{alertType:[],notifyCollaborator:!1}}}},seniorForm:{alertModel:{success:{alertType:[],notifyCollaborator:!1},failure:{alertType:[],notifyCollaborator:!1,isChecked:!1},retry:{alertType:[],notifyCollaborator:!1},start:{alertType:[],notifyCollaborator:!1}},regularAlert:{offset:0,graularity:"",checkTime:"",triggerCondition:"notStart",alertType:[],notifyCollaborator:!1,isChecked:!1},mysqlCdcType:"init",owner:"",collaborators:[],dsGroups:[],group:"",resourceLevel:"standard",executionTimeout:0,retries:1,maxActiveRuns:1,emails:"",clusterSla:"normal",acrossCloud:"common",startDate:"",endDate:"",batchParams:"",lifecycle:"Ec2spot",location:""},ruleForm:{isLakeHouseReal:!1,isLakeHouseMore:!1,invokingStatus:!0,templateCode:"Mysql2Hive",name:"",description:"",dependTypes:[],triggerParam:{type:"data",isIrregularSheduler:1,outputGranularity:"daily",crontabParam:{range:[],interval:5,startTime:"00:00",endTime:"23:59",fixedTime:"00:00"},crontab:""},eventDepends:[],inputDataset:[{metadata:{region:"",type:"mysql",source:"",db:"",table:""},guid:"",id:"",granularity:"daily",unitOffset:0,ready_time:"0 0 * * *",useDateCalcuParam:!1,dateCalculationParam:{}}],outputDataset:[{metadata:{region:"",type:"hive",source:"",db:"",table:""},offset:-1}],cost:[{key:"",value:"100"}]},configForm:{partitions:[{name:"",value:""}],executeMode:"local",sourceType:"mysql",isTableList:!0,table_type:"single",sourceRegion:"",sourceId:"",destinationId:"",sourceDb:"",sourceTable:"",existTargetTable:!1,exitDatabase:!0,targetDb:"stage",targetTable:"",layer:"ods",theme:"",targetTablePart:"",syncTypeText:"all",syncType:1,connectionUrl:"",dbUser:"",dbPassword:"",filterStr:"",splitPk:""},addDbRules:{dbItemName:[{required:!0,message:"请输入库名",trigger:["blur","change"]},{validator:n,trigger:["blur","change"]}]},rules:{sourceRegion:[{required:!0,message:"请选择区域",trigger:["blur","change"]}],sourceType:[{required:!0,message:"请选择数据源",trigger:["blur","change"]}],sourceId:[{required:!0,message:"请选择数据源名称",trigger:["blur","change"]}],destinationId:[{required:!0,message:"请选择数据源名称",trigger:["blur","change"]}],sourceDb:[{required:!0,message:"请选择数据库名称",trigger:["blur","change"]}],sourceTable:[{required:!0,message:"请选择表名称",trigger:["blur","change"]}],targetDb:[{required:!0,message:"请选择数据库名称",trigger:["blur","change"]}],theme:[{required:!0,message:"请输入主题",trigger:["blur","change"]}],targetTable:[{required:!0,message:"请输入目标表名称",trigger:["blur","change"]},{validator:t,trigger:["blur","change"]}],targetTablePart:[{required:!1,message:"请输入LakeHouse表名前缀",trigger:["blur","change"]},{validator:r,trigger:["blur","change"]}],filterStr:[{validator:a,trigger:["blur"]}],name:[{required:!0,message:"请输入name",trigger:["blur","change"]}],syncType:[{required:!0,message:"请选择数据同步方式",trigger:["blur","change"]}]},sourceLoad:!1,dbLoad:!1,tableLoad:!1,tdbLoad:!1,ttabLoad:!1,userGroupName:"",regionList:w["l"],typeList:["String","Boolean","Bigint","Date","Double","Float","Int","Tinyint","Timestamp"],targetDbList:[],targetTableList:[],dataSourceList:[],sourceTableList:[],primaryKey:"",addColumns:[],inputColumnsLoading:!1,inputColumns:[],columnsLoading:!1,columns:[],initMoreInputColumns:[],moreInputColumns:[],moreInputLoadingArr:[],moreInputColumnsLoading:!1,drawerVisible:!1,tables:[],canEdit:!0,nameDisabled:!0,copyMsg:null,isMatched:!1,showInput:!1,inputField:"",inputFieldList:[],showOutput:!1,outputField:"",outputFieldList:[],isTipDisabled:!1,isWorkflow:!1}},computed:{info:function(){return 1===this.configForm.syncType?Object.assign({},this.ruleForm,this.seniorForm,this.configForm,{target_columns:this.columns,source_columns:this.inputColumns,moreTableList:this.moreTableList}):Object.assign({},this.ruleForm,this.seniorFormSql.runtimeConfig,this.configForm,{target_columns:this.columns,source_columns:this.inputColumns,moreTableList:this.moreTableList})},disabled:function(){return 3===this.currentStep},groupList:function(){var e=this.$store.getters.userInfo;return e&&e.group?e.group.split(","):[]},isShowMode:function(){return"sg2"!==this.configForm.sourceRegion}},watch:{data:{handler:function(e){Object.keys(e).length>0&&(this.isEdit=!0,this.getTaskInfo(e))},deep:!0,immediate:!0},inputColumns:{handler:function(e){e.length&&(this.splitPkList=e.map((function(e){return e.name})))},deep:!0,immediate:!0},"configForm.targetDb":function(e){this.moreInputColumns.forEach((function(t){t.lakeHouseDbName=e})),this.initMoreInputColumns.forEach((function(t){t.lakeHouseDbName=e}))},"configForm.partitions":{handler:function(e){this.getLocation()},deep:!0}},created:function(){this.seniorForm.dsGroups=this.$store.getters["user/currentUserGroup"].id?[this.$store.getters["user/currentUserGroup"].id]:[],this.seniorFormSql.runtimeConfig.dsGroups=this.$store.getters["user/currentUserGroup"].id?[this.$store.getters["user/currentUserGroup"].id]:[]},mounted:function(){var e=this;w["l"].then((function(t){e.regionList=t,e.configForm.sourceRegion=t[0].value,e.changeLakeHouseDb("stage"),setTimeout((function(){e.isEdit||e.changeRegion(t[0].value)}),1e3)}))},destroyed:function(){this.copyMsg&&this.copyMsg.close()},methods:{stopTest:function(e){e.stopPropagation()},getCluster:function(){var e=this;Object(C["s"])().then((function(t){var n=t.data;n&&n.length?e.clusterList=n:(e.drawerVisible=!0,e.noCluster=!0)}))},getTaskInfo:function(){var e=j(M().mark((function e(t){var n,r,a,o,i=this;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.copyId||(this.queryId=t.id),n=JSON.parse(t.runtimeConfig),n.cost&&(this.ruleForm.cost=n.cost),this.isLiveTable=n.catalog.tables[0].dynamicTable,this.autoCreateTable=n.catalog.tables[0].autoCreateTable,this.configForm.sourceRegion=n.sourceRegion,this.configForm.sourceType=n.sourceType,this.configForm.sourceId=n.sourceId,this.configForm.destinationId=n.destinationId,this.configForm.table_type=n.catalog.table_type,this.configForm.syncType=n.catalog.sync_mode,this.configForm.sourceDb=n.catalog.sourceDb,this.configForm.sourceTable=n.catalog.tables[0].sourceTable,this.configForm.targetTable=n.catalog.tables[0].targetTable,this.configForm.targetTablePart=n.catalog.tables[0].targetTablePart,this.initTable=this.configForm.sourceTable,this.configForm.filterStr=n.catalog.tables[0].filterStr,this.configForm.splitPk=n.catalog.tables[0].splitPk,this.configForm.executeMode=n.executeMode,r=n.catalog.tables[0].partitions.split(","),r.map((function(e,t){var n=e.indexOf("="),r=e.substring(0,n),a=e.substring(n+1);i.$set(i.configForm.partitions,t,{name:r,value:a})})),1===this.configForm.syncType?(Object.keys(this.seniorForm).forEach((function(e){i.seniorForm[e]=n.advancedParameters[e]})),this.seniorForm.alertModel=n.alertModel?n.alertModel:this.seniorForm.alertModel,this.seniorForm.regularAlert=n.regularAlert?n.regularAlert:this.seniorForm.regularAlert):(this.seniorFormSql.flinkClusterId=t.flinkClusterId,Object.keys(this.seniorFormSql.runtimeConfig).forEach((function(e){i.seniorFormSql.runtimeConfig[e]=n.advancedParameters[e]})),this.seniorFormSql.isLakeHouseReal=t.isLakeHouseReal,t.displayDependJars&&t.displayDependJars.length?this.seniorFormSql.displayDependJars=t.displayDependJars:this.seniorFormSql.displayDependJars=[{artifactId:"",id:""}]),this.configForm.existTargetTable=n.catalog.tables[0].existTargetTable,this.syncTypeChange(),this.typeChange("init"),this.ruleForm.name=t.name,this.ruleForm.oldAlertList=t.oldAlertList,this.copyId||t.isCopy?(this.ruleForm.name=t.name+"_copy",this.nameDisabled=!1,this.seniorForm.owner=this.seniorFormSql.runtimeConfig.owner=this.$store.getters.userInfo.userId):this.canEdit=t.canEdit,this.configForm.sourceType=this.configForm.sourceType?this.configForm.sourceType:"mysql","single"===n.catalog.table_type?(this.columnsArr=Array.isArray(n.catalog.tables[0].columns)?n.catalog.tables[0].columns:JSON.parse(n.catalog.tables[0].columns),this.columnsArr.forEach((function(e,t){i.columns.push({columnName:e.columnName,columnType:e.columnType,columnComment:e.columnComment,securityLevel:e.securityLevel});var n={name:e.name,data_type:e.data_type?e.data_type:e.dataType,comment:e.comment,isPK:e.isPK};e.funcs&&(n.funcs=e.funcs),e.isPK&&(i.primaryKey=e.name),i.inputColumns.push(n)}))):(n.catalog.tables.forEach((function(e){e.name=e.sourceTable,e.preMoreTableName=e.targetTable,e.inputColumns=e.columns.map((function(e){var t={name:e.name,data_type:e.data_type,comment:e.comment,isPK:e.isPK};return e.funcs&&(t.funcs=e.funcs),t}));var t=e.columns.findIndex((function(e){return!0===e.isPK}));e.primaryKey=t>-1?e.columns[t].name:""})),this.moreInputColumns=n.catalog.tables,this.initMoreInputColumns=JSON.parse(JSON.stringify(n.catalog.tables)),this.$nextTick((function(){i.$refs.moreInputColumns.toggleAllSelection()}))),this.ruleForm.description=t.description,this.$set(this.ruleForm,"online",t.online),a=JSON.parse(t.outputDataset),o=JSON.parse(t.inputDataset),this.ruleForm.inputDataset=o.length?o:this.ruleForm.inputDataset,this.ruleForm.outputDataset=a.length?a:this.ruleForm.outputDataset,this.ruleForm.outputDataset&&this.ruleForm.outputDataset.length>0&&this.ruleForm.outputDataset[0].location&&this.$set(this.ruleForm.outputDataset[0],"check",!0),e.next=39,this.changeRegion(this.configForm.sourceRegion,"init");case 39:return e.next=41,this.changeSourceName(this.configForm.sourceId,"init");case 41:n.taskParam?this.taskParam=n.taskParam:this.getLocation(),this.contentLoading=!1,t.dependTypes&&(this.ruleForm.dependTypes=JSON.parse(t.dependTypes)),t.triggerParam&&Object.assign(this.ruleForm.triggerParam,JSON.parse(t.triggerParam)),t.eventDepends&&(this.ruleForm.eventDepends=JSON.parse(t.eventDepends)),t.workflowId&&(this.isWorkflow=!0),this.isMatched=!0,this.targetTableExit();case 49:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),refreshTable:function(){var e=j(M().mark((function e(t){var n,r,a,o,i=this;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("more"!==t){e.next=5;break}n=JSON.parse(JSON.stringify(this.initMoreInputColumns)),n.map(function(){var e=j(M().mark((function e(t,r){var a,o,s;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i.moreInputColumns[r].addColumns=[],i.moreInputColumns[r].inputColumns=[],i.moreInputLoadingArr[r]=!0,e.next=5,i.changeSourceTable(t.name,r);case 5:i.moreInputLoadingArr[r]=!1,a=i.moreInputColumns[r].inputColumns,o=!0,s=n[r].inputColumns.map((function(e,t){var n=a.findIndex((function(t){return t.name===e.name}));-1===n&&(o=!1);var r={name:e.name,data_type:e.data_type?e.data_type:e.dataType,comment:e.comment};return e.funcs&&(r.funcs=e.funcs),r})),a.map((function(e,t){var n=s.findIndex((function(t){return t.name===e.name}));n>-1?e.data_type!==s[n].data_type&&(e.isTypeChange=!0):(e.isNameChange=!0,o&&i.moreInputColumns[r].addColumns.push(P(P({},e),i.regColumItem(e))))})),i.formatColumns({index:r});case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),e.next=23;break;case 5:return this.singleTableSelect=[],this.selectItemShow=!1,this.addColumns=[],this.inputColumns=[],this.inputColumnsLoading=!0,this.columnsLoading=!0,e.next=13,Object(C["y"])({region:this.configForm.sourceRegion,type:this.configForm.sourceType,actorId:this.configForm.sourceId,db:this.configForm.sourceDb,table:this.configForm.sourceTable,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive"});case 13:return e.next=15,e.sent.data.columns;case 15:r=e.sent,this.configForm.sourceTable!==this.initTable&&(this.columnsArr=[],this.columns=r.map((function(e){i.columnsArr.push(P(P({},e),i.regColumItem(e)))}))),this.inputColumnsLoading=!1,this.columnsLoading=!1,a=!0,o=this.columnsArr.map((function(e,t){var n=r.findIndex((function(t){return t.name===e.name}));-1===n&&(a=!1);var o={name:e.name,data_type:e.data_type?e.data_type:e.dataType,comment:e.comment};return e.funcs&&(o.funcs=e.funcs),o})),r.map((function(e,t){var n=o.findIndex((function(t){return t.name===e.name}));n>-1?e.data_type!==o[n].data_type&&(e.isTypeChange=!0):(e.isNameChange=!0,a&&i.addColumns.push(P(P({},e),i.regColumItem(e)))),i.inputColumns.push(e)})),this.formatColumns({});case 23:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),formatOriginLabel:function(){var e="";switch(this.configForm.sourceType){case"mysql":e="MySQL";break;case"oracle":e="Oracle";break;case"sqlserver":e="SQL Server";break;case"doris":e="Doris";break;case"postgres":e="Postgres";break;case"mongodb":e="MongoDB";break;case"hana":e="Hana";break}return e},getLocation:function(){var e="/";this.configForm.partitions.map((function(t){t.name&&(e+=t.name+"="+t.value+"/")})),e=e.substring(0,e.length-1),this.taskParam.location="/stage/".concat(this.userGroupName,"/").concat(this.configForm.targetTable).concat(e)},modeChange:function(e){this.runModeShow="local"!==e},deletePartitions:function(e){this.configForm.partitions.splice(e,1)},addPartitions:function(){this.configForm.partitions.push({value:"",name:""})},targetTableExit:function(){var e=this;Object(C["y"])({db:this.configForm.targetDb,table:this.configForm.targetTable,metaFlag:"AIRBYTE",region:this.configForm.sourceRegion,type:"hive",templateCode:"Mysql2Hive",judgeTable:!0}).then((function(t){e.isTargetTableExit=t.data.isTalbeExist}))},changeLakeHouseDb:function(e){var t=this;Object(C["y"])({region:this.configForm.sourceRegion,type:"hive",db:e,metaFlag:"AIRBYTE",templateCode:"Hive2Doris"}).then((function(e){var n=e.data;n.data&&(t.targetTableList=n.data)}))},changeDataOrigin:function(e){this.changeRegion(this.configForm.sourceRegion),this.isEdit&&this.targetTableExit()},deleteTableItem:function(e){var t={label:this.inputColumns[e].name,value:JSON.stringify([this.inputColumns[e],this.columns[e]])};this.singleTableSelect.push(t),this.inputColumns.splice(e,1),this.columns.splice(e,1)},addTableItem:function(){this.selectItemShow=!0,this.tableAddItem=""},selectTableItem:function(e){this.inputColumns.push(JSON.parse(e)[0]),this.columns.push(JSON.parse(e)[1]);var t=this.singleTableSelect.findIndex((function(t){return t.value===e}));this.singleTableSelect.splice(t,1),this.selectItemShow=!1},selectable:function(){return!this.disabled},searchMoreTable:function(){var e=this;this.moreInputColumns=this.initMoreInputColumns.filter((function(t){return!e.moretableName||-1!==t.name.indexOf(e.moretableName)}))},selectMoreTable:function(e){this.moreTableList=e},expandChange:function(e,t){var n=t.some((function(t){if(t&&e)return t.name===e.name})),r=this.moreInputColumns.findIndex((function(t){if(t&&e)return t.name===e.name}));n&&!this.moreInputColumns[r].inputColumns&&this.changeSourceTable(e.name,r)},syncTypeChange:function(){this.ruleForm.isLakeHouseReal=this.seniorFormSql.isLakeHouseReal=2===this.configForm.syncType},switchLiveTable:function(){this.isLiveTable=!this.isLiveTable,this.configForm.sourceTable=""},changeLiveTable:function(){var e=j(M().mark((function e(){var t=this;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:Object(C["K"])({content:this.configForm.sourceTable}).then((function(e){t.configForm.sourceId&&t.changeSourceTable(e.data).then((function(e){e.length||t.$message({type:"warning",message:'未能获取到该动态表的schema信息，可能导致任务读数失败，请检查"MySQL表名"输入项。'})}))}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),typeChange:function(e){this.ruleForm.isLakeHouseMore="more"===this.configForm.table_type,e||(this.configForm.sourceId="",this.configForm.targetTable="",this.configForm.targetTable="",this.changeSourceName()),this.ruleForm.isLakeHouseMore&&(this.ruleForm.outputDataset=[{}],this.configForm.syncType=1,this.syncTypeChange())},changeTargetTable:function(e){var t=this;"single"===e?(this.getLocation(),this.hasTableName=this.sourceTableList.some((function(e){return t.configForm.targetTable===e.name})),this.autoCreateTable||Object(C["y"])({region:this.configForm.sourceRegion,type:"hive",db:this.configForm.targetDb,table:this.configForm.targetTable,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive"}).then((function(e){var n="";n=e.data.partitionKeys&&e.data.partitionKeys.length?e.data.partitionKeys[0].name:"",t.configForm.partitions=[{name:"",value:""}],t.$set(t.configForm.partitions,0,{name:n,value:""})}))):(this.moreInputColumns.forEach((function(e){e.preMoreTableName=(t.configForm.targetTablePart+e.name).toLowerCase()})),this.initMoreInputColumns.forEach((function(e){e.preMoreTableName=(t.configForm.targetTablePart+e.name).toLowerCase()}))),this.$forceUpdate()},handelInfo:function(e,t){this.infoObj.type=!0,this.infoObj.msgType=e,this.infoObj.title=t},handelStep:function(e){e<1?this.$router.push("/task/step1"):this.currentStep=e},formatType:function(e){var t=e.toLowerCase().split(" ")[0];return"bigint"===t||"bigserial"===t||"integer"===t||"smallint"===t||"serial"===t||"int"===t||"numberic"===t?"Bigint":"boolean"===t?"Boolean":"String"},regColumItem:function(e){var t=this;return{columnName:e.name.toLowerCase(),columnType:this.typeList.find((function(n){return n===t.formatType(e.data_type)})),columnComment:e.comment,securityLevel:"1级"}},formatColumns:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"refresh"===t.type||(this.columns=this.inputColumns.map((function(t){return e.regColumItem(t)}))),void 0!==t.index&&(this.moreInputColumns[t.index].columns=this.columns,this.$refs.moreInputColumns.toggleRowExpansion(),this.$nextTick((function(){e.$refs.moreInputColumns.toggleRowExpansion()})))},changeRegion:function(){var e=j(M().mark((function e(t,n){var r;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isEdit&&this.targetTableExit(),n||(this.configForm.sourceId="",this.configForm.sourceDb="",this.configForm.sourceTable="",this.configForm.targetTable="",this.sourceTableList=[],this.moreInputColumns=[],this.inputColumns=[],this.configForm.splitPk="",this.columns=[]),!t){e.next=18;break}return this.formLoading=!0,this.targetDbList=[],this.dataSourceList=[],this.sourceLoad=!0,this.tdbLoad=!0,e.next=10,Object(C["y"])({region:t,type:this.configForm.sourceType,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive"});case 10:return e.next=12,e.sent.data;case 12:r=e.sent,this.dataSourceList=r.data||[],this.formLoading=!1,this.sourceLoad=!1,this.tdbLoad=!1,this.getDestinationId();case 18:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),getDestinationId:function(){var e=this,t={pageNum:1,pageSize:10,sourceName:"iceberg",region:this.configForm.sourceRegion,sortKey:"createTime",sortOrder:"desc"};Object(C["N"])(t).then((function(t){e.destinationList=t.data.list,e.configForm.destinationId=e.destinationList[0].sourceId}))},changeSourceName:function(e,t){var n=this;if(t||(this.configForm.sourceDb="",this.configForm.sourceTable="",this.moreInputColumns=[],this.inputColumns=[],this.configForm.splitPk="",this.columns=[]),e){this.dataSourceList.forEach((function(t){t.actorId===e&&(n.userGroupName=t.userGroupName)})),this.getLocation();var r=this.dataSourceList.find((function(t){return t.actorId===e}));r&&r.parameters&&(this.configForm.connectionUrl=r.parameters.url,this.configForm.dbUser=r.parameters.username,this.configForm.dbPassword=r.parameters.password),this.configForm.sourceDb=r.db,this.formLoading=!0,this.sourceTableList=[],this.tableLoad=!0,this.moreInputColumnsLoading=!0,Object(C["y"])({region:this.configForm.sourceRegion,type:this.configForm.sourceType,actorId:this.configForm.sourceId,db:this.configForm.sourceDb,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive"}).then((function(e){n.moreInputColumnsLoading=!1;var r=e.data;t||(n.moreInputColumns=r.data,n.initMoreInputColumns=JSON.parse(JSON.stringify(n.moreInputColumns)),n.ruleForm.inputDataset=n.initInputDataset,n.ruleForm.outputDataset=n.initOutputDataset),n.changeTargetTable(n.configForm.table_type),n.sourceTableList=r.data,n.formLoading=!1,n.tableLoad=!1}))}},changeSourceTable:function(){var e=j(M().mark((function e(t,n){var r,a=this;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.isMatched=!1,!t){e.next=11;break}return this.configForm.targetTable="stage_".concat(this.configForm.sourceDb,"_").concat(this.configForm.sourceTable,"_df").toLowerCase(),this.getLocation(),r=this.sourceTableList.find((function(e){return e.name===a.configForm.sourceTable})),r&&(this.ruleForm.inputDataset[0].id=r.qualifiedName,this.ruleForm.inputDataset[0].guid=r.guid),void 0!==n&&this.$set(this.moreInputLoadingArr,n,!0),this.inputColumnsLoading=!0,e.next=10,Object(C["y"])({region:this.configForm.sourceRegion,type:this.configForm.sourceType,actorId:this.configForm.sourceId,db:this.configForm.sourceDb,table:t,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive"}).then((function(e){var t=e.data;t.columns&&(a.inputColumns=t.columns.map((function(e){return e.isPK&&(a.primaryKey=e.name),{name:e.name,data_type:e.data_type,comment:e.comment,isPK:e.isPK}})),void 0!==n&&(a.moreInputColumns[n].inputColumns=a.inputColumns,a.moreInputColumns[n].primaryKey=a.primaryKey,a.$set(a.moreInputLoadingArr,n,!1)),a.formatColumns({index:n})),a.inputColumnsLoading=!1})).catch((function(){}));case 10:return e.abrupt("return",Promise.resolve(this.inputColumns));case 11:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}(),save:function(e,t){this.$set(this.inputColumns[t],"funcs",e)},isShowTooltip:function(e){var t=e.target.clientWidth,n=e.target.scrollWidth;this.isTipDisabled=!(n>t)},preStep:function(){1===this.currentStep?this.$router.push("/task/step1"):this.currentStep--},getPreviewData:function(e,t){var n=this;this.previewData=[],Object(C["L"])({type:this.configForm.sourceType,metaFlag:"AIRBYTE",templateCode:"Mysql2Hive",region:this.configForm.sourceRegion,actorId:this.configForm.sourceId,db:this.configForm.sourceDb,table:e||this.configForm.sourceTable}).then(function(){var r=j(M().mark((function r(a){var o;return M().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n.previewVisible=!0,n.previewTable=e||n.configForm.sourceTable,e){r.next=6;break}o=n.inputColumns,r.next=13;break;case 6:if(!n.moreInputColumns[t].inputColumns){r.next=10;break}o=n.moreInputColumns[t].inputColumns,r.next=13;break;case 10:return r.next=12,n.changeSourceTable(e,t);case 12:o=n.moreInputColumns[t].inputColumns;case 13:a.data.results.map((function(e){for(var t in e)e[t.toLowerCase()]=e[t];var r={};o.map((function(t){r[t.name]=e[t.name]})),n.previewData.push(r)}));case 14:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())},localToParams:function(e){var t=this,n=JSON.parse(JSON.stringify(e)),r={isNewFormat:!0,sourceRegion:this.configForm.sourceRegion,executeMode:this.configForm.executeMode,sourceType:this.configForm.sourceType,sourceId:this.configForm.sourceId,destinationType:"iceberg",destinationId:this.configForm.destinationId,taskParam:this.taskParam,catalog:{table_type:this.configForm.table_type,sync_mode:this.configForm.syncType,sourceDb:this.configForm.sourceDb,targetDb:this.configForm.targetDb,tables:this.tables},advancedParameters:1===this.configForm.syncType?this.seniorForm:this.seniorFormSql.runtimeConfig,alertModel:this.seniorForm.alertModel,regularAlert:this.seniorForm.regularAlert,cost:this.ruleForm.cost};return n.runtimeConfig=r,n.folderId=this.$route.query.folderId,n.runtimeConfig.regularAlert.isChecked||delete n.runtimeConfig.regularAlert,Object.keys(n.runtimeConfig.alertModel).forEach((function(e){n.runtimeConfig.alertModel[e].isChecked||(n.runtimeConfig.alertModel[e]=t.initAlertModel)})),n.outputDataset[0].check||(n.outputDataset[0].fileName="",n.outputDataset[0].location=""),n.outputDataset[0].id||delete n.outputDataset[0].id,n},nextStep:function(){var e=j(M().mark((function e(t){var n,r,a,o,i,s=this;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.seniorForm.owner=this.$store.getters.userInfo.userId,1!==this.currentStep){e.next=8;break}if(!("more"===this.configForm.table_type&&this.moreTableList.length<2)){e.next=5;break}return this.$message({type:"warning",message:"至少选择2项表映射"}),e.abrupt("return");case 5:this.$refs.ruleForm.validate((function(e){if(e){s.copyId||(s.ruleForm.name="imp_".concat(s.configForm.targetTable));var t="";s.configForm.partitions.map((function(e){var n=e.name?e.name+"="+e.value:"";t+=n+","})),t=t.substring(0,t.length-1),"single"===s.configForm.table_type?(s.ruleForm.inputDataset[0].metadata={region:s.configForm.sourceRegion,type:s.configForm.sourceType,source:s.configForm.sourceId,db:s.configForm.sourceDb,table:s.configForm.sourceTable},s.ruleForm.inputDataset[0].id="",s.ruleForm.outputDataset[0].metadata={region:s.configForm.sourceRegion,type:"hive",source:"",db:s.configForm.targetDb,table:s.configForm.targetTable},s.ruleForm.outputDataset[0].id="",s.tables=[{dynamicTable:s.isLiveTable,autoCreateTable:s.autoCreateTable,sourceTable:s.configForm.sourceTable,partitions:t,targetTable:s.configForm.targetTable,targetTablePart:s.configForm.targetTablePart,existTargetTable:s.configForm.existTargetTable,filterStr:s.configForm.filterStr,splitPk:s.configForm.splitPk,columns:s.columns.map((function(e,t){return P(P({},s.inputColumns[t]),e)})),primaryKey:s.primaryKey,addColumns:s.addColumns}]):(s.tables=[],s.ruleForm.inputDataset=[{metadata:{region:"",type:s.configForm.sourceType,source:"",db:"",table:""},guid:"",id:"",granularity:"daily",unitOffset:0,ready_time:"0 0 * * *",useDateCalcuParam:!1,dateCalculationParam:{}}],s.moreTableList.map(function(){var e=j(M().mark((function e(n,r){var a,o;return M().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r>0?(a=JSON.parse(JSON.stringify(s.ruleForm.inputDataset[0])),a.metadata.table=n.name,a.metadata.region=s.configForm.sourceRegion,a.metadata.source=s.configForm.sourceId,a.metadata.db=s.configForm.sourceDb,s.ruleForm.inputDataset.push(a)):(s.ruleForm.inputDataset[0].metadata.table=n.name,s.ruleForm.inputDataset[0].metadata.db=s.configForm.sourceDb,s.ruleForm.inputDataset[0].metadata.region=s.configForm.sourceRegion,s.ruleForm.inputDataset[0].metadata.source=s.configForm.sourceId),o=s.moreInputColumns.findIndex((function(e){return e.name===n.name})),n.columns){e.next=5;break}return e.next=5,s.changeSourceTable(n.name,o);case 5:s.tables.push({sourceTable:n.name,partitions:t,targetTable:(s.configForm.targetTablePart+n.name).toLowerCase(),targetTablePart:s.configForm.targetTablePart,existTargetTable:s.configForm.existTargetTable,primaryKey:n.primaryKey,addColumns:s.moreInputColumns[o].addColumns,columns:s.moreInputColumns[o].columns.map((function(e,t){return P(P({},s.moreInputColumns[o].inputColumns[t]),e)}))});case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),s.ruleForm.inputDataset.length>1&&(s.ruleForm.inputDataset=s.ruleForm.inputDataset.filter((function(e){return s.moreTableList.findIndex((function(t){return t.name===e.metadata.table}))>=0}))),s.configForm.targetTable=s.configForm.targetTablePart+s.moreTableList.slice(-1)[0].name),s.currentStep++}})),e.next=31;break;case 8:if(2!==this.currentStep||"task"!==this.source){e.next=12;break}this.$refs.stepThree.$refs.ruleForm.validate((function(e){e&&s.$refs.stepThree.validateType()&&(s.currentStep++,s.$nextTick((function(){document.documentElement.scrollTo(0,0)})))})),e.next=31;break;case 12:if(n=0,this.ruleForm.cost.forEach((function(e){n+=parseInt(e.value)})),100===n){e.next=17;break}return this.$message.error("成本归属占比总额必须是100哦"),e.abrupt("return",!1);case 17:if(r=!1,this.ruleForm.dependTypes.includes("event")&&0===this.ruleForm.eventDepends.length&&(r=!0,this.$message.warning("请至少添加一条内部依赖")),!r){e.next=21;break}return e.abrupt("return");case 21:this.seniorForm.source||(this.seniorForm.source=this.source),a=this.targetDbList.some((function(e){return e.name===s.configForm.targetDb})),a||(this.configForm.exitDatabase=!1),o={},1===this.configForm.syncType?(this.ruleForm.outputDataset[0].check||"more"!==this.configForm.table_type||(this.ruleForm.outputDataset=[{}]),o=P({},w["b"](this.ruleForm))):o=P(P({},w["b"](this.ruleForm)),{},{oldAlertList:this.seniorFormSql.oldAlertList,isLakeHouseReal:this.seniorFormSql.isLakeHouseReal,displayDependJars:this.seniorFormSql.displayDependJars,flinkClusterId:this.seniorFormSql.flinkClusterId}),delete o.cost,o.inputDataset.forEach((function(e){e.granularityList&&delete e.granularityList,e.checkPathList&&delete e.checkPathList})),this.queryId&&(o.id=this.queryId),i=this.localToParams(o),this.$refs.validParams.show(i);case 31:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},A=$,R=(n("feb7"),Object(f["a"])(A,r,a,!1,null,"386ab740",null));t["default"]=R.exports},c8e3:function(e,t,n){},feb7:function(e,t,n){"use strict";n("a95f")}}]);