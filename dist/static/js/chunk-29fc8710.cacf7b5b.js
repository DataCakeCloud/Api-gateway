(window["webpackJsonp_datastudio-web"]=window["webpackJsonp_datastudio-web"]||[]).push([["chunk-29fc8710"],{"0298":function(e,t,a){},"4b52":function(e,t,a){"use strict";a("0298")},6322:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"box-card-container"},[a("el-form",{attrs:{inline:!0,model:e.params,"label-position":"top","label-width":"80px"}},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("div",[a("el-form-item",{attrs:{prop:"id"}},[a("el-input",{attrs:{placeholder:"请输入监控ID",clearable:""},model:{value:e.params.id,callback:function(t){e.$set(e.params,"id",t)},expression:"params.id"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"dataTable"}},[a("el-input",{attrs:{placeholder:"请输入表名称",clearable:""},model:{value:e.params.dataTable,callback:function(t){e.$set(e.params,"dataTable",t)},expression:"params.dataTable"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"createBy"}},[a("el-input",{attrs:{placeholder:"请输入负责人",clearable:""},model:{value:e.params.createBy,callback:function(t){e.$set(e.params,"createBy",t)},expression:"params.createBy"}})],1),e._v(" "),a("el-form-item",{attrs:{prop:"status"}},[a("el-select",{attrs:{clearable:!0,placeholder:"请选择监控状态"},model:{value:e.params.status,callback:function(t){e.$set(e.params,"status",t)},expression:"params.status"}},[e._l(e.statusList,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.name,value:e.value}})]}))],2)],1),e._v(" "),a("el-form-item",{attrs:{prop:"ruleType"}},[a("el-select",{attrs:{clearable:!0,placeholder:"请选择规则类别"},model:{value:e.params.ruleType,callback:function(t){e.$set(e.params,"ruleType",t)},expression:"params.ruleType"}},[e._l(e.ruleTypeList,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.name,value:e.value}})]}))],2)],1),e._v(" "),a("el-form-item",{attrs:{prop:"active"}},[a("el-select",{attrs:{clearable:!0,placeholder:"请选择启停状态"},model:{value:e.params.active,callback:function(t){e.$set(e.params,"active",t)},expression:"params.active"}},[e._l(e.activeList,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.name,value:e.value}})]}))],2)],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:e.handleReset}},[e._v("重置")])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("确定")])],1)],1),e._v(" "),a("div",[a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增监控")])],1)],1)])],1),e._v(" "),e.body.length||e.loading?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("el-table",{ref:"reportTable",attrs:{data:e.body,height:"calc(100vh - 250px)","highlight-current-row":"",border:""}},[a("el-table-column",{attrs:{label:"ID",align:"center",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.metricInfo.id)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"监控名称",align:"left","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{slot:"label",effect:"dark",content:t.row.metricInfo.name,placement:"right"},slot:"label"},[a("div",{staticClass:"cell-ellipsis",attrs:{title:"点击可复制"},on:{click:function(a){return e.handleCopy(t.row.metricInfo.name)}}},[e._v(e._s(t.row.metricInfo.name))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"表",align:"center","min-width":"270"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{staticClass:"cell-ellipsis",attrs:{href:"javascript:;"},on:{click:function(a){return e.handleConfig(t.row)}}},[e._v(e._s(t.row.metricInfo.dataTable))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数据源",align:"center","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.metricInfo.sourceType+"/"+t.row.metricInfo.dataSet+"@"+t.row.metricInfo.dataRegion)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"监控状态",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.statusList.find((function(e){return e.value===t.row.status}))["name"])+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"规则模板ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{domProps:{innerHTML:e._s(e.getRuleIds(t.row))}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"监控周期",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(0===t.row.metricInfo.checkInterval?"天":"小时")+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"基线时间",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.metricInfo.checkTime)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"最近开始时间-最近结束时间",align:"center","min-width":"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.lastCheckStartTime)+" - "+e._s(t.row.lastCheckFinishTime)+" ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"监控owner",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.metricInfo.ownerName)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDqcReport(t.row)}}},[e._v("监控报告")]),e._v(" "),0===t.row.metricInfo.active?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleOpenClose(t.row)}}},[e._v("开启")]):e._e(),e._v(" "),1===t.row.metricInfo.active?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleOpenClose(t.row)}}},[e._v("关闭")]):e._e(),e._v(" "),a("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定删除吗？"},on:{confirm:function(a){return e.handleDelete(t.row)}}},[a("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.params.pageNo,"page-sizes":[10,20,30,40],"page-size":e.params.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1):a("el-empty",{attrs:{description:"无报表数据"}}),e._v(" "),a("Report",{attrs:{visible:e.reportVisible,"report-data":e.reportData},on:{"update:visible":function(t){e.reportVisible=t}}})],1)},r=[],l=a("a211"),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"监控报告",visible:e.visible,width:"60%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisiable=t}}},[void 0!==e.report.status?a("el-tag",{staticStyle:{"margin-bottom":"20px"},attrs:{effect:"dark"}},[e._v(e._s(e.statusList.find((function(t){return t.value===e.report.status}))["name"]))]):e._e(),e._v(" "),void 0!==e.report.ruleResultList?a("el-tabs",{staticClass:"box-tab",attrs:{type:"border-card"}},[a("el-tab-pane",{attrs:{label:"监控条件"}},[e.report.ruleResultList.length?[e._l(e.report.ruleResultList,(function(t,n){return[a("el-card",{key:"detail_"+n},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(e._s("条件"+(n+1)))])]),e._v(" "),a("el-descriptions",{attrs:{column:2}},[a("el-descriptions-item",{attrs:{label:"规则模板"}},[e._v(e._s(t.typeName))]),e._v(" "),a("el-descriptions-item",{attrs:{label:"模板名称"}},[e._v(e._s(t.lastRuleResult.name))]),e._v(" "),"NUMBER"===t.lastRuleResult.checkType?a("el-descriptions-item",{attrs:{label:"监控字段"}},[e._v(e._s(t.fieldName))]):e._e(),e._v(" "),a("el-descriptions-item",{attrs:{label:"sql表达段"}},[e._v(e._s(t.lastRuleResult.sqlStatement))]),e._v(" "),a("el-descriptions-item",{attrs:{label:"校验类型"}},[e._v(e._s(t.typeName))]),e._v(" "),a("el-descriptions-item",{attrs:{label:"校验方式"}},[e._v(e._s(t.actionTypeName))]),e._v(" "),a("el-descriptions-item",{attrs:{label:"比较方式"}},[e._v(e._s(t.operatorName))]),e._v(" "),"NUMBER"===t.lastRuleResult.checkType?a("el-descriptions-item",{attrs:{label:"阈值"}},[e._v(e._s(t.fixedValue))]):e._e(),e._v(" "),"RATIO"===t.lastRuleResult.checkType?a("el-descriptions-item",{attrs:{label:"橙色阈值"}},[e._v(e._s(t.minValue+"%"))]):e._e(),e._v(" "),"RATIO"===t.lastRuleResult.checkType?a("el-descriptions-item",{attrs:{label:"红色阈值"}},[e._v(e._s(t.maxValue+"%"))]):e._e()],1)],1),e._v(" "),void 0!==t.operators?[n<e.report.ruleResultList.length-1?a("el-tag",{key:"tag_"+n,staticStyle:{position:"relative",left:"-30px",margin:"10px 0"},attrs:{type:"info",effect:"plain"}},[e._v(e._s(t.operators))]):e._e()]:e._e()]}))]:[a("el-empty",{attrs:{description:"无监控报告"}})]],2)],1):e._e(),e._v(" "),e._l(e.report.ruleResultList,(function(t,n){return[a("div",{key:"chart_"+n},[a("div",{staticClass:"chart",attrs:{id:"report_"+n+"_chart"}}),e._v(" "),n!==e.report.ruleResultList.length-1?a("el-divider"):e._e()],1)]})),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("关闭")])],1)],2)},s=[],o=a("ed08"),c=a("22b4"),u=a("1be7"),p=a("9394"),d=a("3094"),m=a("2da7"),f=a("4b2a"),h=a("ff32"),v=a("3620"),b=a("c55a"),_=a("f95e");c["a"]([p["a"],d["a"],m["a"],f["a"],h["a"],v["a"],_["a"],b["a"]]);var g={name:"Report",props:{reportData:{type:Object,default:function(){}},visible:{type:Boolean,required:!0}},data:function(){return{report:{},loading:!1,dialogVisiable:this.visible,statusList:this.$t("dqc.statusList"),ruleTypeList:this.$t("dqc.ruleTypeList"),checkTypeList:this.$t("dqc.checkTypeList"),checkActionLists:this.$t("dqc.checkActionList"),checkOperatorLists:this.$t("dqc.checkOperatorList"),ruleOperatorsList:this.$t("dqc.ruleOperatorsList"),option:{title:{text:""},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:[]}],yAxis:[{type:"value"}],series:[{name:"",type:"line",symbol:"none",stack:"Total",smooth:!0,emphasis:{focus:"series"},data:[]}]}}},watch:{visible:function(){this.dialogVisiable=this.visible,this.dialogVisiable&&this.metricReport()},dialogVisiable:function(e){this.$emit("update:visible",e)}},methods:{render:function(){var e=this;this.report.ruleResultList.forEach((function(t,a){var n=document.getElementById("report_".concat(a,"_chart")),r=u["b"](n),l=JSON.parse(JSON.stringify(e.option));l.title.text="NUMBER"===t.lastRuleResult.checkType?"指标最近波动图-".concat(t.lastRuleResult.name,"-").concat(t.fieldName,"-").concat(a):"指标最近波动图-".concat(t.lastRuleResult.name),l.series[0].data=t.yAxisData,0===e.report.checkInterval?l.xAxis[0].data=t.xAxisData.map((function(e){var t=Object(o["parseTime"])(e,"{y}/{m}/{d}");return t})):l.xAxis[0].data=t.xAxisData.map((function(e){var t=Object(o["parseTime"])(e,"{h}:{i}");return t})),r.setOption(l,!0)}))},metricReport:function(){var e=this;this.loading=!0,this.report={},Object(l["f"])({id:this.reportData.id}).then((function(t){if(e.loading=!1,0===t.resultCode){var a=t.data;a.ruleResultList.map((function(t,n){var r=t.lastRuleResult,l=e.checkActionLists[r.checkType],i=e.checkOperatorLists[r.checkType],s=e.checkTypeList.find((function(e){return e.value===r.checkType}))["name"],o=l.find((function(e){return e.value===r.checkAction}))["name"],c=i.find((function(e){return e.value===r.checkOperator}))["name"],u="".concat(s,"-").concat(o),p=r.checkValue?JSON.parse(r.checkValue):"",d=p.fixedValue,m=p.min,f=p.max,h=-1!==r.params.indexOf("{")?JSON.parse(r.params):[],v=h.length&&h.map((function(e,t){return e.tableField})).join(", ")||"";return t.typeName=s,t.actionTypeName=u,t.operatorName=c,d?t.fixedValue=d:(t.minValue=m,t.maxValue=f),t.fieldName=v,n<a.ruleResultList.length-1&&(t.operators=e.ruleOperatorsList.find((function(e){return e.value===a.ruleOperators[n]}))["name"]),t})),e.report=a,e.$nextTick((function(t){e.render()}))}else e.$message({type:"error",message:t.msg||"服务端错误"})}))},cancel:function(){this.$emit("update:visible",!1)}}},y=g,k=(a("4b52"),a("2877")),x=Object(k["a"])(y,i,s,!1,null,"ff755196",null),w=x.exports,R=a("f904"),T=a.n(R),L={name:"DqcList",components:{Report:w},data:function(){return{loading:!1,reportVisible:!1,reportData:{},body:[],defaultParams:{id:null,dataTable:null,createBy:null,status:null,ruleType:null,active:null,pageNo:1,pageSize:10},params:{id:null,dataTable:null,createBy:null,status:null,ruleType:null,active:null,pageNo:1,pageSize:10},total:0,statusList:this.$t("dqc.statusList"),ruleTypeList:this.$t("dqc.ruleTypeList"),activeList:this.$t("dqc.activeList")}},created:function(){this.handleSearch()},methods:{MetricPages:function(e){var t=this;this.loading=!0,Object(l["e"])(e).then((function(e){if(t.loading=!1,0===e.resultCode){var a=e.data;t.body=a.list,t.params.pageNo=a.pageNum,t.params.pageSize=a.pageSize,t.total=a.total}else t.$message({type:"error",message:e.msg||"服务端错误"})}))},handleCopy:function(e){T()(e,{format:"text/plain"}),this.$message({type:"success",message:"任务名称已复制到剪贴板"})},handleSizeChange:function(e){this.params.pageSize=e,this.handleSearch()},handleCurrentChange:function(e){this.params.pageNo=e,this.handleSearch()},handleReset:function(){this.params=Object.assign({},this.defaultParams),this.handleSearch()},handleSearch:function(){var e=Object.assign({},this.params);this.MetricPages(e)},handleAdd:function(){this.$router.push({name:"DqcConfig"})},handleConfig:function(e){this.$router.push({name:"DqcConfig",query:{id:e.metricInfo.id}})},getRuleIds:function(e){var t=e.templateIds,a=t.map((function(e){return'<a href="/monitor/ruleModel?id='.concat(e,'">').concat(e,"</a>")})).join(", ");return a},handleDelete:function(e){var t=this;Object(l["c"])({id:e.metricInfo.id}).then((function(e){0===e.resultCode?(t.$message({type:"success",message:"删除成功"}),t.handleSearch()):t.$message({type:"error",message:e.msg||"服务端错误"})}))},handleDqcReport:function(e){this.reportVisible=!0,this.reportData=e.metricInfo},handleOpenClose:function(e){var t=this,a=e.metricInfo.active,n=e.metricInfo.id,r=0===a?1:0;Object(l["a"])({id:n,active:r}).then((function(e){0===e.resultCode?(t.$message({type:"success",message:"".concat(0===r?"关闭":"开启","成功")}),t.handleSearch()):t.$message({type:"error",message:e.msg||"服务端错误"})}))}}},S=L,I=Object(k["a"])(S,n,r,!1,null,null,null);t["default"]=I.exports},a211:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"g",(function(){return s})),a.d(t,"d",(function(){return o})),a.d(t,"f",(function(){return c})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return p})),a.d(t,"e",(function(){return d})),a.d(t,"h",(function(){return m})),a.d(t,"l",(function(){return f})),a.d(t,"j",(function(){return h})),a.d(t,"i",(function(){return v})),a.d(t,"k",(function(){return b}));var n=a("7258"),r="/sla-service/metric",l="/sla-service/template";function i(e){return n["b"].post("".concat(r,"/add"),e)}function s(e){return n["b"].post("".concat(r,"/update"),e)}function o(e){return n["b"].get("".concat(r,"/info"),{params:e})}function c(e){return n["b"].get("".concat(r,"/report"),{params:e})}function u(e){return n["b"].get("".concat(r,"/active"),{params:e})}function p(e){return n["b"].get("".concat(r,"/delete"),{params:e})}function d(e){return n["b"].get("".concat(r,"/pages"),{params:e})}function m(e){return n["b"].post("".concat(l,"/addItem"),e)}function f(e){return n["b"].post("".concat(l,"/updateItem"),e)}function h(e){return n["b"].get("".concat(l,"/info"),{params:e})}function v(e){return n["b"].get("".concat(l,"/delete"),{params:e})}function b(e){return n["b"].get("".concat(l,"/pages"),{params:e})}}}]);